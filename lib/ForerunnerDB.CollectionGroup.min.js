(function(){var g=function(e){var h=e.prototype.init,g=e.classes.Collection,k=e.classes.Overload,d=function(){this.init.apply(this,arguments)};d.prototype.init=function(a){var b=this;this._name=a;this._collectionArr=[];this._views=[];this._onCollectionInsert=function(){b._onInsert.apply(b,arguments)};this._onCollectionUpdate=function(){b._onUpdate.apply(b,arguments)};this._onCollectionRemove=function(){b._onRemove.apply(b,arguments)};this._onCollectionChange=function(){b._onChange.apply(b,arguments)}};
d.prototype.on=new k([function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(b);return this},function(a,b,c){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][b]=this._listeners[a][b]||[];this._listeners[a][b].push(c);return this}]);d.prototype.off=new k([function(a){this._listeners&&(this._listeners[a]&&a in this._listeners)&&delete this._listeners[a];
return this},function(a,b){var c,d;"string"===typeof b?this._listeners&&(this._listeners[a]&&this._listeners[a][b])&&delete this._listeners[a][b]:a in this._listeners&&(c=this._listeners[a]["*"],d=c.indexOf(b),-1<d&&c.splice(d,1));return this},function(a,b,c){this._listeners&&a in this._listeners&&(a=this._listeners[a][b],c=a.indexOf(c),-1<c&&a.splice(c,1))}]);d.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var c=this._listeners[a]["*"],
d=c.length,f;for(f=0;f<d;f++)c[f].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var c=this._listeners[a],e,g,d=b.length;for(f=0;f<d;f++)if(c[b[f][this._primaryKey]]){e=c[b[f][this._primaryKey]].length;for(g=0;g<e;g++)c[b[f][this._primaryKey]][g].apply(this,Array.prototype.slice.call(arguments,1))}}}return this};d.prototype.db=function(a){return void 0!==a?(this._db=a,this):this._db};d.prototype.addCollection=function(a){if(a&&-1===this._collectionArr.indexOf(a)){if(this._collectionArr.length){if(this._primaryKey!==
a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this._primaryKey=a.primaryKey();this._collectionArr.push(a);a._groups.push(this);a.on("insert",this._onCollectionInsert);a.on("update",this._onCollectionUpdate);a.on("remove",this._onCollectionRemove);a.on("change",this._onCollectionChange)}return this};d.prototype.removeCollection=function(a){if(a){var b=this._collectionArr.indexOf(a);-1!==b&&(a.off("insert",this._onCollectionInsert),a.off("update",
this._onCollectionUpdate),a.off("remove",this._onCollectionRemove),a.off("change",this._onCollectionChange),this._collectionArr.splice(b,1),b=a._groups.indexOf(this),-1!==b&&a._groups.splice(b,1));0===this._collectionArr.length&&delete this._primaryKey}return this};d.prototype.find=function(a,b){var c=(new g).primaryKey(this._collectionArr[0].primaryKey()),d;for(d=0;d<this._collectionArr.length;d++)c.insert(this._collectionArr[d].find(a));return c.find(a,b)};d.prototype.insert=function(a,b){for(var c=
0;c<this._collectionArr.length;c++)this._collectionArr[c].insert(a,b)};d.prototype.update=function(a,b){for(var c=0;c<this._collectionArr.length;c++)this._collectionArr[c].update(a,b)};d.prototype.updateById=function(a,b){for(var c=0;c<this._collectionArr.length;c++)this._collectionArr[c].updateById(a,b)};d.prototype.remove=function(a){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].remove(a)};d.prototype.removeById=function(a){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].removeById(a)};
d.prototype._onInsert=function(a,b){this.emit("insert",a,b)};d.prototype._onUpdate=function(a,b){this.emit("update",a,b)};d.prototype._onRemove=function(a,b){this.emit("remove",a,b)};d.prototype._onChange=function(){this.emit("change")};d.prototype.subset=function(a,b){var c=this.find(a,b);return(new g)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};d.prototype.drop=function(){var a,b=[].concat(this._collectionArr),c=[].concat(this._views);this._debug&&console.log("Dropping collection group "+
this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<c.length;a++)this._removeView(c[a]);this.emit("drop");return!0};e.prototype.init=function(){this._collectionGroup={};h.apply(this,arguments)};e.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new d(a)).db(this),this._collectionGroup[a]):this._collectionGroup};e.classes.CollectionGroup=d};"function"===typeof define&&define.amd?define(["require","../ForerunnerDB"],function(e,
h){return g(h)}):g(ForerunnerDB)})();
