!function(Pa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Pa();else if("function"==typeof define&&define.amd)define([],Pa);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self);f.ForerunnerDB=Pa()}}(function(){return function f(m,k,h){function d(b,a){if(!k[b]){if(!m[b]){var g="function"==typeof require&&require;if(!a&&g)return g(b,!0);if(c)return c(b,!0);g=Error("Cannot find module '"+b+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=k[b]={exports:{}};m[b][0].call(g.exports,function(g){var c=m[b][1][g];return d(c?c:g)},g,g.exports,f,m,k,h)}return k[b].exports}for(var c="function"==typeof require&&require,a=0;a<h.length;a++)d(h[a]);return d}({1:[function(f,m,k){k=f("../lib/Core");f("../lib/CollectionGroup");f("../lib/View");f("../lib/Highcharts");f("../lib/Persist");f("../lib/Document");f("../lib/Overview");f("../lib/vendor/jsviews");m.exports=k},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Document":6,"../lib/Highcharts":7,
"../lib/Overview":12,"../lib/Persist":14,"../lib/View":16,"../lib/vendor/jsviews":17}],2:[function(f,m,k){var h,d,c,a,b;k=f("./Shared");var e=function(g){this.init.apply(this,arguments)};e.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new d("primary");this._primaryCrc=new d("primaryCrc");this._crcLookup=new d("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new h;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold=
{insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};k.addModule("Collection",e);k.inherit(e.prototype,k.chainSystem);h=f("./Metrics");d=f("./KeyValueStore");c=f("./Path");a=f("./Index");b=f("./Crc");f=k.modules.Core;e.prototype.debug=k.common.debug;e.prototype.crc=b;k.synthesize(e.prototype,"name");e.prototype.on=k.common.on;e.prototype.off=k.common.off;e.prototype.emit=k.common.emit;e.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],b;for(b=0;b<this._groups.length;b++)g.push(this._groups[b]);for(b=0;b<g.length;b++)this._groups[b].removeCollection(this);return!0}return!1};e.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};e.prototype._onInsert=function(g,b){this.emit("insert",
g,b)};e.prototype._onUpdate=function(g){this.emit("update",g)};e.prototype._onRemove=function(g){this.emit("remove",g)};k.synthesize(e.prototype,"db");e.prototype.setData=function(g,b,c){if(g){var a=this._metrics.create("setData");a.start();b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;b.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);a.time("transformIn");g=this.transformIn(g);a.time("transformIn");var e=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?
this.insert(g):this._data=this._data.concat(g));a.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(b);a.time("Rebuild Primary Key Index");a.time("Resolve chains");this.chainSend("setData",g,{oldData:e});a.time("Resolve chains");a.stop();this.emit("setData",this._data,e)}c&&c(!1);return this};e.prototype._rebuildPrimaryKeyIndex=function(g){var b=g&&void 0!==g.ensureKeys?g.ensureKeys:!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var a,c,e,d=this._primaryIndex,h=this._primaryCrc,
f=this._crcLookup,k=this._primaryKey,q;d.truncate();h.truncate();f.truncate();a=this._data;for(c=a.length;c--;)if(e=a[c],b&&this._ensurePrimaryKey(e),g){if(!d.uniqueSet(e[k],e))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+e[this._primaryKey];}else q=JSON.stringify(e),d.set(e[k],e),h.set(e[k],q),f.set(q,e)};e.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=
this.objectId())};e.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};e.prototype.upsert=function(g,b){if(g){var a=this._deferQueue.upsert,c=this._deferThreshold.upsert,e={},d;if(g instanceof Array){if(g.length>c){this._deferQueue.upsert=a.concat(g);this.processQueue("upsert",b);return}e=[];for(a=0;a<g.length;a++)e.push(this.upsert(g[a]));b&&b();return e}g[this._primaryKey]?(d={},d[this._primaryKey]=g[this._primaryKey],this.count(d)?
e.op="update":e.op="insert"):e.op="insert";switch(e.op){case "insert":e.result=this.insert(g);break;case "update":e.result=this.update(d,g)}return e}b&&b()};e.prototype.update=function(g,b,a){b=this.decouple(b);b=this.transformIn(b);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var c=this,e=this._metrics.create("update"),d=this._primaryKey,h,f,k=function(e){if(b&&void 0!==b[d]&&b[d]!=e[d]){c._primaryIndex.unSet(e[d]);var h=c._updateObject(e,b,g,a,"");
if(c._primaryIndex.uniqueSet(e[d],e))return h;throw"Primary key violation in update! Key violated: "+e[d];}return c._updateObject(e,b,g,a,"")};e.start();e.time("Retrieve documents to update");h=this.find(g,{$decouple:!1});e.time("Retrieve documents to update");h.length&&(e.time("Update documents"),f=h.filter(k),e.time("Update documents"),f.length&&(e.time("Resolve chains"),this.chainSend("update",{query:g,update:b},a),e.time("Resolve chains"),this._onUpdate(f),this.deferEmit("change",{type:"update",
data:f})));e.stop();return f||[]};e.prototype.updateById=function(g,b){var a={};a[this._primaryKey]=g;return this.update(a,b)};e.prototype._updateObject=function(g,b,a,e,d,h){b=this.decouple(b);d=d||"";"."===d.substr(0,1)&&(d=d.substr(1,d.length-1));var f=!1,k=!1,n,q,p,l;for(l in b)if(b.hasOwnProperty(l)){n=!1;if("$"===l.substr(0,1))switch(l){case "$index":break;default:n=!0,(k=this._updateObject(g,b[l],a,e,d,l))&&(f=!0)}if(this._isPositionalKey(l)&&(n=!0,l=l.substr(0,l.length-2),k=new c(d+"."+l),
g[l]&&g[l]instanceof Array&&g[l].length)){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],k.value(a)[0])&&q.push(p);for(p=0;p<q.length;p++)(k=this._updateObject(g[l][q[p]],b[l+".$"],a,e,d+"."+l,h))&&(f=!0)}if(!n)if(h||"object"!==typeof b[l])switch(h){case "$inc":this._updateIncrement(g,l,b[l]);f=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==b[l].$position&&b[l].$each instanceof Array)for(k=b[l].$position,n=b[l].$each.length,p=0;p<n;p++)this._updateSplicePush(g[l],
k+p,b[l].$each[p]);else if(b[l].$each instanceof Array)for(n=b[l].$each.length,p=0;p<n;p++)this._updatePush(g[l],b[l].$each[p]);else this._updatePush(g[l],b[l]);f=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],b[l])&&q.push(p);for(n=q.length;n--;)this._updatePull(g[l],q[n]),f=!0}break;case "$pullAll":if(g[l]instanceof Array)if(b[l]instanceof Array){if(q=g[l],n=q.length,0<n)for(;n--;){for(k=
0;k<b[l].length;k++)q[n]===b[l][k]&&(this._updatePull(g[l],n),n--,f=!0);if(0>n)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){p=g[l];var m;q=p.length;var F;n=!0;m=e&&e.$addToSet;var aa;m&&m.key?(k=!1,aa=new c(m.key),F=aa.value(b[l])[0]):(F=JSON.stringify(b[l]),k=!0);for(m=0;m<q;m++)if(k){if(JSON.stringify(p[m])===F){n=!1;break}}else if(F===aa.value(p[m])[0]){n=!1;break}n&&(this._updatePush(g[l],
b[l]),f=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(k=b.$index,void 0!==k)delete b.$index,this._updateSplicePush(g[l],k,b[l]),f=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(p=0;p<g[l].length;p++){if(this._match(g[l][p],b[l])){f=b[l].$index;if(void 0!==f)this._updateSpliceMove(g[l],
p,f),f=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,b[l]);f=!0;break;case "$rename":this._updateRename(g,l,b[l]);f=!0;break;case "$unset":this._updateUnset(g,l);f=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],b[l])&&(f=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),f=!0)}else if(null!==
g[l]&&"object"===typeof g[l])if(p=g[l]instanceof Array,q=b[l]instanceof Array,p||q)if(!q&&p)for(p=0;p<g[l].length;p++)(k=this._updateObject(g[l][p],b[l],a,e,d+"."+l,h))&&(f=!0);else g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),f=!0);else(k=this._updateObject(g[l],b[l],a,e,d+"."+l,h))&&(f=!0);else g[l]!==b[l]&&(this._updateProperty(g,l,b[l]),f=!0)}return f};e.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-2,2)};e.prototype._updateProperty=function(g,b,a){this._linked?(jQuery.observable(g).setProperty(b,
a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(g[b]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};e.prototype._updateIncrement=function(g,b,a){this._linked?jQuery.observable(g).setProperty(b,g[b]+a):g[b]+=a};e.prototype._updateSpliceMove=function(g,b,a){this._linked?(jQuery.observable(g).move(b,a),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+
b+'" to "'+a+'" for collection "'+this.name()+'"')):(g.splice(a,0,g.splice(b,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+b+'" to "'+a+'" for collection "'+this.name()+'"'))};e.prototype._updateSplicePush=function(g,b,a){g.length>b?this._linked?jQuery.observable(g).insert(b,a):g.splice(b,0,a):this._linked?jQuery.observable(g).insert(a):g.push(a)};e.prototype._updatePush=function(g,b){this._linked?jQuery.observable(g).insert(b):g.push(b)};
e.prototype._updatePull=function(g,b){this._linked?jQuery.observable(g).remove(b):g.splice(b,1)};e.prototype._updateMultiply=function(g,b,a){this._linked?jQuery.observable(g).setProperty(b,g[b]*a):g[b]*=a};e.prototype._updateRename=function(g,b,a){var c=g[b];this._linked?(jQuery.observable(g).setProperty(a,c),jQuery.observable(g).removeProperty(b)):(g[a]=c,delete g[b])};e.prototype._updateUnset=function(g,b){this._linked?jQuery.observable(g).removeProperty(b):delete g[b]};e.prototype._updatePop=function(g,
b){var a,c=!1;0<g.length&&(this._linked?(1===b?a=g.length-1:-1===b&&(a=0),-1<a&&(jQuery.observable(arr).remove(a),c=!0)):1===b?(g.pop(),c=!0):-1===b&&(g.shift(),c=!0));return c};e.prototype.remove=function(g,b,a){var c,e;if(g instanceof Array){e=[];for(a=0;a<g.length;a++)e.push(this.remove(g[a],{noEmit:!0}));(!b||b&&!b.noEmit)&&this._onRemove(e);return e}a=this.find(g,{$decouple:!1});if(a.length){for(e=0;e<a.length;e++)c=a[e],this._removeIndex(c),c=this._data.indexOf(c),this._linked?jQuery.observable(this._data).remove(c):
this._data.splice(c,1);this.chainSend("remove",{query:g},b);(!b||b&&!b.noEmit)&&this._onRemove(a);this.deferEmit("change",{type:"remove",data:a})}return a};e.prototype.removeById=function(g){var b={};b[this._primaryKey]=g;return this.remove(b)};e.prototype.deferEmit=function(){var b=this,a;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(a=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){b.debug()&&
console.log("ForerunnerDB.Collection: Emitting "+a[0]);b.emit.apply(b,a)},100))};e.prototype.processQueue=function(b,a){var c=this._deferQueue[b],e=this._deferThreshold[b],d=this._deferTime[b];if(c.length){var f=this;c.length&&(c=c.length>e?c.splice(0,e):c.splice(0,c.length),this[b](c));setTimeout(function(){f.processQueue(b,a)},d)}else a&&a()};e.prototype.insert=function(b,a,c){"function"===typeof a?(c=a,a=this._data.length):void 0===a&&(a=this._data.length);b=this.transformIn(b);return this._insertHandle(b,
a,c)};e.prototype._insertHandle=function(b,a,c){var e=this._deferQueue.insert,d=this._deferThreshold.insert,f=[],h=[];if(b instanceof Array){if(b.length>d){this._deferQueue.insert=e.concat(b);this.processQueue("insert",c);return}for(d=0;d<b.length;d++)e=this._insert(b[d],a+d),!0===e?f.push(b[d]):h.push({doc:b[d],reason:e})}else e=this._insert(b,a),!0===e?f.push(b):h.push({doc:b,reason:e});this.chainSend("insert",b,{index:a});this._onInsert(f,h);c&&c();this.deferEmit("change",{type:"insert",data:f});
return{inserted:f,failed:h}};e.prototype._insert=function(b,a){if(b){var c;this._ensurePrimaryKey(b);if(c=this.insertIndexViolation(b))return"Index violation in index: "+c;this._insertIndex(b);this._linked?jQuery.observable(this._data).insert(a,b):this._data.splice(a,0,b);return!0}return"No document passed to insert"};e.prototype._insertIndex=function(b){var a=this._indexByName,c,e=JSON.stringify(b);this._primaryIndex.uniqueSet(b[this._primaryKey],b);this._primaryCrc.uniqueSet(b[this._primaryKey],
e);this._crcLookup.uniqueSet(e,b);for(c in a)a.hasOwnProperty(c)&&a[c].insert(b)};e.prototype._removeIndex=function(b){var a=this._indexByName,c,e=JSON.stringify(b);this._primaryIndex.unSet(b[this._primaryKey]);this._primaryCrc.unSet(b[this._primaryKey]);this._crcLookup.unSet(e);for(c in a)a.hasOwnProperty(c)&&a[c].remove(b)};e.prototype.subset=function(b,a){var c=this.find(b,a);return(new e)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};e.prototype.subsetOf=function(){return this.__subsetOf};
e.prototype._subsetOf=function(b){this.__subsetOf=b;return this};e.prototype.distinct=function(b,a,e){a=this.find(a,e);b=new c(b);e={};var d=[],f,h;for(h=0;h<a.length;h++)(f=b.value(a[h])[0])&&!e[f]&&(e[f]=!0,d.push(f));return d};e.prototype.decouple=k.common.decouple;e.prototype.findById=function(b,a){var c={};c[this._primaryKey]=b;return this.find(c,a)[0]};e.prototype.peek=function(b,a){var c=this._data,d=c.length,f,h,k=new e;if("string"===typeof b){for(f=0;f<d;f++)h=JSON.stringify(c[f]),-1<h.indexOf(b)&&
k.insert(c[f]);return k.find({},a)}return this.find(b,a)};e.prototype.explain=function(b,a){return this.find(b,a).__fdbOp._data};e.prototype.find=function(b,a){b=b||{};a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;var e=this._metrics.create("find"),d=this,f,h=!0,k,A,n,q,p,l,m,F,aa,la=[];A=function(a){return d._match(a,b,"and")};e.start();if(b){e.time("analyseQuery");f=this._analyseQuery(b,a,e);e.time("analyseQuery");e.data("analysis",f);if(f.hasJoin&&f.queriesJoin){e.time("joinReferences");
for(n=0;n<f.joinsOn.length;n++)p=f.joinsOn[n],q=new c(f.joinQueries[p]),q=q.value(b)[0],this._db.collection(f.joinsOn[n]).subset(q);e.time("joinReferences")}f.indexMatch.length&&(!a||a&&!a.$skipIndex)?(e.data("index.potential",f.indexMatch),e.data("index.used",f.indexMatch[0].index),e.time("indexLookup"),k=f.indexMatch[0].lookup,e.time("indexLookup"),f.indexMatch[0].keyData.totalKeyCount===f.indexMatch[0].keyData.matchedKeyCount&&(h=!1)):e.flag("usedIndex",!1);h&&(k&&k.length?(f=k.length,e.time("tableScan: "+
f),k=k.filter(A)):(f=this._data.length,e.time("tableScan: "+f),k=this._data.filter(A)),a.$orderBy&&(e.time("sort"),k=this.sort(a.$orderBy,k),e.time("sort")),e.time("tableScan: "+f));a.limit&&k&&k.length>a.limit&&(k.length=a.limit,e.data("limit",a.limit));a.$decouple&&(e.time("decouple"),k=this.decouple(k),e.time("decouple"),e.data("flag.decouple",!0));if(a.join){for(A=0;A<a.join.length;A++)for(p in a.join[A])if(a.join[A].hasOwnProperty(p))for(F=p,f=this._db.collection(p),h=a.join[A][p],aa=0;aa<k.length;aa++){m=
{};q=n=!1;for(l in h)if(h.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":F=h[l];break;case "$multi":n=h[l];break;case "$require":q=h[l];break;default:l.substr(0,3)}else m[l]=(new c(h[l])).value(k[aa])[0];m=f.find(m);!q||q&&m[0]?k[aa][F]=!1===n?m[0]:m:la.push(k[aa])}e.data("flag.join",!0)}if(la.length){e.time("removalQueue");for(l=0;l<la.length;l++)p=k.indexOf(la[l]),-1<p&&k.splice(p,1);e.time("removalQueue")}if(a.transform){e.time("transform");for(l=0;l<k.length;l++)k.splice(l,1,a.transform(k[l]));
e.time("transform");e.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(e.time("transformOut"),k=this.transformOut(k),e.time("transformOut"));e.data("results",k.length);e.stop()}else e.stop(),k=[];k.__fdbOp=e;return k};e.prototype.indexOf=function(b){if(b=this.find(b,{$decouple:!1})[0])return this._data.indexOf(b)};e.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=
b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.transformIn=function(b){if(this._transformEnabled&&this._transformIn){if(b instanceof Array){var a=[],c;for(c=0;c<b.length;c++)a[c]=this._transformIn(b[c]);return a}return this._transformIn(b)}return b};e.prototype.transformOut=function(b){if(this._transformEnabled&&this._transformOut){if(b instanceof
Array){var a=[],c;for(c=0;c<b.length;c++)a[c]=this._transformOut(b[c]);return a}return this._transformOut(b)}return b};e.prototype.sort=function(b,a){a=a||[];var c=[],e,d;for(e in b)b.hasOwnProperty(e)&&(d={},d[e]=b[e],d.___fdbKey=e,c.push(d));return 2>c.length?this._sort(b,a):this._bucketSort(c,a)};e.prototype._bucketSort=function(b,a){var c=b.shift(),e,d,f=[];if(0<b.length){a=this._sort(c,a);e=this.bucket(c.___fdbKey,a);for(d in e)e.hasOwnProperty(d)&&(c=[].concat(b),f=f.concat(this._bucketSort(c,
e[d])));return f}return this._sort(c,a)};e.prototype._sort=function(b,a){var e=new c,d=e.parse(b,!0)[0];e.path(d.path);return a.sort(1===d.value?function(b,a){var c=e.value(b)[0],g=e.value(a)[0];return"string"===typeof c&&"string"===typeof g?c.localeCompare(g):c>g?1:c<g?-1:0}:function(b,a){var c=e.value(b)[0],g=e.value(a)[0];return"string"===typeof c&&"string"===typeof g?1===c.localeCompare(g)?-1:1:c>g?-1:c<g?1:0})};e.prototype.bucket=function(b,a){var c,e={};for(c=0;c<a.length;c++)e[a[c][b]]=e[a[c][b]]||
[],e[a[c][b]].push(a[c]);return e};e.prototype._analyseQuery=function(b,a,e){var d={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:a},f,h=[],k=[],m,n,q,p,l;e.time("checkIndexes");void 0!==b[this._primaryKey]&&(e.time("checkIndexMatch: Primary Key"),m=new c,d.indexMatch.push({lookup:this._primaryIndex.lookup(b,a),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(b)},index:this._primaryIndex}),e.time("checkIndexMatch: Primary Key"));
for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],q=n.name(),e.time("checkIndexMatch: "+q),m=n.match(b,a),p=n.lookup(b,a),0<m.matchedKeyCount&&d.indexMatch.push({lookup:p,keyData:m,index:n}),e.time("checkIndexMatch: "+q),m.totalKeyCount===m.matchedKeyCount))break;e.time("checkIndexes");1<d.indexMatch.length&&(e.time("findOptimalIndex"),d.indexMatch.sort(function(b,a){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?
1:b.keyData.matchedKeyCount===a.keyData.matchedKeyCount?b.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),e.time("findOptimalIndex"));if(a.join){d.hasJoin=!0;for(e=0;e<a.join.length;e++)for(f in a.join[e])a.join[e].hasOwnProperty(f)&&(h.push(f),"$as"in a.join[e][f]?k.push(a.join[e][f].$as):k.push(f));for(f=0;f<k.length;f++)if(a=this._queryReferencesCollection(b,k[f],""))d.joinQueries[h[f]]=a,d.queriesJoin=!0;d.joinsOn=h;d.queriesOn=d.queriesOn.concat(h)}return d};
e.prototype._queryReferencesCollection=function(b,a,c){for(var e in b)if(b.hasOwnProperty(e)){if(e===a)return c&&(c+="."),c+e;if("object"===typeof b[e])return c&&(c+="."),c+=e,this._queryReferencesCollection(b[e],a,c)}return!1};e.prototype._match=function(b,a,c){var e,d;e=typeof b;d=typeof a;var f=!0,h;if(!("string"!==e&&"number"!==e||"string"!==d&&"number"!==d))b!==a&&(f=!1);else for(h in a)if(a.hasOwnProperty(h)){e=!1;if("$"===h.substr(0,1))switch(h){case "$gt":if(b>a[h]){if("or"===c)return!0}else f=
!1;e=!0;break;case "$gte":if(b>=a[h]){if("or"===c)return!0}else f=!1;e=!0;break;case "$lt":if(b<a[h]){if("or"===c)return!0}else f=!1;e=!0;break;case "$lte":if(b<=a[h]){if("or"===c)return!0}else f=!1;e=!0;break;case "$exists":if(void 0===b!==a[h]){if("or"===c)return!0}else f=!1;e=!0;break;case "$or":e=!0;for(d=0;d<a[h].length;d++){if(this._match(b,a[h][d],"and"))return!0;f=!1}break;case "$and":e=!0;for(d=0;d<a[h].length;d++)if(!this._match(b,a[h][d],"and"))return!1;break;case "$in":if(a[h]instanceof
Array){e=a[h];d=e.length;var k,m=!1;for(k=0;k<d;k++)if(e[k]===b){m=!0;break}if(m){if("or"===c)return!0}else f=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;e=!0;break;case "$nin":if(a[h]instanceof Array){e=a[h];d=e.length;m=!0;for(k=0;k<d;k++)if(e[k]===b){m=!1;break}if(m){if("or"===c)return!0}else f=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;e=!0;break;case "$ne":if(b!=a[h]){if("or"===c)return!0}else f=!1;e=!0}if(!e&&a[h]instanceof RegExp)if(e=!0,"object"===
typeof b&&void 0!==b[h]&&a[h].test(b[h])){if("or"===c)return!0}else f=!1;if(!e)if("object"===typeof a[h])if(void 0!==b[h]){if(b[h]instanceof Array&&!(a[h]instanceof Array))for(e=!1,d=0;d<b[h].length&&!(e=this._match(b[h][d],a[h],void 0));d++);else if(!(b[h]instanceof Array)&&a[h]instanceof Array)for(e=!1,d=0;d<a[h].length&&!(e=this._match(b[h],a[h][d],void 0));d++);else e="object"===typeof b?this._match(b[h],a[h],void 0):this._match(void 0,a[h],void 0);if(e){if("or"===c)return!0}else f=!1}else if(a[h]&&
void 0!==a[h].$exists)if(e=this._match(void 0,a[h],void 0)){if("or"===c)return!0}else f=!1;else f=!1;else if(b&&b[h]===a[h]){if("or"===c)return!0}else if(b&&b[h]&&b[h]instanceof Array&&a[h]&&"object"!==typeof a[h]){e=!1;for(d=0;d<b[h].length&&!(e=this._match(b[h][d],a[h],void 0));d++);if(e){if("or"===c)return!0}else f=!1}else f=!1;if("and"===c&&!f)return!1}return f};e.prototype.count=function(b,a){return b?this.find(b,a).length:this._data.length};e.prototype.link=function(b,a){if(window.jQuery){this._links=
this._links||{};var c,e;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template),e=a.template):c=a;if(!this._links[c]){if(jQuery(b).length){if(!jQuery.templates[c]){if(!e)if(e=jQuery(a),e.length)e=jQuery(e[0]).html();else throw"Unable to bind collection to target because template does not exist: "+a;jQuery.views.templates(c,e)}jQuery.templates[c].link(b,this._data);this._links[c]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+
this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.unlink=function(b,a){if(window.jQuery){this._links=this._links||{};var c;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template)):c=a;if(this._links[c])return jQuery.templates[c].unlink(b),
delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.findSub=function(b,a,e,d){var h=new c(a);b=this.find(b);var f=b.length,k,m,n=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:f,subDocTotal:0,
subDocs:[],pathFound:!1,err:""};for(k=0;k<f;k++)if(m=h.value(b[k])[0]){n.setData(m);m=n.find(e,d);if(d.returnFirst&&m.length)return m[0];q.subDocs.push(m);q.subDocTotal+=m.length;q.pathFound=!0}n.drop();if(d.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+a);return q};e.prototype.insertIndexViolation=function(b){var a,c=this._indexByName,e,d;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(e in c)if(c.hasOwnProperty(e)&&
(d=c[e],d.unique()&&d.violation(b))){a=d;break}return a?a.name():!1};e.prototype.ensureIndex=function(b,c){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var e=new a(b,c,this),d={start:(new Date).getTime()};if(this._indexByName[e.name()])return{err:"Index with that name already exists"};if(this._indexById[e.id()])return{err:"Index with those keys already exists"};e.rebuild();this._indexByName[e.name()]=e;this._indexById[e.id()]=e;d.end=(new Date).getTime();d.total=d.end-
d.start;this._lastOp={type:"ensureIndex",stats:{time:d}};return{index:e,id:e.id(),name:e.name(),state:e.state()}};e.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};e.prototype.lastOp=function(){return this._metrics.list()};e.prototype.objectId=k.common.objectId;e.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},c=this.primaryKey(),e,d,h,f;if(c===b.primaryKey()){e=b._data;f=e.length;for(d=0;d<f;d++)h=e[d],this._primaryIndex.get(h[c])?this._primaryCrc.get(h[c])!==
b._primaryCrc.get(h[c])&&a.update.push(h):a.insert.push(h);e=this._data;f=e.length;for(d=0;d<f;d++)h=e[d],b._primaryIndex.get(h[c])||a.remove.push(h)}return a};f.prototype.collection=function(b,a){if(b)return this._collection[b]||this.debug()&&console.log("Creating collection "+b),this._collection[b]=this._collection[b]||(new e(b)).db(this),void 0!==a&&this._collection[b].primaryKey(a),this._collection[b];throw"Cannot get collection with undefined name!";};f.prototype.collectionExists=function(b){return Boolean(this._collection[b])};
f.prototype.collections=function(){var b=[],a;for(a in this._collection)this._collection.hasOwnProperty(a)&&b.push({name:a,count:this._collection[a].count()});return b};m.exports=e},{"./Crc":5,"./Index":8,"./KeyValueStore":9,"./Metrics":10,"./Path":13,"./Shared":15}],3:[function(f,m,k){var h,d;k=f("./Shared");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(a){this._name=a;this._data=new d("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};k.addModule("CollectionGroup",
c);k.inherit(c.prototype,k.chainSystem);d=f("./Collection");f=k.modules.Core;h=k.modules.Core.prototype.init;c.prototype.debug=k.common.debug;c.prototype.on=function(){this._data.on.apply(this._data,arguments)};c.prototype.off=function(){this._data.off.apply(this._data,arguments)};c.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};c.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};k.synthesize(c.prototype,"db");c.prototype.addCollection=
function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(a.primaryKey());this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};c.prototype.removeCollection=function(a){if(a){var b=this._collections.indexOf(a);-1!==b&&(a.unChain(this),this._collections.splice(b,1),b=a._groups.indexOf(this),-1!==
b&&a._groups.splice(b,1));0===this._collections.length&&delete this._primaryKey}return this};c.prototype.decouple=k.common.decouple;c.prototype._chainHandler=function(a,b,c,d){switch(b){case "setData":c=this.decouple(c);this._data.remove(d.oldData);this._data.insert(c);break;case "insert":c=this.decouple(c);this._data.insert(c);break;case "update":this._data.update(c.query,c.update,d);break;case "remove":this._data.remove(c.query,d)}};c.prototype.insert=function(){this._collectionsRun("insert",arguments)};
c.prototype.update=function(){this._collectionsRun("update",arguments)};c.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};c.prototype.remove=function(){this._collectionsRun("remove",arguments)};c.prototype._collectionsRun=function(a,b){for(var c=0;c<this._collections.length;c++)this._collections[c][a].apply(this._collections[c],b)};c.prototype.find=function(a,b){return this._data.find(a,b)};c.prototype.removeById=function(a){for(var b=0;b<this._collections.length;b++)this._collections[b].removeById(a)};
c.prototype.subset=function(a,b){var c=this.find(a,b);return(new d)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};c.prototype.drop=function(){var a,b=[].concat(this._collections),c=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<c.length;a++)this._removeView(c[a]);this.emit("drop");return!0};f.prototype.init=function(){this._collectionGroup={};h.apply(this,arguments)};f.prototype.collectionGroup=
function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new c(a)).db(this),this._collectionGroup[a]):this._collectionGroup};m.exports=c},{"./Collection":2,"./Shared":15}],4:[function(f,m,k){var h;k=f("./Shared.js");var d=function(){this.init.apply(this,arguments)};d.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};d.shared=k;d.prototype.shared=k;k.addModule("Core",d);k.inherit(d.prototype,k.chainSystem);h=f("./Collection.js");f("./Metrics.js");
f=f("./Crc.js");d.prototype._isServer=!1;d.prototype.isClient=function(){return!this._isServer};d.prototype.isServer=function(){return this._isServer};d.prototype.crc=f;d.prototype.isClient=function(){return!this._isServer};d.prototype.isServer=function(){return this._isServer};d.prototype.decouple=k.common.decouple;d.prototype.debug=k.common.debug;d.prototype.arrayToCollection=function(c){return(new h).setData(c)};d.prototype.on=function(c,a){this._listeners=this._listeners||{};this._listeners[c]=
this._listeners[c]||[];this._listeners[c].push(a);return this};d.prototype.off=function(c,a){if(c in this._listeners){var b=this._listeners[c],e=b.indexOf(a);-1<e&&b.splice(e,1)}return this};d.prototype.emit=function(c,a){this._listeners=this._listeners||{};if(c in this._listeners){var b=this._listeners[c],e=b.length,d;for(d=0;d<e;d++)b[d].apply(this,Array.prototype.slice.call(arguments,1))}return this};d.prototype.objectId=k.common.objectId;d.prototype.peek=function(c){var a,b,e=[],d=typeof c;for(a in this._collection)this._collection.hasOwnProperty(a)&&
(b=this._collection[a],e="string"===d?e.concat(b.peek(c)):e.concat(b.find(c)));return e};d.prototype.peekCat=function(c){var a,b,e={},d,h=typeof c;for(a in this._collection)this._collection.hasOwnProperty(a)&&(b=this._collection[a],(d="string"===h?b.peek(c):b.find(c))&&d.length&&(e[b.name()]=d));return e};m.exports=d},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":10,"./Shared.js":15}],5:[function(f,m,k){var h=function(){var d=[],c,a,b;for(a=0;256>a;a++){c=a;for(b=0;8>b;b++)c=c&1?3988292384^c>>>
1:c>>>1;d[a]=c}return d}();m.exports=function(d){var c=-1,a;for(a=0;a<d.length;a++)c=c>>>8^h[(c^d.charCodeAt(a))&255];return(c^-1)>>>0}},{}],6:[function(f,m,k){var h,d;k=f("./Shared");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(a){this._name=a;this._data={}};k.addModule("Document",c);k.inherit(c.prototype,k.chainSystem);f=f("./Collection");h=k.modules.Core;d=k.modules.Core.prototype.init;k.synthesize(c.prototype,"db");k.synthesize(c.prototype,"name");c.prototype.setData=
function(a){var b,c;if(a)if(a=this.decouple(a),this._linked){c={};for(b in this._data)"jQuery"!==b.substr(0,6)&&this._data.hasOwnProperty(b)&&void 0===a[b]&&(c[b]=1);a.$unset=c;this._updateObject(this._data,a,{})}else this._data=a;return this};c.prototype.decouple=k.common.decouple;c.prototype.objectId=k.common.objectId;c.prototype.on=k.common.on;c.prototype.off=k.common.off;c.prototype.emit=k.common.emit;c.prototype.debug=k.common.debug;c.prototype.update=function(a,b,c){this._updateObject(this._data,
b,a,c)};c.prototype._updateObject=f.prototype._updateObject;c.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};c.prototype._updateProperty=function(a,b,c){this._linked?(jQuery.observable(a).setProperty(b,c),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(a[b]=c,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+
'"'))};c.prototype._updateIncrement=function(a,b,c){this._linked?jQuery.observable(a).setProperty(b,a[b]+c):a[b]+=c};c.prototype._updateSpliceMove=function(a,b,c){this._linked?(jQuery.observable(a).move(b,c),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+b+'" to "'+c+'" for collection "'+this.name()+'"')):(a.splice(c,0,a.splice(b,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+b+'" to "'+
c+'" for collection "'+this.name()+'"'))};c.prototype._updateSplicePush=function(a,b,c){a.length>b?this._linked?jQuery.observable(a).insert(b,c):a.splice(b,0,c):this._linked?jQuery.observable(a).insert(c):a.push(c)};c.prototype._updatePush=function(a,b){this._linked?jQuery.observable(a).insert(b):a.push(b)};c.prototype._updatePull=function(a,b){this._linked?jQuery.observable(a).remove(b):a.splice(b,1)};c.prototype._updateMultiply=function(a,b,c){this._linked?jQuery.observable(a).setProperty(b,a[b]*
c):a[b]*=c};c.prototype._updateRename=function(a,b,c){var d=a[b];this._linked?(jQuery.observable(a).setProperty(c,d),jQuery.observable(a).removeProperty(b)):(a[c]=d,delete a[b])};c.prototype._updateUnset=function(a,b){this._linked?jQuery.observable(a).removeProperty(b):delete a[b]};c.prototype._updatePop=function(a,b){var c,d=!1;0<a.length&&(this._linked?(1===b?c=a.length-1:-1===b&&(c=0),-1<c&&(jQuery.observable(arr).remove(c),d=!0)):1===b?(a.pop(),d=!0):-1===b&&(a.shift(),d=!0));return d};c.prototype.link=
function(a,b){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var c,d;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(c=this.objectId(b.template),d=b.template):c=b;if(!this._links[c]){if(jQuery(a).length){if(!jQuery.templates[c]){if(!d)if(d=jQuery(b),d.length)d=jQuery(d[0]).html();else throw"Unable to bind document to target because template does not exist: "+b;jQuery.views.templates(c,d)}jQuery.templates[c].link(a,this._data);this._links[c]=a;this._linked++;
this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};c.prototype.unlink=function(a,b){if(window.jQuery){this._links=this._links||{};var c;b&&"object"===typeof b?b.template&&
"string"===typeof b.template&&(c=this.objectId(b.template)):c=b;if(this._links[c])return jQuery.templates[c].unlink(a),delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};c.prototype.drop=function(){this._db&&this._name&&
this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};h.prototype.init=function(){d.apply(this,arguments)};h.prototype.document=function(a){return a?(this._document=this._document||{},this._document[a]=this._document[a]||(new c(a)).db(this),this._document[a]):this._document};m.exports=c},{"./Collection":2,"./Shared":15}],7:[function(f,m,k){var h;f=f("./Shared");var d=function(c,a){this.init.apply(this,arguments)};d.prototype.init=function(c,
a){this._options=a;this._selector=$(this._options.selector);this._listeners={};this._collection=c;this._options.series=[];var b,e;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();b=this._collection.find();e={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};b=this.pieDataFromCollectionData(b,
this._options.keyField,this._options.valField);$.extend(e,this._options.seriesOptions);$.extend(e,{type:"pie",name:this._options.seriesName,data:b});this._chart.addSeries(e);break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=b.xAxis,this._options.chartOptions.series=b.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};
f=f.modules.Collection;h=f.prototype.init;d.prototype.pieDataFromCollectionData=function(c,a,b){var e=[],d;for(d=0;d<c.length;d++)e.push([c[d][a],c[d][b]]);return e};d.prototype.lineDataFromCollectionData=function(c,a,b,e){var d=this._collection.distinct(c),h=[],f={categories:[]},k,m,R,Y,A;for(Y=0;Y<d.length;Y++){k=d[Y];m={};m[c]=k;R=[];m=this._collection.find(m,{orderBy:e});for(A=0;A<m.length;A++)f.categories.push(m[A][a]),R.push(m[A][b]);h.push({name:k,data:R})}return{xAxis:f,series:h}};d.prototype._hookEvents=
function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};d.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var c=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(c,this._options.keyField,this._options.valField));break;case "line":c=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,
this._options.orderBy);this._chart.xAxis[0].setCategories(c.xAxis.categories);for(var a=0;a<c.series.length;a++)this._chart.series[a].setData(c.series[a].data)}}};d.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};d.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];
delete this._chart;delete this._options;delete this._collection;return this};f.prototype.init=function(){this._highcharts={};h.apply(this,arguments)};f.prototype.chart=function(c){this._highcharts[c.selector]||(this._highcharts[c.selector]=new d(this,c));return this._highcharts[c.selector]};f.prototype.dropChart=function(c){this._highcharts[c]&&this._highcharts[c].drop()};m.exports=d},{"./Shared":15}],8:[function(f,m,k){k=f("./Shared");var h=f("./Path");f=function(){this.init.apply(this,arguments)};
f.prototype.init=function(d,c,a){this._crossRef={};this._size=0;this._id=this._itemKeyHash(d,d);this.data({});this.unique(c&&c.unique?c.unique:!1);void 0!==d&&this.keys(d);void 0!==a&&this.collection(a);this.name(c&&c.name?c.name:this._id)};k.addModule("Index",f);k.inherit(f.prototype,k.chainSystem);f.prototype.id=function(){return this._id};f.prototype.state=function(){return this._state};f.prototype.size=function(){return this._size};f.prototype.data=function(d){return void 0!==d?(this._data=d,
this):this._data};k.synthesize(f.prototype,"name");f.prototype.collection=function(d){return void 0!==d?(this._collection=d,this):this._collection};f.prototype.keys=function(d){return void 0!==d?(this._keys=d,this._keyCount=(new h).parse(this._keys).length,this):this._keys};f.prototype.type=function(d){return void 0!==d?(this._type=d,this):this._type};f.prototype.unique=function(d){return void 0!==d?(this._unique=d,this):this._unique};f.prototype.rebuild=function(){if(this._collection){var d=this._collection.subset({},
{$decouple:!1,$orderBy:this._keys}).find(),c,a=d.length;this._data={};this._unique&&(this._uniqueLookup={});for(c=0;c<a;c++)this.insert(d[c])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};f.prototype.insert=function(d,c){var a,b;this._unique&&(a=this._itemHash(d,this._keys),this._uniqueLookup[a]=d);a=this._itemHashArr(d,this._keys);for(b=0;b<a.length;b++)this.pushToPathValue(a[b],d)};f.prototype.remove=function(d,c){var a,b;this._unique&&
(a=this._itemHash(d,this._keys),delete this._uniqueLookup[a]);a=this._itemHashArr(d,this._keys);for(b=0;b<a.length;b++)this.pullFromPathValue(a[b],d)};f.prototype.violation=function(d){d=this._itemHash(d,this._keys);return Boolean(this._uniqueLookup[d])};f.prototype.hashViolation=function(d){return Boolean(this._uniqueLookup[d])};f.prototype.pushToPathValue=function(d,c){var a=this._data[d]=this._data[d]||[];-1===a.indexOf(c)&&(a.push(c),this._size++,this.pushToCrossRef(c,a))};f.prototype.pullFromPathValue=
function(d,c){var a=this._data[d],b;b=a.indexOf(c);-1<b&&(a.splice(b,1),this._size--,this.pullFromCrossRef(c,a));a.length||delete this._data[d]};f.prototype.pull=function(d){var c=d[this._collection.primaryKey()],a=this._crossRef[c],b,e=a.length,g;for(b=0;b<e;b++)g=a[b],this._pullFromArray(g,d);this._size--;delete this._crossRef[c]};f.prototype._pullFromArray=function(d,c){for(var a=d.length;a--;)d[a]===c&&d.splice(a,1)};f.prototype.pushToCrossRef=function(d,c){var a=d[this._collection.primaryKey()];
this._crossRef[a]=this._crossRef[a]||[];a=this._crossRef[a];-1===a.indexOf(c)&&a.push(c)};f.prototype.pullFromCrossRef=function(d,c){var a=d[this._collection.primaryKey()];delete this._crossRef[a]};f.prototype.lookup=function(d){return this._data[this._itemHash(d,this._keys)]||[]};f.prototype.match=function(d,c){return(new h).countObjectPaths(this._keys,d)};f.prototype._itemHash=function(d,c){var a=new h,b,e="",g;b=a.parse(c);for(g=0;g<b.length;g++)e&&(e+="_"),e+=a.value(d,b[g].path).join(":");return e};
f.prototype._itemKeyHash=function(d,c){var a=new h,b,e="",g;b=a.parse(c);for(g=0;g<b.length;g++)e&&(e+="_"),e+=a.keyValue(d,b[g].path);return e};f.prototype._itemHashArr=function(d,c){var a=new h,b,e=[],g,f,k,m;b=a.parse(c);for(k=0;k<b.length;k++)for(g=a.value(d,b[k].path),f=0;f<g.length;f++)if(0===k)e.push(g[f]);else for(m=0;m<e.length;m++)e[m]=e[m]+"_"+g[f];return e};m.exports=f},{"./Path":13,"./Shared":15}],9:[function(f,m,k){f=f("./Shared");k=function(h){this.init.apply(this,arguments)};k.prototype.init=
function(h){this._name=h;this._data={};this._primaryKey="_id"};f.addModule("KeyValueStore",k);f.inherit(k.prototype,f.chainSystem);f.synthesize(k.prototype,"name");k.prototype.primaryKey=function(h){return void 0!==h?(this._primaryKey=h,this):this._primaryKey};k.prototype.truncate=function(){this._data={};return this};k.prototype.set=function(h,d){this._data[h]=d?d:!0;return this};k.prototype.get=function(h){return this._data[h]};k.prototype.lookup=function(h){h=h[this._primaryKey];var d,c,a,b;if(h instanceof
Array){c=h.length;b=[];for(d=0;d<c;d++)(a=this._data[h[d]])&&b.push(a);return b}if(h instanceof RegExp){b=[];for(d in this._data)this._data.hasOwnProperty(d)&&h.test(d)&&b.push(this._data[d]);return b}if("object"===typeof h){if(h.$ne){b=[];for(d in this._data)this._data.hasOwnProperty(d)&&d!==h.$ne&&b.push(this._data[d]);return b}if(h.$in&&h.$in instanceof Array){b=[];for(d in this._data)this._data.hasOwnProperty(d)&&-1<h.$in.indexOf(d)&&b.push(this._data[d]);return b}if(h.$nin&&h.$nin instanceof
Array){b=[];for(d in this._data)this._data.hasOwnProperty(d)&&-1===h.$nin.indexOf(d)&&b.push(this._data[d]);return b}if(h.$or&&h.$or instanceof Array){b=[];for(d=0;d<h.$or.length;d++)b=b.concat(this.lookup(h.$or[d]));return b}}else return a=this._data[h],void 0!==a?[a]:[]};k.prototype.unSet=function(h){delete this._data[h];return this};k.prototype.uniqueSet=function(h,d){return void 0===this._data[h]?(this._data[h]=d,!0):!1};m.exports=k},{"./Shared":15}],10:[function(f,m,k){k=f("./Shared");var h=
f("./Operation");f=function(){this.init.apply(this,arguments)};f.prototype.init=function(){this._data=[]};k.addModule("Metrics",f);k.inherit(f.prototype,k.chainSystem);f.prototype.create=function(d){d=new h(d);this._enabled&&this._data.push(d);return d};f.prototype.start=function(){this._enabled=!0;return this};f.prototype.stop=function(){this._enabled=!1;return this};f.prototype.clear=function(){this._data=[];return this};f.prototype.list=function(){return this._data};m.exports=f},{"./Operation":11,
"./Shared":15}],11:[function(f,m,k){k=f("./Shared");var h=f("./Path");f=function(d){this.pathSolver=new h;this.counter=0;this.init.apply(this,arguments)};f.prototype.init=function(d){this._data={operation:d,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};k.addModule("Operation",f);k.inherit(f.prototype,k.chainSystem);f.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};f.prototype.log=function(d){if(d){var c=0<this._log.length?
this._data.log[this._data.log.length-1].time:0;d={event:d,time:(new Date).getTime(),delta:0};this._data.log.push(d);c&&(d.delta=d.time-c);return this}return this._data.log};f.prototype.time=function(d){if(void 0!==d){var c=this._data.time.process,c=c[d]=c[d]||{};c.startMs?(c.stopMs=(new Date).getTime(),c.totalMs=c.stopMs-c.startMs,c.stepObj.totalMs=c.totalMs,delete c.stepObj):(c.startMs=(new Date).getTime(),c.stepObj={name:d},this._data.steps.push(c.stepObj));return this}return this._data.time};f.prototype.flag=
function(d,c){if(void 0!==d&&void 0!==c)this._data.flag[d]=c;else return void 0!==d?this._data.flag[d]:this._data.flag};f.prototype.data=function(d,c,a){return void 0!==c?(this.pathSolver.set(this._data,d,c),this):this.pathSolver.get(this._data,d)};f.prototype.pushData=function(d,c,a){this.pathSolver.push(this._data,d,c)};f.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=f},{"./Path":13,"./Shared":15}],
12:[function(f,m,k){var h,d,c;k=f("./Shared");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(b){this._name=b;this._data=new c("__FDB__dc_data_"+this._name);this._collData=new d;this._collections=[]};k.addModule("Overview",a);k.inherit(a.prototype,k.chainSystem);d=f("./Collection");c=f("./Document");f=k.modules.Core;h=k.modules.Core.prototype.init;k.synthesize(a.prototype,"db");k.synthesize(a.prototype,"name");k.synthesize(a.prototype,"query",function(b){var a=this.$super(b);
void 0!==b&&this._refresh();return a});k.synthesize(a.prototype,"queryOptions",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});k.synthesize(a.prototype,"reduce",function(b){var a=this.$super(b);void 0!==b&&this._refresh();return a});a.prototype.debug=k.common.debug;a.prototype.objectId=k.common.objectId;a.prototype.from=function(b){void 0!==b&&("string"===typeof b&&(b=this._db.collection(b)),this._addCollection(b));return this};a.prototype.find=function(){return this._collData.find.apply(this._collData,
arguments)};a.prototype.count=function(){return this._collData.count.apply(this._collData,arguments)};a.prototype._addCollection=function(b){-1===this._collections.indexOf(b)&&(this._collections.push(b),b.chain(this),this._refresh());return this};a.prototype._removeCollection=function(b){-1<this._collections.indexOf(b)&&(this._collections.splice(b,1),b.unChain(this),this._refresh());return this};a.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());
var b=[],a;for(a=0;a<this._collections.length;a++)b=b.concat(this._collections[a].find(this._query,this._queryOptions));this._collData.setData(b)}this._reduce&&(b=this._reduce(),this._data.setData(b))};a.prototype._chainHandler=function(b,a,c,d){switch(a){case "setData":case "insert":case "update":case "remove":this._refresh()}};a.prototype.link=function(b,a){this._data.link.apply(this._data,arguments);this._refresh()};a.prototype.unlink=function(b,a){this._data.unlink.apply(this._data,arguments);
this._refresh()};f.prototype.init=function(){this._overview={};h.apply(this,arguments)};f.prototype.overview=function(b){return b?(this._overview[b]=this._overview[b]||(new a(b)).db(this),this._overview[b]):this._overview};m.exports=a},{"./Collection":2,"./Document":6,"./Shared":15}],13:[function(f,m,k){f=f("./Shared");k=function(h){this.init.apply(this,arguments)};k.prototype.init=function(h){h&&this.path(h)};f.addModule("Path",k);f.inherit(k.prototype,f.chainSystem);k.prototype.path=function(h){return void 0!==
h?(this._path=this.clean(h),this._pathParts=this._path.split("."),this):this._path};k.prototype.hasObjectPaths=function(h,d){var c=!0,a;for(a in h)if(h.hasOwnProperty(a)&&(void 0===d[a]||"object"===typeof h[a]&&(c=this.hasObjectPaths(h[a],d[a]),!c)))return!1;return c};k.prototype.countKeys=function(h){var d=0,c;for(c in h)h.hasOwnProperty(c)&&void 0!==h[c]&&("object"!==typeof h[c]?d++:d+=this.countKeys(h[c]));return d};k.prototype.countObjectPaths=function(h,d){var c,a={},b=0,e=0,g;for(g in d)d.hasOwnProperty(g)&&
("object"===typeof d[g]?(c=this.countObjectPaths(h[g],d[g]),a[g]=c.matchedKeys,e+=c.totalKeyCount,b+=c.matchedKeyCount):(e++,h&&h[g]&&"object"!==typeof h[g]?(a[g]=!0,b++):a[g]=!1));return{matchedKeys:a,matchedKeyCount:b,totalKeyCount:e}};k.prototype.parse=function(h,d){var c=[],a="",b,e,g;for(e in h)if(h.hasOwnProperty(e))if(a=e,"object"===typeof h[e])if(d)for(b=this.parse(h[e],d),g=0;g<b.length;g++)c.push({path:a+"."+b[g].path,value:b[g].value});else for(b=this.parse(h[e]),g=0;g<b.length;g++)c.push({path:a+
"."+b[g].path});else d?c.push({path:a,value:h[e]}):c.push({path:a});return c};k.prototype.parseArr=function(h,d){d=d||{};return this._parseArr(h,"",[],d)};k.prototype._parseArr=function(h,d,c,a){var b,e="";d=d||"";c=c||[];for(b in h)h.hasOwnProperty(b)&&(!a.ignore||a.ignore&&!a.ignore.test(b))&&(e=d?d+"."+b:b,"object"===typeof h[b]?this._parseArr(h[b],e,c,a):c.push(e));return c};k.prototype.value=function(h,d){if(void 0!==h&&"object"===typeof h){var c,a,b,e,g=[],f;void 0!==d&&(d=this.clean(d),c=d.split("."));
c=c||this._pathParts;a=c.length;b=h;for(f=0;f<a;f++){b=b[c[f]];if(e instanceof Array){for(a=0;a<e.length;a++)g=g.concat(this.value(e,a+"."+c[f]));return g}if(!b||"object"!==typeof b)break;e=b}return[b]}return[]};k.prototype.set=function(f,d,c){if(void 0!==f&&void 0!==d){var a;d=this.clean(d);d=d.split(".");a=d.shift();d.length?(f[a]=f[a]||{},this.set(f[a],d.join("."),c)):f[a]=c}return f};k.prototype.get=function(f,d){return this.value(f,d)[0]};k.prototype.push=function(f,d,c){if(void 0!==f&&void 0!==
d){var a;d=this.clean(d);d=d.split(".");a=d.shift();if(d.length)f[a]=f[a]||{},this.set(f[a],d.join("."),c);else if(f[a]=f[a]||[],f[a]instanceof Array)f[a].push(c);else throw"Cannot push to a path whose endpoint is not an array!";}return f};k.prototype.keyValue=function(f,d){var c,a,b,e,g;void 0!==d&&(d=this.clean(d),c=d.split("."));c=c||this._pathParts;a=c.length;b=f;for(g=0;g<a;g++)if(b=b[c[g]],!b||"object"!==typeof b){e=c[g]+":"+b;break}return e};k.prototype.clean=function(f){"."===f.substr(0,1)&&
(f=f.substr(1,f.length-1));return f};m.exports=k},{"./Shared":15}],14:[function(f,m,k){k=f("./Shared");var h,d,c,a;a=function(){this.init.apply(this,arguments)};a.prototype.init=function(b){b.isClient()&&void 0!==Storage&&this.mode("localStorage")};k.addModule("Persist",a);k.inherit(a.prototype,k.chainSystem);k=k.modules.Core;h=f("./Collection");d=h.prototype.drop;f("./CollectionGroup");c=k.prototype.init;a.prototype.mode=function(b){return void 0!==b?(this._mode=b,this):this._mode};a.prototype.save=
function(b,a,c){switch(this.mode()){case "localStorage":a="object"===typeof a?"json::fdb::"+JSON.stringify(a):"raw::fdb::"+a;try{localStorage.setItem(b,a)}catch(d){if(c)c(d);else throw d;break}if(c)c(!1);else return!1;break;default:if(c)c("No data handler.");else throw"No data handler.";}};a.prototype.load=function(b,a){var c,d;switch(this.mode()){case "localStorage":try{c=localStorage.getItem(b)}catch(f){a(f,null)}if(c){c=c.split("::fdb::");switch(c[0]){case "json":d=JSON.parse(c[1]);break;case "raw":d=
c[1]}if(a)a(!1,d);else return d}break;default:if(a)a("No data handler or unrecognised data type.");else throw"No data handler or unrecognised data type.";}};a.prototype.drop=function(b,a){switch(this.mode()){case "localStorage":try{localStorage.removeItem(b)}catch(c){a&&a(c)}a&&a(!1);break;default:a&&a("No data handler or unrecognised data type.")}};h.prototype.drop=function(b){if(b)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),
"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";d.apply(this)};h.prototype.save=function(b){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,b);else return b&&b("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";
else return b&&b("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};h.prototype.load=function(b){var a=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(c,d){if(c)return b&&b(c),c;d&&a.setData(d);b&&b(!1)});else return b&&b("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return b&&b("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};
k.prototype.init=function(){this.persist=new a(this);c.apply(this,arguments)};m.exports=a},{"./Collection":2,"./CollectionGroup":3,"./Shared":15}],15:[function(f,m,k){var h=0,d=function(c){var a=[],b,e=["string","object","number","function","undefined"],g;if(-1<c.indexOf("*"))for(g=0;g<e.length;g++)b=c.replace("*",e[g]),a=a.concat(d(b));else a.push(c);return a};f=function(c){if(c){var a,b,e,g,f;if(!(c instanceof Array)){e={};for(a in c)if(c.hasOwnProperty(a))if(g=a.replace(/ /g,""),-1===g.indexOf("*"))e[g]=
c[a];else for(f=d(g),g=0;g<f.length;g++)e[f[g]]||(e[f[g]]=c[a]);c=e}return function(){if(c instanceof Array)for(b=c.length,a=0;a<b;a++){if(c[a].length===arguments.length)return c[a].apply(this,arguments)}else{var d=[],e;for(a=0;a<arguments.length;a++)d.push(typeof arguments[a]);e=d.join(",");if(c[e])return c[e].apply(this,arguments);for(a=d.length;0<=a;a--)if(e=d.slice(0,a).join(","),c[e+",..."])return c[e+",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments!";
}}return function(){}};f={modules:{},common:{decouple:function(c){return JSON.parse(JSON.stringify(c))},objectId:function(c){var a=Math.pow(10,17);if(c){var b=0,d=c.length,g;for(g=0;g<d;g++)b+=c.charCodeAt(g)*a;c=b.toString(16)}else h++,c=(h+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return c},debug:new f([function(){return this._debug&&this._debug.all},function(c){return void 0!==c?"boolean"===typeof c?(this._debug=this._debug||{},this._debug.all=c,this.chainSend("debug",
this._debug),this):this._debug&&this._debug[c]||this._db&&this._db._debug&&this._db._debug[c]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(c,a){return void 0!==c?void 0!==a?(this._debug=this._debug||{},this._debug[c]=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[c]:this._debug&&this._debug.all}]),on:new f({"string, function":function(c,a){this._listeners=this._listeners||{};this._listeners[c]=this._listeners[c]||
{};this._listeners[c]["*"]=this._listeners[c]["*"]||[];this._listeners[c]["*"].push(a);return this},"string, *, function":function(c,a,b){this._listeners=this._listeners||{};this._listeners[c]=this._listeners[c]||{};this._listeners[c][a]=this._listeners[c][a]||[];this._listeners[c][a].push(b);return this}}),off:new f({string:function(c){this._listeners&&this._listeners[c]&&c in this._listeners&&delete this._listeners[c];return this},"string, function":function(c,a){var b,d;"string"===typeof a?this._listeners&&
this._listeners[c]&&this._listeners[c][a]&&delete this._listeners[c][a]:c in this._listeners&&(b=this._listeners[c]["*"],d=b.indexOf(a),-1<d&&b.splice(d,1));return this},"string, *, function":function(c,a,b){this._listeners&&c in this._listeners&&(c=this._listeners[c][a],b=c.indexOf(b),-1<b&&c.splice(b,1))}}),emit:function(c,a){this._listeners=this._listeners||{};if(c in this._listeners){if(this._listeners[c]["*"]){var b=this._listeners[c]["*"],d=b.length,g;for(g=0;g<d;g++)b[g].apply(this,Array.prototype.slice.call(arguments,
1))}if(a instanceof Array&&a[0]&&a[0][this._primaryKey]){var b=this._listeners[c],f,h,d=a.length;for(g=0;g<d;g++)if(b[a[g][this._primaryKey]])for(f=b[a[g][this._primaryKey]].length,h=0;h<f;h++)b[a[g][this._primaryKey]][h].apply(this,Array.prototype.slice.call(arguments,1))}}return this}},_synth:{},addModule:function(c,a){this.modules[c]=a},inherit:function(c,a){for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b])},synthesize:function(c,a,b){this._synth[a]=this._synth[a]||function(b){return void 0!==b?
(this["_"+a]=b,this):this["_"+a]};if(b){var d=this;c[a]=function(){var c=this.$super,f;this.$super=d._synth[a];f=b.apply(this,arguments);this.$super=c;return f}}else c[a]=this._synth[a]},overload:f,chainSystem:{chain:function(c){this._chain=this._chain||[];-1===this._chain.indexOf(c)&&this._chain.push(c)},unChain:function(c){this._chain&&(c=this._chain.indexOf(c),-1<c&&this._chain.splice(c,1))},chainSend:function(c,a,b){if(this._chain){var d=this._chain,g=d.length,f;for(f=0;f<g;f++)d[f].chainReceive(this,
c,a,b)}},chainReceive:function(c,a,b,d){(!this._chainHandler||this._chainHandler&&!this._chainHandler(c,a,b,d))&&this.chainSend(a,b,d)}}};m.exports=f},{}],16:[function(f,m,k){var h,d,c;k=f("./Shared");var a=function(b,a,c){this.init.apply(this,arguments)};a.prototype.init=function(b,a,c){this._name=b;this._collections=[];this._groups=[];this._listeners={};this._querySettings={query:a,options:c};this._debug={};this._privateData=new h("__FDB__view_privateData_"+this._name)};k.addModule("View",a);k.inherit(a.prototype,
k.chainSystem);h=f("./Collection");CollectionGroup=f("./CollectionGroup");d=h.prototype.init;f=k.modules.Core;c=f.prototype.init;k.synthesize(a.prototype,"name");a.prototype.debug=k.common.debug;a.prototype.insert=function(){this._collectionsRun("insert",arguments)};a.prototype.update=function(){this._collectionsRun("update",arguments)};a.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};a.prototype.remove=function(){this._collectionsRun("remove",arguments)};a.prototype._collectionsRun=
function(b,a){for(var c=0;c<this._collections.length;c++)this._collections[c][b].apply(this._collections[c],a)};a.prototype.find=function(b,a){return this.publicData().find(b,a)};a.prototype.link=function(b,a){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+b);return c.link(b,a)};a.prototype.unlink=function(b,a){var c=this.publicData();this.debug()&&
console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+b);return c.unlink(b,a)};a.prototype.decouple=k.common.decouple;a.prototype.from=function(b){void 0!==b&&("string"===typeof b&&(b=this._db.collection(b)),this._addCollection(b));return this};a.prototype._addCollection=function(b){if(-1===this._collections.indexOf(b)){this._collections.push(b);b.chain(this);var a=b.find(this._querySettings.query,
this._querySettings.options);this._transformPrimaryKey(b.primaryKey());this._transformInsert(a);this._privateData.primaryKey(b.primaryKey());this._privateData.insert(a)}return this};a.prototype._removeCollection=function(b){-1<this._collections.indexOf(b)&&(this._collections.splice(b,1),b.unChain(this),this._privateData.remove(b.find(this._querySettings.query,this._querySettings.options)));return this};a.prototype._chainHandler=function(b,a,c,d){var f,h;switch(a){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');c=this.decouple(c);this._transformSetData(c);this._privateData.setData(c);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');c=this.decouple(c);if(this._querySettings.options&&this._querySettings.options.$orderBy)if(f=[].concat(this._privateData._data),(b=c instanceof Array)?f=
f.concat(c):f.push(c),f=this._privateData.sort(this._querySettings.options.$orderBy,f),b)for(c.sort(function(b,a){return f.indexOf(b)-f.indexOf(a)}),b=0;b<c.length;b++)a=f.indexOf(c[b]),this._transformInsert(c,a),this._privateData._insertHandle(c,a);else a=f.indexOf(c),this._transformInsert(c,a),this._privateData._insertHandle(c,a);else a=d&&d.index?d.index:this._privateData._data.length,this._transformInsert(c,a),this._privateData._insertHandle(c,a);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');c=this._privateData.update(c.query,c.update,c.options);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(f=[].concat(this._privateData._data),f=this._privateData.sort(this._querySettings.options.$orderBy,f),c.sort(function(b,a){return f.indexOf(b)-f.indexOf(a)}),b=0;b<c.length;b++)d=this._privateData._data.indexOf(c[b]),a=f.indexOf(c[b]),this._privateData._updateSpliceMove(this._privateData._data,
d,a);if(this._transformEnabled&&this._transformIn)for(a=this._publicData.primaryKey(),b=0;b<c.length;b++)d={},h=c[b],d[a]=h[a],this._transformUpdate(d,h);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(c.query,d),this._privateData.remove(c.query,d)}};a.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};a.prototype.off=
function(){this._privateData.off.apply(this._privateData,arguments)};a.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};a.prototype.drop=function(){if(this._collections&&this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name);for(var b=this._collections.length;b--;)this._removeCollection(this._collections[b]);this._privateData.drop();return!0}return!1};a.prototype.db=function(b){return void 0!==
b?(this._db=b,this.privateData().db(b),this.publicData().db(b),this):this._db};a.prototype.primaryKey=function(){return this._privateData.primaryKey()};a.prototype.queryData=function(b,a,c){void 0!==b&&(this._querySettings.query=b);void 0!==a&&(this._querySettings.options=a);return void 0!==b||void 0!==a?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};a.prototype.queryAdd=function(b,a,c){var d=this._querySettings.query,f;if(void 0!==b)for(f in b)b.hasOwnProperty(f)&&(void 0===d[f]||
void 0!==d[f]&&a)&&(d[f]=b[f]);void 0!==c&&!0!==c||this.refresh()};a.prototype.queryRemove=function(b,a){var c=this._querySettings.query,d;if(void 0!==b)for(d in b)b.hasOwnProperty(d)&&delete c[d];void 0!==a&&!0!==a||this.refresh()};a.prototype.query=function(b,a){return void 0!==b?(this._querySettings.query=b,void 0!==a&&!0!==a||this.refresh(),this):this._querySettings.query};a.prototype.queryOptions=function(b,a){return void 0!==b?(this._querySettings.options=b,void 0===b.$decouple&&(b.$decouple=
!0),void 0!==a&&!0!==a||this.refresh(),this):this._querySettings.options};a.prototype.refresh=function(){var b,a=this.publicData(),c;this._privateData.remove();a.remove();for(c=0;c<this._collections.length;c++)b=this._collections[c],this._privateData.insert(b.find(this._querySettings.query,this._querySettings.options));b=this._privateData.find({},this._querySettings.options);a._linked?jQuery.observable(a._data).refresh(b):(this._privateData._data.length=0,this._privateData._data=this._privateData._data.concat(b));
return this};a.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};a.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):
{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};a.prototype.privateData=function(){return this._privateData};a.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};a.prototype._transformSetData=function(b){this._transformEnabled&&(this._publicData=new h("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),
this._publicData.setData(b))};a.prototype._transformInsert=function(b,a){this._transformEnabled&&this._publicData&&this._publicData.insert(b,a)};a.prototype._transformUpdate=function(b,a,c){this._transformEnabled&&this._publicData&&this._publicData.update(b,a,c)};a.prototype._transformRemove=function(b,a){this._transformEnabled&&this._publicData&&this._publicData.remove(b,a)};a.prototype._transformPrimaryKey=function(b){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(b)};h.prototype.init=
function(){this._views=[];d.apply(this,arguments)};h.prototype.view=function(b,c,d){if(this._db&&this._db._views){if(this._db._views[b])throw"Cannot create a view using this collection because one with this name already exists: "+b;b=(new a(b,c,d)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(b);return b}};h.prototype._addView=CollectionGroup.prototype._addView=function(b){void 0!==b&&this._views.push(b);return this};h.prototype._removeView=CollectionGroup.prototype._removeView=
function(b){void 0!==b&&(b=this._views.indexOf(b),-1<b&&this._views.splice(b,1));return this};f.prototype.init=function(){this._views={};c.apply(this,arguments)};f.prototype.view=function(b){this._views[b]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+b);this._views[b]=this._views[b]||(new a(b)).db(this);return this._views[b]};f.prototype.viewExists=function(b){return Boolean(this._views[b])};f.prototype.views=function(){var b=[],a;for(a in this._views)this._views.hasOwnProperty(a)&&
b.push({name:a,count:this._views[a].count()});return b};m.exports=a},{"./Collection":2,"./CollectionGroup":3,"./Shared":15}],17:[function(f,m,k){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(f,d,c){function a(b){return b}function b(b){debugger;return b}function e(c){Ma=(va._dbgMode=c)?"Unavailable (nested view): use #getIndex()":"";wa("dbg",Ia.dbg=na.dbg=c?b:a)}function g(b){this.name=(r.link?"JsViews":"JsRender")+" Error";this.message=b||this.name}function k(b,a){for(var c in a)b[c]=
a[c];return b}function m(b){return"function"===typeof b}function ja(b,a,c){if(!S.rTag||b)x=b?b.charAt(0):x,ha=b?b.charAt(1):ha,N=a?a.charAt(0):N,z=a?a.charAt(1):z,O=c||O,b="\\"+x+"(\\"+O+")?\\"+ha,a="\\"+N+"\\"+z,G="(?:(?:(\\w+(?=[\\/\\s\\"+N+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+N+"]|\\"+N+"(?!\\"+z+"))*?)",S.rTag=G+")",G=RegExp(b+G+"(\\/)?|(?:\\/(\\w+)))"+a,"g"),xa=RegExp("<.*>|([^\\\\]|^)[{}]|"+b+".*"+a);return[x,ha,N,z,O]}function Ja(b,a){a||(a=b,b=c);var d,e,f,g;
f=this;d=!a||"root"===a;if(b){if(g=f.type===a?f:c,!g)if(d=f.views,f._.useKey)for(e in d){if(g=d[e].get(b,a))break}else for(e=0,f=d.length;!g&&e<f;e++)g=d[e].get(b,a)}else if(d)for(;f.parent.parent;)g=f=f.parent;else for(;f&&!g;)g=f.type===a?f:c,f=f.parent;return g}function R(){var b=this.get("item");return b?b.index:c}function Y(){return this.index}function A(b){var a,d=this,e=d.linkCtx,g=(d.ctx||{})[b];g===c&&e&&e.ctx&&(g=e.ctx[b]);g===c&&(g=Ia[b]);g&&m(g)&&!g._wrp&&(a=function(){return g.apply(this&&
this!==f?this:d,arguments)},a._wrp=1,k(a,g));return a||g}function n(b,a,d){var e,f,g=+d===d&&d,h=a.linkCtx;g&&(d=(g=a.tmpl.bnds[g-1])(a.data,a,I));e=d.args[0];if(b||g){e=h&&h.tag;e||(e={_:{inline:!h,bnd:g},tagName:":",cvt:b,flow:!0,tagCtx:d,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,d.ctx=J(d.ctx,h.view.ctx)),S._lnk(e));for(f in d.props)Na.test(f)&&(e[f]=d.props[f]);d.view=a;e.ctx=d.ctx||{};delete d.ctx;a._.tag=e;e=q(e,e.convert||"true"!==b&&b)[0];e=g&&a._.onRender?a._.onRender(e,a,g):e;a._.tag=c}return e!=
c?e:""}function q(b,a){var c=b.tagCtx,d=c.view,e=c.args;a=a&&(""+a===a?d.getRsc("converters",a)||ka("Unknown converter: '"+a+"'"):a);e=e.length||c.index?a?e.slice():e:[d.data];a&&(a.depends&&(b.depends=S.getDeps(b.depends,b,a.depends,a)),e[0]=a.apply(b,e));return e}function p(a,b){for(var d,e=this;d===c&&e;)d=(d=e.tmpl[a])&&d[b],e=e.parent;return d||I[a][b]}function l(a,b,d,e,f){var g,h,s,l,H,m,u,t,r,p,E,D="",n=+e===e&&e,G=b.linkCtx||0,w=b.ctx,x=d||b.tmpl;"tag"===a._is&&(g=a,a=g.tagName,e=g.tagCtxs);
g=g||G.tag;n&&(e=(t=x.bnds[n-1])(b.data,b,I));m=e.length;for(H=0;H<m;H++){H||d&&g||(r=b.getRsc("tags",a)||ka("Unknown tag: {{"+a+"}}"));h=e[H];G.tag||(u=h.tmpl,u=h.content=u&&x.tmpls[u-1],k(h,{tmpl:(g?g:r).template||u,render:P,index:H,view:b,ctx:J(h.ctx,w)}));if(d=h.props.tmpl)d=""+d===d?b.getRsc("templates",d)||Ca(d):d,h.tmpl=d;g||(r._ctr?(g=new r._ctr,p=!!g.init,g.attr=g.attr||r.attr||c):S._lnk(g={render:r.render}),g._={inline:!G},G&&(G.attr=g.attr=G.attr||g.attr,G.tag=g,g.linkCtx=G),(g._.bnd=t||
G.fn)?g._.arrVws={}:g.dataBoundOnly&&ka("{^{"+a+"}} tag must be data-bound"),g.tagName=a,g.parent=l=w&&w.tag,g._is="tag",g._def=r,g.tagCtxs=e);if(!H)for(E in u=h.props)Na.test(E)&&(g[E]=u[E]);h.tag=g;g.dataMap&&g.tagCtxs&&(h.map=g.tagCtxs[H].map);g.flow||(u=h.ctx=h.ctx||{},h=g.parents=u.parentTags=w&&J(u.parentTags,w.parentTags)||{},l&&(h[l.tagName]=l),u.tag=g)}b._.tag=g;g.rendering={};for(H=0;H<m;H++){h=g.tagCtx=g.tagCtxs[H];u=h.props;a=q(g,g.convert);if(e=u.dataMap||g.dataMap)if(a.length||u.dataMap){l=
h.map;if(!l||l.src!==a[0]||f)l&&l.src&&l.unmap(),l=h.map=e.map(a[0],u);a=[l.tgt]}g.ctx=h.ctx;!H&&p&&(e=g.template,g.init(h,G,g.ctx),p=c,g.template!==e&&(g._.tmpl=g.template));l=c;if(e=g.render)l=e.apply(g,a);a=a.length?a:[b];l=l!==c?l:h.render(a[0],!0)||(f?c:"");D=D?D+(l||""):l}delete g.rendering;g.tagCtx=g.tagCtxs[0];g.ctx=g.tagCtx.ctx;g._.inline&&(s=g.attr)&&s!==K&&(D="text"===s?na.html(D):"");return n&&b._.onRender?b._.onRender(D,b,n):D}function Z(a,b,c,d,e,f,g,h){var k="array"===b,s={key:0,useKey:k?
0:1,id:""+Ha++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=c;this.type=b;this._=s;this.linked=!!h;c?(b=c.views,d=c._,d.useKey?(b[s.key="_"+d.useKey++]=this,this.index=Ma,this.getIndex=R,f=d.tag,s.bnd=k&&(!f||!!f._.bnd&&f)):b.splice(s.key=this.index=f,0,this),this.ctx=a||c.ctx):this.ctx=a}function F(a){var b,c,d,e,f,g;for(b in Q)if(e=Q[b],(f=e.compile)&&(c=a[b+"s"]))for(d in c)(e=c[d]=f(d,c[d],a))&&(g=S.onStore[b])&&g(d,e,f)}function aa(a,b,d){m(b)?b={depends:b.depends,
render:b}:(b.baseTag&&(b.flow=!!b.flow,b=k(k({},b.baseTag),b)),(a=b.template)!==c&&(b.template=""+a===a?Ca[a]||Ca(a):a),!1!==b.init&&(a=b._ctr=function(){},(a.prototype=b).constructor=a));d&&(b._parentTmpl=d);return b}function la(b,a,e,g){function k(a){if(""+a===a||0<a.nodeType){try{l=0<a.nodeType?a:!xa.test(a)&&d&&d(f.document).find(a)[0]}catch(s){}l&&(a=Ca[b=b||l.getAttribute(W)],a||(b=b||"_"+X++,l.setAttribute(W,b),a=Ca[b]=la(b,l.innerHTML,e,g)),l=c);return a}}var s,l;a=a||"";s=k(a);g=g||(a.markup?
a:{});g.tmplName=b;e&&(g._parentTmpl=e);!s&&a.markup&&(s=k(a.markup))&&s.fn&&(s.debug!==a.debug||s.allowCode!==a.allowCode)&&(s=s.markup);if(s!==c)return b&&!e&&(w[b]=function(){return a.render.apply(a,arguments)}),s.fn||a.fn?s.fn&&(a=b&&b!==s.tmplName?J(g,s):s):(a=La(s,g),oa(s.replace(y,"\\$&"),a)),F(g),a}function ma(a){function b(c,d){this.tgt=a.getTgt(c,d)}m(a)&&(a={getTgt:a});a.baseMap&&(a=k(k({},a.baseMap),a));a.map=function(a,c){return new b(a,c)};return a}function La(a,b){var c,d=va.wrapMap||
{},e=k({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:Da},b);b.htmlTag||(c=da.exec(a),e.htmlTag=c?c[1].toLowerCase():"");(c=d[e.htmlTag])&&c!==d.div&&(e.markup=r.trim(e.markup));return e}function pa(a,b){function d(f,g,h){var k,s,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(s in f)d(s,f[s],g);return I}g===c&&(g=f,f=c);f&&""+f!==f&&(h=g,g=f,f=c);l=h?h[e]=h[e]||{}:d;s=b.compile;null===g?f&&delete l[f]:(g=s?g=s(f,g,h):g,f&&(l[f]=g));s&&g&&(g._is=a);g&&(k=S.onStore[a])&&
k(f,g,s);return g}var e=a+"s";I[e]=d;Q[a]=b}function Aa(a,b){var c=this.jquery&&(this[0]||ka('Unknown template: "'+this.selector+'"')),d=c.getAttribute(W);return Da.call(d?Ca[d]:Ca(c),a,b)}function ra(a,b,c){if(va._dbgMode)try{return a.fn(b,c,I)}catch(d){return ka(d,c)}return a.fn(b,c,I)}function Da(a,b,c,d,e,f){return d||!this.fn._nvw||r.isArray(a)?P.call(this,a,b,c,d,e,f):ra(this,a,{tmpl:this})}function P(a,b,d,e,f,g){var h,k,s,l,H,u,m,t,p;s=this;var E="";!!b===b&&(d=b,b=c);!0===f&&(h=!0,f=0);s.tag?
(u=s,s=s.tag,k=s._,H=s.tagName,t=k.tmpl||u.tmpl,p=s.attr&&s.attr!==K,b=J(b,s.ctx),m=u.content,!1===u.props.link&&(b=b||{},b.link=!1),e=e||u.view,a=arguments.length?a:e):t=s;if(t&&(!e&&a&&"view"===a._is&&(e=a),e&&(m=m||e.content,g=g||e._.onRender,a===e&&(a=e.data),b=J(b,e.ctx)),e&&e.data!==c||((b=b||{}).root=a),t.fn||(t=Ca[t]||Ca(t)),t)){u=g=!1!==(b&&b.link)&&!p&&g;!0===g&&(u=c,g=e._.onRender);b=t.helpers?J(t.helpers,b):b;if(r.isArray(a)&&!d)for(l=h?e:f!==c&&e||new Z(b,"array",e,a,t,f,m,g),h=0,k=a.length;h<
k;h++)s=a[h],H=new Z(b,"item",l,s,t,(f||0)+h,m,g),s=ra(t,s,H),E+=l._.onRender?l._.onRender(s,H):s;else{if(e||!t.fn._nvw)l=h?e:new Z(b,H||"data",e,a,t,f,m,g),k&&!s.flow&&(l.tag=s);E+=ra(t,a,l)}return u?u(E,l):E}return""}function ka(a,b,c){c=va.onError(a,b,c);if(""+a===a)throw new S.Err(c);return!b.linkCtx&&b.linked?na.html(c):c}function ea(a){ka("Syntax error\n"+a)}function oa(a,b,c,d){function e(b){(b-=J)&&t.push(a.substr(J,b).replace(ia,"\\n"))}function f(b){b&&ea('Unmatched or missing tag: "{{/'+
b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,u=[],J=0,m=[],t=u,r=[,,u];c&&(a=x+a+z);f(m[0]&&m[0][2].pop()[0]);a.replace(G,function(g,H,u,p,E,D,n,q,G,w,x,I){D&&(E=":",p=K);w=w||c;H=(H||c)&&[];var y="",B="",fa="",sa="",ta="",Ka="",Oa="",Xa="";n=!w&&!E&&!n;u=u||(G=G||"#data",E);e(I);J=I+g.length;q?l&&t.push(["*","\n"+G.replace(ga,"$1")+"\n"]):u?("else"===u&&(T.test(G)&&ea('for "{{else if expr}}" use "{{else expr}}"'),H=r[7],r[8]=a.substring(r[8],I),r=m.pop(),t=r[2],n=!0),G&&s(G.replace(ia," "),
H,b).replace(M,function(a,b,c,d,e,f,g,h){g?(B+=f+",",sa+="'"+h+"',"):c?(fa+=d+f+",",Ka+=d+"'"+h+"',"):b?Oa+=f:("trigger"===e&&(Xa+=f),y+=d+f+",",ta+=d+"'"+h+"',",k=k||Na.test(e));return""}).slice(0,-1),h=[u,p||!!d||k||"",n&&[],[sa.slice(0,-1),ta.slice(0,-1),Ka.slice(0,-1)],[B.slice(0,-1),y.slice(0,-1),fa.slice(0,-1)],Oa,Xa,H||0],t.push(h),n&&(m.push(r),r=h,r[8]=J)):x&&(f(x!==r[0]&&"else"!==r[0]&&x),r[8]=a.substring(r[8],I),r=m.pop());f(!r&&x);t=r[2]});e(a.length);(J=u[u.length-1])&&f(""+J!==J&&+J[8]===
J[8]&&J[0]);c?(g=H(u,a,c),g.paths=u[0][7]):g=H(u,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Ga(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function s(a,b,c){var d,e,f,g,h,k=0,s=c?c.links:b&&(b.links=b.links||{}),l={},H={0:-1},u=0;return(a+(c?" ":"")).replace(/\)\^/g,").").replace(Fa,function(J,m,t,r,E,p,D,n,G,q,w,x,I,y,F,B,fa,sa,ta,Ka){function Oa(a,c,g,B,fa,h,sa,k){return g&&(b&&("linkTo"===d&&(e=b._jsvto=b._jsvto||
[],e.push(E)),d&&!f||b.push(E.slice(c.length))),"."!==g)?(a=(B?'view.hlp("'+B+'")':fa?"view":"data")+(k?(h?"."+h:B?"":fa?"":"."+g)+(sa||""):(k=B?"":fa?h||"":g,"")),a+=k?"."+k:"",c+("view.data"===a.slice(0,9)?a.slice(5):a)):a}p=p||"";t=t||m||x;E=E||G;q=q||fa||"";if(!D||h||g)return!b||!B||h||g||d&&!f&&!e||(B=H[u],Ka.length-1>ta-B&&(B=Ka.slice(B,ta+1),B=ha+":"+B+N,D=s[B],D||(s[B]=1,s[B]=D=oa(B,c||b,!0),D.paths.push({_jsvOb:D})),1!==D&&(e||b).push({_jsvOb:D}))),h?(h=!I,h?J:'"'):g?(g=!y,g?J:'"'):(t?(u++,
H[u]=ta++,t):"")+(sa?u?"":(k=Ka.slice(k,ta),d?(d=f=e=!1,"\b"):"\b,")+k+(k=ta+J.length,"\b"):n?(u&&ea(a),d=E,f=r,k=ta+J.length,E+":"):E?E.split("^").join(".").replace(V,Oa)+(q?(l[++u]=!0,"."!==E.charAt(0)&&(H[u]=ta),q):p):p?p:F?(l[u--]=!1,F)+(q?(l[++u]=!0,q):""):w?(l[u]||ea(a),","):m?"":(h=I,g=y,'"'));ea(a)})}function H(a,b,c){var e,f,g,h,k,s,l,u,J,m,t,r,E,p,D,n,q,G,w,x,I,y,F,N,z=0,B="",fa={},sa=a.length;""+b===b?(D=c?'data-link="'+b.replace(ia," ").slice(1,-1)+'"':b,b=0):(D=b.tmplName||"unnamed",
b.allowCode&&(fa.allowCode=!0),b.debug&&(fa.debug=!0),t=b.bnds,p=b.tmpls);for(e=0;e<sa;e++)if(f=a[e],""+f===f)B+='\n+"'+f+'"';else if(g=f[0],"*"===g)B+=";\n"+f[1]+"\nret=ret";else{h=f[1];G=f[2];k=Ga(f[3],"params")+"},"+Ga(E=f[4]);F=f[5];N=f[6];w=f[8];(I="else"===g)||(z=0,t&&(r=f[7])&&(z=t.push(r)));(f=":"===g)?h&&(g=h===K?">":h+g):(G&&(n=La(w,fa),n.tmplName=D+"/"+g,H(G,n),p.push(n)),I||(q=g,x=B,B=""),n=(n=a[e+1])&&"else"===n[0]);I=F?";\ntry{\nret+=":"\n+";if(f&&(r||N||h&&h!==K)){y="return {"+k+"};";
F&&(y="try {\n"+y+"\n}catch(e){return {error: j._err(e,view,"+F+")}}\n");y=new Function("data,view,j,u"," // "+D+" "+z+" "+g+"\n"+y);y.paths=r;y._tag=g;if(c)return y;m=1}B+=f?(c?(F?"\ntry{\n":"")+"return ":I)+(m?(m=0,J=u=!0,'c("'+h+'",view,'+(r?(t[z-1]=y,z):"{"+k+"}")+")"):">"===g?(l=!0,"h("+E[0]+")"):"((v="+E[0]+')!=null?v:"")'):(J=s=!0,"\n{view:view,tmpl:"+(G?p.length:"0")+","+k+"},");if(q&&!n){B="["+B.slice(0,-1)+"]";if(c||r)if(B=new Function("data,view,j,u"," // "+D+" "+z+" "+q+"\nreturn "+B+
";"),r&&((t[z-1]=B).paths=r),B._tag=g,c)return B;B=x+I+'t("'+q+'",view,this,'+(z||B)+")";q=r=0}F&&(J=!0,B+=";\n}catch(e){ret"+(c?"urn ":"+=")+"j._err(e,view,"+F+");}\n"+(c?"":"ret=ret"))}B="// "+D+"\nj=j||"+(d?"jQuery.":"jsviews.")+"views;var v"+(s?",t=j._tag":"")+(u?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(c?";\n":',ret=""\n')+(fa.debug?"debugger;":"")+B+(c?"\n":";\nreturn ret;");try{B=new Function("data,view,j,u",B)}catch(ta){ea("Compiled template code:\n\n"+B+'\n: "'+ta.message+'"')}b&&
(b.fn=B);J||(B._nvw=!0);return B}function J(a,b){return a&&a!==b?b?k(k({},b),a):a:b&&k({},b)}function u(a){return ba[a]||(ba[a]="&#"+a.charCodeAt(0)+";")}function E(a){var b,c,d=[];if("object"===typeof a)for(b in a)(c=a[b])&&c.toJSON&&!c.toJSON()||m(c)||d.push({key:b,prop:c});return d}function D(a){return null!=a?ca.test(a)&&(""+a).replace(qa,u)||a:""}if(!(d&&d.render||f.jsviews)){var r,t,G,xa,Ma,x="{",ha="{",N="}",z="}",O="^",V=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,
Fa=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,ia=/[ \t]*(\r\n|\n|\r)/g,ga=/\\(['"])/g,y=/['"\\]/g,M=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,T=/^if\s/,da=/<(\w+)[>\s]/,ca=/[\x00`><\"'&]/,Na=/^on[A-Z]|^convert(Back)?$/,qa=/[\x00`><"'&]/g,X=0,Ha=0,ba={"&":"&amp;","<":"&lt;",">":"&gt;",
"\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},K="html",W="data-jsv-tmpl",w={},Q={template:{compile:la},tag:{compile:aa},helper:{},converter:{}},I={jsviews:"v1.0.0-beta",settings:function(a){k(va,a);e(va._dbgMode);va.jsv&&va.jsv()},sub:{View:Z,Err:g,tmplFn:oa,cvt:q,parse:s,extend:k,syntaxErr:ea,onStore:{},_lnk:a},map:ma,_cnvt:n,_tag:l,_err:ka};(g.prototype=Error()).constructor=g;R.depends=function(){return[this.get("item"),"index"]};Y.depends=function(){return["index"]};Z.prototype={get:Ja,getIndex:Y,
getRsc:p,hlp:A,_is:"view"};for(t in Q)pa(t,Q[t]);var Ca=I.templates,na=I.converters,Ia=I.helpers,wa=I.tags,S=I.sub,va=I.settings;d?(r=d,r.fn.render=Aa,r.observable&&(k(S,r.views.sub),I.map=r.views.map)):(r=f.jsviews={},r.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});r.render=w;r.views=I;r.templates=Ca=I.templates;va({debugMode:e,delimiters:ja,onError:function(a,b,d){b&&(a=d===c?"{Error: "+a+"}":m(d)?d(a,b):d);return a==c?"":a},_dbgMode:!0});
wa({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,b,c){var d;for(a=0;(d=this.tagCtxs[a])&&d.args.length;a++)if(d=d.args[0],b=!d!==!c[a].args[0],!this.convert&&d||b)return b;return!1},flow:!0},"for":{render:function(a){var b,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(b=!arguments.length)a=d.view.data;a!==
c&&(e+=d.render(a,b),f+=r.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:a,flow:!0}});wa("props",{baseTag:wa["for"],dataMap:ma(E)});na({html:D,attr:D,url:function(a){return a!=c?encodeURI(""+a):null===a?a:""}});ja()}})(this,this.jQuery);(function(f,d,c){function a(a){return F(a)?new e(a):new b(a)}function b(a){this._data=a;return this}function e(a){this._data=a;return this}function g(a,b){a=F(a)?a:[a];var c,d,e=b,f=e,h=a.length,
k=[];for(c=0;c<h;c++)d=a[c],P(d)?k=k.concat(g(d.call(b,b),b)):""+d!==d?(b=f=d,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(d));return k}function k(a,b){var c,d;for(c in a){d=!0;break}d||delete ra[b]}function m(a,b){if(!a.data||!a.data.off){var d,e,f,g=b.oldValue,h=b.value,k=a.data,l=k.observeAll,p=!k.cb.noArray,n=k.paths;if(a.type===Aa)(k.cb.array||k.cb).call(k,a,b);else if(k.prop===b.path||"*"===k.prop)g=typeof g===la&&(n[0]||p&&F(g))&&g,h=typeof(h=b.value)===la&&(n[0]||p&&F(h))&&h,l?(d=l._path+
"."+b.path,e=l.filter,f=[l.parents().slice()],g&&R(p,l.ns,[g],n,k.cb,!0,e,f,d),h&&R(p,l.ns,[h],n,k.cb,c,e,f,d)):(g&&R(p,[g],n,k.cb,!0),h&&R(p,[h],n,k.cb)),k.cb(a,b)}}function ja(){function b(a,c,e,f){var g,h=oa(w),k=F(w)?[w]:w;a=ca?a+"."+ca:a;if(A||f)h&&d(k).off(a,m);else{if(O=h&&d._data(w))for(N=(O=(O=O&&O.events)&&O[e?Aa:pa])&&O.length;N--;)if((z=O[N].data)&&z.cb._cId===x._cId&&z.ns===ca){if(e)return;("*"===c&&z.prop!==c||z.prop===t)&&d(w).off(a,m)}c=e?{}:{fullPath:n,paths:c?[c]:[],prop:t};c.ns=
ca;c.cb=x;T&&(c.observeAll={_path:T,path:function(){g=M.length;return T.replace(/[[.]/g,function(a){g--;return"["===a?"["+d.inArray(M[g-1],M[g]):"."})},parents:function(){return M},filter:da,ns:ca});d(k).on(a,null,c,m);ia&&(ia[d.data(w,"obId")||d.data(w,"obId",ka++)]=w)}}function e(a,b){a._ob=V(a,W);var c=W;return function(d,e){var g=a._ob,h=b.length;typeof g===la&&(f(g,!0),(h||X&&F(g))&&R(X,[g],b,x,V,!0));g=a._ob=V(a,c);typeof g===la&&(f(g),(h||X&&F(g))&&R(X,[g],b,x,V,[c]));x(d,e)}}function f(d,
e,g,h){if(X){var k=w,l=T;w=d;h&&(w=d[h],T+="."+h,da&&(w=a._fltr(h,d,T,da)));w&&(g||F(w))&&b(Aa+".observe"+(x?".obs"+(ha=x._cId=x._cId||ea++):""),c,!0,e);w=k;T=l}}var h,l,p,r,t,n,q,A,x,ha,N,z,O,V,aa,ia,ga,y,M,T,da,ca,Y,ma,X=!1!=this,ja=1,ba=Da,K=Array.apply(0,arguments);h=K.pop();var W=K.shift(),w=y=W,Q=K.length;W+""===W&&X&&(ca=W,W=w=y=K.shift(),Q--);if(P(h))x=h;else if(h+""===h&&(T=h,M=K.pop(),da=K.pop(),h=K.pop(),Q-=3),!0===h?A=h:h&&(W=h,ja=0),h=K[Q-1],Q&&h===c||P(h))x=K.pop(),Q--;Q&&P(K[Q-1])&&
(V=x,x=K.pop(),Q--);ba+=A?x?".obs"+x._cId:"":".obs"+(ha=x._cId=x._cId||ea++);A||(ia=ra[ha]=ra[ha]||{});Y=ca&&ca.match(La)||[""];for(ma=Y.length;ma--;)for(ca=Y[ma],F(y)?f(y,A,!0):A&&0===Q&&y&&b(ba,""),h=ga=0;h<Q;h++)if(n=K[h],""!==n){w=y;if(""+n===n){r=n.split("^");r[1]&&(ga=r[0].split(".").length,n=r.join("."),ga=n.split(".").length-ga);if(V&&(aa=V(n,y))){Q+=aa.length-1;Z.apply(K,[h--,1].concat(aa));continue}r=n.split(".")}else ja&&!P(n)&&(n._jsvOb&&(y=e(n,K.slice(h+1)),y.noArray=!X,y._cId=x._cId,
R(X,[W],K.slice(0,h),y,V),y=c,n=n._ob),w=n),y=n,r=[y];for(;w&&(t=r.shift())!==c;)if(typeof w===la){if(""+t===t){if(""===t)continue;if(r.length<ga+1&&!w.nodeType){if(!A&&(O=oa(w)&&d._data(w))){N=(O=(O=O.events)&&O[pa])&&O.length;for(p=0;N--;)!(z=O[N].data)||z.cb!==x||z.ns!==ca||z.prop!==t&&"*"!==z.prop||((l=r.join("."))&&z.paths.push(l),p++);if(p){w=w[t];continue}}if("*"===t){!A&&O&&O.length&&b(ba,"",!1,!0);P(w)?(q=w.depends)&&R(X,[q],x,A||W):b(ba,"");for(l in w)f(w,A,c,l);break}else t&&b(ba+"."+t,
r.join("."))}T&&(T+="."+t);t=w[t]}if(P(t)){(q=t.depends)&&R(X,[w],g(q,w),x,V,A||[W]);break}w=t}f(w,A)}ha&&k(ia,ha);return{cbId:ha,bnd:ia}}function Ja(){[].push.call(arguments,!0);return ja.apply(this,arguments)}function R(){var a=[].concat.apply([],arguments);return ja.apply(a.shift(),a)}function Y(a,b,c,d){a+""!==a&&(c=b,b=a,a="");n(a,this._data,b,c,[],"root",d)}function A(a,b,c){Y.call(this,a,b,c,!0)}function n(b,d,e,f,g,h,k){function l(c,d){p=c.length;for(x=h+"[]";p--;)(A=a._fltr(p,c,x,f))&&n(b,
A,e,f||"",g.slice(),x,d)}function m(a,c){h=a.data.observeAll._path;var d=g;g[0]!==a.target&&(g=g.slice(),g.unshift(a.target));switch(c.change){case "insert":l(c.items);break;case "remove":l(c.items,!0);break;case "refresh":l(c.oldItems,!0);l(a.target);break;case "set":x=h+"."+c.path,n(b,c.oldValue,e,0,g.slice(),x,!0),n(b,c.value,e,0,g.slice(),x)}e.apply(this,arguments);g=d}var p,q,x,A;if(typeof d===la){q=F(d)?"":"*";g.unshift(d);if(e){if(q||0!==f)m._cId=e._cId=e._cId||ea++,ja(b,d,q,m,k,f,g.slice(),
h)}else ja(b,d,q,c,k,f,g.slice(),h);if(q)for(p in d)"_"!==p.charAt(0)&&p!==aa&&(x=h+"."+p,(A=a._fltr(p,d,x,f))&&n(b,A,e,f||0,g.slice(),x,k));else l(d,k)}}function q(a,b,c){return 0>c.indexOf(".")&&0>c.indexOf("[")&&b[a]}if(!d)throw"jsViews/jsObservable require jQuery";if(!d.observable){f=d.views=d.views||{jsviews:"v1.0.0-alpha",sub:{}};var p=f.sub,l=d.event.special,Z=[].splice,F=d.isArray,aa=d.expando,la="object",ma=parseInt,La=/\S+/g,pa=p.propChng=p.propChng||"propertyChange",Aa=p.arrChng=p.arrChng||
"arrayChange",ra=p._cbBnds=p._cbBnds||{},Da=pa+".observe",P=d.isFunction,ka=1,ea=1,oa=d.hasData,Ga={};p.getDeps=function(){var a=arguments;return function(){for(var b,c,d=[],e=a.length;e--;)b=a[e--],(c=a[e])&&(d=d.concat(P(c)?c(b,b):c));return d}};d.observable=a;a._fltr=function(a,b,c,d){(a=d&&P(d)?d(a,b,c):b[a])&&(a=P(a)?a.set&&a.call(b):a);return typeof a===la&&a};a.Object=b;a.Array=e;d.observe=a.observe=ja;d.unobserve=a.unobserve=Ja;a._apply=R;b.prototype={_data:null,observeAll:Y,unobserveAll:A,
data:function(){return this._data},setProperty:function(a,b,d){var e,f=this._data;a=a||"";if(f)if(F(a))for(e=a.length;e--;)b=a[e],this.setProperty(b.name,b.value,d===c||d);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],b);else if(a!==aa){for(a=a.split(".");f&&1<a.length;)f=f[a.shift()];f&&this._setProperty(f,a[0],b,d)}return this},removeProperty:function(a){this.setProperty(a,Ga);return this},_setProperty:function(a,b,d,e){var f,g,h,k=b?a[b]:a;P(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));
if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)f?(f.call(a,d),d=g.call(a)):(h=d===Ga)?(delete a[b],d=c):b&&(a[b]=d),this._trigger(a,{change:"set",path:b,value:d,oldValue:k,remove:h})},_trigger:function(a,b){d(a).triggerHandler(pa,b)}};e.prototype={_data:null,observeAll:Y,unobserveAll:A,data:function(){return this._data},insert:function(a,b){var c=this._data;1===arguments.length&&(b=a,a=c.length);a=ma(a);-1<a&&a<=c.length&&(b=F(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,
b){var c=this._data,d=c.length;Z.apply(c,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},d)},remove:function(a,b){var d;d=this._data;a===c&&(a=d.length-1);a=ma(a);b=b?ma(b):0===b?0:1;-1<b&&-1<a&&(d=d.slice(a,a+b),(b=d.length)&&this._remove(a,b,d));return this},_remove:function(a,b,c){var d=this._data,e=d.length;d.splice(a,b);this._trigger({change:"remove",index:a,items:c},e)},move:function(a,b,c){c=c?ma(c):0===c?0:1;a=ma(a);b=ma(b);if(0<c&&-1<a&&-1<b&&a!==b){var d=this._data.slice(a,
a+c);(c=d.length)&&this._move(a,b,c,d)}return this},_move:function(a,b,c,d){var e=this._data,f=e.length;e.splice(a,c);e.splice.apply(e,[b,0].concat(d));this._trigger({change:"move",oldIndex:a,index:b,items:d},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,b){var c=this._data,d=c.length;Z.apply(c,[0,c.length].concat(b));this._trigger({change:"refresh",oldItems:a},d)},_trigger:function(a,b){var c=this._data,e=c.length,c=d([c]);c.triggerHandler(Aa,
a);e!==b&&c.triggerHandler(pa,{change:"set",path:"length",value:e,oldValue:b})}};l[pa]=l[Aa]={remove:function(a){var b,c,e,f,g=a.data;if(g&&(g.off=1,g=g.cb)&&(b=ra[g._cId])){a=d._data(this).events[a.type];for(e=a.length;e--&&!c;)c=(f=a[e].data)&&f.cb===g;c||(delete b[d.data(this,"obId")],k(b,g._cId))}}};f.map=function(b){function e(c,d,f){var g,h=this;this.src&&this.unmap();"object"===typeof c&&(h.src=c,h.tgt=f||h.tgt||[],h.options=d||h.options,h.update(),b.obsSrc&&a(h.src).observeAll(h.obs=function(a,
c){g||(g=1,b.obsSrc(h,a,c),g=0)},h.srcFlt),b.obsTgt&&a(h.tgt).observeAll(h.obt=function(a,c){g||(g=1,b.obsTgt(h,a,c),g=0)},h.tgtFlt))}(e.prototype={srcFlt:b.srcFlt||q,tgtFlt:b.tgtFlt||q,update:function(a){d.observable(this.tgt).refresh(b.getTgt(this.src,this.options=a||this.options))},unmap:function(){this.src&&(this.obs&&d.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&d.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=c)},map:e,_def:b}).constructor=e;P(b)&&(b=
{getTgt:b});b.baseMap&&(b=d.extend({},b.baseMap,b));b.map=function(a,b,c){return new e(a,b,c)};return b}}})(this,this.jQuery);(function(f,d,c){function a(a,b,e){var f,g,h,k,l,p,n,q,r,C=a.target,s=C._jsvBnd,v=/&(\d+)\+?/g;if(s)for(;h=v.exec(s);)if(h=Ba[h[1]])if(b=h.to){h=h.linkCtx;n=h.view;r=h.tag;p=d(C);l=n.hlp(Q);q=n.hlp(I);g=m(C);f=Ra[g];e===c&&(e=ca(g)?g(C):f?p[f]():p.attr(g));f=b[1];b=b[0];f&&(k=ca(f)?f:n.getRsc("converters",f));k&&(e=k.call(r,e));f=n.linkCtx;n.linkCtx=h;g={change:"change",oldValue:h._val,
value:e};if(!(l&&!1===l.call(h,a,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(a,g)||e===c)&&(l=b[0],e!==c&&l)){l=l._jsvOb?l._ob:l;r&&(r._.chging=!0);X(l).setProperty(b[2]||b[1],e);q&&q.call(h,a,g);if(r){if(r.onAfterChange)r.onAfterChange(a,g);delete r._.chging}h._val=e}n.linkCtx=f}}function b(a,b,f){var g,h,k,l=this.data,p=this.elem,n=this.convert;h=p.parentNode;var q=this.view,r=q.linkCtx,s=q.hlp(Q);q.linkCtx=this;if(h&&!(s&&b&&!1===s.call(this,a,b)||b&&"*"!==a.data.prop&&a.data.prop!==b.path)){b&&
(this.eventArgs=b);if(b||this._initVal){delete this._initVal;h=f.call(q.tmpl,l,q,y);a:{var C=h,t=k=this.tag;g=this.attr||m(p,!0,n!==c);var v,u,w=t&&t.parentElem||this.elem;if(C!==c){u=d(w);g=t&&t.attr||g;ca(C)&&ha(this.expr+": missing parens");"visible"===g&&(g="css-display");if(t=/^css-/.test(g)&&g.slice(4))v=d.style(w,t),+C===C&&(v=parseInt(v));else if("link"!==g){if("value"===g)w.type===Ia&&(v=u.prop(g=na));else if(g===wa)if(w.value===""+C)v=u.prop(na);else break a;v===c&&(v=(v=Ra[g])?u[v]():u.attr(g))}this._val=
v}}if(h&&h.error!==c)h=h.error;else if(k){h=h[0]?h:[h];f=b&&k.onUpdate&&!1===k.onUpdate(a,b,h);ra(k,h);if(f||g===S){g===U&&k.onBeforeLink&&k.onBeforeLink();ma(k,k.tagCtx);R(this,l,p);q.linkCtx=r;return}if(k._.chging)return;h=":"===k.tagName?y._cnvt(k.cvt,q,h[0]):y._tag(k,q,q.tmpl,h,!0)}else f._tag&&(h=(n=""===n?va:n)?y._cnvt(n,q,h):y._tag(f._tag,q,q.tmpl,h,!0),k=this.tag,g=this.attr||g);e(h,this,g,k)&&b&&(s=q.hlp(I))&&s.call(this,a,b);k&&ma(k,k.tagCtx)}R(this,l,p);q.linkCtx=r}}function e(a,b,e,g){var k,
l,m,p,n,q,r=a!==c,t=b.data,C=g&&g.parentElem||b.elem,u=d(C),v=b.view;q=b._val;var w=v.ctx,y=v.linkCtx,x=g||e===U;g&&(g.parentElem=g.parentElem||b.expr||g._elCnt?C:C.parentNode,l=g._prv,m=g._nxt);if(r){if(/^css-/.test(e))"visible"===b.attr&&(b=(C.currentStyle||eb.call(f,C,"")).display,a?(a=C._jsvd||b,a!==S||(a=bb[k=C.nodeName])||(b=ga.createElement(k),ga.body.appendChild(b),a=bb[k]=(b.currentStyle||eb.call(f,b,"")).display,ga.body.removeChild(b))):(C._jsvd=b,a=S)),(x=x||q!==a)&&d.style(C,e.slice(4),
a);else if("link"!==e){if(e===na)n=1,a=a&&"false"!==a;else if(e===wa)if(C.value===""+a)a=!0,n=1,e=na;else{R(b,t,C);return}else if("selected"===e||"disabled"===e||"multiple"===e||"readonly"===e)a=a&&"false"!==a?e:null;if(k=Ra[e])if(e===U){v.linkCtx=b;v.ctx=b.ctx;if(g&&g._.inline){e=g.nodes(!0);if(g._elCnt){if(l&&l!==m)s(l,m,C,g._tgId,"^",!0);else if(p=C._dfr)q=g._tgId+"^",k=p.indexOf("#"+q)+1,n=p.indexOf("/"+q),k&&0<n&&(k+=q.length,n>k&&(C._dfr=p.slice(0,k)+p.slice(n),H(p.slice(k,n))));l=l?l.previousSibling:
m?m.previousSibling:C.lastChild}d(e).remove();if(g&&g.onBeforeLink)g.onBeforeLink();p=v.link(v.data,C,l,m,a,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{r&&u.empty();if(g&&g.onBeforeLink)g.onBeforeLink();r&&(p=v.link(t,C,l,m,a,g&&{tag:g._tgId}))}v.linkCtx=y;v.ctx=w}else{if(x=x||q!==a)if("text"===e&&C.children&&!C.children[0])C.textContent!==c?C.textContent=a:C.innerText=null===a?"":a;else u[k](a)}else if(x=x||q!==a)u[n?"prop":"attr"](e,a!==c||n?a:null);b._val=a}return p||x}if(e===U&&g&&
g.onBeforeLink)g.onBeforeLink()}function g(a,b){var c=this.hlp(Q),d=this.hlp(I);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,e=b.items;switch(b.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,a,b)}}function k(a){var b,e=a.data,f=a._.bnd;if(!a._.useKey&&f){if(b=a._.bndArr)d([b[1]]).off(W,b[0]),a._.bndArr=c;f!==!!f&&f._.inline?e?f._.arrVws[a._.id]=a:delete f._.arrVws[a._.id]:
e&&(b=function(b){b.data&&b.data.off||g.apply(a,arguments)},d([e]).on(W,b),a._.bndArr=[b,e])}}function m(a,b,c){var d=a.nodeName.toLowerCase(),e=T.merge[d]||a.contentEditable===va&&{to:U,from:U};return e?b?"input"===d&&a.type===wa?wa:e.to:e.from:b?c?"text":U:""}function ja(a,b,e,g,f,h,k){var l,m,p,n=a.parentElem,q=a._prv,r=a._nxt,t=a._elCnt;q&&q.parentNode!==n&&ha("Missing parentNode");if(k)for(p in m=a.nodes(),t&&q&&q!==r&&s(q,r,n,a._.id,"_",!0),a.removeViews(c,c,!0),g=r,t&&(q=q?q.previousSibling:
r?r.previousSibling:n.lastChild),d(m).remove(),a._.bnds)P(p);else{if(b){l=g[b-1];if(!l)return!1;q=l._nxt}t?q=(g=q)?g.previousSibling:n.lastChild:g=q.nextSibling}b=e.render(f,h,a._.useKey&&k,a,k||b,!0);a.link(f,n,q,g,b,l)}function Ja(a,b,d){var e;d?(e="^`",b=b._.tag||{_:{inline:!0,bnd:d},tagCtx:{view:b},flow:!0},d=b._tgId,d||(Ba[d=cb++]=b,b._tgId=""+d)):(e="_`",ia[d=b._.id]=b);return"#"+d+e+(a!=c?a:"")+"/"+d+e}function R(a,b,d){var e,g=a.tag,f=a.convertBack,h=[],k=a._bndId||""+cb++,l=a._hdlr;delete a._bndId;
g&&(h=g.depends||h,h=ca(h)?g.depends(g):h,e=g.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&X._apply(!1,[b],a._depends,l,!0),b=X._apply(!1,[b],a.fn.paths,h,l,a._ctxCb),b.elem=d,b.linkCtx=a,b._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Ba[k]=b,e&&(b.to=[[],f]),(e||f!==c)&&Aa(b,g&&g.convertBack||f),g){if(g.onAfterBind)g.onAfterBind(b);g.flow||g._.inline||(d.setAttribute(ba,(d.getAttribute(ba)||"")+"#"+k+"^/"+k+"^"),g._tgId=""+k)}if(e&&e[0])for(g._.radio&&
(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=g}function Y(a,b,c,d,e,g,f){return A(this,a,b,c,d,e,g,f)}function A(b,e,g,f,h,k,l,m){if(b&&e){e=e.jquery?e:d(e);D||(D=ga.body,d(D).on(w,a).on("blur","[contenteditable]",a));for(var n,p,t,s,C,u,v,x=Ja,y=f&&"replace"===f.target,A=e.length;A--;)if(v=e[A],""+b===b)C=r(v),n=C.ctx,C.ctx=f,q(b,v,C,g),C.ctx=n;else{k=k||r(v);if(b.markup!==c)!1===k.link&&(f=f||{},f.link=x=!1),y&&(u=v.parentNode),t=b.render(g,
f,h,k,c,x),u?(l=v.previousSibling,m=v.nextSibling,d.cleanData([v],!0),u.removeChild(v),v=u):(l=m=c,d(v).empty());else if(!0!==b)break;if(v._dfr&&!m){s=F(v._dfr,1,db);n=0;for(p=s.length;n<p;n++)C=s[n],(C=ia[C.id])&&C.data!==c&&C.parent.removeViews(C._.key,c,!0);v._dfr=""}k.link(g,v,l,m,t,c,f)}}return e}function n(a,b,e,f,h,m,n,p){function s(a,b,d,e,g,f,k,B,l,fa,sa,m,ta){var n,p="";if(ta)return C=0,a;v=B||l||"";e=e||fa;d=d||m;ka&&!d&&(e||v||f)&&(ka=c,ya=oa.shift());if(e=e||d)C=0,ka=c,da&&(d||m?Wa[ya]||
/;svg;|;math;/.test(";"+oa.join(";")+";")||(n="'<"+ya+".../"):Wa[e]?n="'</"+e:oa.length&&e===ya||(n="Mismatch: '</"+e),n&&Ta(n+">' in:\n"+h)),pa=za,ya=oa.shift(),za=Va[ya],fa=fa?"</"+fa+">":"",pa&&(ua+=Ea,Ea="",za?ua+="-":(p=fa+Za+"@"+ua+Ya+(sa||""),ua=Ga.shift()));za?(f?Ea+=f:b=fa||m||"",v&&(b+=v,Ea&&(b+=" "+ba+'="'+Ea+'"',Ea=""))):b=f?b+p+g+Za+f+Ya+k+v:p||a;C&&f&&Ta(" No {^{ tags within elem markup ("+C+' ). Use data-link="..."');v&&(C=v,oa.unshift(ya),ya=v.slice(1),oa[0]&&oa[0]===jb[ya]&&ha("Parent of <tr> must be <tbody>"),
ka=Wa[ya],(za=Va[ya])&&!pa&&(Ga.unshift(ua),ua=""),pa=za,ua&&za&&(ua+="+"));return b}function t(a,d){var e,f,h,B,sa=[];if(a){"@"===a._tkns.charAt(0)&&(d=L.previousSibling,L.parentNode.removeChild(L),L=c);for(G=a.length;G--;){E=a[G];h=E.ch;if(e=E.path)for(D=e.length-1;f=e.charAt(D--);)"+"===f?"-"===e.charAt(D)?(D--,d=d.previousSibling):d=d.parentNode:d=d.lastChild;if("^"===h){if(v=Ba[e=E.id]){f=d&&(!L||L.parentNode!==d);if(!L||f)v.parentElem=d;E.elCnt&&f&&(d._dfr=(E.open?"#":"/")+e+h+(d._dfr||""));
sa.push([f?null:L,E])}}else if(z=ia[e=E.id])(z.parentElem||(z.parentElem=d||L&&L.parentNode||b,z._.onRender=Ja,z._.onArrayChange=g,k(z)),f=z.parentElem,E.open)?(z._elCnt=E.elCnt,d?d._dfr="#"+e+h+(d._dfr||""):(z._prv||(f._dfr=l(f._dfr,"#"+e+h)),z._prv=L)):(!d||L&&L.parentNode===d?L&&(z._nxt||(f._dfr=l(f._dfr,"/"+e+h)),z._nxt=L):(d._dfr="/"+e+h+(d._dfr||""),z._nxt=c),y=z.linkCtx,(B=z.ctx&&z.ctx.onAfterCreate||Ia)&&B.call(y,z))}for(G=sa.length;G--;)xa.push(sa[G])}return!a||a.elCnt}function u(a){var b,
c;if(a)for(G=a.length,D=0;D<G;D++)if(E=a[D],S.id)S.id=S.id!==E.id&&S.id;else if(c=v=Ba[E.id].linkCtx.tag,!v.flow){if(!X){for(b=1;c=c.parent;)b++;ja=ja||b}!X&&b!==ja||Y&&v.tagName!==Y||W.push(v)}}function w(){I=Ua?b.querySelectorAll(O):d(O,b).get();H=I.length;e&&e.innerHTML&&(M=Ua?e.querySelectorAll(O):d(O,e).get(),e=M.length?M[M.length-1]:e);for(A=ja=0;A<H;A++)if(L=I[A],e&&!Aa)Aa=L===e;else if(f&&L===f)break;else L.parentNode&&Ha(F(L,c,W&&ob))&&!S&&L.getAttribute(N)&&xa.push([L]);wa===Fa&&h===c&&
b.getAttribute(N)&&xa.push([b]);aa(e,za);aa(f,za);if(!S){if(za&&ua+Ea&&(L=f,ua&&(f?t(F(ua+"+",1),f):t(F(ua,1),b)),t(F(Ea,1),b),f)){U=f.getAttribute(ba);if(H=U.indexOf(ra)+1)U=U.slice(H+ra.length-1);f.setAttribute(ba,Ea+U)}H=xa.length;for(A=0;A<H;A++)if(L=xa[A],J=L[1],L=L[0],J){if(v=Ba[J.id]){if(y=v.linkCtx)v=y.tag,v.linkCtx=y;J.open?(L&&(v.parentElem=L.parentNode,v._prv=L),v._elCnt=J.elCnt,!v||v.onBeforeLink&&!1===v.onBeforeLink()||v._.bound||(v._.bound=!0,z=v.tagCtx.view,q(c,v._prv,z,a,J.id)),v._.linking=
!0):(v._nxt=L,v._.linking&&(ca=v.tagCtx,z=ca.view,delete v._.linking,v._.bound||(v._.bound=!0,q(c,v._prv,z,a,J.id)),ma(v,ca)))}}else z=r(L),q(L.getAttribute(N),L,z,a,c,n)}qa&&qa.resolve()}var C,y,v,A,H,D,G,I,L,z,E,J,M,K,Q,R,P,W,X,Y,ca,da,ja,S,ea,Z,ya,ka,na,U,za,pa,Ea,ra,Aa,qa,wa=this,Da=wa._.id+"_",ua="",xa=[],oa=[],Ga=[],Ia=wa.hlp(Ca),Ha=t;m&&(qa=m.lazyLink&&d.Deferred(),m.tmpl?Q="/"+m._.id+"_":(S=m.get,m.tag&&(Da=m.tag+"^",m=!0)),m=!0===m);S&&(Ha=u,W=S.tags,X=S.deep,Y=S.name);b=b?""+b===b?d(b)[0]:
b.jquery?b[0]:b:wa.parentElem||ga.body;da=!T.noValidate&&b.contentEditable!==va;ya=b.tagName.toLowerCase();za=!!Va[ya];e=e&&la(e,za);f=f&&la(f,za)||null;if(h!=c){na=ea=ga.createElement("div");ra=Ea="";Z="http://www.w3.org/2000/svg"===b.namespaceURI?"svg_ns":(K=hb.exec(h))&&K[1]||"";x&&K&&K[2]&&ha("Unsupported: "+K[2]);if(za){for(P=f;P&&!(R=F(P));)P=P.nextSibling;if(U=R?R._tkns:b._dfr){K=Q||"";if(m||!Q)K+="#"+Da;D=U.indexOf(K);D+1&&(D+=K.length,ra=Ea=U.slice(0,D),U=U.slice(D),R?P.setAttribute(ba,U):
b._dfr=U)}}ka=c;h=(""+h).replace(lb,s);da&&oa.length&&Ta("Mismatched '<"+ya+"...>' in:\n"+h);if(p)return;ab.appendChild(ea);Z=V[Z]||V.div;m=Z[0];for(na.innerHTML=Z[1]+h+Z[2];m--;)na=na.lastChild;ab.removeChild(ea);for(ea=ga.createDocumentFragment();Z=na.firstChild;)ea.appendChild(Z);b.insertBefore(ea,f)}qa?setTimeout(w,0):w();return qa&&qa.promise()}function q(a,b,e,f,g,h){var k,l,n,q,r,s,u,w;f=e.data===c?f||{}:e.data;if(g)h=Ba[g],h=h.linkCtx?h.linkCtx.tag:h,u=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:
b,view:e,ctx:e.ctx,attr:U,fn:h._.bnd,tag:h,_bndId:g},p(u,u.fn);else if(a&&b)for(k=e.tmpl,n=m(b),a=d.trim(a).replace(ib,"\\$&"),a=a.slice(-1)!==xa?G+":"+a+(n?":":"")+xa:a,t.lastIndex=0;l=t.exec(a);)w=t.lastIndex,n=g?U:l[1],s=l[3],r=l[10],q=c,u={data:f,elem:b,view:e,ctx:h||e.ctx,attr:n,_initVal:!l[2]},l[6]&&(!n&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==c&&(r=-q.length-1,s=s.slice(0,r-1)+xa)),null===q&&(q=c),u.convert=l[5]||""),u.expr=n+s,(l=k.links[s])||(k.links[s]=l=M.tmplFn(s,k,!0,q)),u.fn=l,n||q===
c||(u.convertBack=q),p(u,l),t.lastIndex=w}function p(a,c){function d(e,f){b.call(a,e,f,c)}d.noArray=!0;a._ctxCb=oa(a.view);a._hdlr=d;d(!0)}function l(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function Z(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ba)||"")}function F(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:Z(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||
!a.type,f._tkns=b,b.replace(c||pb,d),f}function aa(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(N)&&a.removeAttribute(N))}function la(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ga.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):Z(c)||c.getAttribute(N)||c.setAttribute(N,""));return c}function ma(a,b){var e,f,g,h,k,l,m;e=b.view;var n=a.linkCtx=a.linkCtx||{tag:a,data:e.data,view:e,ctx:e.ctx};if(a.onAfterLink)a.onAfterLink(b,
n);if(f=(e=a.targetTag?a.targetTag.linkedElem:a.linkedElem)&&e[0]){if(g=a._.radio)e=e.children("input[type=radio]");if(g||!a._.chging){h=M.cvt(a,a.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(a._.inline&&(!k||k!==a&&k.targetTag!==a))for(f._jsvLnkdEl=a,k=n.elem?n.elem._jsvBnd:a._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)Aa(Ba[k[l]],a.convertBack);g&&(f[na]=h===f.value)}n._val=h}h!==c&&(g||f.value===c?f.contentEditable===va&&(f.innerHTML=h):f.type===
Ia?f[na]=h&&"false"!==h:e.val(h))}}if(f=f||":"===a.tagName&&n.elem)g=f._jsvTr,h=b.props.trigger,g!==h&&(f._jsvTr=h,e=e||d(f),pa(e,g,"off"),pa(e,h,"on"))}function La(b){setTimeout(function(){a(b)},0)}function pa(b,c,d){c&&b[d](!0===c?"keydown":c,!0===c?La:a)}function Aa(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],
b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function ra(a,b){var c,e;c=a.tagCtx.view;var f=a.tagCtxs||[a.tagCtx],g=f.length,h=!b;for(b=b||a._.bnd.call(c.tmpl,(a.linkCtx||c).data,c,y);g--;)c=f[g],e=b[g],d.observable(c.props).setProperty(e.props),da(c.ctx,e.ctx),c.args=e.args,h&&(c.tmpl=e.tmpl);return f}function Da(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd=
"",a=c.length;a--;)P(c[a],b._jsvLnkdEl,b);H(Z(b)+(b._dfr||""))}}function P(a,b,e){var f,g,h,k=Ba[a];if(b)e===b.linkedElem[0]&&(delete e._jsvLnkdEl,delete b.linkedElem);else if(k){delete Ba[a];for(f in k.bnd)b=k.bnd[f],e=".obs"+k.cbId,d.isArray(b)?d([b]).off(W+e).off(K+e):d(b).off(K+e),delete k.bnd[f];if(f=k.linkCtx){if(b=f.tag){if(e=b.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=b.linkedElem)&&h[0]||f.elem)&&e._jsvTr)pa(h||d(e),g,"off"),e._jsvTr=c;if(b.onDispose)b.onDispose();b._elCnt||
(b._prv&&b._prv.parentNode.removeChild(b._prv),b._nxt&&b._nxt.parentNode.removeChild(b._nxt))}delete f.view._.bnds[a]}delete M._cbBnds[k.cbId]}}function ka(b,e){b===c?(D&&(d(D).off(w,a).off("blur","[contenteditable]",a),D=c),b=!0,Fa.removeViews(),Da(ga.body.getElementsByTagName("*"))):e&&!0===b&&(e=e.jquery?e:d(e),e.each(function(){for(var a;(a=r(this,!0))&&a.parent;)a.parent.removeViews(a._.key,c,!0);Da(this.getElementsByTagName("*"));Da([this])}));return e}function ea(a,b){return ka(this,a,b)}function oa(a){a=
a||d.view();return function(b,c){var d,e,f=[c];if(a&&b){if(b._jsvOb)return b._jsvOb.call(a.tmpl,c,a,y);if("~"===b.charAt(0)){if("~tag"===b.slice(0,4)&&(e=a.ctx,"."===b.charAt(4)&&(d=b.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];b=b.slice(1).split(".");if(c=a.hlp(b.shift()))b.length&&f.unshift(b.join(".")),f.unshift(c);return c?f:[]}if("#"===b.charAt(0))return"#data"===b?[]:[a,b.replace(kb,""),c]}}}function Ga(a){return a.type===Ia?a[na]:a.value}function s(a,b,c,d,e,f){var g,h,k,
m,n,p,q=0,r=a===b;if(a){k=F(a)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?ia[p]:Ba[p].linkCtx.tag,m.open?n._prv=b:m.close&&(n._nxt=b));q+=p.length+2}q&&a.setAttribute(ba,a.getAttribute(ba).slice(q));a=b?b.getAttribute(ba):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ba,a):c._dfr=a)}else c._dfr=l(c._dfr,"#"+d+e),f||b||(c._dfr=l(c._dfr,"/"+d+e))}function H(a){var b,d,e;if(e=F(a,1,mb))for(a=
0,b=e.length;a<b;a++)d=e[a],"_"===d.ch?(d=ia[d.id])&&d.data!==c&&d.parent.removeViews(d._.key,c,!0):P(d.id)}function J(a,b,c){switch(c.change){case "set":a=a.tgt;for(b=a.length;b--&&a[b].key!==c.path;);-1===b?c.path&&d.observable(a).insert({key:c.path,prop:c.value}):c.remove?d.observable(a).remove(b):d.observable(a[b]).setProperty("prop",c.value)}}function u(a,b,c){a=a.src;switch(c.change){case "set":"prop"===c.path?d.observable(a).setProperty(b.target.key,c.value):(d.observable(a).setProperty(c.oldValue,
null),delete a[c.oldValue],d.observable(a).setProperty(c.value,b.target.prop));break;case "remove":b=c.items[0];d.observable(a).removeProperty(b.key);delete a[b.key];break;case "insert":b=c.items[0],b.key&&d.observable(a).setProperty(b.key,b.prop)}}function E(a,b,c){return 0>c.indexOf(".")&&b[a]}var D,r,t,G,xa,Ma,x,ha,N,z,O,V,Fa,ia,ga=f.document,y=d.views,M=y.sub,T=y.settings,da=M.extend,ca=d.isFunction,Na=y.converters,qa=y.tags,X=d.observable,Ha=X.observe,ba="data-jsv",K=M.propChng=M.propChng||"propertyChange",
W=M.arrChng=M.arrChng||"arrayChange",w="change.jsv",Q="onBeforeChange",I="onAfterChange",Ca="onAfterCreate",na="checked",Ia="checkbox",wa="radio",S="none",va="true",Ya='">\x3c/script>',Za='<script type="jsv',Qa="script,["+ba+"]",U="html",Ra={value:"val",input:"val",html:U,text:"text"},$a={from:"value",to:"value"},Sa=0,fb=d.cleanData,gb=T.delimiters,Ta=M.syntaxErr,hb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,ib=/['"\\]/g,ab=ga.createDocumentFragment(),Ua=ga.querySelector,Va={ol:1,ul:1,table:1,
tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},jb={tr:"table"},Wa={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},bb={},Ba={},cb=1,kb=/^#(view\.?)?/,lb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,db=/(#)()(\d+)(_)/g,mb=/(#)()(\d+)([_^])/g,nb=/(?:(#)|(\/))(\d+)(_)/g,ob=/(#)()(\d+)(\^)/g,pb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,
eb=f.getComputedStyle;if(!d)throw"JsViews requires jQuery";if(!d.views)throw"JsViews requires JsRender";if(!d.observable)throw"JsViews requires jquery.observable";d.link||(z={contents:function(a,b){a!==!!a&&(b=a,a=c);var e,f=d(this.nodes());f[0]&&(e=b?f.filter(b):f,f=a&&b?e.add(f.find(b)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&
(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,b){a!==!!a&&(b=a,a=c);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(c,this.parentElem,f?e.previousSibling:e,this._nxt,c,{get:{tags:g,deep:a,name:b,id:f&&this._tgId}});return g},refresh:function(a){var b,d=this.linkCtx,f=this.tagCtx.view;this.disposed&&ha("Removed tag");a===c&&(a=y._tag(this,f,f.tmpl,ra(this),!0));a+""===a&&(b=this._.inline?U:d.attr||m(this.parentElem,
!0),b=e(a,d,b,this));ma(this,this.tagCtx);return b||this},update:function(b){var d=this.linkedElem;d&&a({target:d[0]},c,b)}},M.onStore.template=function(a,b){b.link=Y;b.unlink=ea;a&&(d.link[a]=function(){return Y.apply(b,arguments)},d.unlink[a]=function(){return ea.apply(b,arguments)})},M.onStore.tag=function(a,b){M._lnk(b)},M._lnk=function(a){return da(a,z)},M.viewInfos=F,(T.delimiters=function(){var a=gb.apply(y,arguments);G=a[1];xa=a[2];Ma=a[4];t=RegExp("(?:^|\\s*)([\\w-]*)(\\"+Ma+")?(\\"+G+M.rTag+
"\\"+xa+")","g");return this})(),da(M._lnk(M.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==ja(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)X(f[a]).setProperty("index",a);return this},removeViews:function(a,b,e){function f(a){var b,g,h,l,n,p=m[a];if(p&&p.link){a=p._.id;e||(n=p.nodes());p.removeViews(c,c,!0);p.data=c;h=p._prv;l=p._nxt;g=p.parentElem;e||(p._elCnt&&s(h,l,g,a,"_"),d(n).remove());if(!p._elCnt)try{h.parentNode.removeChild(h),
l.parentNode.removeChild(l)}catch(q){}k(p);for(b in p._.bnds)P(b);delete ia[a]}}var g,h,l=!this._.useKey,m=this.views;l&&(h=m.length);if(a===c)if(l){for(g=h;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(b===c&&(l?b=1:(f(a),delete m[a])),l&&b){for(g=a+b;g-- >a;)f(g);m.splice(a,b);if(h=m.length)for(;a<h;)X(m[a]).setProperty("index",a++)}return this},refresh:function(a){var b=this.parent;b&&(ja(this,this.index,this.tmpl,b.views,this.data,a,!0),k(this));return this},link:n}),ia={0:Fa=
new M.View(c,"top")},Na.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},qa("on",{attr:S,onAfterLink:function(a,b){for(var e,f,g=0,h=a.args,k=a.props.data,l=a.view,m=a.props.context;!ca(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(a.params.args.slice(-f.length-1)[0]))&&M.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(b.data,
l));if(e){if(this._evs)this.onDispose();d(b.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==c?null:k,this._hlr=function(a){return e.apply(m||b.data,[].concat(f,a,{change:a.type,view:l,linkCtx:b}))})}},onDispose:function(){d(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),da(qa["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();
else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,c,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],e=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(c=g[a])&&e!==c[0]&&(Ha(c[0],c[1],!0),delete g[a]),!g[a]&&d.isArray(e)&&(Ha(e,b=function(a,b){f.onArrayChange(a,b)}),g[a]=[e,b]);for(a=l+1;a<k;a++)if(c=g[a])Ha(c[0],c[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)Ha(this._ars[a][0],
this._ars[a][1],!0)}}),da(qa["for"],z),da(qa["if"],z),da(qa.include,z),qa("props",{baseTag:qa["for"],dataMap:y.map({getTgt:qa.props.dataMap.getTgt,obsSrc:J,obsTgt:u,tgtFlt:E})}),da(d,{view:y.view=r=function(a,b,e){b!==!!b&&(e=b,b=c);var f,g,h,k,l,m;m=0;l=ga.body;if(a&&a!==l&&1<Fa._.useKey&&(a=""+a===a?d(a)[0]:a.jquery?a[0]:a))if(b)for(m=Ua?a.querySelectorAll(Qa):d(Qa,a).get(),l=m.length,a=0;a<l;a++)for(f=m[a],g=F(f,c,db),h=0,k=g.length;h<k;h++){if(f=g[h],f=ia[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;a;){if(g=
F(a,c,nb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=ia[f.id])&&e?f.get(e):f||Fa;m--}else m++;a=a.previousSibling||a.parentNode}return b?c:Fa},link:y.link=A,unlink:y.unlink=ka,cleanData:function(a){a.length&&Sa&&Da(a);fb.apply(d,arguments)}}),y.utility={validate:function(a){try{Fa.link(c,ga.createElement("div"),c,c,a,c,c,1)}catch(b){return b.message}}},da(d.fn,{link:function(a,b,c,d,e,f,g){return A(a,this,b,c,d,e,f,g)},unlink:function(a){return ka(a,this)},view:function(a){return r(this[0],
a)}}),d.each([U,"replaceWith","empty","remove"],function(a,b){var c=d.fn[b];d.fn[b]=function(){var a;Sa=1;try{a=c.apply(this,arguments)}finally{Sa=0}return a}}),da(Fa,{tmpl:{links:{},tags:{}}}),Fa._.onRender=Ja,T({wrapMap:V={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],
col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:N="data-link",merge:{input:{from:Ga,to:"value"},textarea:$a,select:$a,optgroup:{to:"label"}},jsrDbgMode:T.debugMode,debugMode:function(a){T.jsrDbgMode(a);a?f._jsv={views:ia,bindings:Ba}:delete f._jsv},jsv:function(){T.debugMode(T._dbgMode);N=T.linkAttr;ha=y._err;O=Qa+",["+N+"]";x=T.noDomLevel0;V.optgroup=V.option;V.tbody=V.tfoot=V.colgroup=
V.caption=V.thead;V.th=V.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
