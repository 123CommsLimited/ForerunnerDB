function z(){return function k(p,a,g){function h(d,f){if(!a[d]){if(!p[d]){var b="function"==typeof require&&require;if(!f&&b)return b(d,!0);if(e)return e(d,!0);b=Error("Cannot find module '"+d+"'");throw b.code="MODULE_NOT_FOUND",b;}b=a[d]={m:{}};p[d][0].call(b.m,function(b){var f=p[d][1][b];return h(f?f:b)},b,b.m,k,p,a,g)}return a[d].m}for(var e="function"==typeof require&&require,d=0;d<g.length;d++)h(g[d]);return h}({1:[function(k,p){var a=k("../lib/Core");k("../lib/CollectionGroup");k("../lib/View");
k("../lib/OldView");k("../lib/OldView.Bind");k("../lib/Highcharts");k("../lib/Persist");p.m=a;window.ForerunnerDB=a},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Highcharts":6,"../lib/OldView":11,"../lib/OldView.Bind":10,"../lib/Persist":15,"../lib/View":17}],2:[function(k,p){function a(b){this.d.apply(this,arguments)}var g,h,e,d,l,f;g=k("./Shared");a.prototype.d=function(b){this.c="_id";this.F=new l("primary");this.Ga=new l("primaryCrc");this.Ca=new l("crcLookup");this.h=b;this.b=[];this.S=
[];this.Fa=new d;this.D=0;this.g={};this.R={i:[],update:[],remove:[],H:[]};this.ba={i:100,update:100,remove:100,H:100};this.Da={i:1,update:1,remove:1,H:1};this.Ia(this)};g.n.Jb=a;e=k("./Overload");d=k("./Metrics");l=k("./KeyValueStore");f=k("./Path");k("./Index");k("./Crc");h=g.n.W;a.prototype.debug=new e([function(){return this.g.all},function(b){if(void 0!==b){if("boolean"===typeof b){this.g.all=b;for(var c=0;c<this.v.length;c++)this.v[c].debug(b);return this}return this.g[b]||this.f&&this.f.g&&
this.f.g[b]||this.g.all}return this.g.all},function(b,c){if(void 0!==b){if(void 0!==c){this.g[b]=c;for(var f=0;f<this.v.length;f++)this.v[f].debug(b,c);return this}return this.g[b]||this.f&&this.f.g&&this.f.g[b]}return this.g.all}]);a.prototype.name=function(b){return void 0!==b?(this.h=b,this):this.h};a.prototype.C=new e([function(b,c){this.a=this.a||{};this.a[b]=this.a[b]||{};this.a[b]["*"]=this.a[b]["*"]||[];this.a[b]["*"].push(c);return this},function(b,c,f){this.a=this.a||{};this.a[b]=this.a[b]||
{};this.a[b][c]=this.a[b][c]||[];this.a[b][c].push(f);return this}]);a.prototype.s=new e([function(b){this.a&&this.a[b]&&b in this.a&&delete this.a[b];return this},function(b,c){var f,e;"string"===typeof c?this.a&&this.a[b]&&this.a[b][c]&&delete this.a[b][c]:b in this.a&&(f=this.a[b]["*"],e=f.indexOf(c),-1<e&&f.splice(e,1));return this},function(b,c,f){this.a&&b in this.a&&(b=this.a[b][c],f=b.indexOf(f),-1<f&&b.splice(f,1))}]);a.prototype.j=function(b,c){this.a=this.a||{};if(b in this.a){if(this.a[b]["*"]){var f=
this.a[b]["*"],e=f.length,a;for(a=0;a<e;a++)f[a].apply(this,Array.prototype.slice.call(arguments,1))}if(c instanceof Array&&c[0]&&c[0][this.c]){var f=this.a[b],h,d,e=c.length;for(a=0;a<e;a++)if(f[c[a][this.c]])for(h=f[c[a][this.c]].length,d=0;d<h;d++)f[c[a][this.c]][d].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.K=function(){if(this.f&&this.h){this.debug()&&console.log("Dropping collection "+this.h);this.j("drop");delete this.f.k[this.h];var b=[],c;for(c=0;c<this.S.length;c++)b.push(this.S[c]);
for(c=0;c<b.length;c++)this.S[c].Hb(this);return!0}return!1};a.prototype.primaryKey=function(b){return void 0!==b?(this.c=b,this.F.primaryKey(b),this.ob(),this):this.c};a.prototype.T=function(b,c){this.j("insert",b,c)};a.prototype.ca=function(b){this.j("update",b)};a.prototype.X=function(b){this.j("remove",b)};a.prototype.db=function(b){return void 0!==b?(this.f=b,this):this.f};a.prototype.setData=function(b,c,f){if(b){var e=this.Fa.create("setData");e.start();b instanceof Array||(b=[b]);e.time("transformIn");
b=this.Ta(b);e.time("transformIn");var a=this.b;this.b=[];b.length&&(this.b=this.b.concat(b));e.time("_rebuildPrimaryKeyIndex");this.ob(c);e.time("_rebuildPrimaryKeyIndex");e.stop();this.j("setData",this.b,a)}f&&f(!1);return this};a.prototype.ob=function(b){var c=b&&void 0!==b.uc?b.uc:!0;b=b&&void 0!==b.Kc?b.Kc:!0;var f,e,a,h=this.F,d=this.Ga,l=this.Ca,g=this.c,k;h.truncate();d.truncate();l.truncate();f=this.b;for(e=f.length;e--;)if(a=f[e],c&&this.eb(a),b){if(!h.ja(a[g],a))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+
a[this.c];}else k=JSON.stringify(a),h.set(a[g],a),d.set(a[g],k),l.set(k,a)};a.prototype.eb=function(b){void 0===b[this.c]&&(b[this.c]=this.Ab())};a.prototype.truncate=function(){this.j("truncate",this.b);this.b.length=0;this.ua("change");return this};a.prototype.H=function(b,c){if(b){var f=this.R.H,e=this.ba.H,a={},h;if(b instanceof Array){if(b.length>e){this.R.H=f.concat(b);this.ga("upsert",c);return}a=[];for(f=0;f<b.length;f++)a.push(this.H(b[f]));c&&c();return a}b[this.c]?(h={},h[this.c]=b[this.c],
this.count(h)?a.Ra="update":a.Ra="insert"):a.Ra="insert";switch(a.Ra){case "insert":a.result=this.i(b);break;case "update":a.result=this.update(h,b)}return a}c&&c()};a.prototype.update=function(b,c,f){function a(h){if(c&&void 0!==c[d]&&c[d]!=h[d]){e.F.ya(h[d]);var C=e.da(h,c,b,f,"");if(e.F.ja(h[d],h))return C;throw"Primary key violation in update! Key violated: "+h[d];}return e.da(h,c,b,f,"")}c=this.w(c);c=this.Ta(c);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+
'"');var e=this,h=this.Fa.create("update"),d=this.c,l,g,k=this.v;h.start();h.time("Retrieve documents to update");l=this.find(b,{w:!1});h.time("Retrieve documents to update");if(l.length&&(h.time("Update documents"),g=l.filter(a),h.time("Update documents"),g.length)){if(k&&k.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());h.time("Inform views of update");for(l=0;l<k.length;l++)k[l].update(b,c);h.time("Inform views of update")}this.ca(g);this.ua("change",{type:"update",
data:g})}h.stop();return g||[]};a.prototype.da=function(b,c,e,a,h){c=this.w(c);h=h||"";"."===h.substr(0,1)&&(h=h.substr(1,h.length-1));var d=!1,l=!1,g,k,q,m,n;for(m in c)if(c.hasOwnProperty(m)){g=!1;if("$"===m.substr(0,1))switch(m){case "$inc":g=!0;for(n in c[m])if(c[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if("number"===typeof b[n])this.gc(b,n,c[m][n]),d=!0;else throw"Cannot increment field that is not a number! ("+n+")!";break;case "$push":g=!0;for(n in c[m])if(c[m].hasOwnProperty(n)&&"$"!==n.substr(0,
1))if(b[n]instanceof Array)this.rb(b[n],c[m][n]),d=!0;else throw"Cannot push to a key that is not an array! ("+n+")!";break;case "$addToSet":g=!0;for(n in c[m])if(c[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(b[n]instanceof Array){k=b[n];var p;q=k.length;var s,l=!0;p=a&&a.Lc;var u,r;p&&p.key?(u=!1,r=new f(p.key),s=r.value(c[m][n])[0]):(s=JSON.stringify(c[m][n]),u=!0);for(p=0;p<q;p++)if(u){if(JSON.stringify(k[p])===s){l=!1;break}}else if(s===r.value(k[p])[0]){l=!1;break}l&&(this.rb(b[n],c[m][n]),
d=!0)}else throw"Cannot push to a key that is not an array! ("+n+")!";break;case "$splicePush":g=!0;for(n in c[m])if(c[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(b[n]instanceof Array)if(d=c[m].Wa,void 0!==d)delete c[m][n].Wa,this.jc(b[n],d,c[m][n]),d=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+n+")!";break;case "$move":g=!0;for(n in c[m])if(c[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(b[n]instanceof Array)for(q=
0;q<b[n].length;q++){if(this.u(b[n][q],c[m][n])){d=c[m].Wa;if(void 0!==d)this.ic(b[n],q,d),d=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot pull from a key that is not an array! ("+n+")!";break;case "$pull":for(n in g=!0,c[m])if(c[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(b[n]instanceof Array){k=[];for(q=0;q<b[n].length;q++)this.u(b[n][q],c[m][n])&&k.push(q);for(q=k.length;q--;)this.hc(b[n],k[q]),d=!0}else throw"Cannot pull from a key that is not an array! ("+
n+")!";}if(".$"===m.substr(m.length-2,2)&&(g=!0,m=m.substr(0,m.length-2),l=new f(h+"."+m),b[m]&&b[m]instanceof Array&&b[m].length)){k=[];for(q=0;q<b[m].length;q++)this.u(b[m][q],l.value(e)[0])&&k.push(q);for(q=0;q<k.length;q++)(l=this.da(b[m][k[q]],c[m+".$"],e,a,h+"."+m))&&(d=!0)}if(!g)if("object"===typeof c[m])if(null!==b[m]&&"object"===typeof b[m])if(g=b[m]instanceof Array,k=c[m]instanceof Array,g||k)if(!k&&g)for(q=0;q<b[m].length;q++)(l=this.da(b[m][q],c[m],e,a,h+"."+m))&&(d=!0);else this.Ka(b,
m,c[m]),d=!0;else(l=this.da(b[m],c[m],e,a,h+"."+m))&&(d=!0);else this.Ka(b,m,c[m]),d=!0;else b[m]!==c[m]&&(this.Ka(b,m,c[m]),d=!0)}return d};a.prototype.Ka=function(b,c,f){this.D?($.M(b).setProperty(c,f),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+c+'" for collection "'+this.name()+'"')):(b[c]=f,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+c+'" for collection "'+this.name()+'"'))};a.prototype.ic=function(b,
c,f){this.D?($.M(b).move(c,f),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+c+'" to "'+f+'" for collection "'+this.name()+'"')):(b.splice(f,0,b.splice(c,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+c+'" to "'+f+'" for collection "'+this.name()+'"'))};a.prototype.jc=function(b,c,f){b.length>c?this.D?$.M(b).i(c,f):b.splice(c,0,f):this.D?$.M(b).i(f):b.push(f)};a.prototype.rb=function(b,
c){this.D?$.M(b).i(c):b.push(c)};a.prototype.hc=function(b,c){this.D?$.M(b).remove(c):b.splice(c,1)};a.prototype.gc=function(b,c,f){this.D?$.M(b).setProperty(c,b[c]+f):b[c]+=f};a.prototype.remove=function(b){var c,f,e=this.v,a;if(b instanceof Array){e=[];for(c=0;c<b.length;c++)e.push(this.remove(b[c]));return e}c=this.find(b,{w:!1});if(c.length){for(a=0;a<c.length;a++)f=c[a],this.$b(f),f=this.b.indexOf(f),this.D?$.M(this.b).remove(f):this.b.splice(f,1);if(e&&e.length)for(a=0;a<e.length;a++)e[a].remove(b);
this.X(c);this.ua("change",{type:"remove",data:c})}return c};a.prototype.ua=function(){var b=this,c;this.Ub||this.f&&(!this.f||this.f.Ub)?this.j.apply(this,arguments):(c=arguments,this.bb&&clearTimeout(this.bb),this.bb=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+c[0]);b.j.apply(b,c)},100))};a.prototype.ga=function(b,c){var f=this.R[b],e=this.ba[b],a=this.Da[b];if(f.length){var h=this;f.length&&(f=f.length>e?f.splice(0,e):f.splice(0,f.length),this[b](f));setTimeout(function(){h.ga(b,
c)},a)}else c&&c()};a.prototype.i=function(b,c,f){"function"===typeof c?(f=c,c=this.b.length):void 0===c&&(c=this.b.length);b=this.Ta(b);return this.hb(b,c,f)};a.prototype.hb=function(b,c,f){var e=this.R.i,a=this.ba.i,h=[],d=[],l=this.v;if(b instanceof Array){if(b.length>a){this.R.i=e.concat(b);this.ga("insert",f);return}for(a=0;a<b.length;a++)e=this.gb(b[a],c+a),!0===e?h.push(b[a]):d.push({tc:b[a],reason:e})}else e=this.gb(b,c),!0===e?h.push(b):d.push({tc:b,reason:e});if(l&&l.length)for(e=0;e<l.length;e++)l[e].i(b,
c);this.T(h,d);f&&f();this.ua("change",{type:"insert",data:h});return{gd:h,dd:d}};a.prototype.gb=function(b,c){if(b){var f;this.eb(b);if(f=this.vc(b))return"Index violation in index: "+f;this.Rb(b);this.D?$.M(this.b).i(c,b):this.b.splice(c,0,b);return!0}return"No document passed to insert"};a.prototype.Rb=function(b){var c=this.pa,f,e=JSON.stringify(b);this.F.ja(b[this.c],b);this.Ga.ja(b[this.c],e);this.Ca.ja(e,b);for(f in c)c.hasOwnProperty(f)&&c[f].i(b)};a.prototype.$b=function(b){var c=this.pa,
f,e=JSON.stringify(b);this.F.ya(b[this.c]);this.Ga.ya(b[this.c]);this.Ca.ya(e);for(f in c)c.hasOwnProperty(f)&&c[f].remove(b)};a.prototype.$=function(b,c){var f=this.find(b,c);return(new a).Ia(this).primaryKey(this.c).setData(f)};a.prototype.Ia=function(b){this.Ya=b;return this};a.prototype.sc=function(b){var c=this.find(void 0,void 0);b=new f(b);var e={},a=[],h,d;for(d=0;d<c.length;d++)(h=b.value(c[d])[0])&&!e[h]&&(e[h]=!0,a.push(h));return a};a.prototype.w=function(b){return JSON.parse(JSON.stringify(b))};
a.prototype.find=function(b,c){function e(c){return h.u(c,b,"and")}b=b||{};c=c||{};c.w=void 0!==c.w?c.w:!0;var a=this.Fa.create("find"),h=this,d,l=!0,g,k,p,m,n,t,s,u,r,y=[];a.start();if(b){a.time("analyseQuery");d=this.Mb(b,c,a);a.time("analyseQuery");a.data("analysis",d);if(d.vb&&d.Fb){a.time("joinReferences");for(k=0;k<d.Oa.length;k++)m=d.Oa[k],p=new f(d.xb[m]),p=p.value(b)[0],this.f.ta(d.Oa[k]).$(p);a.time("joinReferences")}d.G.length&&(!c||c&&!c.rd)?(a.data("index.potential",d.G),a.data("index.used",
d.G[0].index),a.time("indexLookup"),g=d.G[0].L,a.time("indexLookup"),d.G[0].A.aa===d.G[0].A.B&&(l=!1)):a.fa("usedIndex",!1);l&&(g&&g.length?(d=g.length,a.time("tableScan: "+d),g=g.filter(e)):(d=this.b.length,a.time("tableScan: "+d),g=this.b.filter(e)),c.sort&&(a.time("sort"),g=this.sort(c.sort,g),a.time("sort")),a.time("tableScan: "+d));c.Qa&&g&&g.length>c.Qa&&(g.length=c.Qa,a.data("limit",c.Qa));c.w&&(a.time("decouple"),g=this.w(g),a.time("decouple"),a.data("flag.decouple",!0));if(c.join){for(d=
0;d<c.join.length;d++)for(m in c.join[d])if(c.join[d].hasOwnProperty(m))for(u=m,l=this.f.ta(m),k=c.join[d][m],r=0;r<g.length;r++){t={};s=p=!1;for(n in k)if(k.hasOwnProperty(n))if("$"===n.substr(0,1))switch(n){case "$as":u=k[n];break;case "$multi":p=k[n];break;case "$require":s=k[n]}else t[n]=(new f(k[n])).value(g[r])[0];t=l.find(t);!s||s&&t[0]?g[r][u]=!1===p?t[0]:t:y.push(g[r])}a.data("flag.join",!0)}if(y.length){a.time("removalQueue");for(n=0;n<y.length;n++)m=g.indexOf(y[n]),-1<m&&g.splice(m,1);
a.time("removalQueue")}if(c.transform){a.time("transform");for(n=0;n<g.length;n++)g.splice(n,1,c.transform(g[n]));a.time("transform");a.data("flag.transform",!0)}this.p&&this.Q&&(a.time("transformOut"),g=this.Ic(g),a.time("transformOut"));a.data("results",g.length);a.stop()}else a.stop(),g=[];g.Wc=a;return g};a.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this.p=b.enabled),void 0!==b.Y&&(this.P=b.Y),void 0!==b.Z&&(this.Q=b.Z)):this.p=!1===b?!1:!0,this):
{enabled:this.p,Y:this.P,Z:this.Q}};a.prototype.Ta=function(b){if(this.p&&this.P){if(b instanceof Array){var c=[],f;for(f=0;f<b.length;f++)c[f]=this.P(b[f]);return c}return this.P(b)}return b};a.prototype.Ic=function(b){if(this.p&&this.Q){if(b instanceof Array){var c=[],f;for(f=0;f<b.length;f++)c[f]=this.Q(b[f]);return c}return this.Q(b)}return b};a.prototype.sort=function(b,c){c=c||[];var f=[],a,e;for(a in b)b.hasOwnProperty(a)&&(e={},e[a]=b[a],e.Lb=a,f.push(e));return 2>f.length?this.Ha(b,c):this.ab(f,
c)};a.prototype.ab=function(b,c){var f=b.shift(),a,e,h=[];if(0<b.length){c=this.Ha(f,c);a=this.qc(f.Lb,c);for(e in a)a.hasOwnProperty(e)&&(f=[].concat(b),h=h.concat(this.ab(f,a[e])));return h}return this.Ha(f,c)};a.prototype.Ha=function(b,c){var a=new f,e=a.parse(b,!0)[0];a.path(e.path);return c.sort(1===e.value?function(b,c){var f=a.value(b)[0],e=a.value(c)[0];return"string"===typeof f&&"string"===typeof e?f.localeCompare(e):f>e?1:f<e?-1:0}:function(b,c){var f=a.value(b)[0],e=a.value(c)[0];return"string"===
typeof f&&"string"===typeof e?1===f.localeCompare(e)?-1:1:f>e?-1:f<e?1:0})};a.prototype.qc=function(b,c){var f,a={};for(f=0;f<c.length;f++)a[c[f][b]]=a[c[f][b]]||[],a[c[f][b]].push(c[f]);return a};a.prototype.Mb=function(b,c,a){var e={Gb:[this.h],G:[],vb:!1,Fb:!1,xb:{},t:b,options:c},h,d=[],l=[],g,k,p,m,n;a.time("checkIndexes");void 0!==b[this.c]&&(a.time("checkIndexMatch: Primary Key"),g=new f,e.G.push({L:this.F.L(b,c),A:{zb:[this.c],B:1,aa:g.tb(b)},index:this.F}),a.time("checkIndexMatch: Primary Key"));
for(n in this.fb)if(this.fb.hasOwnProperty(n)&&(k=this.fb[n],p=k.name(),a.time("checkIndexMatch: "+p),g=k.match(b,c),m=k.L(b,c),0<g.B&&e.G.push({L:m,A:g,index:k}),a.time("checkIndexMatch: "+p),g.aa===g.B))break;a.time("checkIndexes");1<e.G.length&&(a.time("findOptimalIndex"),e.G.sort(function(b,c){return b.A.aa===b.A.B?-1:c.A.aa===c.A.B?1:b.A.B===c.A.B?b.L.length-c.L.length:c.A.B-b.A.B}),a.time("findOptimalIndex"));if(c.join){e.vb=!0;for(a=0;a<c.join.length;a++)for(h in c.join[a])c.join[a].hasOwnProperty(h)&&
(d.push(h),"$as"in c.join[a][h]?l.push(c.join[a][h].$as):l.push(h));for(h=0;h<l.length;h++)if(c=this.nb(b,l[h],""))e.xb[d[h]]=c,e.Fb=!0;e.Oa=d;e.Gb=e.Gb.concat(d)}return e};a.prototype.nb=function(b,c,f){for(var a in b)if(b.hasOwnProperty(a)){if(a===c)return f&&(f+="."),f+a;if("object"===typeof b[a])return f&&(f+="."),f+=a,this.nb(b[a],c,f)}return!1};a.prototype.u=function(b,c,f){var a,e;a=typeof b;e=typeof c;var h=!0,d;if(!("string"!==a&&"number"!==a||"string"!==e&&"number"!==e))b!==c&&(h=!1);else for(d in c)if(c.hasOwnProperty(d)){a=
!1;if("$"===d.substr(0,1))switch(d){case "$gt":if(b>c[d]){if("or"===f)return!0}else h=!1;a=!0;break;case "$gte":if(b>=c[d]){if("or"===f)return!0}else h=!1;a=!0;break;case "$lt":if(b<c[d]){if("or"===f)return!0}else h=!1;a=!0;break;case "$lte":if(b<=c[d]){if("or"===f)return!0}else h=!1;a=!0;break;case "$exists":if(void 0===b!==c[d]){if("or"===f)return!0}else h=!1;a=!0;break;case "$or":a=!0;for(e=0;e<c[d].length;e++){if(this.u(b,c[d][e],"and"))return!0;h=!1}break;case "$and":a=!0;for(e=0;e<c[d].length;e++)if(!this.u(b,
c[d][e],"and"))return!1;break;case "$in":if(c[d]instanceof Array){a=c[d];e=a.length;var l,g=!1;for(l=0;l<e;l++)if(a[l]===b){g=!0;break}if(g){if("or"===f)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+d;a=!0;break;case "$nin":if(c[d]instanceof Array){a=c[d];e=a.length;g=!0;for(l=0;l<e;l++)if(a[l]===b){g=!1;break}if(g){if("or"===f)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+d;a=!0;break;case "$ne":if(b!=c[d]){if("or"===f)return!0}else h=
!1;a=!0}if(!a&&c[d]instanceof RegExp)if(a=!0,"object"===typeof b&&void 0!==b[d]&&c[d].test(b[d])){if("or"===f)return!0}else h=!1;if(!a)if("object"===typeof c[d])if(void 0!==b[d]){if(b[d]instanceof Array&&!(c[d]instanceof Array))for(a=!1,e=0;e<b[d].length&&!(a=this.u(b[d][e],c[d],void 0));e++);else if(!(b[d]instanceof Array)&&c[d]instanceof Array)for(a=!1,e=0;e<c[d].length&&!(a=this.u(b[d],c[d][e],void 0));e++);else a="object"===typeof b?this.u(b[d],c[d],void 0):this.u(void 0,c[d],void 0);if(a){if("or"===
f)return!0}else h=!1}else if(c[d]&&void 0!==c[d].$exists)if(a=this.u(void 0,c[d],void 0)){if("or"===f)return!0}else h=!1;else h=!1;else if(b&&b[d]===c[d]){if("or"===f)return!0}else if(b&&b[d]&&b[d]instanceof Array&&c[d]&&"object"!==typeof c[d]){a=!1;for(e=0;e<b[d].length&&!(a=this.u(b[d][e],c[d],void 0));e++);if(a){if("or"===f)return!0}else h=!1}else h=!1;if("and"===f&&!h)return!1}return h};a.prototype.count=function(b,c){return b?this.find(b,c).length:this.b.length};a.prototype.vc=function(b){var c,
a=this.pa,f,e;if(this.F.get(b[this.c]))c=this.F;else for(f in a)if(a.hasOwnProperty(f)&&(e=a[f],e.unique()&&e.Jc(b))){c=e;break}return c?c.name():!1};a.prototype.index=function(b){if(this.pa)return this.pa[b]};a.prototype.Ab=function(b){var c=Math.pow(10,17);if(b){var a=0,f=b.length,e;for(e=0;e<f;e++)a+=b.charCodeAt(e)*c;b=a.toString(16)}else g.va++,b=(g.va+(Math.random()*c+Math.random()*c+Math.random()*c+Math.random()*c)).toString(16);return b};h.prototype.ta=function(b,c){if(b)return this.k[b]||
this.debug()&&console.log("Creating collection "+b),this.k[b]=this.k[b]||(new a(b)).db(this),void 0!==c&&this.k[b].primaryKey(c),this.k[b];throw"Cannot get collection with undefined name!";};p.m=a},{"./Crc":5,"./Index":7,"./KeyValueStore":8,"./Metrics":9,"./Overload":13,"./Path":14,"./Shared":16}],3:[function(k,p){function a(){this.d.apply(this,arguments)}var g,h,e,d,l;g=k("./Shared");a.prototype.d=function(a){var b=this;this.h=a;this.q=[];this.v=[];this.Wb=function(){b.T.apply(b,arguments)};this.Yb=
function(){b.ca.apply(b,arguments)};this.Xb=function(){b.X.apply(b,arguments)};this.Vb=function(){b.kb.apply(b,arguments)}};g.n.Mc=a;d=k("./Collection");l=k("./Overload");h=g.n.W;e=g.n.W.prototype.d;a.prototype.C=new l([function(a,b){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a]["*"]=this.a[a]["*"]||[];this.a[a]["*"].push(b);return this},function(a,b,c){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a][b]=this.a[a][b]||[];this.a[a][b].push(c);return this}]);a.prototype.s=new l([function(a){this.a&&
this.a[a]&&a in this.a&&delete this.a[a];return this},function(a,b){var c,e;"string"===typeof b?this.a&&this.a[a]&&this.a[a][b]&&delete this.a[a][b]:a in this.a&&(c=this.a[a]["*"],e=c.indexOf(b),-1<e&&c.splice(e,1));return this},function(a,b,c){this.a&&a in this.a&&(a=this.a[a][b],c=a.indexOf(c),-1<c&&a.splice(c,1))}]);a.prototype.j=function(a,b){this.a=this.a||{};if(a in this.a){if(this.a[a]["*"]){var c=this.a[a]["*"],e=c.length,d;for(d=0;d<e;d++)c[d].apply(this,Array.prototype.slice.call(arguments,
1))}if(b instanceof Array&&b[0]&&b[0][this.c]){var c=this.a[a],h,l,e=b.length;for(d=0;d<e;d++)if(c[b[d][this.c]])for(h=c[b[d][this.c]].length,l=0;l<h;l++)c[b[d][this.c]][l].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.db=function(a){return void 0!==a?(this.f=a,this):this.f};a.prototype.Hb=function(a){if(a){var b=this.q.indexOf(a);-1!==b&&(a.s("insert",this.Wb),a.s("update",this.Yb),a.s("remove",this.Xb),a.s("change",this.Vb),this.q.splice(b,1),b=a.S.indexOf(this),
-1!==b&&a.S.splice(b,1));0===this.q.length&&delete this.c}};a.prototype.find=function(a,b){var c=(new d).primaryKey(this.q[0].primaryKey()),e;for(e=0;e<this.q.length;e++)c.i(this.q[e].find(a));return c.find(a,b)};a.prototype.i=function(a,b){for(var c=0;c<this.q.length;c++)this.q[c].i(a,b)};a.prototype.update=function(a,b){for(var c=0;c<this.q.length;c++)this.q[c].update(a,b)};a.prototype.remove=function(a){for(var b=0;b<this.q.length;b++)this.q[b].remove(a)};a.prototype.T=function(a,b){this.j("insert",
a,b)};a.prototype.ca=function(a,b){this.j("update",a,b)};a.prototype.X=function(a,b){this.j("remove",a,b)};a.prototype.kb=function(){this.j("change")};a.prototype.$=function(a,b){var c=this.find(a,b);return(new d).Ia(this).primaryKey(this.c).setData(c)};a.prototype.K=function(){var a,b=[].concat(this.q),c=[].concat(this.v);this.g&&console.log("Dropping collection group "+this.h);for(a=0;a<b.length;a++)this.Hb(b[a]);for(a=0;a<c.length;a++)this.pb(c[a]);this.j("drop");return!0};h.prototype.d=function(){e.apply(this,
arguments)};p.m=a},{"./Collection":2,"./Overload":13,"./Shared":16}],4:[function(k,p){function a(){this.d.apply(this,arguments)}var g,h;g=k("./Shared.js");a.prototype.d=function(){this.k={};this.g={}};g.n.W=a;h=k("./Overload.js");k("./Collection.js");k("./Metrics.js");k("./Crc.js");a.prototype.ib=!1;a.prototype.wb=function(){return!this.ib};a.prototype.wb=function(){return!this.ib};a.prototype.w=function(a){return JSON.parse(JSON.stringify(a))};a.prototype.debug=new h([function(){return this.g.all},
function(a){return void 0!==a&&"boolean"===typeof a?(this.g.all=a,this):this.g.all},function(a,d){return void 0!==a?void 0!==d?(this.g[a]=d,this):this.g[a]:this.g.all}]);a.prototype.C=function(a,d){this.a=this.a||{};this.a[a]=this.a[a]||[];this.a[a].push(d);return this};a.prototype.s=function(a,d){if(a in this.a){var h=this.a[a],f=h.indexOf(d);-1<f&&h.splice(f,1)}return this};a.prototype.j=function(a,d){this.a=this.a||{};if(a in this.a){var h=this.a[a],f=h.length,b;for(b=0;b<f;b++)h[b].apply(this,
Array.prototype.slice.call(arguments,1))}return this};a.prototype.Ab=function(a){var d,h,f=Math.pow(10,17),b;if(a){d=0;h=a.length;for(b=0;b<h;b++)d+=a.charCodeAt(b)*f;a=d.toString(16)}else g.va++,a=(g.va+(Math.random()*f+Math.random()*f+Math.random()*f+Math.random()*f)).toString(16);return a};p.m=a},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":9,"./Overload.js":13,"./Shared.js":16}],5:[function(k,p){var a=function(){var a=[],h,e,d;for(e=0;256>e;e++){h=e;for(d=0;8>d;d++)h=h&1?3988292384^h>>>1:
h>>>1;a[e]=h}return a}();p.m=function(g){var h=-1,e;for(e=0;e<g.length;e++)h=h>>>8^a[(h^g.charCodeAt(e))&255];return(h^-1)>>>0}},{}],6:[function(k,p){function a(a,d){this.d.apply(this,arguments)}var g,h;g=k("./Shared");a.prototype.d=function(a,d){this.l=d;this.sa=$(this.l.Dc);this.a={};this.k=a;this.l.V=[];var h,f;switch(this.l.type){case "pie":this.sa.Na(this.l.Ma);this.N=this.sa.Na();h=this.k.find();f={Zc:!0,cursor:"pointer",bd:{enabled:!0,ed:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",
style:{color:Highcharts.Hc&&Highcharts.Hc.ad||"black"}}};h=this.Db(h,this.l.Pa,this.l.Ua);$.extend(f,this.l.pd);$.extend(f,{type:"pie",name:this.l.od,data:h});this.N.Yc(f);break;case "line":h=this.yb(this.l.Ec,this.l.Pa,this.l.Ua,this.l.Bb),this.l.Ma.za=h.za,this.l.Ma.V=h.V,this.sa.Na(this.l.Ma),this.N=this.sa.Na()}this.Pb()};g=g.n.Jb;h=g.prototype.d;a.prototype.Db=function(a,d,h){var f=[],b;for(b=0;b<a.length;b++)f.push([a[b][d],a[b][h]]);return f};a.prototype.yb=function(a,d,h,f){var b=this.k.sc(a),
c=[],g={sb:[]},k,p,B,x,w;for(x=0;x<b.length;x++){k=b[x];p={};p[a]=k;B=[];p=this.k.find(p,{Bb:f});for(w=0;w<p.length;w++)g.sb.push(p[w][d]),B.push(p[w][h]);c.push({name:k,data:B})}return{za:g,V:c}};a.prototype.Pb=function(){this.k.C("change",this.Ba);this.k.C("drop",this.Ea)};a.prototype.Ba=function(){if("undefined"!==typeof this.k&&this.N){var a=this.k.find();switch(this.l.type){case "pie":this.N.V[0].setData(this.Db(a,this.l.Pa,this.l.Ua));break;case "line":a=this.yb(this.l.Ec,this.l.Pa,this.l.Ua,
this.l.Bb);this.N.za[0].qd(a.za.sb);for(var d=0;d<a.V.length;d++)this.N.V[d].setData(a.V[d].data)}}};a.prototype.Ea=function(){this.k.s("change",this.Ba);this.k.s("drop",this.Ea)};a.prototype.K=function(){this.N.cd();this.k.s("change",this.Ba);this.k.s("drop",this.Ea);delete this.k.Ob[this.l.Dc];delete this.N;delete this.l;delete this.k;return this};g.prototype.d=function(){this.Ob={};h.apply(this,arguments)};p.m=a},{"./Shared":16}],7:[function(k,p){function a(){this.d.apply(this,arguments)}var g=
k("./Shared"),h=k("./Path");a.prototype.d=function(a,d,h){this.oa={};this.Qb=this.Sb(a,a);this.data({});this.unique(d&&d.unique?d.unique:!1);void 0!==a&&this.keys(a);void 0!==h&&this.ta(h);this.name(d&&d.name?d.name:this.Qb)};g.n.Oc=a;a.prototype.data=function(a){return void 0!==a?(this.b=a,this):this.b};a.prototype.name=function(a){return void 0!==a?(this.h=a,this):this.h};a.prototype.ta=function(a){return void 0!==a?(this.k=a,this):this.k};a.prototype.keys=function(a){return void 0!==a?(this.I=
a,(new h).parse(this.I),this):this.I};a.prototype.type=function(a){return void 0!==a?(this.fc=a,this):this.fc};a.prototype.unique=function(a){return void 0!==a?(this.Ja=a,this):this.Ja};a.prototype.i=function(a){var d,h;this.Ja&&(d=this.qa(a,this.I),this.qb[d]=a);d=this.jb(a,this.I);for(h=0;h<d.length;h++)this.Cc(d[h],a)};a.prototype.remove=function(a){var h,g;this.Ja&&(h=this.qa(a,this.I),delete this.qb[h]);h=this.jb(a,this.I);for(g=0;g<h.length;g++)this.Ac(h[g],a)};a.prototype.Jc=function(a){a=
this.qa(a,this.I);return Boolean(this.qb[a])};a.prototype.Cc=function(a,h){var g=this.b[a]=this.b[a]||[];-1===g.indexOf(h)&&(g.push(h),this.Bc(h,g))};a.prototype.Ac=function(a,h){var g=this.b[a],f;f=g.indexOf(h);-1<f&&(g.splice(f,1),this.zc(h));g.length||delete this.b[a]};a.prototype.Bc=function(a,h){var g=a[this.k.primaryKey()];this.oa[g]=this.oa[g]||[];g=this.oa[g];-1===g.indexOf(h)&&g.push(h)};a.prototype.zc=function(a){a=a[this.k.primaryKey()];delete this.oa[a]};a.prototype.L=function(a){return this.b[this.qa(a,
this.I)]||[]};a.prototype.match=function(a){return(new h).ub(this.I,a)};a.prototype.qa=function(a,d){var g=new h,f,b="",c;f=g.parse(d);for(c=0;c<f.length;c++)b&&(b+="_"),b+=g.value(a,f[c].path).join(":");return b};a.prototype.Sb=function(a,d){var g=new h,f,b="",c;f=g.parse(d);for(c=0;c<f.length;c++)b&&(b+="_"),b+=g.wc(a,f[c].path);return b};a.prototype.jb=function(a,d){var g=new h,f,b=[],c,k,p,v;f=g.parse(d);for(p=0;p<f.length;p++)for(c=g.value(a,f[p].path),k=0;k<c.length;k++)if(0===p)b.push(c[k]);
else for(v=0;v<b.length;v++)b[v]=b[v]+"_"+c[k];return b};p.m=a},{"./Path":14,"./Shared":16}],8:[function(k,p){function a(a){this.d.apply(this,arguments)}var g=k("./Shared");a.prototype.d=function(a){this.h=a;this.b={};this.c="_id"};g.n.Pc=a;a.prototype.name=function(a){return void 0!==a?(this.h=a,this):this.h};a.prototype.primaryKey=function(a){return void 0!==a?(this.c=a,this):this.c};a.prototype.truncate=function(){this.b={};return this};a.prototype.set=function(a,e){this.b[a]=e?e:!0;return this};
a.prototype.get=function(a){return this.b[a]};a.prototype.L=function(a){a=a[this.c];var e,d,g,f;if(a instanceof Array){d=a.length;f=[];for(e=0;e<d;e++)(g=this.b[a[e]])&&f.push(g);return f}if(a instanceof RegExp){f=[];for(e in this.b)this.b.hasOwnProperty(e)&&a.test(e)&&f.push(this.b[e]);return f}if("object"===typeof a){if(a.Ib){f=[];for(e in this.b)this.b.hasOwnProperty(e)&&e!==a.Ib&&f.push(this.b[e]);return f}if(a.Va&&a.Va instanceof Array){f=[];for(e in this.b)this.b.hasOwnProperty(e)&&-1<a.Va.indexOf(e)&&
f.push(this.b[e]);return f}if(a.Xa&&a.Xa instanceof Array){f=[];for(e in this.b)this.b.hasOwnProperty(e)&&-1===a.Xa.indexOf(e)&&f.push(this.b[e]);return f}if(a.Aa&&a.Aa instanceof Array){f=[];for(e=0;e<a.Aa.length;e++)f=f.concat(this.L(a.Aa[e]));return f}}else return g=this.b[a],void 0!==g?[g]:[]};a.prototype.ya=function(a){delete this.b[a]};a.prototype.ja=function(a,e){return void 0===this.b[a]?(this.b[a]=e,!0):!1};p.m=a},{"./Shared":16}],9:[function(k,p){function a(){this.d.apply(this,arguments)}
var g=k("./Shared"),h=k("./Operation");a.prototype.d=function(){this.b=[]};g.n.Qc=a;a.prototype.create=function(a){a=new h(a);this.cb&&this.b.push(a);return a};a.prototype.start=function(){this.cb=!0;return this};a.prototype.stop=function(){this.cb=!1;return this};p.m=a},{"./Operation":12,"./Shared":16}],10:[function(k){var p;k=k("./Shared").n.Kb;p=k.prototype.d;k.prototype.d=function(){var a=this;this.$a=[];this.R={i:[],update:[],remove:[],H:[],la:[],na:[],ma:[],Za:[]};this.ba={i:100,update:100,
remove:100,H:100,la:100,na:100,ma:100,Za:100};this.Da={i:100,update:1,remove:1,H:1,la:100,na:1,ma:1,Za:1};p.apply(this,arguments);this.C("insert",function(g,h){a.ka("insert",g,h)});this.C("update",function(g,h){a.ka("update",g,h)});this.C("remove",function(g,h){a.ka("remove",g,h)});this.C("change",a.Nb)};k.prototype.pc=function(a,g){var h=$(a),e,d,l;this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",g);for(e=0;e<g.length;e++)d=g[e],l=h.find("#"+d[this.c]),l.length?0===e?
(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",l),h.Eb(l)):(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+e+"...",l),l.fd(h.children(":eq("+(e-1)+")"))):this.debug()&&console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",d)};k.prototype.oc=function(a){var g=this.$a,h,e;a||(a={data:this.find()});for(h in g)g.hasOwnProperty(h)&&(e=g[h],this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting DOM..."),
this.pc(h,a.data),e.lc&&e.lc(),e.refresh&&e.refresh())};k.prototype.ga=function(a,g){var h=this.R[a],e=this.ba[a],d=this.Da[a];if(h.length){var l=this;h.length&&(h=h.length>e?h.splice(0,e):h.splice(0,h.length),this.ka(a,h,[]));setTimeout(function(){l.ga(a,g)},d)}else g&&g(),this.j("bindQueueComplete")};k.prototype.ka=function(a,g,h){var e=this.$a,d=this.find({}),l,f;for(f in e)if(e.hasOwnProperty(f))switch(l=e[f].reduce?this.find(e[f].reduce.t,e[f].reduce.options):d,a){case "insert":this.la(f,e[f],
g,h,l);break;case "update":this.na(f,e[f],g,h,l);break;case "remove":this.ma(f,e[f],g,h,l)}};k.prototype.Nb=function(a){this.debug()&&console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",a);this.oc(a)};k.prototype.la=function(a,g,h,e,d){var l=$(a),f;for(f=0;f<h.length;f++)a=l.find("#"+h[f][this.c]),a.length||g.Gc(h[f],function(a,c,f,e){return function(a){g.i?g.i(a,c,f,e):g.kd?l.Eb(a):l.append(a);g.kc&&g.kc(a,c,f,e)}}(a,h[f],e,d))};k.prototype.na=function(a,g,h,e,d){var l=
$(a);for(e=0;e<h.length;e++)a=l.find("#"+h[e][this.c]),g.Gc(h[e],function(a,b){return function(c){g.update?g.update(c,b,d,a.length?"update":"append"):a.length?a.nd(c):g.ld?l.Eb(c):l.append(c);g.mc&&g.mc(c,b,d)}}(a,h[e]))};k.prototype.ma=function(a,g,h,e,d){a=$(a);var l;for(l=0;l<h.length;l++)e=a.find("#"+h[l][this.c]),e.length&&(g.nc?g.nc(e,h[l],d,function(a,b,c){return function(){g.remove?g.remove(a,b,c):(a.remove(),g.La&&g.La(a,b,c))}}(e,h[l],d)):g.remove?g.remove(e,h[l],d):(e.remove(),g.La&&g.La(e,
h[l],d)))}},{"./Shared":16}],11:[function(k,p){function a(){this.d.apply(this,arguments)}var g,h,e,d,l,f,b;g=k("./Shared");a.prototype.d=function(a){this.h=a;this.S=[];this.a={};this.J={t:{},options:{}}};g.n.Kb=a;h=k("./CollectionGroup");e=k("./Collection");d=e.prototype.d;l=h.prototype.d;b=k("./Overload");g=g.n.W;f=g.prototype.d;a.prototype.C=new b([function(a,b){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a]["*"]=this.a[a]["*"]||[];this.a[a]["*"].push(b);return this},function(a,b,f){this.a=
this.a||{};this.a[a]=this.a[a]||{};this.a[a][b]=this.a[a][b]||[];this.a[a][b].push(f);return this}]);a.prototype.s=new b([function(a){this.a&&this.a[a]&&a in this.a&&delete this.a[a];return this},function(a,b){var f,e;"string"===typeof b?this.a&&this.a[a]&&this.a[a][b]&&delete this.a[a][b]:a in this.a&&(f=this.a[a]["*"],e=f.indexOf(b),-1<e&&f.splice(e,1));return this},function(a,b,f){this.a&&a in this.a&&(a=this.a[a][b],f=a.indexOf(f),-1<f&&a.splice(f,1))}]);a.prototype.j=function(a,b){this.a=this.a||
{};if(a in this.a){if(this.a[a]["*"]){var f=this.a[a]["*"],e=f.length,d;for(d=0;d<e;d++)f[d].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this.c]){var f=this.a[a],h,g,e=b.length;for(d=0;d<e;d++)if(f[b[d][this.c]])for(h=f[b[d][this.c]].length,g=0;g<h;g++)f[b[d][this.c]][g].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.K=function(){return(this.f||this.o)&&this.h?(this.debug()&&console.log("ForerunnerDB.OldView: Dropping view "+
this.h),this.j("drop"),this.f&&delete this.f.ra[this.h],this.o&&delete this.o.ra[this.h],!0):!1};a.prototype.debug=function(){return!1};a.prototype.db=function(a){return void 0!==a?(this.f=a,this):this.f};a.prototype.primaryKey=function(){if(this.o)return this.o.primaryKey()};a.prototype.t=function(a,b){return void 0!==a?(this.J.t=a,void 0!==b&&!0!==b||this.refresh(),this):this.J.t};a.prototype.refresh=function(a){if(this.o){var b=this.b,f,e,d,h,g,l=[],k=[],m=[],n;this.debug()&&(console.log("ForerunnerDB.OldView: Refreshing view "+
this.h),console.log("ForerunnerDB.OldView: Existing data: "+("undefined"!==typeof this.b)),"undefined"!==typeof this.b&&console.log("ForerunnerDB.OldView: Current data rows: "+this.b.find().length));this.J?(this.debug()&&console.log("ForerunnerDB.OldView: View has query and options, getting subset..."),this.b=this.o.$(this.J.t,this.J.options)):this.J.options?(this.debug()&&console.log("ForerunnerDB.OldView: View has options, getting subset..."),this.b=this.o.$({},this.J.options)):(this.debug()&&console.log("ForerunnerDB.OldView: View has no query or options, getting subset..."),
this.b=this.o.$({}));if(!a&&b)if(this.debug()&&console.log("ForerunnerDB.OldView: Refresh not forced, old data detected..."),e=this.b,b.Ya===e.Ya){this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from same collection...");d=e.find();a=b.find();h=e.c;for(n=0;n<d.length;n++)g=d[n],f={},f[h]=g[h],(f=b.find(f)[0])?JSON.stringify(f)!==JSON.stringify(g)&&k.push(g):l.push(g);for(n=0;n<a.length;n++)g=a[n],f={},f[h]=g[h],e.find(f)[0]||m.push(g);this.debug()&&(console.log("ForerunnerDB.OldView: Removed "+
m.length+" rows"),console.log("ForerunnerDB.OldView: Inserted "+l.length+" rows"),console.log("ForerunnerDB.OldView: Updated "+k.length+" rows"));l.length&&this.T(l,[]);k.length&&this.ca(k,[]);m.length&&this.X(m,[])}else this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from different collections..."),m=b.find(),m.length&&this.X(m),l=e.find(),l.length&&this.T(l);else this.debug()&&console.log("ForerunnerDB.OldView: Forcing data update",d),this.b=this.o.$(this.J.t,this.J.options),
d=this.b.find(),this.debug()&&console.log("ForerunnerDB.OldView: Emitting change event with data",d),this.T(d,[]);this.debug()&&console.log("ForerunnerDB.OldView: Emitting change");this.j("change")}return this};a.prototype.count=function(){return this.b&&this.b.b?this.b.b.length:0};a.prototype.find=function(){return this.b?(this.debug()&&console.log("ForerunnerDB.OldView: Finding data in view collection...",this.b),this.b.find.apply(this.b,arguments)):[]};a.prototype.i=function(){return this.o?this.o.i.apply(this.o,
arguments):[]};a.prototype.update=function(){return this.o?this.o.update.apply(this.o,arguments):[]};a.prototype.remove=function(){return this.o?this.o.remove.apply(this.o,arguments):[]};a.prototype.T=function(a,b){this.j("insert",a,b)};a.prototype.ca=function(a,b){this.j("update",a,b)};a.prototype.X=function(a,b){this.j("remove",a,b)};a.prototype.kb=function(){this.debug()&&console.log("ForerunnerDB.OldView: Refreshing data");this.refresh()};e.prototype.d=function(){this.ra=[];d.apply(this,arguments)};
h.prototype.d=function(){this.ra=[];l.apply(this,arguments)};g.prototype.d=function(){this.ra={};f.apply(this,arguments)};p.m=a},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],12:[function(k,p){function a(a){this.Cb=new h;this.d.apply(this,arguments)}var g=k("./Shared"),h=k("./Path");a.prototype.d=function(a){this.b={hd:a,index:{jd:[],sd:!1},Fc:[],time:{ia:0,wa:0,xa:0,yc:{}},fa:{},log:[]}};g.n.Rc=a;a.prototype.start=function(){this.b.time.ia=(new Date).getTime()};a.prototype.log=
function(a){if(a){var d=0<this.Xc.length?this.b.log[this.b.log.length-1].time:0;a={event:a,time:(new Date).getTime(),rc:0};this.b.log.push(a);d&&(a.rc=a.time-d);return this}return this.b.log};a.prototype.time=function(a){if(void 0!==a){var d=this.b.time.yc,d=d[a]=d[a]||{};d.ia?(d.wa=(new Date).getTime(),d.xa=d.wa-d.ia,d.Sa.xa=d.xa,delete d.Sa):(d.ia=(new Date).getTime(),d.Sa={name:a},this.b.Fc.push(d.Sa));return this}return this.b.time};a.prototype.fa=function(a,d){if(void 0!==a&&void 0!==d)this.b.fa[a]=
d;else return void 0!==a?this.b.fa[a]:this.b.fa};a.prototype.data=function(a,d){return void 0!==d?(this.Cb.set(this.b,a,d),this):this.Cb.get(this.b,a)};a.prototype.stop=function(){this.b.time.wa=(new Date).getTime();this.b.time.xa=this.b.time.wa-this.b.time.ia};p.m=a},{"./Path":14,"./Shared":16}],13:[function(k,p){function a(a){if(a){var h,e=a.length;return function(){for(h=0;h<e;h++)if(a[h].length===arguments.length)return a[h].apply(this,arguments);return null}}return function(){}}k("./Shared").n.Sc=
a;p.m=a},{"./Shared":16}],14:[function(k,p){function a(a){this.d.apply(this,arguments)}var g=k("./Shared");a.prototype.d=function(a){a&&this.path(a)};g.n.Tc=a;a.prototype.path=function(a){return void 0!==a?(this.lb=this.ea(a),this.mb=this.lb.split("."),this):this.lb};a.prototype.tb=function(a){var e=0,d;for(d in a)a.hasOwnProperty(d)&&void 0!==a[d]&&("object"!==typeof a[d]?e++:e+=this.tb(a[d]));return e};a.prototype.ub=function(a,e){var d,g={},f=0,b=0,c;for(c in e)e.hasOwnProperty(c)&&("object"===
typeof e[c]?(d=this.ub(a[c],e[c]),g[c]=d.zb,b+=d.aa,f+=d.B):(b++,a&&a[c]&&"object"!==typeof a[c]?(g[c]=!0,f++):g[c]=!1));return{zb:g,B:f,aa:b}};a.prototype.parse=function(a,e){var d=[],g="",f,b,c;for(b in a)if(a.hasOwnProperty(b))if(g=b,"object"===typeof a[b])if(e)for(f=this.parse(a[b],e),c=0;c<f.length;c++)d.push({path:g+"."+f[c].path,value:f[c].value});else for(f=this.parse(a[b]),c=0;c<f.length;c++)d.push({path:g+"."+f[c].path});else e?d.push({path:g,value:a[b]}):d.push({path:g});return d};a.prototype.value=
function(a,e){if(void 0!==a&&"object"===typeof a){var d,g,f,b,c=[],k;void 0!==e&&(e=this.ea(e),d=e.split("."));d=d||this.mb;g=d.length;f=a;for(k=0;k<g;k++){f=f[d[k]];if(b instanceof Array){for(g=0;g<b.length;g++)c=c.concat(this.value(b,g+"."+d[k]));return c}if(!f||"object"!==typeof f)break;b=f}return[f]}return[]};a.prototype.set=function(a,e,d){if(void 0!==a&&void 0!==e){var g;e=this.ea(e);e=e.split(".");g=e.shift();e.length?(a[g]=a[g]||{},this.set(a[g],e.join("."),d)):a[g]=d}return a};a.prototype.get=
function(a,e){return this.value(a,e)[0]};a.prototype.push=function(a,e,d){if(void 0!==a&&void 0!==e){var g;e=this.ea(e);e=e.split(".");g=e.shift();if(e.length)a[g]=a[g]||{},this.set(a[g],e.join("."),d);else if(a[g]=a[g]||[],a[g]instanceof Array)a[g].push(d);else throw"Cannot push to a path whose endpoint is not an array!";}return a};a.prototype.wc=function(a,e){var d,g,f,b,c;void 0!==e&&(e=this.ea(e),d=e.split("."));d=d||this.mb;g=d.length;f=a;for(c=0;c<g;c++)if(f=f[d[c]],!f||"object"!==typeof f){b=
d[c]+":"+f;break}return b};a.prototype.ea=function(a){"."===a.substr(0,1)&&(a=a.substr(1,a.length-1));return a};p.m=a},{"./Shared":16}],15:[function(k,p){var a=k("./Shared"),g,h,e,d;d=function(){this.d.apply(this,arguments)};d.prototype.d=function(a){a.wb()&&void 0!==Storage&&this.mode("localStorage")};a.n.Uc=d;a=a.n.W;g=k("./Collection");h=g.prototype.K;k("./CollectionGroup");k("./Overload");e=a.prototype.d;d.prototype.mode=function(a){return void 0!==a?(this.Tb=a,this):this.Tb};d.prototype.K=function(a,
f){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(b){f&&f(b)}f&&f(!1)}f&&f("No data handler or unrecognised data type.")};g.prototype.K=function(a){if(a)if(this.h)if(this.f)this.f.xc.K(this.h);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),
"Cannot drop a collection's persistent storage when no name assigned to collection!";h.apply(this)};a.prototype.d=function(){this.xc=new d(this);e.apply(this,arguments)};p.m=d},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],16:[function(k,p){p.m={va:0,n:{},md:{}}},{}],17:[function(k,p){function a(a,b,c){this.d.apply(this,arguments)}var g,h,e,d,l;g=k("./Shared");a.prototype.d=function(a,b,c){this.h=a;this.O=[];this.S=[];this.a={};this.U={t:b,options:c};this.g={};this.e=new h("__FDB__view_privateData_"+
this.h)};g.n.Vc=a;h=k("./Collection");l=k("./Overload");e=h.prototype.d;g=g.n.W;d=g.prototype.d;a.prototype.debug=new l([function(){return this.g.all},function(a){return void 0!==a&&"boolean"===typeof a?(this.g.all=a,this.e.debug(a),this.ha().debug(a),this):this.g.all},function(a,b){return void 0!==a?void 0!==b?(this.g[a]=b,this.e.debug(a,b),this.ha().debug(a,b),this):this.g[a]:this.g.all}]);a.prototype.name=function(a){return void 0!==a?(this.h=a,this):this.h};a.prototype.find=function(a,b){return this.ha().find(a,
b)};a.prototype.i=function(a,b,c){a=this.e.w(a);"function"===typeof b?(c=b,b=this.e.length):void 0===b&&(b=this.e.length);this.ac(a,b);this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');return this.e.hb(a,b,c)};a.prototype.update=function(a,b){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');
var c=this.e.update(a,b),d,e,g;if(this.p&&this.P){d=this.r.primaryKey();for(var h=0;h<c.length;h++)e={},g=c[h],e[d]=g[d],this.ec(e,g)}return c};a.prototype.remove=function(a){this.cc(a);this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');return this.e.remove(a)};a.prototype.Zb=function(a){-1<this.O.indexOf(a)&&(this.O.splice(a,1),a.pb(this),this.e.remove(a.find(this.U.t,this.U.options)))};a.prototype.C=
function(){this.e.C.apply(this.e,arguments)};a.prototype.s=function(){this.e.s.apply(this.e,arguments)};a.prototype.j=function(){this.e.j.apply(this.e,arguments)};a.prototype.K=function(){if(this.O&&this.O.length){(this.debug()||this.f&&this.f.debug())&&console.log("ForerunnerDB.View: Dropping view "+this.h);this.j("drop");for(var a=this.O.length;a--;)this.Zb(this.O[a]);this.e.K();return!0}return!1};a.prototype.db=function(a){return void 0!==a?(this.f=a,this.e.db(a),this.ha().db(a),this):this.f};
a.prototype.primaryKey=function(){return this.e.primaryKey()};a.prototype.t=function(a,b){return void 0!==a?(this.U.t=a,void 0!==b&&!0!==b||this.refresh(),this):this.U.t};a.prototype.refresh=function(){var a,b=this.ha(),c;this.e.remove();b.remove();for(c=0;c<this.O.length;c++)a=this.O[c],this.e.i(a.find(this.U.t,this.U.options));a=this.e.find({},this.U.options);b.D?$.M(b.b).refresh(a):(this.e.b.length=0,this.e.b=this.e.b.concat(a));return this};a.prototype.count=function(){return this.e&&this.e.b?
this.e.b.length:0};a.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this.p=a.enabled),void 0!==a.Y&&(this.P=a.Y),void 0!==a.Z&&(this.Q=a.Z)):this.p=!1===a?!1:!0,this.bc(this.e.primaryKey()),this.dc(this.e.find()),this):{enabled:this.p,Y:this.P,Z:this.Q}};a.prototype.ha=function(){return this.p?this.r:this.e};a.prototype.dc=function(a){this.p&&(this.r=new h("__FDB__view_publicData_"+this.h),this.r.db(this.e.f),this.r.transform({enabled:!0,Y:this.P,Z:this.Q}),
this.r.setData(a))};a.prototype.ac=function(a,b){this.p&&this.r&&this.r.i(a,b)};a.prototype.ec=function(a,b){this.p&&this.r&&this.r.update(a,b)};a.prototype.cc=function(a){this.p&&this.r&&this.r.remove(a)};a.prototype.bc=function(a){this.p&&this.r&&this.r.primaryKey(a)};h.prototype.d=function(){this.v=[];e.apply(this,arguments)};h.prototype.pb=function(a){void 0!==a&&(a=this.v.indexOf(a),-1<a&&this.v.splice(a,1))};g.prototype.d=function(){this.v={};d.apply(this,arguments)};p.m=a},{"./Collection":2,
"./Overload":13,"./Shared":16}]},{},[1])(1)}if("object"==typeof exports&&"undefined"!=typeof module)module.m=z();else if("function"==typeof define&&define.$c)define([],z);else{var A;"undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self);A.Nc=z()}!0;
