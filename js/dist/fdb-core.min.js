function x(){return function n(p,d,k){function c(g,f){if(!d[g]){if(!p[g]){var b="function"==typeof require&&require;if(!f&&b)return b(g,!0);if(a)return a(g,!0);b=Error("Cannot find module '"+g+"'");throw b.code="MODULE_NOT_FOUND",b;}b=d[g]={e:{}};p[g][0].call(b.e,function(b){var a=p[g][1][b];return c(a?a:b)},b,b.e,n,p,d,k)}return d[g].e}for(var a="function"==typeof require&&require,g=0;g<k.length;g++)c(k[g]);return c}({1:[function(n,p){var d=n("../lib/Core");p.e=d},{"../lib/Core":3}],2:[function(n,
p){function d(b){this.g.apply(this,arguments)}var k,c,a,g,h,f;k=n("./Shared");d.prototype.g=function(b){this.c="_id";this.l=new h("primary");this.Z=new h("primaryCrc");this.W=new h("crcLookup");this.t=b;this.a=[];this.Y=new g;this.q=0;this.d={};this.C={f:[],update:[],remove:[],w:[]};this.X={f:100,update:100,remove:100,w:100};this.Oa={f:1,update:1,remove:1,w:1};this.wa()};k.s.ub=d;a=n("./Overload");g=n("./Metrics");h=n("./KeyValueStore");f=n("./Path");n("./Index");n("./Crc");c=k.s.La;d.prototype.debug=
new a([function(){return this.d.all},function(b){if(void 0!==b){if("boolean"===typeof b){this.d.all=b;for(var e=0;e<this.A.length;e++)this.A[e].debug(b);return this}return this.d[b]||this.h&&this.h.d&&this.h.d[b]||this.d.all}return this.d.all},function(b,e){if(void 0!==b){if(void 0!==e){this.d[b]=e;for(var a=0;a<this.A.length;a++)this.A[a].debug(b,e);return this}return this.d[b]||this.h&&this.h.d&&this.h.d[b]}return this.d.all}]);d.prototype.name=function(b){return void 0!==b?(this.t=b,this):this.t};
new a([function(b,e){this.b=this.b||{};this.b[b]=this.b[b]||{};this.b[b]["*"]=this.b[b]["*"]||[];this.b[b]["*"].push(e);return this},function(b,e,a){this.b=this.b||{};this.b[b]=this.b[b]||{};this.b[b][e]=this.b[b][e]||[];this.b[b][e].push(a);return this}]);new a([function(b){this.b&&this.b[b]&&b in this.b&&delete this.b[b];return this},function(b,e){var a,r;"string"===typeof e?this.b&&this.b[b]&&this.b[b][e]&&delete this.b[b][e]:b in this.b&&(a=this.b[b]["*"],r=a.indexOf(e),-1<r&&a.splice(r,1));return this},
function(b,e,a){this.b&&b in this.b&&(b=this.b[b][e],a=b.indexOf(a),-1<a&&b.splice(a,1))}]);d.prototype.u=function(b,e){this.b=this.b||{};if(b in this.b){if(this.b[b]["*"]){var a=this.b[b]["*"],r=a.length,t;for(t=0;t<r;t++)a[t].apply(this,Array.prototype.slice.call(arguments,1))}if(e instanceof Array&&e[0]&&e[0][this.c]){var a=this.b[b],d,c,r=e.length;for(t=0;t<r;t++)if(a[e[t][this.c]])for(d=a[e[t][this.c]].length,c=0;c<d;c++)a[e[t][this.c]][c].apply(this,Array.prototype.slice.call(arguments,1))}}return this};
d.prototype.primaryKey=function(b){return void 0!==b?(this.c=b,this.l.primaryKey(b),this.va(),this):this.c};d.prototype.Ua=function(b,e){this.u("insert",b,e)};d.prototype.Wa=function(b){this.u("update",b)};d.prototype.Va=function(b){this.u("remove",b)};d.prototype.db=function(b){return void 0!==b?(this.h=b,this):this.h};d.prototype.setData=function(b,e,a){if(b){var r=this.Y.create("setData");r.start();b instanceof Array||(b=[b]);r.time("transformIn");b=this.ha(b);r.time("transformIn");var t=this.a;
this.a=[];b.length&&(this.a=this.a.concat(b));r.time("_rebuildPrimaryKeyIndex");this.va(e);r.time("_rebuildPrimaryKeyIndex");r.stop();this.u("setData",this.a,t)}a&&a(!1);return this};d.prototype.va=function(b){var e=b&&void 0!==b.gb?b.gb:!0;b=b&&void 0!==b.sb?b.sb:!0;var a,r,t,d=this.l,c=this.Z,g=this.W,h=this.c,f;d.truncate();c.truncate();g.truncate();a=this.a;for(r=a.length;r--;)if(t=a[r],e&&this.oa(t),b){if(!d.K(t[h],t))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+
t[this.c];}else f=JSON.stringify(t),d.set(t[h],t),c.set(t[h],f),g.set(f,t)};d.prototype.oa=function(b){void 0===b[this.c]&&(b[this.c]=this.Ga())};d.prototype.truncate=function(){this.u("truncate",this.a);this.a.length=0;this.Q("change");return this};d.prototype.w=function(b,e){if(b){var a=this.C.w,r=this.X.w,d={},c;if(b instanceof Array){if(b.length>r){this.C.w=a.concat(b);this.fa("upsert",e);return}d=[];for(a=0;a<b.length;a++)d.push(this.w(b[a]));e&&e();return d}b[this.c]?(c={},c[this.c]=b[this.c],
this.count(c)?d.ea="update":d.ea="insert"):d.ea="insert";switch(d.ea){case "insert":d.result=this.f(b);break;case "update":d.result=this.update(c,b)}return d}e&&e()};d.prototype.update=function(b,e,a){function r(r){if(e&&void 0!==e[g]&&e[g]!=r[g]){d.l.U(r[g]);var c=d.G(r,e,b,a,"");if(d.l.K(r[g],r))return c;throw"Primary key violation in update! Key violated: "+r[g];}return d.G(r,e,b,a,"")}e=this.m(e);e=this.ha(e);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+
'"');var d=this,c=this.Y.create("update"),g=this.c,h,f,q=this.A;c.start();c.time("Retrieve documents to update");h=this.find(b,{m:!1});c.time("Retrieve documents to update");if(h.length&&(c.time("Update documents"),f=h.filter(r),c.time("Update documents"),f.length)){if(q&&q.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());c.time("Inform views of update");for(h=0;h<q.length;h++)q[h].update(b,e);c.time("Inform views of update")}this.Wa(f);this.Q("change",{type:"update",
data:f})}c.stop();return f||[]};d.prototype.G=function(b,e,a,r,d){e=this.m(e);d=d||"";"."===d.substr(0,1)&&(d=d.substr(1,d.length-1));var c=!1,g=!1,h,u,q,l,m;for(l in e)if(e.hasOwnProperty(l)){h=!1;if("$"===l.substr(0,1))switch(l){case "$inc":h=!0;for(m in e[l])if(e[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if("number"===typeof b[m])this.Za(b,m,e[l][m]),c=!0;else throw"Cannot increment field that is not a number! ("+m+")!";break;case "$push":h=!0;for(m in e[l])if(e[l].hasOwnProperty(m)&&"$"!==m.substr(0,
1))if(b[m]instanceof Array)this.ya(b[m],e[l][m]),c=!0;else throw"Cannot push to a key that is not an array! ("+m+")!";break;case "$addToSet":h=!0;for(m in e[l])if(e[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array){u=b[m];var k;q=u.length;var n,g=!0;k=r&&r.tb;var p,v;k&&k.key?(p=!1,v=new f(k.key),n=v.value(e[l][m])[0]):(n=JSON.stringify(e[l][m]),p=!0);for(k=0;k<q;k++)if(p){if(JSON.stringify(u[k])===n){g=!1;break}}else if(n===v.value(u[k])[0]){g=!1;break}g&&(this.ya(b[m],e[l][m]),
c=!0)}else throw"Cannot push to a key that is not an array! ("+m+")!";break;case "$splicePush":h=!0;for(m in e[l])if(e[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array)if(c=e[l].ja,void 0!==c)delete e[l][m].ja,this.bb(b[m],c,e[l][m]),c=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+m+")!";break;case "$move":h=!0;for(m in e[l])if(e[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array)for(q=
0;q<b[m].length;q++){if(this.i(b[m][q],e[l][m])){c=e[l].ja;if(void 0!==c)this.ab(b[m],q,c),c=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot pull from a key that is not an array! ("+m+")!";break;case "$pull":for(m in h=!0,e[l])if(e[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array){u=[];for(q=0;q<b[m].length;q++)this.i(b[m][q],e[l][m])&&u.push(q);for(q=u.length;q--;)this.$a(b[m],u[q]),c=!0}else throw"Cannot pull from a key that is not an array! ("+
m+")!";}if(".$"===l.substr(l.length-2,2)&&(h=!0,l=l.substr(0,l.length-2),g=new f(d+"."+l),b[l]&&b[l]instanceof Array&&b[l].length)){u=[];for(q=0;q<b[l].length;q++)this.i(b[l][q],g.value(a)[0])&&u.push(q);for(q=0;q<u.length;q++)(g=this.G(b[l][u[q]],e[l+".$"],a,r,d+"."+l))&&(c=!0)}if(!h)if("object"===typeof e[l])if(null!==b[l]&&"object"===typeof b[l])if(h=b[l]instanceof Array,u=e[l]instanceof Array,h||u)if(!u&&h)for(q=0;q<b[l].length;q++)(g=this.G(b[l][q],e[l],a,r,d+"."+l))&&(c=!0);else this.ba(b,l,
e[l]),c=!0;else(g=this.G(b[l],e[l],a,r,d+"."+l))&&(c=!0);else this.ba(b,l,e[l]),c=!0;else b[l]!==e[l]&&(this.ba(b,l,e[l]),c=!0)}return c};d.prototype.ba=function(b,e,a){this.q?($.v(b).setProperty(e,a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+e+'" for collection "'+this.name()+'"')):(b[e]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+e+'" for collection "'+this.name()+'"'))};d.prototype.ab=function(b,
e,a){this.q?($.v(b).move(e,a),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+e+'" to "'+a+'" for collection "'+this.name()+'"')):(b.splice(a,0,b.splice(e,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+e+'" to "'+a+'" for collection "'+this.name()+'"'))};d.prototype.bb=function(b,e,a){b.length>e?this.q?$.v(b).f(e,a):b.splice(e,0,a):this.q?$.v(b).f(a):b.push(a)};d.prototype.ya=function(b,
e){this.q?$.v(b).f(e):b.push(e)};d.prototype.$a=function(b,e){this.q?$.v(b).remove(e):b.splice(e,1)};d.prototype.Za=function(b,e,a){this.q?$.v(b).setProperty(e,b[e]+a):b[e]+=a};d.prototype.remove=function(b){var e,a,r=this.A,c;if(b instanceof Array){r=[];for(e=0;e<b.length;e++)r.push(this.remove(b[e]));return r}e=this.find(b,{m:!1});if(e.length){for(c=0;c<e.length;c++)a=e[c],this.Xa(a),a=this.a.indexOf(a),this.q?$.v(this.a).remove(a):this.a.splice(a,1);if(r&&r.length)for(c=0;c<r.length;c++)r[c].remove(b);
this.Va(e);this.Q("change",{type:"remove",data:e})}return e};d.prototype.Q=function(){var b=this,e;this.Ta||this.h&&(!this.h||this.h.Ta)?this.u.apply(this,arguments):(e=arguments,this.ma&&clearTimeout(this.ma),this.ma=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+e[0]);b.u.apply(b,e)},100))};d.prototype.fa=function(b,e){var a=this.C[b],c=this.X[b],d=this.Oa[b];if(a.length){var g=this;a.length&&(a=a.length>c?a.splice(0,c):a.splice(0,a.length),this[b](a));setTimeout(function(){g.fa(b,
e)},d)}else e&&e()};d.prototype.f=function(b,e,a){"function"===typeof e?(a=e,e=this.a.length):void 0===e&&(e=this.a.length);b=this.ha(b);return this.Qa(b,e,a)};d.prototype.Qa=function(b,e,a){var c=this.C.f,d=this.X.f,g=[],h=[],f=this.A;if(b instanceof Array){if(b.length>d){this.C.f=c.concat(b);this.fa("insert",a);return}for(d=0;d<b.length;d++)c=this.qa(b[d],e+d),!0===c?g.push(b[d]):h.push({fb:b[d],reason:c})}else c=this.qa(b,e),!0===c?g.push(b):h.push({fb:b,reason:c});if(f&&f.length)for(c=0;c<f.length;c++)f[c].f(b,
e);this.Ua(g,h);a&&a();this.Q("change",{type:"insert",data:g});return{Gb:g,Fb:h}};d.prototype.qa=function(b,e){if(b){var a;this.oa(b);if(a=this.hb(b))return"Index violation in index: "+a;this.Ra(b);this.q?$.v(this.a).f(e,b):this.a.splice(e,0,b);return!0}return"No document passed to insert"};d.prototype.Ra=function(b){var e=this.M,a,c=JSON.stringify(b);this.l.K(b[this.c],b);this.Z.K(b[this.c],c);this.W.K(c,b);for(a in e)e.hasOwnProperty(a)&&e[a].f(b)};d.prototype.Xa=function(b){var e=this.M,a,c=JSON.stringify(b);
this.l.U(b[this.c]);this.Z.U(b[this.c]);this.W.U(c);for(a in e)e.hasOwnProperty(a)&&e[a].remove(b)};d.prototype.pb=function(b){b=this.find(b,void 0);(new d).wa().primaryKey(this.c).setData(b)};d.prototype.wa=function(){return this};d.prototype.m=function(b){return JSON.parse(JSON.stringify(b))};d.prototype.find=function(b,e){function a(e){return d.i(e,b,"and")}b=b||{};e=e||{};e.m=void 0!==e.m?e.m:!0;var c=this.Y.create("find"),d=this,g,h=!0,s,k,q,l,m,n,p,z,v,w=[];c.start();if(b){c.time("analyseQuery");
g=this.Na(b,e,c);c.time("analyseQuery");c.data("analysis",g);if(g.Da&&g.Ia){c.time("joinReferences");for(k=0;k<g.ca.length;k++)l=g.ca[k],q=new f(g.Ea[l]),q=q.value(b)[0],this.h.P(g.ca[k]).pb(q);c.time("joinReferences")}g.n.length&&(!e||e&&!e.Lb)?(c.data("index.potential",g.n),c.data("index.used",g.n[0].index),c.time("indexLookup"),s=g.n[0].r,c.time("indexLookup"),g.n[0].j.B===g.n[0].j.k&&(h=!1)):c.I("usedIndex",!1);h&&(s&&s.length?(g=s.length,c.time("tableScan: "+g),s=s.filter(a)):(g=this.a.length,
c.time("tableScan: "+g),s=this.a.filter(a)),e.sort&&(c.time("sort"),s=this.sort(e.sort,s),c.time("sort")),c.time("tableScan: "+g));e.da&&s&&s.length>e.da&&(s.length=e.da,c.data("limit",e.da));e.m&&(c.time("decouple"),s=this.m(s),c.time("decouple"),c.data("flag.decouple",!0));if(e.join){for(g=0;g<e.join.length;g++)for(l in e.join[g])if(e.join[g].hasOwnProperty(l))for(z=l,h=this.h.P(l),k=e.join[g][l],v=0;v<s.length;v++){n={};p=q=!1;for(m in k)if(k.hasOwnProperty(m))if("$"===m.substr(0,1))switch(m){case "$as":z=
k[m];break;case "$multi":q=k[m];break;case "$require":p=k[m]}else n[m]=(new f(k[m])).value(s[v])[0];n=h.find(n);!p||p&&n[0]?s[v][z]=!1===q?n[0]:n:w.push(s[v])}c.data("flag.join",!0)}if(w.length){c.time("removalQueue");for(m=0;m<w.length;m++)l=s.indexOf(w[m]),-1<l&&s.splice(l,1);c.time("removalQueue")}if(e.transform){c.time("transform");for(m=0;m<s.length;m++)s.splice(m,1,e.transform(s[m]));c.time("transform");c.data("flag.transform",!0)}this.D&&this.F&&(c.time("transformOut"),s=this.qb(s),c.time("transformOut"));
c.data("results",s.length);c.stop()}else c.stop(),s=[];s.Cb=c;return s};d.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this.D=b.enabled),void 0!==b.Ba&&(this.O=b.Ba),void 0!==b.Ca&&(this.F=b.Ca)):this.D=!1===b?!1:!0,this):{enabled:this.D,Ba:this.O,Ca:this.F}};d.prototype.ha=function(b){if(this.D&&this.O){if(b instanceof Array){var e=[],a;for(a=0;a<b.length;a++)e[a]=this.O(b[a]);return e}return this.O(b)}return b};d.prototype.qb=function(b){if(this.D&&
this.F){if(b instanceof Array){var e=[],a;for(a=0;a<b.length;a++)e[a]=this.F(b[a]);return e}return this.F(b)}return b};d.prototype.sort=function(b,e){e=e||[];var a=[],c,d;for(c in b)b.hasOwnProperty(c)&&(d={},d[c]=b[c],d.Ma=c,a.push(d));return 2>a.length?this.$(b,e):this.la(a,e)};d.prototype.la=function(b,e){var a=b.shift(),c,d,g=[];if(0<b.length){e=this.$(a,e);c=this.cb(a.Ma,e);for(d in c)c.hasOwnProperty(d)&&(a=[].concat(b),g=g.concat(this.la(a,c[d])));return g}return this.$(a,e)};d.prototype.$=
function(b,a){var c=new f,d=c.parse(b,!0)[0];c.path(d.path);return a.sort(1===d.value?function(b,a){var e=c.value(b)[0],d=c.value(a)[0];return"string"===typeof e&&"string"===typeof d?e.localeCompare(d):e>d?1:e<d?-1:0}:function(b,a){var e=c.value(b)[0],d=c.value(a)[0];return"string"===typeof e&&"string"===typeof d?1===e.localeCompare(d)?-1:1:e>d?-1:e<d?1:0})};d.prototype.cb=function(b,a){var c,d={};for(c=0;c<a.length;c++)d[a[c][b]]=d[a[c][b]]||[],d[a[c][b]].push(a[c]);return d};d.prototype.Na=function(b,
a,c){var d={Ja:[this.t],n:[],Da:!1,Ia:!1,Ea:{},Kb:b,options:a},g,h=[],k=[],n,p,q,l,m;c.time("checkIndexes");void 0!==b[this.c]&&(c.time("checkIndexMatch: Primary Key"),n=new f,d.n.push({r:this.l.r(b,a),j:{Fa:[this.c],k:1,B:n.za(b)},index:this.l}),c.time("checkIndexMatch: Primary Key"));for(m in this.pa)if(this.pa.hasOwnProperty(m)&&(p=this.pa[m],q=p.name(),c.time("checkIndexMatch: "+q),n=p.match(b,a),l=p.r(b,a),0<n.k&&d.n.push({r:l,j:n,index:p}),c.time("checkIndexMatch: "+q),n.B===n.k))break;c.time("checkIndexes");
1<d.n.length&&(c.time("findOptimalIndex"),d.n.sort(function(b,a){return b.j.B===b.j.k?-1:a.j.B===a.j.k?1:b.j.k===a.j.k?b.r.length-a.r.length:a.j.k-b.j.k}),c.time("findOptimalIndex"));if(a.join){d.Da=!0;for(c=0;c<a.join.length;c++)for(g in a.join[c])a.join[c].hasOwnProperty(g)&&(h.push(g),"$as"in a.join[c][g]?k.push(a.join[c][g].$as):k.push(g));for(g=0;g<k.length;g++)if(a=this.ua(b,k[g],""))d.Ea[h[g]]=a,d.Ia=!0;d.ca=h;d.Ja=d.Ja.concat(h)}return d};d.prototype.ua=function(b,a,c){for(var d in b)if(b.hasOwnProperty(d)){if(d===
a)return c&&(c+="."),c+d;if("object"===typeof b[d])return c&&(c+="."),c+=d,this.ua(b[d],a,c)}return!1};d.prototype.i=function(b,a,c){var d,g;d=typeof b;g=typeof a;var h=!0,f;if(!("string"!==d&&"number"!==d||"string"!==g&&"number"!==g))b!==a&&(h=!1);else for(f in a)if(a.hasOwnProperty(f)){d=!1;if("$"===f.substr(0,1))switch(f){case "$gt":if(b>a[f]){if("or"===c)return!0}else h=!1;d=!0;break;case "$gte":if(b>=a[f]){if("or"===c)return!0}else h=!1;d=!0;break;case "$lt":if(b<a[f]){if("or"===c)return!0}else h=
!1;d=!0;break;case "$lte":if(b<=a[f]){if("or"===c)return!0}else h=!1;d=!0;break;case "$exists":if(void 0===b!==a[f]){if("or"===c)return!0}else h=!1;d=!0;break;case "$or":d=!0;for(g=0;g<a[f].length;g++){if(this.i(b,a[f][g],"and"))return!0;h=!1}break;case "$and":d=!0;for(g=0;g<a[f].length;g++)if(!this.i(b,a[f][g],"and"))return!1;break;case "$in":if(a[f]instanceof Array){d=a[f];g=d.length;var k,n=!1;for(k=0;k<g;k++)if(d[k]===b){n=!0;break}if(n){if("or"===c)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+
f;d=!0;break;case "$nin":if(a[f]instanceof Array){d=a[f];g=d.length;n=!0;for(k=0;k<g;k++)if(d[k]===b){n=!1;break}if(n){if("or"===c)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+f;d=!0;break;case "$ne":if(b!=a[f]){if("or"===c)return!0}else h=!1;d=!0}if(!d&&a[f]instanceof RegExp)if(d=!0,"object"===typeof b&&void 0!==b[f]&&a[f].test(b[f])){if("or"===c)return!0}else h=!1;if(!d)if("object"===typeof a[f])if(void 0!==b[f]){if(b[f]instanceof Array&&!(a[f]instanceof Array))for(d=
!1,g=0;g<b[f].length&&!(d=this.i(b[f][g],a[f],void 0));g++);else if(!(b[f]instanceof Array)&&a[f]instanceof Array)for(d=!1,g=0;g<a[f].length&&!(d=this.i(b[f],a[f][g],void 0));g++);else d="object"===typeof b?this.i(b[f],a[f],void 0):this.i(void 0,a[f],void 0);if(d){if("or"===c)return!0}else h=!1}else if(a[f]&&void 0!==a[f].$exists)if(d=this.i(void 0,a[f],void 0)){if("or"===c)return!0}else h=!1;else h=!1;else if(b&&b[f]===a[f]){if("or"===c)return!0}else if(b&&b[f]&&b[f]instanceof Array&&a[f]&&"object"!==
typeof a[f]){d=!1;for(g=0;g<b[f].length&&!(d=this.i(b[f][g],a[f],void 0));g++);if(d){if("or"===c)return!0}else h=!1}else h=!1;if("and"===c&&!h)return!1}return h};d.prototype.count=function(b,a){return b?this.find(b,a).length:this.a.length};d.prototype.hb=function(b){var a,c=this.M,d,g;if(this.l.get(b[this.c]))a=this.l;else for(d in c)if(c.hasOwnProperty(d)&&(g=c[d],g.unique()&&g.rb(b))){a=g;break}return a?a.name():!1};d.prototype.index=function(b){if(this.M)return this.M[b]};d.prototype.Ga=function(b){var a=
Math.pow(10,17);if(b){var c=0,d=b.length,g;for(g=0;g<d;g++)c+=b.charCodeAt(g)*a;b=c.toString(16)}else k.R++,b=(k.R+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return b};c.prototype.P=function(a,c){if(a)return this.o[a]||this.debug()&&console.log("Creating collection "+a),this.o[a]=this.o[a]||(new d(a)).db(this),void 0!==c&&this.o[a].primaryKey(c),this.o[a];throw"Cannot get collection with undefined name!";};p.e=d},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,
"./Overload":9,"./Path":10,"./Shared":11}],3:[function(n,p){function d(){this.g.apply(this,arguments)}var k,c;k=n("./Shared.js");d.prototype.g=function(){this.o={};this.d={}};k.s.La=d;c=n("./Overload.js");n("./Collection.js");n("./Metrics.js");n("./Crc.js");d.prototype.m=function(a){return JSON.parse(JSON.stringify(a))};d.prototype.debug=new c([function(){return this.d.all},function(a){return void 0!==a&&"boolean"===typeof a?(this.d.all=a,this):this.d.all},function(a,c){return void 0!==a?void 0!==
c?(this.d[a]=c,this):this.d[a]:this.d.all}]);d.prototype.u=function(a,c){this.b=this.b||{};if(a in this.b){var d=this.b[a],f=d.length,b;for(b=0;b<f;b++)d[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};d.prototype.Ga=function(a){var c,d,f=Math.pow(10,17),b;if(a){c=0;d=a.length;for(b=0;b<d;b++)c+=a.charCodeAt(b)*f;a=c.toString(16)}else k.R++,a=(k.R+(Math.random()*f+Math.random()*f+Math.random()*f+Math.random()*f)).toString(16);return a};p.e=d},{"./Collection.js":2,"./Crc.js":4,
"./Metrics.js":7,"./Overload.js":9,"./Shared.js":11}],4:[function(n,p){var d=function(){var d=[],c,a,g;for(a=0;256>a;a++){c=a;for(g=0;8>g;g++)c=c&1?3988292384^c>>>1:c>>>1;d[a]=c}return d}();p.e=function(k){var c=-1,a;for(a=0;a<k.length;a++)c=c>>>8^d[(c^k.charCodeAt(a))&255];return(c^-1)>>>0}},{}],5:[function(n,p){function d(){this.g.apply(this,arguments)}var k=n("./Shared"),c=n("./Path");d.prototype.g=function(a,c,d){this.L={};this.Pa=this.Sa(a,a);this.data({});this.unique(c&&c.unique?c.unique:!1);
void 0!==a&&this.keys(a);void 0!==d&&this.P(d);this.name(c&&c.name?c.name:this.Pa)};k.s.wb=d;d.prototype.data=function(a){return void 0!==a?(this.a=a,this):this.a};d.prototype.name=function(a){return void 0!==a?(this.t=a,this):this.t};d.prototype.P=function(a){return void 0!==a?(this.o=a,this):this.o};d.prototype.keys=function(a){return void 0!==a?(this.p=a,(new c).parse(this.p),this):this.p};d.prototype.type=function(a){return void 0!==a?(this.Ya=a,this):this.Ya};d.prototype.unique=function(a){return void 0!==
a?(this.aa=a,this):this.aa};d.prototype.f=function(a){var c,d;this.aa&&(c=this.N(a,this.p),this.xa[c]=a);c=this.ra(a,this.p);for(d=0;d<c.length;d++)this.nb(c[d],a)};d.prototype.remove=function(a){var c,d;this.aa&&(c=this.N(a,this.p),delete this.xa[c]);c=this.ra(a,this.p);for(d=0;d<c.length;d++)this.lb(c[d],a)};d.prototype.rb=function(a){a=this.N(a,this.p);return Boolean(this.xa[a])};d.prototype.nb=function(a,c){var d=this.a[a]=this.a[a]||[];-1===d.indexOf(c)&&(d.push(c),this.mb(c,d))};d.prototype.lb=
function(a,c){var d=this.a[a],f;f=d.indexOf(c);-1<f&&(d.splice(f,1),this.kb(c));d.length||delete this.a[a]};d.prototype.mb=function(a,c){var d=a[this.o.primaryKey()];this.L[d]=this.L[d]||[];d=this.L[d];-1===d.indexOf(c)&&d.push(c)};d.prototype.kb=function(a){a=a[this.o.primaryKey()];delete this.L[a]};d.prototype.r=function(a){return this.a[this.N(a,this.p)]||[]};d.prototype.match=function(a){return(new c).Aa(this.p,a)};d.prototype.N=function(a,d){var h=new c,f,b="",e;f=h.parse(d);for(e=0;e<f.length;e++)b&&
(b+="_"),b+=h.value(a,f[e].path).join(":");return b};d.prototype.Sa=function(a,d){var h=new c,f,b="",e;f=h.parse(d);for(e=0;e<f.length;e++)b&&(b+="_"),b+=h.ib(a,f[e].path);return b};d.prototype.ra=function(a,d){var h=new c,f,b=[],e,k,n,p;f=h.parse(d);for(n=0;n<f.length;n++)for(e=h.value(a,f[n].path),k=0;k<e.length;k++)if(0===n)b.push(e[k]);else for(p=0;p<b.length;p++)b[p]=b[p]+"_"+e[k];return b};p.e=d},{"./Path":10,"./Shared":11}],6:[function(n,p){function d(c){this.g.apply(this,arguments)}var k=
n("./Shared");d.prototype.g=function(c){this.t=c;this.a={};this.c="_id"};k.s.xb=d;d.prototype.name=function(c){return void 0!==c?(this.t=c,this):this.t};d.prototype.primaryKey=function(c){return void 0!==c?(this.c=c,this):this.c};d.prototype.truncate=function(){this.a={};return this};d.prototype.set=function(c,a){this.a[c]=a?a:!0;return this};d.prototype.get=function(c){return this.a[c]};d.prototype.r=function(c){c=c[this.c];var a,d,h,f;if(c instanceof Array){d=c.length;f=[];for(a=0;a<d;a++)(h=this.a[c[a]])&&
f.push(h);return f}if(c instanceof RegExp){f=[];for(a in this.a)this.a.hasOwnProperty(a)&&c.test(a)&&f.push(this.a[a]);return f}if("object"===typeof c){if(c.Ka){f=[];for(a in this.a)this.a.hasOwnProperty(a)&&a!==c.Ka&&f.push(this.a[a]);return f}if(c.ia&&c.ia instanceof Array){f=[];for(a in this.a)this.a.hasOwnProperty(a)&&-1<c.ia.indexOf(a)&&f.push(this.a[a]);return f}if(c.ka&&c.ka instanceof Array){f=[];for(a in this.a)this.a.hasOwnProperty(a)&&-1===c.ka.indexOf(a)&&f.push(this.a[a]);return f}if(c.V&&
c.V instanceof Array){f=[];for(a=0;a<c.V.length;a++)f=f.concat(this.r(c.V[a]));return f}}else return h=this.a[c],void 0!==h?[h]:[]};d.prototype.U=function(c){delete this.a[c]};d.prototype.K=function(c,a){return void 0===this.a[c]?(this.a[c]=a,!0):!1};p.e=d},{"./Shared":11}],7:[function(n,p){function d(){this.g.apply(this,arguments)}var k=n("./Shared"),c=n("./Operation");d.prototype.g=function(){this.a=[]};k.s.yb=d;d.prototype.create=function(a){a=new c(a);this.na&&this.a.push(a);return a};d.prototype.start=
function(){this.na=!0;return this};d.prototype.stop=function(){this.na=!1;return this};p.e=d},{"./Operation":8,"./Shared":11}],8:[function(n,p){function d(a){this.Ha=new c;this.g.apply(this,arguments)}var k=n("./Shared"),c=n("./Path");d.prototype.g=function(a){this.a={Hb:a,index:{Ib:[],Mb:!1},ob:[],time:{J:0,S:0,T:0,jb:{}},I:{},log:[]}};k.s.zb=d;d.prototype.start=function(){this.a.time.J=(new Date).getTime()};d.prototype.log=function(a){if(a){var c=0<this.Db.length?this.a.log[this.a.log.length-1].time:
0;a={event:a,time:(new Date).getTime(),eb:0};this.a.log.push(a);c&&(a.eb=a.time-c);return this}return this.a.log};d.prototype.time=function(a){if(void 0!==a){var c=this.a.time.jb,c=c[a]=c[a]||{};c.J?(c.S=(new Date).getTime(),c.T=c.S-c.J,c.ga.T=c.T,delete c.ga):(c.J=(new Date).getTime(),c.ga={name:a},this.a.ob.push(c.ga));return this}return this.a.time};d.prototype.I=function(a,c){if(void 0!==a&&void 0!==c)this.a.I[a]=c;else return void 0!==a?this.a.I[a]:this.a.I};d.prototype.data=function(a,c){return void 0!==
c?(this.Ha.set(this.a,a,c),this):this.Ha.get(this.a,a)};d.prototype.stop=function(){this.a.time.S=(new Date).getTime();this.a.time.T=this.a.time.S-this.a.time.J};p.e=d},{"./Path":10,"./Shared":11}],9:[function(n,p){function d(d){if(d){var c,a=d.length;return function(){for(c=0;c<a;c++)if(d[c].length===arguments.length)return d[c].apply(this,arguments);return null}}return function(){}}n("./Shared").s.Ab=d;p.e=d},{"./Shared":11}],10:[function(n,p){function d(c){this.g.apply(this,arguments)}var k=n("./Shared");
d.prototype.g=function(c){c&&this.path(c)};k.s.Bb=d;d.prototype.path=function(c){return void 0!==c?(this.sa=this.H(c),this.ta=this.sa.split("."),this):this.sa};d.prototype.za=function(c){var a=0,d;for(d in c)c.hasOwnProperty(d)&&void 0!==c[d]&&("object"!==typeof c[d]?a++:a+=this.za(c[d]));return a};d.prototype.Aa=function(c,a){var d,h={},f=0,b=0,e;for(e in a)a.hasOwnProperty(e)&&("object"===typeof a[e]?(d=this.Aa(c[e],a[e]),h[e]=d.Fa,b+=d.B,f+=d.k):(b++,c&&c[e]&&"object"!==typeof c[e]?(h[e]=!0,f++):
h[e]=!1));return{Fa:h,k:f,B:b}};d.prototype.parse=function(c,a){var d=[],h="",f,b,e;for(b in c)if(c.hasOwnProperty(b))if(h=b,"object"===typeof c[b])if(a)for(f=this.parse(c[b],a),e=0;e<f.length;e++)d.push({path:h+"."+f[e].path,value:f[e].value});else for(f=this.parse(c[b]),e=0;e<f.length;e++)d.push({path:h+"."+f[e].path});else a?d.push({path:h,value:c[b]}):d.push({path:h});return d};d.prototype.value=function(c,a){if(void 0!==c&&"object"===typeof c){var d,h,f,b,e=[],k;void 0!==a&&(a=this.H(a),d=a.split("."));
d=d||this.ta;h=d.length;f=c;for(k=0;k<h;k++){f=f[d[k]];if(b instanceof Array){for(h=0;h<b.length;h++)e=e.concat(this.value(b,h+"."+d[k]));return e}if(!f||"object"!==typeof f)break;b=f}return[f]}return[]};d.prototype.set=function(c,a,d){if(void 0!==c&&void 0!==a){var h;a=this.H(a);a=a.split(".");h=a.shift();a.length?(c[h]=c[h]||{},this.set(c[h],a.join("."),d)):c[h]=d}return c};d.prototype.get=function(c,a){return this.value(c,a)[0]};d.prototype.push=function(c,a,d){if(void 0!==c&&void 0!==a){var h;
a=this.H(a);a=a.split(".");h=a.shift();if(a.length)c[h]=c[h]||{},this.set(c[h],a.join("."),d);else if(c[h]=c[h]||[],c[h]instanceof Array)c[h].push(d);else throw"Cannot push to a path whose endpoint is not an array!";}return c};d.prototype.ib=function(c,a){var d,h,f,b,e;void 0!==a&&(a=this.H(a),d=a.split("."));d=d||this.ta;h=d.length;f=c;for(e=0;e<h;e++)if(f=f[d[e]],!f||"object"!==typeof f){b=d[e]+":"+f;break}return b};d.prototype.H=function(c){"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));return c};
p.e=d},{"./Shared":11}],11:[function(n,p){p.e={R:0,s:{},Jb:{}}},{}]},{},[1])(1)}if("object"==typeof exports&&"undefined"!=typeof module)module.e=x();else if("function"==typeof define&&define.Eb)define([],x);else{var y;"undefined"!=typeof window?y=window:"undefined"!=typeof global?y=global:"undefined"!=typeof self&&(y=self);y.vb=x()}!0;
