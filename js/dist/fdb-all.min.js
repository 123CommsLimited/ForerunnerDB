!function(Ta){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Ta();else if("function"==typeof define&&define.amd)define([],Ta);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=Ta()}}(function(){return function h(m,k,g){function e(b,d){if(!k[b]){if(!m[b]){var f="function"==typeof require&&require;if(!d&&f)return f(b,!0);if(a)return a(b,!0);throw Error("Cannot find module '"+b+"'");}f=k[b]={exports:{}};
m[b][0].call(f.exports,function(f){var a=m[b][1][f];return e(a?a:f)},f,f.exports,h,m,k,g)}return k[b].exports}for(var a="function"==typeof require&&require,b=0;b<g.length;b++)e(g[b]);return e}({1:[function(h,m,k){k=h("../lib/Core");h("../lib/CollectionGroup");h("../lib/View");h("../lib/Highcharts");h("../lib/Persist");h("../lib/Document");h("../lib/Overview");h("../lib/vendor/jsviews");m.exports=k},{"../lib/CollectionGroup":4,"../lib/Core":5,"../lib/Document":7,"../lib/Highcharts":8,"../lib/Overview":13,
"../lib/Persist":15,"../lib/View":18,"../lib/vendor/jsviews":19}],2:[function(h,m,k){m.exports={chain:function(g){this._chain=this._chain||[];-1===this._chain.indexOf(g)&&this._chain.push(g)},unChain:function(g){this._chain&&(g=this._chain.indexOf(g),-1<g&&this._chain.splice(g,1))},chainSend:function(g,e,a){if(this._chain){var b=this._chain,c=b.length,d;for(d=0;d<c;d++)b[d].chainReceive(this,g,e,a)}},chainReceive:function(g,e,a,b){g={sender:g,type:e,data:a,options:b};(!this._chainHandler||this._chainHandler&&
!this._chainHandler(g))&&this.chainSend(g.type,g.data,g.options)}}},{}],3:[function(h,m,k){var g,e,a,b,c;k=h("./Shared");var d=function(f){this.init.apply(this,arguments)};d.prototype.init=function(f){this._primaryKey="_id";this._primaryIndex=new e("primary");this._primaryCrc=new e("primaryCrc");this._crcLookup=new e("crcLookup");this._name=f;this._data=[];this._groups=[];this._metrics=new g;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,
update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};k.addModule("Collection",d);k.inherit(d.prototype,k.chainReactor);g=h("./Metrics");e=h("./KeyValueStore");a=h("./Path");b=h("./Index");c=h("./Crc");h=k.modules.Core;d.prototype.debug=k.common.debug;d.prototype.crc=c;k.synthesize(d.prototype,"name");d.prototype.on=k.common.on;d.prototype.off=k.common.off;d.prototype.emit=k.common.emit;d.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var f=[],a;for(a=0;a<this._groups.length;a++)f.push(this._groups[a]);for(a=0;a<f.length;a++)this._groups[a].removeCollection(this);return!0}return!1};d.prototype.primaryKey=function(f){return void 0!==f?(this._primaryKey!==f&&(this._primaryKey=f,this._primaryIndex.primaryKey(f),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};d.prototype._onInsert=function(f,a){this.emit("insert",
f,a)};d.prototype._onUpdate=function(f){this.emit("update",f)};d.prototype._onRemove=function(f){this.emit("remove",f)};k.synthesize(d.prototype,"db");d.prototype.setData=function(f,a,b){if(f){var d=this._metrics.create("setData");d.start();a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;a.$decouple&&(f=this.decouple(f));f instanceof Array||(f=[f]);d.time("transformIn");f=this.transformIn(f);d.time("transformIn");var c=this._data;this._linked?this.remove():this._data=[];f.length&&(this._linked?
this.insert(f):this._data=this._data.concat(f));d.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(a);d.time("Rebuild Primary Key Index");d.time("Resolve chains");this.chainSend("setData",f,{oldData:c});d.time("Resolve chains");d.stop();this.emit("setData",this._data,c)}b&&b(!1);return this};d.prototype._rebuildPrimaryKeyIndex=function(f){var a=f&&void 0!==f.ensureKeys?f.ensureKeys:!0;f=f&&void 0!==f.violationCheck?f.violationCheck:!0;var b,d,c,e=this._primaryIndex,g=this._primaryCrc,
k=this._crcLookup,h=this._primaryKey,r;e.truncate();g.truncate();k.truncate();b=this._data;for(d=b.length;d--;){c=b[d];a&&this._ensurePrimaryKey(c);if(f){if(!e.uniqueSet(c[h],c))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+c[this._primaryKey];}else e.set(c[h],c);r=JSON.stringify(c);g.set(c[h],r);k.set(r,c)}};d.prototype._ensurePrimaryKey=function(f){void 0===f[this._primaryKey]&&(f[this._primaryKey]=
this.objectId())};d.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};d.prototype.upsert=function(f,a){if(f){var b=this._deferQueue.upsert,d=this._deferThreshold.upsert,c={},e;if(f instanceof Array){if(f.length>d){this._deferQueue.upsert=b.concat(f);this.processQueue("upsert",a);return}c=[];for(b=0;b<f.length;b++)c.push(this.upsert(f[b]));a&&a();return c}f[this._primaryKey]?(e={},e[this._primaryKey]=f[this._primaryKey],this._primaryIndex.lookup(e)[0]?
c.op="update":c.op="insert"):c.op="insert";switch(c.op){case "insert":c.result=this.insert(f);break;case "update":c.result=this.update(e,f)}return c}a&&a()};d.prototype.update=function(f,a,b){a=this.decouple(a);a=this.transformIn(a);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var d=this,c=this._metrics.create("update"),e=this._primaryKey,g,k,h=function(c){if(a&&void 0!==a[e]&&a[e]!=c[e]){d._removeIndex(c);var g=d._updateObject(c,a,f,b,"");if(d._insertIndex(c))return g;
throw"Primary key violation in update! Key violated: "+c[e];}return d._updateObject(c,a,f,b,"")};c.start();c.time("Retrieve documents to update");g=this.find(f,{$decouple:!1});c.time("Retrieve documents to update");g.length&&(c.time("Update documents"),k=g.filter(h),c.time("Update documents"),k.length&&(c.time("Resolve chains"),this.chainSend("update",{query:f,update:a},b),c.time("Resolve chains"),this._onUpdate(k),this.deferEmit("change",{type:"update",data:k})));c.stop();return k||[]};d.prototype.updateById=
function(f,a){var b={};b[this._primaryKey]=f;return this.update(b,a)};d.prototype._updateObject=function(f,b,d,c,e,g){b=this.decouple(b);e=e||"";"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));var k=!1,h=!1,q,r,n,l;for(l in b)if(b.hasOwnProperty(l)){q=!1;if("$"===l.substr(0,1))switch(l){case "$index":q=!0;break;default:q=!0,(h=this._updateObject(f,b[l],d,c,e,l))&&(k=!0)}if(this._isPositionalKey(l)&&(q=!0,l=l.substr(0,l.length-2),h=new a(e+"."+l),f[l]&&f[l]instanceof Array&&f[l].length)){r=[];for(n=
0;n<f[l].length;n++)this._match(f[l][n],h.value(d)[0])&&r.push(n);for(n=0;n<r.length;n++)(h=this._updateObject(f[l][r[n]],b[l+".$"],d,c,e+"."+l,g))&&(k=!0)}if(!q)if(g||"object"!==typeof b[l])switch(g){case "$inc":this._updateIncrement(f,l,b[l]);k=!0;break;case "$push":void 0===f[l]&&(f[l]=[]);if(f[l]instanceof Array){if(void 0!==b[l].$position&&b[l].$each instanceof Array)for(h=b[l].$position,q=b[l].$each.length,n=0;n<q;n++)this._updateSplicePush(f[l],h+n,b[l].$each[n]);else if(b[l].$each instanceof
Array)for(q=b[l].$each.length,n=0;n<q;n++)this._updatePush(f[l],b[l].$each[n]);else this._updatePush(f[l],b[l]);k=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(f[l]instanceof Array){r=[];for(n=0;n<f[l].length;n++)this._match(f[l][n],b[l])&&r.push(n);for(q=r.length;q--;)this._updatePull(f[l],r[q]),k=!0}break;case "$pullAll":if(f[l]instanceof Array)if(b[l]instanceof Array){if(r=f[l],q=r.length,0<q)for(;q--;){for(h=0;h<b[l].length;h++)r[q]===b[l][h]&&(this._updatePull(f[l],
q),q--,k=!0);if(0>q)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===f[l]&&(f[l]=[]);if(f[l]instanceof Array){n=f[l];var m;r=n.length;var s;q=!0;m=c&&c.$addToSet;var Z;m&&m.key?(h=!1,Z=new a(m.key),s=Z.value(b[l])[0]):(s=JSON.stringify(b[l]),h=!0);for(m=0;m<r;m++)if(h){if(JSON.stringify(n[m])===s){q=!1;break}}else if(s===Z.value(n[m])[0]){q=!1;break}q&&(this._updatePush(f[l],b[l]),k=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";
break;case "$splicePush":void 0===f[l]&&(f[l]=[]);if(f[l]instanceof Array)if(h=b.$index,void 0!==h)delete b.$index,h>f[l].length&&(h=f[l].length),this._updateSplicePush(f[l],h,b[l]),k=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(f[l]instanceof Array)for(n=0;n<f[l].length;n++){if(this._match(f[l][n],b[l])){k=b.$index;if(void 0!==k)delete b.$index,this._updateSpliceMove(f[l],n,k),k=!0;else throw"Cannot move without a $index integer value!";
break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(f,l,b[l]);k=!0;break;case "$rename":this._updateRename(f,l,b[l]);k=!0;break;case "$unset":this._updateUnset(f,l);k=!0;break;case "$pop":if(f[l]instanceof Array)this._updatePop(f[l],b[l])&&(k=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:f[l]!==b[l]&&(this._updateProperty(f,l,b[l]),k=!0)}else if(null!==f[l]&&"object"===typeof f[l])if(n=f[l]instanceof Array,
r=b[l]instanceof Array,n||r)if(!r&&n)for(n=0;n<f[l].length;n++)(h=this._updateObject(f[l][n],b[l],d,c,e+"."+l,g))&&(k=!0);else f[l]!==b[l]&&(this._updateProperty(f,l,b[l]),k=!0);else(h=this._updateObject(f[l],b[l],d,c,e+"."+l,g))&&(k=!0);else f[l]!==b[l]&&(this._updateProperty(f,l,b[l]),k=!0)}return k};d.prototype._isPositionalKey=function(f){return".$"===f.substr(f.length-2,2)};d.prototype._updateProperty=function(f,a,b){this._linked?(jQuery.observable(f).setProperty(a,b),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+
a+'" for collection "'+this.name()+'"')):(f[a]=b,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+a+'" for collection "'+this.name()+'"'))};d.prototype._updateIncrement=function(f,a,b){this._linked?jQuery.observable(f).setProperty(a,f[a]+b):f[a]+=b};d.prototype._updateSpliceMove=function(f,a,b){this._linked?(jQuery.observable(f).move(a,b),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+a+'" to "'+b+'" for collection "'+
this.name()+'"')):(f.splice(b,0,f.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+a+'" to "'+b+'" for collection "'+this.name()+'"'))};d.prototype._updateSplicePush=function(f,a,b){f.length>a?this._linked?jQuery.observable(f).insert(a,b):f.splice(a,0,b):this._linked?jQuery.observable(f).insert(b):f.push(b)};d.prototype._updatePush=function(f,a){this._linked?jQuery.observable(f).insert(a):f.push(a)};d.prototype._updatePull=function(f,
a){this._linked?jQuery.observable(f).remove(a):f.splice(a,1)};d.prototype._updateMultiply=function(f,a,b){this._linked?jQuery.observable(f).setProperty(a,f[a]*b):f[a]*=b};d.prototype._updateRename=function(f,a,b){var d=f[a];this._linked?(jQuery.observable(f).setProperty(b,d),jQuery.observable(f).removeProperty(a)):(f[b]=d,delete f[a])};d.prototype._updateUnset=function(f,a){this._linked?jQuery.observable(f).removeProperty(a):delete f[a]};d.prototype._updatePop=function(f,a){var b,d=!1;0<f.length&&
(this._linked?(1===a?b=f.length-1:-1===a&&(b=0),-1<b&&(jQuery.observable(arr).remove(b),d=!0)):1===a?(f.pop(),d=!0):-1===a&&(f.shift(),d=!0));return d};d.prototype.remove=function(f,a,b){var d,c;if(f instanceof Array){c=[];for(b=0;b<f.length;b++)c.push(this.remove(f[b],{noEmit:!0}));(!a||a&&!a.noEmit)&&this._onRemove(c);return c}b=this.find(f,{$decouple:!1});if(b.length){for(c=0;c<b.length;c++)d=b[c],this._removeIndex(d),d=this._data.indexOf(d),this._linked?jQuery.observable(this._data).remove(d):
this._data.splice(d,1);this.chainSend("remove",{query:f},a);(!a||a&&!a.noEmit)&&this._onRemove(b);this.deferEmit("change",{type:"remove",data:b})}return b};d.prototype.removeById=function(f){var a={};a[this._primaryKey]=f;return this.remove(a)};d.prototype.deferEmit=function(){var f=this,a;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(a=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){f.debug()&&
console.log("ForerunnerDB.Collection: Emitting "+a[0]);f.emit.apply(f,a)},100))};d.prototype.processQueue=function(f,a){var b=this._deferQueue[f],d=this._deferThreshold[f],c=this._deferTime[f];if(b.length){var e=this;b.length&&(b=b.length>d?b.splice(0,d):b.splice(0,b.length),this[f](b));setTimeout(function(){e.processQueue(f,a)},c)}else a&&a()};d.prototype.insert=function(f,a,b){"function"===typeof a?(b=a,a=this._data.length):void 0===a&&(a=this._data.length);f=this.transformIn(f);return this._insertHandle(f,
a,b)};d.prototype._insertHandle=function(f,a,b){var d=this._deferQueue.insert,c=this._deferThreshold.insert,e=[],g=[];if(f instanceof Array){if(f.length>c){this._deferQueue.insert=d.concat(f);this.processQueue("insert",b);return}for(c=0;c<f.length;c++)d=this._insert(f[c],a+c),!0===d?e.push(f[c]):g.push({doc:f[c],reason:d})}else d=this._insert(f,a),!0===d?e.push(f):g.push({doc:f,reason:d});this.chainSend("insert",f,{index:a});this._onInsert(e,g);b&&b();this.deferEmit("change",{type:"insert",data:e});
return{inserted:e,failed:g}};d.prototype._insert=function(f,a){if(f){var b;this._ensurePrimaryKey(f);if(b=this.insertIndexViolation(f))return"Index violation in index: "+b;this._insertIndex(f);a>this._data.length&&(a=this._data.length);this._linked?jQuery.observable(this._data).insert(a,f):this._data.splice(a,0,f);return!0}return"No document passed to insert"};d.prototype._insertIndex=function(f){var a=this._indexByName,b,d,c=JSON.stringify(f);d=this._primaryIndex.uniqueSet(f[this._primaryKey],f);
this._primaryCrc.uniqueSet(f[this._primaryKey],c);this._crcLookup.uniqueSet(c,f);for(b in a)a.hasOwnProperty(b)&&a[b].insert(f);return d};d.prototype._removeIndex=function(f){var a=this._indexByName,b,d=JSON.stringify(f);this._primaryIndex.unSet(f[this._primaryKey]);this._primaryCrc.unSet(f[this._primaryKey]);this._crcLookup.unSet(d);for(b in a)a.hasOwnProperty(b)&&a[b].remove(f)};d.prototype.subset=function(a,b){var c=this.find(a,b);return(new d)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};
d.prototype.subsetOf=function(){return this.__subsetOf};d.prototype._subsetOf=function(a){this.__subsetOf=a;return this};d.prototype.distinct=function(f,b,d){b=this.find(b,d);f=new a(f);d={};var c=[],e,g;for(g=0;g<b.length;g++)(e=f.value(b[g])[0])&&!d[e]&&(d[e]=!0,c.push(e));return c};d.prototype.decouple=k.common.decouple;d.prototype.findById=function(a,b){var d={};d[this._primaryKey]=a;return this.find(d,b)[0]};d.prototype.peek=function(a,b){var c=this._data,e=c.length,g,k,h=new d;if("string"===
typeof a){for(g=0;g<e;g++)k=JSON.stringify(c[g]),-1<k.indexOf(a)&&h.insert(c[g]);return h.find({},b)}return this.find(a,b)};d.prototype.explain=function(a,b){return this.find(a,b).__fdbOp._data};d.prototype.find=function(b,d){b=b||{};d=d||{};d.$decouple=void 0!==d.$decouple?d.$decouple:!0;var c=this._metrics.create("find"),e=this,g,k=!0,h,F,q,r,n,l,m,s,Z,pa=[];F=function(a){return e._match(a,b,"and")};c.start();if(b){c.time("analyseQuery");g=this._analyseQuery(b,d,c);c.time("analyseQuery");c.data("analysis",
g);if(g.hasJoin&&g.queriesJoin){c.time("joinReferences");for(q=0;q<g.joinsOn.length;q++)n=g.joinsOn[q],r=new a(g.joinQueries[n]),r=r.value(b)[0],this._db.collection(g.joinsOn[q]).subset(r);c.time("joinReferences")}g.indexMatch.length&&(!d||d&&!d.$skipIndex)?(c.data("index.potential",g.indexMatch),c.data("index.used",g.indexMatch[0].index),c.time("indexLookup"),h=g.indexMatch[0].lookup,c.time("indexLookup"),g.indexMatch[0].keyData.totalKeyCount===g.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):c.flag("usedIndex",
!1);k&&(h&&h.length?(g=h.length,c.time("tableScan: "+g),h=h.filter(F)):(g=this._data.length,c.time("tableScan: "+g),h=this._data.filter(F)),d.$orderBy&&(c.time("sort"),h=this.sort(d.$orderBy,h),c.time("sort")),c.time("tableScan: "+g));d.limit&&h&&h.length>d.limit&&(h.length=d.limit,c.data("limit",d.limit));d.$decouple&&(c.time("decouple"),h=this.decouple(h),c.time("decouple"),c.data("flag.decouple",!0));if(d.join){for(F=0;F<d.join.length;F++)for(n in d.join[F])if(d.join[F].hasOwnProperty(n))for(s=
n,g=this._db.collection(n),k=d.join[F][n],Z=0;Z<h.length;Z++){m={};r=q=!1;for(l in k)if(k.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":s=k[l];break;case "$multi":q=k[l];break;case "$require":r=k[l];break;default:l.substr(0,3)}else m[l]=(new a(k[l])).value(h[Z])[0];m=g.find(m);!r||r&&m[0]?h[Z][s]=!1===q?m[0]:m:pa.push(h[Z])}c.data("flag.join",!0)}if(pa.length){c.time("removalQueue");for(l=0;l<pa.length;l++)n=h.indexOf(pa[l]),-1<n&&h.splice(n,1);c.time("removalQueue")}if(d.transform){c.time("transform");
for(l=0;l<h.length;l++)h.splice(l,1,d.transform(h[l]));c.time("transform");c.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(c.time("transformOut"),h=this.transformOut(h),c.time("transformOut"));c.data("results",h.length);c.stop()}else c.stop(),h=[];h.__fdbOp=c;return h};d.prototype.indexOf=function(a){if(a=this.find(a,{$decouple:!1})[0])return this._data.indexOf(a)};d.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=
a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.transformIn=function(a){if(this._transformEnabled&&this._transformIn){if(a instanceof Array){var b=[],d;for(d=0;d<a.length;d++)b[d]=this._transformIn(a[d]);return b}return this._transformIn(a)}return a};d.prototype.transformOut=function(a){if(this._transformEnabled&&
this._transformOut){if(a instanceof Array){var b=[],d;for(d=0;d<a.length;d++)b[d]=this._transformOut(a[d]);return b}return this._transformOut(a)}return a};d.prototype.sort=function(a,b){b=b||[];var d=[],c,e;for(c in a)a.hasOwnProperty(c)&&(e={},e[c]=a[c],e.___fdbKey=c,d.push(e));return 2>d.length?this._sort(a,b):this._bucketSort(d,b)};d.prototype._bucketSort=function(a,b){var d=a.shift(),c,e,g=[];if(0<a.length){b=this._sort(d,b);c=this.bucket(d.___fdbKey,b);for(e in c)c.hasOwnProperty(e)&&(d=[].concat(a),
g=g.concat(this._bucketSort(d,c[e])));return g}return this._sort(d,b)};d.prototype._sort=function(b,d){var c=new a,e=c.parse(b,!0)[0];c.path(e.path);return d.sort(1===e.value?function(a,b){var f=c.value(a)[0],d=c.value(b)[0];return"string"===typeof f&&"string"===typeof d?f.localeCompare(d):f>d?1:f<d?-1:0}:function(a,b){var f=c.value(a)[0],d=c.value(b)[0];return"string"===typeof f&&"string"===typeof d?1===f.localeCompare(d)?-1:1:f>d?-1:f<d?1:0})};d.prototype.bucket=function(a,b){var d,c={};for(d=0;d<
b.length;d++)c[b[d][a]]=c[b[d][a]]||[],c[b[d][a]].push(b[d]);return c};d.prototype._analyseQuery=function(b,d,c){var e={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:d},g,h=[],k=[],m,q,r,n,l;c.time("checkIndexes");void 0!==b[this._primaryKey]&&(c.time("checkIndexMatch: Primary Key"),m=new a,e.indexMatch.push({lookup:this._primaryIndex.lookup(b,d),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(b)},index:this._primaryIndex}),
c.time("checkIndexMatch: Primary Key"));for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(q=this._indexById[l],r=q.name(),c.time("checkIndexMatch: "+r),m=q.match(b,d),n=q.lookup(b,d),0<m.matchedKeyCount&&e.indexMatch.push({lookup:n,keyData:m,index:q}),c.time("checkIndexMatch: "+r),m.totalKeyCount===m.matchedKeyCount))break;c.time("checkIndexes");1<e.indexMatch.length&&(c.time("findOptimalIndex"),e.indexMatch.sort(function(a,b){return a.keyData.totalKeyCount===a.keyData.matchedKeyCount?
-1:b.keyData.totalKeyCount===b.keyData.matchedKeyCount?1:a.keyData.matchedKeyCount===b.keyData.matchedKeyCount?a.lookup.length-b.lookup.length:b.keyData.matchedKeyCount-a.keyData.matchedKeyCount}),c.time("findOptimalIndex"));if(d.join){e.hasJoin=!0;for(c=0;c<d.join.length;c++)for(g in d.join[c])d.join[c].hasOwnProperty(g)&&(h.push(g),"$as"in d.join[c][g]?k.push(d.join[c][g].$as):k.push(g));for(g=0;g<k.length;g++)if(d=this._queryReferencesCollection(b,k[g],""))e.joinQueries[h[g]]=d,e.queriesJoin=!0;
e.joinsOn=h;e.queriesOn=e.queriesOn.concat(h)}return e};d.prototype._queryReferencesCollection=function(a,b,d){for(var c in a)if(a.hasOwnProperty(c)){if(c===b)return d&&(d+="."),d+c;if("object"===typeof a[c])return d&&(d+="."),d+=c,this._queryReferencesCollection(a[c],b,d)}return!1};d.prototype._match=function(a,b,d){var c,e;c=typeof a;e=typeof b;var g=!0,h;if(!("string"!==c&&"number"!==c||"string"!==e&&"number"!==e))a!==b&&(g=!1);else for(h in b)if(b.hasOwnProperty(h)){c=!1;if("$"===h.substr(0,1))switch(h){case "$gt":if(a>
b[h]){if("or"===d)return!0}else g=!1;c=!0;break;case "$gte":if(a>=b[h]){if("or"===d)return!0}else g=!1;c=!0;break;case "$lt":if(a<b[h]){if("or"===d)return!0}else g=!1;c=!0;break;case "$lte":if(a<=b[h]){if("or"===d)return!0}else g=!1;c=!0;break;case "$exists":if(void 0===a!==b[h]){if("or"===d)return!0}else g=!1;c=!0;break;case "$or":c=!0;for(e=0;e<b[h].length;e++){if(this._match(a,b[h][e],"and"))return!0;g=!1}break;case "$and":c=!0;for(e=0;e<b[h].length;e++)if(!this._match(a,b[h][e],"and"))return!1;
break;case "$in":if(b[h]instanceof Array){c=b[h];e=c.length;var k,m=!1;for(k=0;k<e;k++)if(c[k]===a){m=!0;break}if(m){if("or"===d)return!0}else g=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;c=!0;break;case "$nin":if(b[h]instanceof Array){c=b[h];e=c.length;m=!0;for(k=0;k<e;k++)if(c[k]===a){m=!1;break}if(m){if("or"===d)return!0}else g=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;c=!0;break;case "$ne":if(a!=b[h]){if("or"===d)return!0}else g=!1;c=!0}if(!c&&b[h]instanceof
RegExp)if(c=!0,"object"===typeof a&&void 0!==a[h]&&b[h].test(a[h])){if("or"===d)return!0}else g=!1;if(!c)if("object"===typeof b[h])if(void 0!==a[h]){if(a[h]instanceof Array&&!(b[h]instanceof Array))for(c=!1,e=0;e<a[h].length&&!(c=this._match(a[h][e],b[h],void 0));e++);else if(!(a[h]instanceof Array)&&b[h]instanceof Array)for(c=!1,e=0;e<b[h].length&&!(c=this._match(a[h],b[h][e],void 0));e++);else c="object"===typeof a?this._match(a[h],b[h],void 0):this._match(void 0,b[h],void 0);if(c){if("or"===d)return!0}else g=
!1}else if(b[h]&&void 0!==b[h].$exists)if(c=this._match(void 0,b[h],void 0)){if("or"===d)return!0}else g=!1;else g=!1;else if(a&&a[h]===b[h]){if("or"===d)return!0}else if(a&&a[h]&&a[h]instanceof Array&&b[h]&&"object"!==typeof b[h]){c=!1;for(e=0;e<a[h].length&&!(c=this._match(a[h][e],b[h],void 0));e++);if(c){if("or"===d)return!0}else g=!1}else g=!1;if("and"===d&&!g)return!1}return g};d.prototype.count=function(a,b){return a?this.find(a,b).length:this._data.length};d.prototype.link=function(a,b){if(window.jQuery){this._links=
this._links||{};var d,c;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(d=this.objectId(b.template),c=b.template):d=b;if(!this._links[d]){if(jQuery(a).length){if(!jQuery.templates[d]){if(!c)if(c=jQuery(b),c.length)c=jQuery(c[0]).html();else throw"Unable to bind collection to target because template does not exist: "+b;jQuery.views.templates(d,c)}jQuery.templates[d].link(a,this._data);this._links[d]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+
this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+d;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.unlink=function(a,b){if(window.jQuery){this._links=this._links||{};var d;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(d=this.objectId(b.template)):d=b;if(this._links[d])return jQuery.templates[d].unlink(a),
delete this._links[d],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";return this};d.prototype.findSub=function(b,d,c,e){var g=new a(d);b=this.find(b);var h=b.length,k,m,q=this._db.collection("__FDB_temp_"+this.objectId()),r={parents:h,
subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(k=0;k<h;k++)if(m=g.value(b[k])[0]){q.setData(m);m=q.find(c,e);if(e.returnFirst&&m.length)return m[0];r.subDocs.push(m);r.subDocTotal+=m.length;r.pathFound=!0}q.drop();if(e.noStats)return r.subDocs;r.pathFound||(r.err="No objects found in the parent documents with a matching path of: "+d);return r};d.prototype.insertIndexViolation=function(a){var b,d=this._indexByName,c,e;if(this._primaryIndex.get(a[this._primaryKey]))b=this._primaryIndex;else for(c in d)if(d.hasOwnProperty(c)&&
(e=d[c],e.unique()&&e.violation(a))){b=e;break}return b?b.name():!1};d.prototype.ensureIndex=function(a,d){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var c=new b(a,d,this),e={start:(new Date).getTime()};if(this._indexByName[c.name()])return{err:"Index with that name already exists"};if(this._indexById[c.id()])return{err:"Index with those keys already exists"};c.rebuild();this._indexByName[c.name()]=c;this._indexById[c.id()]=c;e.end=(new Date).getTime();e.total=e.end-
e.start;this._lastOp={type:"ensureIndex",stats:{time:e}};return{index:c,id:c.id(),name:c.name(),state:c.state()}};d.prototype.index=function(a){if(this._indexByName)return this._indexByName[a]};d.prototype.lastOp=function(){return this._metrics.list()};d.prototype.objectId=k.common.objectId;d.prototype.diff=function(a){var b={insert:[],update:[],remove:[]},d=this.primaryKey(),c,e,g,h;if(d===a.primaryKey()){for(c=a._data;c&&!(c instanceof Array);)a=c,c=a._data;h=c.length;for(e=0;e<h;e++)g=c[e],this._primaryIndex.get(g[d])?
this._primaryCrc.get(g[d])!==a._primaryCrc.get(g[d])&&b.update.push(g):b.insert.push(g);c=this._data;h=c.length;for(e=0;e<h;e++)g=c[e],a._primaryIndex.get(g[d])||b.remove.push(g)}else throw"Collection diffing requires that both collections have the same primary key!";return b};h.prototype.collection=function(a,b){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+a),this._collection[a]=this._collection[a]||(new d(a)).db(this),void 0!==b&&this._collection[a].primaryKey(b),
this._collection[a];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(a){return Boolean(this._collection[a])};h.prototype.collections=function(){var a=[],b;for(b in this._collection)this._collection.hasOwnProperty(b)&&a.push({name:b,count:this._collection[b].count()});return a};m.exports=d},{"./Crc":6,"./Index":9,"./KeyValueStore":10,"./Metrics":11,"./Path":14,"./Shared":17}],4:[function(h,m,k){var g,e;k=h("./Shared");var a=function(){this.init.apply(this,arguments)};
a.prototype.init=function(a){this._name=a;this._data=new e("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};k.addModule("CollectionGroup",a);k.inherit(a.prototype,k.chainReactor);e=h("./Collection");h=k.modules.Core;g=k.modules.Core.prototype.init;a.prototype.debug=k.common.debug;a.prototype.on=function(){this._data.on.apply(this._data,arguments)};a.prototype.off=function(){this._data.off.apply(this._data,arguments)};a.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};
a.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};k.synthesize(a.prototype,"db");a.prototype.addCollection=function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(a.primaryKey());this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};a.prototype.removeCollection=
function(a){if(a){var c=this._collections.indexOf(a);-1!==c&&(a.unChain(this),this._collections.splice(c,1),c=a._groups.indexOf(this),-1!==c&&a._groups.splice(c,1));0===this._collections.length&&delete this._primaryKey}return this};a.prototype.decouple=k.common.decouple;a.prototype._chainHandler=function(a){switch(a.type){case "setData":a.data=this.decouple(a.data);this._data.remove(a.options.oldData);this._data.insert(a.data);break;case "insert":a.data=this.decouple(a.data);this._data.insert(a.data);
break;case "update":this._data.update(a.data.query,a.data.update,a.options);break;case "remove":this._data.remove(a.data.query,a.options)}};a.prototype.insert=function(){this._collectionsRun("insert",arguments)};a.prototype.update=function(){this._collectionsRun("update",arguments)};a.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};a.prototype.remove=function(){this._collectionsRun("remove",arguments)};a.prototype._collectionsRun=function(a,c){for(var d=0;d<this._collections.length;d++)this._collections[d][a].apply(this._collections[d],
c)};a.prototype.find=function(a,c){return this._data.find(a,c)};a.prototype.removeById=function(a){for(var c=0;c<this._collections.length;c++)this._collections[c].removeById(a)};a.prototype.subset=function(a,c){var d=this.find(a,c);return(new e)._subsetOf(this).primaryKey(this._primaryKey).setData(d)};a.prototype.drop=function(){var a,c=[].concat(this._collections),d=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<c.length;a++)this.removeCollection(c[a]);
for(a=0;a<d.length;a++)this._removeView(d[a]);this.emit("drop");return!0};h.prototype.init=function(){this._collectionGroup={};g.apply(this,arguments)};h.prototype.collectionGroup=function(b){return b?(this._collectionGroup[b]=this._collectionGroup[b]||(new a(b)).db(this),this._collectionGroup[b]):this._collectionGroup};m.exports=a},{"./Collection":3,"./Shared":17}],5:[function(h,m,k){var g,e;g=h("./Shared.js");k=function(){this.init.apply(this,arguments)};k.prototype.init=function(){this._collection=
{};this._debug={};this._version="1.2.7"};k.prototype.moduleLoaded=g.overload({string:function(a){if(void 0!==a){a=a.replace(/ /g,"");var b=a.split(","),c;for(c=0;c<b.length;c++)if(!g.modules[a])return!1;return!0}return!1},"string, function":function(a,b){if(void 0!==a){a=a.replace(/ /g,"");var c=a.split(","),d;for(d=0;d<c.length;d++)if(!g.modules[a])return!1;b()}},"string, function, function":function(a,b,c){if(void 0!==a){a=a.replace(/ /g,"");var d=a.split(","),f;for(f=0;f<d.length;f++)if(!g.modules[a])return c(),
!1;b()}}});k.moduleLoaded=k.prototype.moduleLoaded;k.shared=g;k.prototype.shared=g;g.addModule("Core",k);g.inherit(k.prototype,g.chainReactor);e=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");k.prototype._isServer=!1;k.prototype.isClient=function(){return!this._isServer};k.prototype.isServer=function(){return this._isServer};k.prototype.crc=h;k.prototype.isClient=function(){return!this._isServer};k.prototype.isServer=function(){return this._isServer};k.prototype.decouple=g.common.decouple;
k.prototype.debug=g.common.debug;k.prototype.arrayToCollection=function(a){return(new e).setData(a)};k.prototype.on=function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);return this};k.prototype.off=function(a,b){if(a in this._listeners){var c=this._listeners[a],d=c.indexOf(b);-1<d&&c.splice(d,1)}return this};k.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){var c=this._listeners[a],d=c.length,
f;for(f=0;f<d;f++)c[f].apply(this,Array.prototype.slice.call(arguments,1))}return this};k.prototype.objectId=g.common.objectId;k.prototype.peek=function(a){var b,c,d=[],f=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(c=this._collection[b],d="string"===f?d.concat(c.peek(a)):d.concat(c.find(a)));return d};k.prototype.peekCat=function(a){var b,c,d={},f,e=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(c=this._collection[b],(f="string"===e?c.peek(a):c.find(a))&&
f.length&&(d[c.name()]=f));return d};m.exports=k},{"./Collection.js":3,"./Crc.js":6,"./Metrics.js":11,"./Shared.js":17}],6:[function(h,m,k){var g=function(){var e=[],a,b,c;for(b=0;256>b;b++){a=b;for(c=0;8>c;c++)a=a&1?3988292384^a>>>1:a>>>1;e[b]=a}return e}();m.exports=function(e){var a=-1,b;for(b=0;b<e.length;b++)a=a>>>8^g[(a^e.charCodeAt(b))&255];return(a^-1)>>>0}},{}],7:[function(h,m,k){var g,e;k=h("./Shared");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(a){this._name=
a;this._data={}};k.addModule("Document",a);k.inherit(a.prototype,k.chainReactor);h=h("./Collection");g=k.modules.Core;e=k.modules.Core.prototype.init;k.synthesize(a.prototype,"db");k.synthesize(a.prototype,"name");a.prototype.setData=function(a){var c,d;if(a)if(a=this.decouple(a),this._linked){d={};for(c in this._data)"jQuery"!==c.substr(0,6)&&this._data.hasOwnProperty(c)&&void 0===a[c]&&(d[c]=1);a.$unset=d;this._updateObject(this._data,a,{})}else this._data=a;return this};a.prototype.decouple=k.common.decouple;
a.prototype.objectId=k.common.objectId;a.prototype.on=k.common.on;a.prototype.off=k.common.off;a.prototype.emit=k.common.emit;a.prototype.debug=k.common.debug;a.prototype.update=function(a,c,d){this._updateObject(this._data,c,a,d)};a.prototype._updateObject=h.prototype._updateObject;a.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};a.prototype._updateProperty=function(a,c,d){this._linked?(jQuery.observable(a).setProperty(c,d),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+
c+'" for collection "'+this.name()+'"')):(a[c]=d,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+c+'" for collection "'+this.name()+'"'))};a.prototype._updateIncrement=function(a,c,d){this._linked?jQuery.observable(a).setProperty(c,a[c]+d):a[c]+=d};a.prototype._updateSpliceMove=function(a,c,d){this._linked?(jQuery.observable(a).move(c,d),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+c+'" to "'+d+'" for collection "'+
this.name()+'"')):(a.splice(d,0,a.splice(c,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+c+'" to "'+d+'" for collection "'+this.name()+'"'))};a.prototype._updateSplicePush=function(a,c,d){a.length>c?this._linked?jQuery.observable(a).insert(c,d):a.splice(c,0,d):this._linked?jQuery.observable(a).insert(d):a.push(d)};a.prototype._updatePush=function(a,c){this._linked?jQuery.observable(a).insert(c):a.push(c)};a.prototype._updatePull=function(a,
c){this._linked?jQuery.observable(a).remove(c):a.splice(c,1)};a.prototype._updateMultiply=function(a,c,d){this._linked?jQuery.observable(a).setProperty(c,a[c]*d):a[c]*=d};a.prototype._updateRename=function(a,c,d){var f=a[c];this._linked?(jQuery.observable(a).setProperty(d,f),jQuery.observable(a).removeProperty(c)):(a[d]=f,delete a[c])};a.prototype._updateUnset=function(a,c){this._linked?jQuery.observable(a).removeProperty(c):delete a[c]};a.prototype._updatePop=function(a,c){var d,f=!1;0<a.length&&
(this._linked?(1===c?d=a.length-1:-1===c&&(d=0),-1<d&&(jQuery.observable(arr).remove(d),f=!0)):1===c?(a.pop(),f=!0):-1===c&&(a.shift(),f=!0));return f};a.prototype.link=function(a,c){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var d,f;c&&"object"===typeof c?c.template&&"string"===typeof c.template&&(d=this.objectId(c.template),f=c.template):d=c;if(!this._links[d]){if(jQuery(a).length){if(!jQuery.templates[d]){if(!f)if(f=jQuery(c),f.length)f=jQuery(f[0]).html();else throw"Unable to bind document to target because template does not exist: "+
c;jQuery.views.templates(d,f)}jQuery.templates[d].link(a,this._data);this._links[d]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+d;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};a.prototype.unlink=
function(a,c){if(window.jQuery){this._links=this._links||{};var d;c&&"object"===typeof c?c.template&&"string"===typeof c.template&&(d=this.objectId(c.template)):d=c;if(this._links[d])return jQuery.templates[d].unlink(a),delete this._links[d],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+c)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";
};a.prototype.drop=function(){this._db&&this._name&&this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};g.prototype.init=function(){e.apply(this,arguments)};g.prototype.document=function(b){return b?(this._document=this._document||{},this._document[b]=this._document[b]||(new a(b)).db(this),this._document[b]):this._document};m.exports=a},{"./Collection":3,"./Shared":17}],8:[function(h,m,k){var g;h=h("./Shared");var e=function(a,b){this.init.apply(this,
arguments)};e.prototype.init=function(a,b){this._options=b;this._selector=$(this._options.selector);this._listeners={};this._collection=a;this._options.series=[];var c,d;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();c=this._collection.find();d={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||
"black"}}};c=this.pieDataFromCollectionData(c,this._options.keyField,this._options.valField);$.extend(d,this._options.seriesOptions);$.extend(d,{type:"pie",name:this._options.seriesName,data:c});this._chart.addSeries(d);break;case "line":c=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=c.xAxis,this._options.chartOptions.series=c.series,this._selector.highcharts(this._options.chartOptions),
this._chart=this._selector.highcharts()}this._hookEvents()};h=h.modules.Collection;g=h.prototype.init;e.prototype.pieDataFromCollectionData=function(a,b,c){var d=[],f;for(f=0;f<a.length;f++)d.push([a[f][b],a[f][c]]);return d};e.prototype.lineDataFromCollectionData=function(a,b,c,d){var f=this._collection.distinct(a),e=[],g={categories:[]},h,k,m,ba,F;for(ba=0;ba<f.length;ba++){h=f[ba];k={};k[a]=h;m=[];k=this._collection.find(k,{orderBy:d});for(F=0;F<k.length;F++)g.categories.push(k[F][b]),m.push(k[F][c]);
e.push({name:h,data:m})}return{xAxis:g,series:e}};e.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};e.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var a=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField));break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,
this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);for(var b=0;b<a.series.length;b++)this._chart.series[b].setData(a.series[b].data)}}};e.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};e.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];
delete this._chart;delete this._options;delete this._collection;return this};h.prototype.init=function(){this._highcharts={};g.apply(this,arguments)};h.prototype.chart=function(a){this._highcharts[a.selector]||(this._highcharts[a.selector]=new e(this,a));return this._highcharts[a.selector]};h.prototype.dropChart=function(a){this._highcharts[a]&&this._highcharts[a].drop()};m.exports=e},{"./Shared":17}],9:[function(h,m,k){k=h("./Shared");var g=h("./Path");h=function(){this.init.apply(this,arguments)};
h.prototype.init=function(e,a,b){this._crossRef={};this._size=0;this._id=this._itemKeyHash(e,e);this.data({});this.unique(a&&a.unique?a.unique:!1);void 0!==e&&this.keys(e);void 0!==b&&this.collection(b);this.name(a&&a.name?a.name:this._id)};k.addModule("Index",h);k.inherit(h.prototype,k.chainReactor);h.prototype.id=function(){return this._id};h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};h.prototype.data=function(e){return void 0!==e?(this._data=e,
this):this._data};k.synthesize(h.prototype,"name");h.prototype.collection=function(e){return void 0!==e?(this._collection=e,this):this._collection};h.prototype.keys=function(e){return void 0!==e?(this._keys=e,this._keyCount=(new g).parse(this._keys).length,this):this._keys};h.prototype.type=function(e){return void 0!==e?(this._type=e,this):this._type};h.prototype.unique=function(e){return void 0!==e?(this._unique=e,this):this._unique};h.prototype.rebuild=function(){if(this._collection){var e=this._collection.subset({},
{$decouple:!1,$orderBy:this._keys}).find(),a,b=e.length;this._data={};this._unique&&(this._uniqueLookup={});for(a=0;a<b;a++)this.insert(e[a])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(e,a){var b,c;this._unique&&(b=this._itemHash(e,this._keys),this._uniqueLookup[b]=e);b=this._itemHashArr(e,this._keys);for(c=0;c<b.length;c++)this.pushToPathValue(b[c],e)};h.prototype.remove=function(e,a){var b,c;this._unique&&
(b=this._itemHash(e,this._keys),delete this._uniqueLookup[b]);b=this._itemHashArr(e,this._keys);for(c=0;c<b.length;c++)this.pullFromPathValue(b[c],e)};h.prototype.violation=function(e){e=this._itemHash(e,this._keys);return Boolean(this._uniqueLookup[e])};h.prototype.hashViolation=function(e){return Boolean(this._uniqueLookup[e])};h.prototype.pushToPathValue=function(e,a){var b=this._data[e]=this._data[e]||[];-1===b.indexOf(a)&&(b.push(a),this._size++,this.pushToCrossRef(a,b))};h.prototype.pullFromPathValue=
function(e,a){var b=this._data[e],c;c=b.indexOf(a);-1<c&&(b.splice(c,1),this._size--,this.pullFromCrossRef(a,b));b.length||delete this._data[e]};h.prototype.pull=function(e){var a=e[this._collection.primaryKey()],b=this._crossRef[a],c,d=b.length,f;for(c=0;c<d;c++)f=b[c],this._pullFromArray(f,e);this._size--;delete this._crossRef[a]};h.prototype._pullFromArray=function(e,a){for(var b=e.length;b--;)e[b]===a&&e.splice(b,1)};h.prototype.pushToCrossRef=function(e,a){var b=e[this._collection.primaryKey()];
this._crossRef[b]=this._crossRef[b]||[];b=this._crossRef[b];-1===b.indexOf(a)&&b.push(a)};h.prototype.pullFromCrossRef=function(e,a){var b=e[this._collection.primaryKey()];delete this._crossRef[b]};h.prototype.lookup=function(e){return this._data[this._itemHash(e,this._keys)]||[]};h.prototype.match=function(e,a){return(new g).countObjectPaths(this._keys,e)};h.prototype._itemHash=function(e,a){var b=new g,c,d="",f;c=b.parse(a);for(f=0;f<c.length;f++)d&&(d+="_"),d+=b.value(e,c[f].path).join(":");return d};
h.prototype._itemKeyHash=function(e,a){var b=new g,c,d="",f;c=b.parse(a);for(f=0;f<c.length;f++)d&&(d+="_"),d+=b.keyValue(e,c[f].path);return d};h.prototype._itemHashArr=function(e,a){var b=new g,c,d=[],f,h,k,m;c=b.parse(a);for(k=0;k<c.length;k++)for(f=b.value(e,c[k].path),h=0;h<f.length;h++)if(0===k)d.push(f[h]);else for(m=0;m<d.length;m++)d[m]=d[m]+"_"+f[h];return d};m.exports=h},{"./Path":14,"./Shared":17}],10:[function(h,m,k){h=h("./Shared");k=function(g){this.init.apply(this,arguments)};k.prototype.init=
function(g){this._name=g;this._data={};this._primaryKey="_id"};h.addModule("KeyValueStore",k);h.inherit(k.prototype,h.chainReactor);h.synthesize(k.prototype,"name");k.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey=g,this):this._primaryKey};k.prototype.truncate=function(){this._data={};return this};k.prototype.set=function(g,e){this._data[g]=e?e:!0;return this};k.prototype.get=function(g){return this._data[g]};k.prototype.lookup=function(g){g=g[this._primaryKey];var e,a,b,c;if(g instanceof
Array){a=g.length;c=[];for(e=0;e<a;e++)(b=this._data[g[e]])&&c.push(b);return c}if(g instanceof RegExp){c=[];for(e in this._data)this._data.hasOwnProperty(e)&&g.test(e)&&c.push(this._data[e]);return c}if("object"===typeof g){if(g.$ne){c=[];for(e in this._data)this._data.hasOwnProperty(e)&&e!==g.$ne&&c.push(this._data[e]);return c}if(g.$in&&g.$in instanceof Array){c=[];for(e in this._data)this._data.hasOwnProperty(e)&&-1<g.$in.indexOf(e)&&c.push(this._data[e]);return c}if(g.$nin&&g.$nin instanceof
Array){c=[];for(e in this._data)this._data.hasOwnProperty(e)&&-1===g.$nin.indexOf(e)&&c.push(this._data[e]);return c}if(g.$or&&g.$or instanceof Array){c=[];for(e=0;e<g.$or.length;e++)c=c.concat(this.lookup(g.$or[e]));return c}}else return b=this._data[g],void 0!==b?[b]:[]};k.prototype.unSet=function(g){delete this._data[g];return this};k.prototype.uniqueSet=function(g,e){return void 0===this._data[g]?(this._data[g]=e,!0):!1};m.exports=k},{"./Shared":17}],11:[function(h,m,k){k=h("./Shared");var g=
h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};k.addModule("Metrics",h);k.inherit(h.prototype,k.chainReactor);h.prototype.create=function(e){e=new g(e);this._enabled&&this._data.push(e);return e};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=function(){this._enabled=!1;return this};h.prototype.clear=function(){this._data=[];return this};h.prototype.list=function(){return this._data};m.exports=h},{"./Operation":12,
"./Shared":17}],12:[function(h,m,k){k=h("./Shared");var g=h("./Path");h=function(e){this.pathSolver=new g;this.counter=0;this.init.apply(this,arguments)};h.prototype.init=function(e){this._data={operation:e,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};k.addModule("Operation",h);k.inherit(h.prototype,k.chainReactor);h.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};h.prototype.log=function(e){if(e){var a=0<this._log.length?
this._data.log[this._data.log.length-1].time:0;e={event:e,time:(new Date).getTime(),delta:0};this._data.log.push(e);a&&(e.delta=e.time-a);return this}return this._data.log};h.prototype.time=function(e){if(void 0!==e){var a=this._data.time.process,a=a[e]=a[e]||{};a.startMs?(a.stopMs=(new Date).getTime(),a.totalMs=a.stopMs-a.startMs,a.stepObj.totalMs=a.totalMs,delete a.stepObj):(a.startMs=(new Date).getTime(),a.stepObj={name:e},this._data.steps.push(a.stepObj));return this}return this._data.time};h.prototype.flag=
function(e,a){if(void 0!==e&&void 0!==a)this._data.flag[e]=a;else return void 0!==e?this._data.flag[e]:this._data.flag};h.prototype.data=function(e,a,b){return void 0!==a?(this.pathSolver.set(this._data,e,a),this):this.pathSolver.get(this._data,e)};h.prototype.pushData=function(e,a,b){this.pathSolver.push(this._data,e,a)};h.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=h},{"./Path":14,"./Shared":17}],
13:[function(h,m,k){var g,e,a;k=h("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(c){this._name=c;this._data=new a("__FDB__dc_data_"+this._name);this._collData=new e;this._collections=[]};k.addModule("Overview",b);k.inherit(b.prototype,k.chainReactor);e=h("./Collection");a=h("./Document");h=k.modules.Core;g=k.modules.Core.prototype.init;k.synthesize(b.prototype,"db");k.synthesize(b.prototype,"name");k.synthesize(b.prototype,"query",function(a){var d=this.$super(a);
void 0!==a&&this._refresh();return d});k.synthesize(b.prototype,"queryOptions",function(a){var d=this.$super(a);void 0!==a&&this._refresh();return d});k.synthesize(b.prototype,"reduce",function(a){var d=this.$super(a);void 0!==a&&this._refresh();return d});b.prototype.debug=k.common.debug;b.prototype.objectId=k.common.objectId;b.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};b.prototype.find=function(){return this._collData.find.apply(this._collData,
arguments)};b.prototype.count=function(){return this._collData.count.apply(this._collData,arguments)};b.prototype._addCollection=function(a){-1===this._collections.indexOf(a)&&(this._collections.push(a),a.chain(this),this._refresh());return this};b.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._refresh());return this};b.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());
var a=[],d;for(d=0;d<this._collections.length;d++)a=a.concat(this._collections[d].find(this._query,this._queryOptions));this._collData.setData(a)}this._reduce&&(a=this._reduce(),this._data.setData(a))};b.prototype._chainHandler=function(a){switch(a.type){case "setData":case "insert":case "update":case "remove":this._refresh()}};b.prototype.link=function(a,d){this._data.link.apply(this._data,arguments);this._refresh()};b.prototype.unlink=function(a,d){this._data.unlink.apply(this._data,arguments);
this._refresh()};h.prototype.init=function(){this._overview={};g.apply(this,arguments)};h.prototype.overview=function(a){return a?(this._overview[a]=this._overview[a]||(new b(a)).db(this),this._overview[a]):this._overview};m.exports=b},{"./Collection":3,"./Document":7,"./Shared":17}],14:[function(h,m,k){h=h("./Shared");k=function(g){this.init.apply(this,arguments)};k.prototype.init=function(g){g&&this.path(g)};h.addModule("Path",k);h.inherit(k.prototype,h.chainReactor);k.prototype.path=function(g){return void 0!==
g?(this._path=this.clean(g),this._pathParts=this._path.split("."),this):this._path};k.prototype.hasObjectPaths=function(g,e){var a=!0,b;for(b in g)if(g.hasOwnProperty(b)&&(void 0===e[b]||"object"===typeof g[b]&&(a=this.hasObjectPaths(g[b],e[b]),!a)))return!1;return a};k.prototype.countKeys=function(g){var e=0,a;for(a in g)g.hasOwnProperty(a)&&void 0!==g[a]&&("object"!==typeof g[a]?e++:e+=this.countKeys(g[a]));return e};k.prototype.countObjectPaths=function(g,e){var a,b={},c=0,d=0,f;for(f in e)e.hasOwnProperty(f)&&
("object"===typeof e[f]?(a=this.countObjectPaths(g[f],e[f]),b[f]=a.matchedKeys,d+=a.totalKeyCount,c+=a.matchedKeyCount):(d++,g&&g[f]&&"object"!==typeof g[f]?(b[f]=!0,c++):b[f]=!1));return{matchedKeys:b,matchedKeyCount:c,totalKeyCount:d}};k.prototype.parse=function(g,e){var a=[],b="",c,d,f;for(d in g)if(g.hasOwnProperty(d))if(b=d,"object"===typeof g[d])if(e)for(c=this.parse(g[d],e),f=0;f<c.length;f++)a.push({path:b+"."+c[f].path,value:c[f].value});else for(c=this.parse(g[d]),f=0;f<c.length;f++)a.push({path:b+
"."+c[f].path});else e?a.push({path:b,value:g[d]}):a.push({path:b});return a};k.prototype.parseArr=function(g,e){e=e||{};return this._parseArr(g,"",[],e)};k.prototype._parseArr=function(g,e,a,b){var c,d="";e=e||"";a=a||[];for(c in g)g.hasOwnProperty(c)&&(!b.ignore||b.ignore&&!b.ignore.test(c))&&(d=e?e+"."+c:c,"object"===typeof g[c]?this._parseArr(g[c],d,a,b):a.push(d));return a};k.prototype.value=function(g,e){if(void 0!==g&&"object"===typeof g){var a,b,c,d,f=[],h;void 0!==e&&(e=this.clean(e),a=e.split("."));
a=a||this._pathParts;b=a.length;c=g;for(h=0;h<b;h++){c=c[a[h]];if(d instanceof Array){for(b=0;b<d.length;b++)f=f.concat(this.value(d,b+"."+a[h]));return f}if(!c||"object"!==typeof c)break;d=c}return[c]}return[]};k.prototype.set=function(g,e,a){if(void 0!==g&&void 0!==e){var b;e=this.clean(e);e=e.split(".");b=e.shift();e.length?(g[b]=g[b]||{},this.set(g[b],e.join("."),a)):g[b]=a}return g};k.prototype.get=function(g,e){return this.value(g,e)[0]};k.prototype.push=function(g,e,a){if(void 0!==g&&void 0!==
e){var b;e=this.clean(e);e=e.split(".");b=e.shift();if(e.length)g[b]=g[b]||{},this.set(g[b],e.join("."),a);else if(g[b]=g[b]||[],g[b]instanceof Array)g[b].push(a);else throw"Cannot push to a path whose endpoint is not an array!";}return g};k.prototype.keyValue=function(g,e){var a,b,c,d,f;void 0!==e&&(e=this.clean(e),a=e.split("."));a=a||this._pathParts;b=a.length;c=g;for(f=0;f<b;f++)if(c=c[a[f]],!c||"object"!==typeof c){d=a[f]+":"+c;break}return d};k.prototype.clean=function(g){"."===g.substr(0,1)&&
(g=g.substr(1,g.length-1));return g};m.exports=k},{"./Shared":17}],15:[function(h,m,k){k=h("./Shared");var g,e,a,b;b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};k.addModule("Persist",b);k.inherit(b.prototype,k.chainReactor);k=k.modules.Core;g=h("./Collection");e=g.prototype.drop;h("./CollectionGroup");a=k.prototype.init;b.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};b.prototype.save=
function(a,d,b){switch(this.mode()){case "localStorage":d="object"===typeof d?"json::fdb::"+JSON.stringify(d):"raw::fdb::"+d;try{localStorage.setItem(a,d)}catch(e){if(b)b(e);else throw e;break}if(b)b(!1);else return!1;break;default:if(b)b("No data handler.");else throw"No data handler.";}};b.prototype.load=function(a,d){var b,e;switch(this.mode()){case "localStorage":try{b=localStorage.getItem(a)}catch(g){d(g,null)}if(b){b=b.split("::fdb::");switch(b[0]){case "json":e=JSON.parse(b[1]);break;case "raw":e=
b[1]}if(d)d(!1,e);else return e}break;default:if(d)d("No data handler or unrecognised data type.");else throw"No data handler or unrecognised data type.";}};b.prototype.drop=function(a,d){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(b){d&&d(b)}d&&d(!1);break;default:d&&d("No data handler or unrecognised data type.")}};g.prototype.drop=function(a){if(a)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),
"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";e.apply(this)};g.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,a);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";
else return a&&a("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};g.prototype.load=function(a){var d=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(b,e){if(b)return a&&a(b),b;e&&d.setData(e);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};
k.prototype.init=function(){this.persist=new b(this);a.apply(this,arguments)};m.exports=b},{"./Collection":3,"./CollectionGroup":4,"./Shared":17}],16:[function(h,m,k){h=h("./Shared");k=function(g,e,a){if(g&&e&&a){this._reactorIn=g;this._reactorOut=e;this._chainHandler=a;if(!g.chain||!e.chainReceive)throw"ReactorIO requires passed in and out objects to implement the ChainReactor mixin!";g.chain(this);this.chain(e)}else throw"ReactorIO requires an in, out and process argument to instantiate!";};k.prototype.drop=
function(){this._reactorIn.unChain(this);this.unChain(this._reactorOut);delete this._reactorIn;delete this._reactorOut;delete this._chainHandler};h.addModule("ReactorIO",k);h.inherit(k.prototype,h.chainReactor);m.exports=k},{"./Shared":17}],17:[function(h,m,k){var g=0,e=function(a){var b=[],c,d=["string","object","number","function","undefined"],f;if(-1<a.indexOf("*"))for(f=0;f<d.length;f++)c=a.replace("*",d[f]),b=b.concat(e(c));else b.push(a);return b};k=function(a){if(a){var b,c,d,f,g;if(!(a instanceof
Array)){d={};for(b in a)if(a.hasOwnProperty(b))if(f=b.replace(/ /g,""),-1===f.indexOf("*"))d[f]=a[b];else for(g=e(f),f=0;f<g.length;f++)d[g[f]]||(d[g[f]]=a[b]);a=d}return function(){if(a instanceof Array)for(c=a.length,b=0;b<c;b++){if(a[b].length===arguments.length)return a[b].apply(this,arguments)}else{var d=[],e;for(b=0;b<arguments.length;b++)d.push(typeof arguments[b]);e=d.join(",");if(a[e])return a[e].apply(this,arguments);for(b=d.length;0<=b;b--)if(e=d.slice(0,b).join(","),a[e+",..."])return a[e+
",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments!";}}return function(){}};h={modules:{},common:{decouple:function(a){if(void 0!==a)return JSON.parse(JSON.stringify(a))},objectId:function(a){var b=Math.pow(10,17);if(a){var c=0,d=a.length,e;for(e=0;e<d;e++)c+=a.charCodeAt(e)*b;a=c.toString(16)}else g++,a=(g+(Math.random()*b+Math.random()*b+Math.random()*b+Math.random()*b)).toString(16);return a},debug:new k([function(){return this._debug&&
this._debug.all},function(a){return void 0!==a?"boolean"===typeof a?(this._debug=this._debug||{},this._debug.all=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[a]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(a,b){return void 0!==a?void 0!==b?(this._debug=this._debug||{},this._debug[a]=b,this.chainSend("debug",this._debug),this):this._debug&&this._debug[b]||this._db&&this._db._debug&&this._db._debug[a]:this._debug&&
this._debug.all}]),on:new k({"string, function":function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(b);return this},"string, *, function":function(a,b,c){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][b]=this._listeners[a][b]||[];this._listeners[a][b].push(c);return this}}),off:new k({string:function(a){this._listeners&&this._listeners[a]&&
a in this._listeners&&delete this._listeners[a];return this},"string, function":function(a,b){var c,d;"string"===typeof b?this._listeners&&this._listeners[a]&&this._listeners[a][b]&&delete this._listeners[a][b]:a in this._listeners&&(c=this._listeners[a]["*"],d=c.indexOf(b),-1<d&&c.splice(d,1));return this},"string, *, function":function(a,b,c){this._listeners&&a in this._listeners&&b in this.listeners[a]&&(a=this._listeners[a][b],c=a.indexOf(c),-1<c&&a.splice(c,1))},"string, *":function(a,b){this._listeners&&
a in this._listeners&&b in this._listeners[a]&&delete this._listeners[a][b]}}),emit:function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var c=this._listeners[a]["*"],d=c.length,e;for(e=0;e<d;e++)c[e].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var c=this._listeners[a],g,h,d=b.length;for(e=0;e<d;e++)if(c[b[e][this._primaryKey]])for(g=c[b[e][this._primaryKey]].length,h=0;h<g;h++)c[b[e][this._primaryKey]][h].apply(this,
Array.prototype.slice.call(arguments,1))}}return this}},_synth:{},addModule:function(a,b){this.modules[a]=b},inherit:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},synthesize:function(a,b,c){this._synth[b]=this._synth[b]||function(a){return void 0!==a?(this["_"+b]=a,this):this["_"+b]};if(c){var d=this;a[b]=function(){var a=this.$super,e;this.$super=d._synth[b];e=c.apply(this,arguments);this.$super=a;return e}}else a[b]=this._synth[b]},overload:k,chainReactor:h("./ChainReactor")};m.exports=
h},{"./ChainReactor":2}],18:[function(h,m,k){var g,e,a,b;k=h("./Shared");var c=function(a,b,c){this.init.apply(this,arguments)};c.prototype.init=function(a,b,c){this._name=a;this._groups=[];this._listeners={};this._querySettings={query:b,options:c};this._debug={};this._privateData=new g("__FDB__view_privateData_"+this._name)};k.addModule("View",c);k.inherit(c.prototype,k.chainReactor);g=h("./Collection");CollectionGroup=h("./CollectionGroup");b=h("./ReactorIO");e=g.prototype.init;h=k.modules.Core;
a=h.prototype.init;k.synthesize(c.prototype,"name");c.prototype.debug=k.common.debug;c.prototype.insert=function(){this._from.insert.apply(this._from,arguments)};c.prototype.update=function(){this._from.update.apply(this._from,arguments)};c.prototype.updateById=function(){this._from.updateById.apply(this._from,arguments)};c.prototype.remove=function(){this._from.remove.apply(this._from,arguments)};c.prototype.find=function(a,b){return this.publicData().find(a,b)};c.prototype.link=function(a,b){var c=
this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);c.link(a,b);return this};c.prototype.unlink=function(a,b){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);c.unlink(a,b);return this};c.prototype.decouple=k.common.decouple;
c.prototype.from=function(a){var c=this;if(void 0!==a){"string"===typeof a&&(a=this._db.collection(a));this._from=a;this._io=new b(a,this,function(a){var b,d,e;if("insert"===a.type){if(c._querySettings.query){b=a.data;if(b instanceof Array)for(d=[],a=0;a<b.length;a++)c._privateData._match(b[a],c._querySettings.query,"and")&&(d.push(b[a]),e=!0);else c._privateData._match(b,c._querySettings.query,"and")&&(d=b,e=!0);e&&this.chainSend("insert",d);return!0}return!1}if("update"===a.type){if(c._querySettings.query&&
(d=c._privateData.diff(c._from.subset(c._querySettings.query,c._querySettings.options)),d.insert.length||d.remove.length)){d.insert.length&&this.chainSend("insert",d.insert);if(d.update.length)for(b=c._privateData.primaryKey(),a=0;a<d.update.length;a++)e={},e[b]=d.update[a][b],this.chainSend("update",{query:e,update:d.update[a]});d.remove.length&&this.chainSend("remove",d.remove);return!0}return!1}});var e=a.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(a.primaryKey());
this._transformInsert(e);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(e)}return this};c.prototype.ensureIndex=function(){return this._privateData.ensureIndex.apply(this._privateData,arguments)};c.prototype._chainHandler=function(a){var b,c,e,g;switch(a.type){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');a.data=this.decouple(a.data);this._transformSetData(a.data);
this._privateData.setData(a.data);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');a.data=this.decouple(a.data);a.data instanceof Array||(a.data=[a.data]);b=this._privateData._data.length;this._transformInsert(a.data,b);this._privateData._insertHandle(a.data,b);this._refreshSort(a.data);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');this._privateData.primaryKey();a=this._privateData.update(a.data.query,a.data.update,a.data.options);this._refreshSort(a);if(this._transformEnabled&&this._transformIn)for(b=this._publicData.primaryKey(),g=0;g<a.length;g++)c={},e=a[g],c[b]=e[b],this._transformUpdate(c,e);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+
this._privateData.name()+'"'),this._transformRemove(a.data.query,a.options),this._privateData.remove(a.data.query,a.options)}};c.prototype._refreshSort=function(){if(this._querySettings.options&&this._querySettings.options.$orderBy){var a=this;this._refreshSortDebounce&&clearTimeout(this._refreshSortDebounce);this._refreshSortDebounce=setTimeout(function(){a._refreshSortAction()},10)}};c.prototype._refreshSortAction=function(){var a,b,c,e;delete this._refreshSortDebounce;a=this._privateData.find({},
{$orderBy:this._querySettings.options.$orderBy,$decouple:!1});for(e=0;e<a.length;e++)b=this._privateData._data.indexOf(a[e]),c=a.indexOf(a[e]),b!==c&&this._privateData._updateSpliceMove(this._privateData._data,b,c)};c.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};c.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};c.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};c.prototype.drop=function(){return this._from?
((this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name),this._io.drop(),this._privateData.drop(),!0):!1};c.prototype.db=function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};c.prototype.primaryKey=function(){return this._privateData.primaryKey()};c.prototype.queryData=function(a,b,c){void 0!==a&&(this._querySettings.query=a);void 0!==b&&(this._querySettings.options=b);return void 0!==a||void 0!==
b?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};c.prototype.queryAdd=function(a,b,c){var e=this._querySettings.query,g;if(void 0!==a)for(g in a)a.hasOwnProperty(g)&&(void 0===e[g]||void 0!==e[g]&&b)&&(e[g]=a[g]);void 0!==c&&!0!==c||this.refresh()};c.prototype.queryRemove=function(a,b){var c=this._querySettings.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&delete c[e];void 0!==b&&!0!==b||this.refresh()};c.prototype.query=function(a,b){return void 0!==a?(this._querySettings.query=
a,void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.query};c.prototype.queryOptions=function(a,b){return void 0!==a?(this._querySettings.options=a,void 0===a.$decouple&&(a.$decouple=!0),void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.options};c.prototype.refresh=function(){if(this._from){var a=this.publicData();this._privateData.remove();a.remove();this._privateData.insert(this._from.find(this._querySettings.query,this._querySettings.options));if(a._linked){var b=this._privateData.find();
jQuery.observable(a._data).refresh(b)}}return this};c.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};c.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),
this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};c.prototype.privateData=function(){return this._privateData};c.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};c.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new g("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),
this._publicData.setData(a))};c.prototype._transformInsert=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.insert(a,b)};c.prototype._transformUpdate=function(a,b,c){this._transformEnabled&&this._publicData&&this._publicData.update(a,b,c)};c.prototype._transformRemove=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.remove(a,b)};c.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};g.prototype.init=
function(){this._views=[];e.apply(this,arguments)};g.prototype.view=function(a,b,e){if(this._db&&this._db._views){if(this._db._views[a])throw"Cannot create a view using this collection because one with this name already exists: "+a;a=(new c(a,b,e)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a}};g.prototype._addView=CollectionGroup.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};g.prototype._removeView=CollectionGroup.prototype._removeView=
function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};h.prototype.init=function(){this._views={};a.apply(this,arguments)};h.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new c(a)).db(this);return this._views[a]};h.prototype.viewExists=function(a){return Boolean(this._views[a])};h.prototype.views=function(){var a=[],b;for(b in this._views)this._views.hasOwnProperty(b)&&
a.push({name:b,count:this._views[b].count()});return a};m.exports=c},{"./Collection":3,"./CollectionGroup":4,"./ReactorIO":16,"./Shared":17}],19:[function(h,m,k){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(g,e,a){function b(a,b){for(var c in b.props)L.test(c)&&(a[c]=b.props[c])}function c(a){return a}function d(a){debugger;return a}function f(a){P=(Da._dbgMode=a)?"Unavailable (nested view): use #getIndex()":"";La("dbg",Ma.dbg=za.dbg=a?d:c)}function h(a){this.name=(u.link?"JsViews":
"JsRender")+" Error";this.message=a||this.name}function k(a,b){for(var c in b)a[c]=b[c];return a}function m(a){return"function"===typeof a}function Ca(a,b,c){if(!Ea.rTag||a)aa=a?a.charAt(0):aa,H=a?a.charAt(1):H,t=b?b.charAt(0):t,N=b?b.charAt(1):N,S=c||S,a="\\"+aa+"(\\"+S+")?\\"+H,b="\\"+t+"\\"+N,G="(?:(?:(\\w+(?=[\\/\\s\\"+t+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+t+"]|\\"+t+"(?!\\"+N+"))*?)",Ea.rTag=G+")",G=RegExp(a+G+"(\\/)?|(?:\\/(\\w+)))"+b,"g"),C=RegExp("<.*>|([^\\\\]|^)[{}]|"+
a+".*"+b);return[aa,H,t,N,S]}function fa(b,c){c||(c=b,b=a);var e,d,f,g;f=this;e=!c||"root"===c;if(b){if(g=f.type===c?f:a,!g)if(e=f.views,f._.useKey)for(d in e){if(g=e[d].get(b,c))break}else for(d=0,f=e.length;!g&&d<f;d++)g=e[d].get(b,c)}else if(e)for(;f.parent.parent;)g=f=f.parent;else for(;f&&!g;)g=f.type===c?f:a,f=f.parent;return g}function ba(){var b=this.get("item");return b?b.index:a}function F(){return this.index}function q(b){var c,e=this,d=e.linkCtx,f=(e.ctx||{})[b];f===a&&d&&d.ctx&&(f=d.ctx[b]);
f===a&&(f=Ma[b]);f&&m(f)&&!f._wrp&&(c=function(){return f.apply(this&&this!==g?this:e,arguments)},c._wrp=!0,k(c,f));return c||f}function r(c,e,d,f){var g,h,k=+d===d&&e.tmpl.bnds[d-1],p=e.linkCtx;d=(f=f!==a&&{props:{},args:[f]})||(k?k(e.data,e,A):d);h=d.args[0];if(c||k)g=p&&p.tag,g||(g={_:{inline:!p,bnd:k},tagName:":",cvt:c,flow:!0,tagCtx:d,_is:"tag"},p&&(p.tag=g,g.linkCtx=p,d.ctx=Q(d.ctx,p.view.ctx)),Ea._lnk(g)),g._er=f&&h,b(g,d),d.view=e,g.ctx=d.ctx||{},delete d.ctx,e._.tag=g,h=n(g,g.convert||"true"!==
c&&c)[0],h=k&&e._.onRender?e._.onRender(h,e,k):h,e._.tag=a;return h!=a?h:""}function n(a,b){var c=a.tagCtx,e=c.view,d=c.args;b=b&&(""+b===b?e.getRsc("converters",b)||U("Unknown converter: '"+b+"'"):b);d=d.length||c.index?b?d.slice():d:[e.data];b&&(b.depends&&(a.depends=Ea.getDeps(a.depends,a,b.depends,b)),d[0]=b.apply(a,d));return d}function l(b,c){for(var d,e=this;d===a&&e;)d=(d=e.tmpl[b])&&d[c],e=e.parent;return d||A[b][c]}function ra(c,d,e,f,g,h){var p,l,z,B,m,J,v,r,u,q="",y=d.linkCtx||0,R=d.ctx,
t=e||d.tmpl,s=+f===f&&t.bnds[f-1];"tag"===c._is&&(p=c,c=p.tagName,f=p.tagCtxs);p=p||y.tag;f=(h=h!==a&&(q+=h,[{props:{},args:[]}]))||(s?s(d.data,d,A):f);J=f.length;for(m=0;m<J;m++){m||e&&p||(r=d.getRsc("tags",c)||U("Unknown tag: {{"+c+"}}"));l=f[m];if(!y.tag||p._er)e=l.tmpl,e=l.content=e&&t.tmpls[e-1],k(l,{tmpl:(p?p:r).template||e,render:qa,index:m,view:d,ctx:Q(l.ctx,R)});if(e=l.props.tmpl)e=""+e===e?d.getRsc("templates",e)||ga(e):e,l.tmpl=e;p||(r._ctr?(p=new r._ctr,u=!!p.init):Ea._lnk(p={render:r.render}),
p._={inline:!y},y&&(y.tag=p,p.linkCtx=y),(p._.bnd=s||y.fn)?p._.arrVws={}:p.dataBoundOnly&&U("{^{"+c+"}} tag must be data-bound"),p.tagName=c,p.parent=B=R&&R.tag,p._is="tag",p._def=r,p.tagCtxs=f);l.tag=p;p.dataMap&&p.tagCtxs&&(l.map=p.tagCtxs[m].map);p.flow||(v=l.ctx=l.ctx||{},l=p.parents=v.parentTags=R&&Q(v.parentTags,R.parentTags)||{},B&&(l[B.tagName]=B),l[p.tagName]=v.tag=p)}d._.tag=p;if(!(p._er=h)){b(p,f[0]);p.rendering={};for(m=0;m<J;m++){l=p.tagCtx=p.tagCtxs[m];B=l.props;c=n(p,p.convert);if(f=
B.dataMap||p.dataMap)if(c.length||B.dataMap){h=l.map;if(!h||h.src!==c[0]||g)h&&h.src&&h.unmap(),h=l.map=f.map(c[0],B);c=[h.tgt]}p.ctx=l.ctx;!m&&u&&(f=p.template,p.init(l,y,p.ctx),u=a,p.template!==f&&(p._.tmpl=p.template),y&&(y.attr=p.attr=y.attr||p.attr));f=a;p.render&&(f=p.render.apply(p,c));c=c.length?c:[d];f=f!==a?f:l.render(c[0],!0)||(g?a:"");q=q?q+(f||""):f}delete p.rendering}p.tagCtx=p.tagCtxs[0];p.ctx=p.tagCtx.ctx;p._.inline&&(z=p.attr)&&z!==x&&(q="text"===z?za.html(q):"");return s&&d._.onRender?
d._.onRender(q,d,s):q}function s(a,b,c,d,e,f,g,h){var k="array"===b,p={key:0,useKey:k?0:1,id:""+X++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=c;this.type=b||"top";this._=p;this.linked=!!h;c?(b=c.views,d=c._,d.useKey?(b[p.key="_"+d.useKey++]=this,this.index=P,this.getIndex=ba,f=d.tag,p.bnd=k&&(!f||!!f._.bnd&&f)):b.splice(p.key=this.index=f,0,this),this.ctx=a||c.ctx):this.ctx=a}function Z(a){var b,c,d,e,f,g;for(b in Pa)if(e=Pa[b],(f=e.compile)&&(c=a[b+
"s"]))for(d in c)(e=c[d]=f(d,c[d],a))&&(g=Ea.onStore[b])&&g(d,e,f)}function pa(b,c,d){m(c)?c={depends:c.depends,render:c}:(c.baseTag&&(c.flow=!!c.flow,c=k(k({},c.baseTag),c)),(b=c.template)!==a&&(c.template=""+b===b?ga[b]||ga(b):b),!1!==c.init&&(b=c._ctr=function(){},(b.prototype=c).constructor=b));d&&(c._parentTmpl=d);return c}function ka(b,c,d,f){function h(c){if(""+c===c||0<c.nodeType){try{p=0<c.nodeType?c:!C.test(c)&&e&&e(g.document).find(c)[0]}catch(k){}p&&(c=ga[b=b||p.getAttribute(V)],c||(b=
b||"_"+ha++,p.setAttribute(V,b),c=ga[b]=ka(b,p.innerHTML,d,f)),p=a);return c}}var k,p;c=c||"";k=h(c);f=f||(c.markup?c:{});f.tmplName=b;d&&(f._parentTmpl=d);!k&&c.markup&&(k=h(c.markup))&&k.fn&&(k.debug!==c.debug||k.allowCode!==c.allowCode)&&(k=k.markup);if(k!==a)return b&&!d&&(Na[b]=function(){return c.render.apply(c,arguments)}),k.fn||c.fn?k.fn&&(c=b&&b!==k.tmplName?Q(f,k):k):(c=ca(k,f),Ja(k.replace(W,"\\$&"),c)),Z(f),c}function Qa(a){function b(c,d){this.tgt=a.getTgt(c,d)}m(a)&&(a={getTgt:a});a.baseMap&&
(a=k(k({},a.baseMap),a));a.map=function(a,c){return new b(a,c)};return a}function ca(a,b){var c,d=Da.wrapMap||{},e=k({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:Y},b);b.htmlTag||(c=ab.exec(a),e.htmlTag=c?c[1].toLowerCase():"");(c=d[e.htmlTag])&&c!==d.div&&(e.markup=u.trim(e.markup));return e}function ua(b,c){function d(f,g,h){var k,p,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(p in f)d(p,f[p],g);return A}g===a&&(g=f,f=a);f&&""+f!==f&&(h=g,g=f,f=a);l=h?
h[e]=h[e]||{}:d;p=c.compile;null===g?f&&delete l[f]:(g=p?g=p(f,g,h):g,f&&(l[f]=g));p&&g&&(g._is=b);g&&(k=Ea.onStore[b])&&k(f,g,p);return g}var e=b+"s";A[e]=d;Pa[b]=c}function Ga(a,b,c){var d=this.jquery&&(this[0]||U('Unknown template: "'+this.selector+'"')),e=d.getAttribute(V);return Y.call(e?ga[e]:ga(d),a,b,c)}function Aa(a,b,c){if(Da._dbgMode)try{return a.fn(b,c,A)}catch(d){return U(d,c)}return a.fn(b,c,A)}function Y(a,b,c,d,e,f){return d||!this.fn._nvw||u.isArray(a)?qa.call(this,a,b,c,d,e,f):Aa(this,
a,{tmpl:this})}function qa(b,c,d,e,f,g){var h,k,p,l,z,B,m,J,n;p=this;var v="";!!c===c&&(d=c,c=a);!0===f&&(h=!0,f=0);p.tag?(B=p,p=p.tag,k=p._,z=p.tagName,J=k.tmpl||B.tmpl,n=p.attr&&p.attr!==x,c=Q(c,p.ctx),m=B.content,!1===B.props.link&&(c=c||{},c.link=!1),e=e||B.view,b=arguments.length?b:e):J=p;if(J&&(!e&&b&&"view"===b._is&&(e=b),e&&(m=m||e.content,g=g||e._.onRender,b===e&&(b=e.data),c=Q(c,e.ctx)),e&&"top"!==e.type||((c=c||{}).root=b),J.fn||(J=ga[J]||ga(J)),J)){B=g=!1!==(c&&c.link)&&!n&&g;!0===g&&
(B=a,g=e._.onRender);c=J.helpers?Q(J.helpers,c):c;if(u.isArray(b)&&!d)for(l=h?e:f!==a&&e||new s(c,"array",e,b,J,f,m,g),h=0,k=b.length;h<k;h++)p=b[h],z=new s(c,"item",l,p,J,(f||0)+h,m,g),p=Aa(J,p,z),v+=l._.onRender?l._.onRender(p,z):p;else{if(e||!J.fn._nvw)l=h?e:new s(c,z||"data",e,b,J,f,m,g),k&&!p.flow&&(l.tag=p);v+=Aa(J,b,l)}return B?B(v,l):v}return""}function U(a,b,c){c=Da.onError(a,b,c);if(""+a===a)throw new Ea.Err(c);return!b.linkCtx&&b.linked?za.html(c):c}function la(a){U("Syntax error\n"+a)}
function Ja(a,b,c,e){function d(b){(b-=m)&&n.push(a.substr(m,b).replace(D,"\\n"))}function f(b){b&&la('Unmatched or missing tag: "{{/'+b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,z=[],m=0,v=[],n=z,y=[,,z];c&&(a=aa+a+N);f(v[0]&&v[0][2].pop()[0]);a.replace(G,function(g,p,z,J,Q,q,r,u,R,t,s,T){q&&(Q=":",J=x);t=t||c;p=(p||c)&&[[]];var ia="",ma="",O="",M="",Ka="",Ba="",Oa="",Sa="";r=!t&&!Q&&!r;z=z||(R=R||"#data",Q);d(T);m=T+g.length;u?l&&n.push(["*","\n"+R.replace(I,"$1")+"\n"]):z?("else"===z&&
(da.test(R)&&la('for "{{else if expr}}" use "{{else expr}}"'),p=y[7],y[8]=a.substring(y[8],T),y=v.pop(),n=y[2],r=!0),R&&(B(R.replace(D," "),p,b).replace(na,function(a,b,c,e,d,f,T,g){T?(ma+=f+",",M+="'"+g+"',"):c?(O+=e+f+",",Ba+=e+"'"+g+"',"):b?Oa+=f:("trigger"===d&&(Sa+=f),ia+=e+f+",",Ka+=e+"'"+g+"',",k=k||L.test(d));return""}).slice(0,-1),p&&p[0]&&p.pop()),h=[z,J||!!e||k||"",r&&[],[M.slice(0,-1),Ka.slice(0,-1),Ba.slice(0,-1)],[ma.slice(0,-1),ia.slice(0,-1),O.slice(0,-1)],Oa,Sa,p||0],n.push(h),r&&
(v.push(y),y=h,y[8]=m)):s&&(f(s!==y[0]&&"else"!==y[0]&&s),y[8]=a.substring(y[8],T),y=v.pop());f(!y&&s);n=y[2]});d(a.length);(m=z[z.length-1])&&f(""+m!==m&&+m[8]===m[8]&&m[0]);c?(g=J(z,a,c),p(g,z[0][7])):g=J(z,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function p(a,b){a.deps=[];for(var c in b)"_jsvto"!==c&&b[c].length&&(a.deps=a.deps.concat(b[c]));a.paths=b}function z(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function B(a,
b,c){var e,d,f,g,h,k=b&&b[0],p=0,l=c?c.links:k&&(k.links=k.links||{}),z={},m={0:-1},B=0;return(a+(c?" ":"")).replace(/\)\^/g,").").replace(ja,function(J,v,n,y,r,Q,q,R,u,s,x,C,T,ia,ma,O,M,Ka,Ba,Oa){function Sa(a,c,g,T,h,ia,p,ma){return g&&(k&&("linkTo"===e&&(d=b._jsvto=b._jsvto||[],d.push(r)),e&&!f||k.push(r.slice(c.length))),"."!==g)?(a=(T?'view.hlp("'+T+'")':h?"view":"data")+(ma?(ia?"."+ia:T?"":h?"":"."+g)+(p||""):(ma=T?"":h?ia||"":g,"")),a+=ma?"."+ma:"",c+("view.data"===a.slice(0,9)?a.slice(5):
a)):a}Q=Q||"";n=n||v||C;r=r||u;s=s||M||"";u=Oa.length-1;if(!q||h||g)return!k||!O||h||g||e&&!f&&!d||(O=m[B],u>Ba-O&&(O=Oa.slice(O,Ba+1),O=H+":"+O+t,q=l[O],q||(l[O]=!0,l[O]=q=Ja(O,c||k,!0),q.paths.push({_jsvOb:q})),!0!==q&&(d||k).push({_jsvOb:q}))),h?(h=!T,h?J:'"'):g?(g=!ia,g?J:'"'):(n?(B++,m[B]=Ba++,n):"")+(Ka?B?"":(p=Oa.slice(p,Ba),e?(e=f=d=!1,"\b"):"\b,")+p+(p=Ba+J.length,k&&b.push(k=[]),"\b"):R?(B&&la(a),k&&b.pop(),e=r,f=y,p=Ba+J.length,y&&(k=b[e]=[]),r+":"):r?r.split("^").join(".").replace(oa,
Sa)+(s?(z[++B]=!0,"."!==r.charAt(0)&&(m[B]=Ba),s):Q):Q?Q:ma?(z[B--]=!1,ma)+(s?(z[++B]=!0,s):""):x?(z[B]||la(a),","):v?"":(h=T,g=ia,'"'));la(a)})}function J(b,c,e){var d,f,g,h,k,l,m,B,v,n,y,r,q,Q,R,u,s,t,C,G,H,N,A,T,ia,ma,O=0,M="",Ka={},Ba=b.length;""+c===c?(t=e?'data-link="'+c.replace(D," ").slice(1,-1)+'"':c,c=0):(t=c.tmplName||"unnamed",c.allowCode&&(Ka.allowCode=!0),c.debug&&(Ka.debug=!0),y=c.bnds,s=c.tmpls);for(d=0;d<Ba;d++)if(f=b[d],""+f===f)M+='\n+"'+f+'"';else if(g=f[0],"*"===g)M+=";\n"+f[1]+
"\nret=ret";else{h=f[1];H=f[2];k=z(f[3],"params")+"},"+z(q=f[4]);T=f[5];ma=f[6];R=f[8];(Q="else"===g)||(O=0,y&&(r=f[7])&&(O=y.push(r)));(f=":"===g)?h&&(g=h===x?">":h+g):(H&&(C=ca(R,Ka),C.tmplName=t+"/"+g,J(H,C),s.push(C)),Q||(G=g,N=M,M=""),C=(C=b[d+1])&&"else"===C[0]);ia=T?";\ntry{\nret+=":"\n+";R=Q="";if(f&&(r||ma||h&&h!==x)){A="return {"+k+"};";u='c("'+h+'",view,';A=new Function("data,view,j,u"," // "+t+" "+O+" "+g+"\n"+A);A._er=T;Q=u+O+",";R=")";A._tag=g;if(e)return A;p(A,r);n=!0}M+=f?(e?(T?"\ntry{\n":
"")+"return ":ia)+(n?(n=a,v=B=!0,u+(r?(y[O-1]=A,O):"{"+k+"}")+")"):">"===g?(m=!0,"h("+q[0]+")"):"((v="+q[0]+')!=null?v:"")'):(v=l=!0,"\n{view:view,tmpl:"+(H?s.length:"0")+","+k+"},");if(G&&!C){M="["+M.slice(0,-1)+"]";u='t("'+G+'",view,this,';if(e||r){M=new Function("data,view,j,u"," // "+t+" "+O+" "+G+"\nreturn "+M+";");M._er=T;M._tag=g;r&&p(y[O-1]=M,r);if(e)return M;Q=u+O+",undefined,";R=")"}M=N+ia+u+(O||M)+")";G=r=0}T&&(v=!0,M+=";\n}catch(e){ret"+(e?"urn ":"+=")+Q+"j._err(e,view,"+T+")"+R+";}\n"+
(e?"":"ret=ret"))}M="// "+t+"\nvar v"+(l?",t=j._tag":"")+(B?",c=j._cnvt":"")+(m?",h=j.converters.html":"")+(e?";\n":',ret=""\n')+(Ka.debug?"debugger;":"")+M+(e?"\n":";\nreturn ret;");try{M=new Function("data,view,j,u",M)}catch(Oa){la("Compiled template code:\n\n"+M+'\n: "'+Oa.message+'"')}c&&(c.fn=M);v||(M._nvw=!0);return M}function Q(a,b){return a&&a!==b?b?k(k({},b),a):a:b&&k({},b)}function y(a){return ea[a]||(ea[a]="&#"+a.charCodeAt(0)+";")}function R(a){var b,c,e=[];if("object"===typeof a)for(b in a)(c=
a[b])&&c.toJSON&&!c.toJSON()||m(c)||e.push({key:b,prop:c});return e}function v(a){return null!=a?ta.test(a)&&(""+a).replace(Ra,y)||a:""}if(!(e&&e.render||g.jsviews)){var u,va,G,C,P,aa="{",H="{",t="}",N="}",S="^",oa=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,ja=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,
D=/[ \t]*(\r\n|\n|\r)/g,I=/\\(['"])/g,W=/['"\\]/g,na=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,da=/^if\s/,ab=/<(\w+)[>\s]/,ta=/[\x00`><\"'&]/,L=/^on[A-Z]|^convert(Back)?$/,Ra=/[\x00`><"'&]/g,ha=0,X=0,ea={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},x="html",V="data-jsv-tmpl",Na={},Pa={template:{compile:ka},tag:{compile:pa},helper:{},converter:{}},A={jsviews:"v1.0.0-beta",settings:function(a){k(Da,a);f(Da._dbgMode);Da.jsv&&Da.jsv()},
sub:{View:s,Err:h,tmplFn:Ja,cvt:n,parse:B,extend:k,syntaxErr:la,onStore:{},_lnk:c,_ths:b},map:Qa,_cnvt:r,_tag:ra,_err:U};(h.prototype=Error()).constructor=h;ba.depends=function(){return[this.get("item"),"index"]};F.depends=function(){return["index"]};s.prototype={get:fa,getIndex:F,getRsc:l,hlp:q,_is:"view"};for(va in Pa)ua(va,Pa[va]);var ga=A.templates,za=A.converters,Ma=A.helpers,La=A.tags,Ea=A.sub,Da=A.settings;e?(u=e,u.fn.render=Ga,u.observable&&(k(Ea,u.views.sub),A.map=u.views.map)):(u=g.jsviews=
{},u.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});u.render=Na;u.views=A;u.templates=ga=A.templates;Da({debugMode:f,delimiters:Ca,onError:function(b,c,e){c&&(b=e===a?"{Error: "+b+"}":m(e)?e(b,c):e);return b==a?"":b},_dbgMode:!0});La({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,
!0))},onUpdate:function(a,b,c){var e;for(a=0;(e=this.tagCtxs[a])&&e.args.length;a++)if(e=e.args[0],b=!e!==!c[a].args[0],!this.convert&&e||b)return b;return!1},flow:!0},"for":{render:function(b){var c,e=this.tagCtx,d="",f=0;if(!this.rendering.done){if(c=!arguments.length)b=e.view.data;b!==a&&(d+=e.render(b,c),f+=u.isArray(b)?b.length:1);if(this.rendering.done=f)this.selected=e.index}return d},flow:!0},include:{flow:!0},"*":{render:c,flow:!0}});La("props",{baseTag:La["for"],dataMap:Qa(R)});za({html:v,
attr:v,url:function(b){return b!=a?encodeURI(""+b):null===b?b:""}});Ca()}})(this,this.jQuery);(function(g,e,a){function b(a){return s(a)?new d(a):new c(a)}function c(a){this._data=a;return this}function d(a){this._data=a;return this}function f(a,b){a=s(a)?a:[a];var c,e,d=b,g=d,h=a.length,k=[];for(c=0;c<h;c++)e=a[c],Y(e)?k=k.concat(f(e.call(b,b),b)):""+e!==e?(b=g=e,g!==d&&k.push(d=g)):(g!==d&&k.push(d=g),k.push(e));return k}function h(a,b){var c,e;for(c in a){e=!0;break}e||delete Ga[b]}function k(b,
c){if(!b.data||!b.data.off){var e,d,f,g,h,l=c.oldValue,m=c.value,n=b.data,r=n.observeAll,q=!n.cb.noArray,P=n.paths;if(b.type===ua)(n.cb.array||n.cb).call(n,b,c);else if(n.prop===c.path||"*"===n.prop)g=typeof l===pa&&(P[0]||q&&s(l)),h=typeof m===pa&&(P[0]||q&&s(m)),r?(e=r._path+"."+c.path,d=r.filter,f=[b.target].concat(r.parents()),g&&fa(q,r.ns,[l],P,n.cb,!0,d,[f],e),h&&fa(q,r.ns,[m],P,n.cb,a,d,[f],e)):(g&&fa(q,[l],P,n.cb,!0),h&&fa(q,[m],P,n.cb)),n.cb(b,c)}}function m(){function c(a,b,d,f){var g,h=
la(x),p=s(x)?[x]:x;a=da?a+"."+da:a;if(G||f)h&&e(p).off(a,k);else{if(t=h&&e._data(x))for(aa=(t=(t=t&&t.events)&&t[d?ua:ca])&&t.length;aa--;)if((H=t[aa].data)&&H.cb._cId===C._cId&&H.ns===da){if(d)return;("*"===b&&H.prop!==b||H.prop===v)&&e(x).off(a,k)}b=d?{}:{fullPath:u,paths:b?[b]:[],prop:v};b.ns=da;b.cb=C;W&&(b.observeAll={_path:W,path:function(){g=I.length;return W.replace(/[[.]/g,function(a){g--;return"["===a?"["+e.inArray(I[g-1],I[g]):"."})},parents:function(){return I},filter:Z,ns:da});e(p).on(a,
null,b,k);oa&&(oa[e.data(x,"obId")||e.data(x,"obId",qa++)]=x)}}function d(a,b){a._ob=N(a,ea);var c=ea;return function(e,d){var f=a._ob,h=b.length;typeof f===pa&&(g(f,!0),(h||L&&s(f))&&fa(L,[f],b,C,N,!0));f=a._ob=N(a,c);typeof f===pa&&(g(f),(h||L&&s(f))&&fa(L,[f],b,C,N,[c]));C(e,d)}}function g(e,d,f,h){if(L){var k=x,l=W;x=e;h&&(x=e[h],W+="."+h);Z&&x&&(x=b._fltr(W,x,h?[e].concat(I):I,Z));x&&(f||s(x))&&c(ua+".observe"+(C?".obs"+(P=C._cId=C._cId||U++):""),a,!0,d);x=k;W=l}}var l,n,r,q,v,u,F,G,C,P,aa,H,
t,N,S,oa,ja,D,I,W,Z,da,ba,ka,L=!1!=this,Ca=!0,ha=Aa,X=Array.apply(0,arguments);l=X.pop();var ea=X.shift(),x=D=ea,V=X.length;ea+""===ea&&L&&(da=ea,ea=x=D=X.shift(),V--);if(Y(l))C=l;else if(l+""===l&&(W=l,I=X.pop(),Z=X.pop(),l=X.pop(),V-=3),!0===l?G=l:l&&(ea=l,Ca=a),l=X[V-1],V&&l===a||Y(l))C=X.pop(),V--;V&&Y(X[V-1])&&(N=C,C=X.pop(),V--);ha+=G?C?".obs"+C._cId:"":".obs"+(P=C._cId=C._cId||U++);G||(oa=Ga[P]=Ga[P]||{});ba=da&&da.match(Qa)||[""];for(ka=ba.length;ka--;)for(da=ba[ka],s(D)?g(D,G,!0):G&&0===
V&&D&&c(ha,""),l=ja=0;l<V;l++)if(u=X[l],""!==u){x=D;if(""+u===u){q=u.split("^");q[1]&&(ja=q[0].split(".").length,u=q.join("."),ja=u.split(".").length-ja);if(N&&(S=N(u,D))){V+=S.length-1;ra.apply(X,[l--,1].concat(S));continue}q=u.split(".")}else Ca&&!Y(u)&&(u&&u._jsvOb&&(D=d(u,X.slice(l+1)),D.noArray=!L,D._cId=C._cId,fa(L,[ea],X.slice(0,l),D,N),D=a,u=u._ob),x=u),D=u,q=[D];for(;x&&(v=q.shift())!==a;)if(typeof x===pa){if(""+v===v){if(""===v)continue;if(q.length<ja+1&&!x.nodeType){if(!G&&(t=la(x)&&e._data(x))){aa=
(t=(t=t.events)&&t[ca])&&t.length;for(r=0;aa--;)!(H=t[aa].data)||H.cb!==C||H.ns!==da||H.prop!==v&&"*"!==H.prop||((n=q.join("."))&&H.paths.push(n),r++);if(r){x=x[v];continue}}if("*"===v){!G&&t&&t.length&&c(ha,"",!1,!0);Y(x)?(F=x.depends)&&fa(L,[F],C,G||ea):c(ha,"");for(n in x)g(x,G,a,n);break}else v&&c(ha+"."+v,q.join("^"))}W&&(W+="."+v);v=x[v]}if(Y(v)){(F=v.depends)&&fa(L,[x],f(F,x),C,N,G||[ea]);break}x=v}g(x,G)}P&&h(oa,P);return{cbId:P,bnd:oa}}function Ca(){[].push.call(arguments,!0);return m.apply(this,
arguments)}function fa(){var a=[].concat.apply([],arguments);return m.apply(a.shift(),a)}function ba(a,b,c,e){a+""!==a&&(c=b,b=a,a="");q(a,this._data,b,c,[],"root",e)}function F(a,b,c){ba.call(this,a,b,c,!0)}function q(c,e,d,f,g,h,k){function l(a,b){G=a.length;F=[[a]].concat(F);for(P=h+"[]";G--;)n(a,G,b,1)}function n(e,g,h,k){var l;g!==Z&&(l=b._fltr(P,e[g],F,f))&&q(c,l,d,f||(k?a:0),F.slice(),P,h)}function r(a,b){var c=g;h=a.data.observeAll._path;F=[a.target].concat(g);switch(b.change){case "insert":l(b.items);
break;case "remove":l(b.items,!0);break;case "refresh":l(b.oldItems,!0);l(a.target);break;case "set":P=h+"."+b.path,n(b,"oldValue",!0),n(b,"value")}d.apply(this,arguments);g=c}var G,C,P,F;if(typeof e===pa){C=s(e)?"":"*";if(d){if(C||0!==f)r._cId=d._cId=d._cId||U++,m(c,e,C,r,k,f,g,h)}else m(c,e,C,a,k,f,g,h);if(C)for(G in F=[e].concat(g),e)P=h+"."+G,n(e,G,k);else l(e,k)}}function r(a){return 0>a.indexOf(".")&&0>a.indexOf("[")}if(!e)throw"jsViews/jsObservable require jQuery";if(!e.observable){g=e.views=
e.views||{jsviews:"v1.0.0-alpha",sub:{}};var n=g.sub,l=e.event.special,ra=[].splice,s=e.isArray,Z=e.expando,pa="object",ka=parseInt,Qa=/\S+/g,ca=n.propChng=n.propChng||"propertyChange",ua=n.arrChng=n.arrChng||"arrayChange",Ga=n._cbBnds=n._cbBnds||{},Aa=ca+".observe",Y=e.isFunction,qa=1,U=1,la=e.hasData,Ja={};n.getDeps=function(){var a=arguments;return function(){for(var b,c,e=[],d=a.length;d--;)b=a[d--],(c=a[d])&&(e=e.concat(Y(c)?c(b,b):c));return e}};e.observable=b;b._fltr=function(a,b,c,e){if(e&&
Y(e)?e(a,b,c):1)return b=Y(b)?b.set&&b.call(c[0]):b,typeof b===pa&&b};b.Object=c;b.Array=d;e.observe=b.observe=m;e.unobserve=b.unobserve=Ca;b._apply=fa;c.prototype={_data:null,observeAll:ba,unobserveAll:F,data:function(){return this._data},setProperty:function(b,c,e){var d,f=this._data;b=b||"";if(f)if(s(b))for(d=b.length;d--;)c=b[d],this.setProperty(c.name,c.value,e===a||e);else if(""+b!==b)for(d in b)this.setProperty(d,b[d],c);else if(b!==Z){for(b=b.split(".");f&&1<b.length;)f=f[b.shift()];f&&this._setProperty(f,
b[0],c,e)}return this},removeProperty:function(a){this.setProperty(a,Ja);return this},_setProperty:function(b,c,e,d){var f,g,h,k=c?b[c]:b;Y(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(b));if(k!==e||d&&k!=e)if(!(k instanceof Date)||k>e||k<e)f?(f.call(b,e),e=g.call(b)):(h=e===Ja)?(delete b[c],e=a):c&&(b[c]=e),this._trigger(b,{change:"set",path:c,value:e,oldValue:k,remove:h})},_trigger:function(a,b){e(a).triggerHandler(ca,b)}};d.prototype={_data:null,observeAll:ba,unobserveAll:F,data:function(){return this._data},
insert:function(a,b){var c=this._data;1===arguments.length&&(b=a,a=c.length);a=ka(a);-1<a&&a<=c.length&&(b=s(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,b){var c=this._data,e=c.length;ra.apply(c,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},e)},remove:function(b,c){var e;e=this._data;b===a&&(b=e.length-1);b=ka(b);c=c?ka(c):0===c?0:1;-1<c&&-1<b&&(e=e.slice(b,b+c),(c=e.length)&&this._remove(b,c,e));return this},_remove:function(a,b,c){var e=this._data,d=
e.length;e.splice(a,b);this._trigger({change:"remove",index:a,items:c},d)},move:function(a,b,c){c=c?ka(c):0===c?0:1;a=ka(a);b=ka(b);if(0<c&&-1<a&&-1<b&&a!==b){var e=this._data.slice(a,a+c);(c=e.length)&&this._move(a,b,c,e)}return this},_move:function(a,b,c,e){var d=this._data,f=d.length;d.splice(a,c);d.splice.apply(d,[b,0].concat(e));this._trigger({change:"move",oldIndex:a,index:b,items:e},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,b){var c=
this._data,e=c.length;ra.apply(c,[0,c.length].concat(b));this._trigger({change:"refresh",oldItems:a},e)},_trigger:function(a,b){var c=this._data,d=c.length,c=e([c]);c.triggerHandler(ua,a);d!==b&&c.triggerHandler(ca,{change:"set",path:"length",value:d,oldValue:b})}};l[ca]=l[ua]={remove:function(a){var b,c,d,f,g=a.data;if(g&&(g.off=!0,g=g.cb)&&(b=Ga[g._cId])){a=e._data(this).events[a.type];for(d=a.length;d--&&!c;)c=(f=a[d].data)&&f.cb===g;c||(delete b[e.data(this,"obId")],h(b,g._cId))}}};g.map=function(c){function d(e,
f,g){var h,k=this;this.src&&this.unmap();"object"===typeof e&&(k.src=e,k.tgt=g||k.tgt||[],k.options=f||k.options,k.update(),c.obsSrc&&b(k.src).observeAll(k.obs=function(b,e){h||(h=!0,c.obsSrc(k,b,e),h=a)},k.srcFlt),c.obsTgt&&b(k.tgt).observeAll(k.obt=function(b,e){h||(h=!0,c.obsTgt(k,b,e),h=a)},k.tgtFlt))}Y(c)&&(c={getTgt:c});c.baseMap&&(c=e.extend({},c.baseMap,c));c.map=function(a,b,c){return new d(a,b,c)};(d.prototype={srcFlt:c.srcFlt||r,tgtFlt:c.tgtFlt||r,update:function(a){b(this.tgt).refresh(c.getTgt(this.src,
this.options=a||this.options))},unmap:function(){this.src&&(this.obs&&b(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&b(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=a)},map:d,_def:c}).constructor=d;return c}}})(this,this.jQuery);(function(g,e,a){function b(b,c,d){var f,g,h,l,m,p,n,r,q,E=b.target,s=E._jsvBnd,w=/&(\d+)\+?/g;if(s)for(;h=w.exec(s);)if(h=Fa[h[1]])if(c=h.to){h=h.linkCtx;n=h.view;q=h.tag;p=e(E);m=n.hlp(V);r=n.hlp(Na);g=k(E);f=Va[g];d===a&&(d=da(g)?g(E):f?p[f]():p.attr(g));
f=c[1];c=c[0];f&&(l=da(f)?f:n.getRsc("converters",f));l&&(d=l.call(q,d));f=n.linkCtx;n.linkCtx=h;g={change:"change",oldValue:h._val,value:d};if(!(m&&!1===m.call(h,b,g)||q&&q.onBeforeChange&&!1===q.onBeforeChange(b,g)||d===a)&&(m=c[0],d!==a&&m)){m=m._jsvOb?m._ob:m;q&&(q._.chging=!0);L(m).setProperty(c[2]||c[1],d);r&&r.call(h,b,g);if(q){if(q.onAfterChange)q.onAfterChange(b,g);delete q._.chging}h._val=d}n.linkCtx=f}}function c(b,c,f){var g,h,l,m,p,n=this.tag,q=this.data,r=this.elem;l=this.convert;var n=
r.parentNode,s=this.view,E=s.linkCtx,u=s.hlp(V);s.linkCtx=this;if(n&&!(u&&c&&!1===u.call(this,b,c)||c&&"*"!==b.data.prop&&b.data.prop!==c.path)){c&&(this.eventArgs=c);if(c||this._initVal){delete this._initVal;if(f._er)try{h=f(q,s)}catch(w){m=f._er,p=P(w,s,(new Function("data,view","return "+m+";"))(q,s)),h=[{props:{},args:[p]}]}else h=f(q,s,D);a:{var v=h,x=n=this.tag;g=this.attr||k(r,!0,l!==a);var t,y,C=x&&x.parentElem||this.elem;if(v!==a){y=e(C);g=x&&x.attr||g;da(v)&&P(this.expr+": missing parens");
if(x=/^css-/.test(g)&&g.slice(4))t=e.style(C,x),+v===v&&(t=parseInt(t));else if("link"!==g){if("value"===g)C.type===ga&&(t=y.prop(g=A));else if(g===za)if(C.value===""+v)t=y.prop(A);else break a;t===a&&(t=(t=Va[g])?y[t]():y.attr(g))}this._val=t}}if(n){l=m||n._er;h=h[0]?h:[h];f=!l&&c&&n.onUpdate&&!1===n.onUpdate(b,c,h);Ga(n,h,l);if(f||g===Ma){g===sa&&n.onBeforeLink&&n.onBeforeLink();ka(n,n.tagCtx);fa(this,q,r);s.linkCtx=E;return}if(n._.chging)return;h=":"===n.tagName?D._cnvt(n.cvt,s,h[0]):D._tag(n,
s,s.tmpl,h,!0,p)}else f._tag&&(h=(l=""===l?La:l)?D._cnvt(l,s,h[0]||h):D._tag(f._tag,s,s.tmpl,h,!0,p),n=this.tag,g=this.attr||g);d(h,this,g,n)&&c&&(u=s.hlp(Na))&&u.call(this,b,c);n&&(n._er=m,ka(n,n.tagCtx))}fa(this,q,r);s.linkCtx=E}}function d(b,c,d,f){var h,k,l,m,n,q,r=b!==a,s=c.data,E=f&&f.parentElem||c.elem,u=e(E),w=c.view;q=c._val;var v=w.linkCtx,t=f||d===sa;f&&(f.parentElem=f.parentElem||c.expr||f._elCnt?E:E.parentNode,k=f._prv,l=f._nxt);if(r){"visible"===d&&(d="css-display");if(/^css-/.test(d))"visible"===
c.attr&&(c=(E.currentStyle||hb.call(g,E,"")).display,b?(b=E._jsvd||c,b!==Ma||(b=db[h=E.nodeName])||(c=ja.createElement(h),ja.body.appendChild(c),b=db[h]=(c.currentStyle||hb.call(g,c,"")).display,ja.body.removeChild(c))):(E._jsvd=c,b=Ma)),(t=t||q!==b)&&e.style(E,d.slice(4),b);else if("link"!==d){if(d===A)n=!0,b=b&&"false"!==b;else if(d===za)if(E.value===""+b)b=n=!0,d=A;else{fa(c,s,E);return}else if("selected"===d||"disabled"===d||"multiple"===d||"readonly"===d)b=b&&"false"!==b?d:null;if(h=Va[d])if(d===
sa){w.linkCtx=c;if(f&&f._.inline){d=f.nodes(!0);if(f._elCnt){if(k&&k!==l)p(k,l,E,f._tgId,"^",!0);else if(m=E._dfr)q=f._tgId+"^",h=m.indexOf("#"+q)+1,n=m.indexOf("/"+q),h&&0<n&&(h+=q.length,n>h&&(E._dfr=m.slice(0,h)+m.slice(n),z(m.slice(h,n))));k=k?k.previousSibling:l?l.previousSibling:E.lastChild}e(d).remove();if(f&&f.onBeforeLink)f.onBeforeLink();m=w.link(w.data,E,k,l,b,f&&{tag:f._tgId,lazyLink:f.tagCtx.props.lazyLink})}else{r&&u.empty();if(f&&f.onBeforeLink)f.onBeforeLink();r&&(m=w.link(s,E,k,l,
b,f&&{tag:f._tgId}))}w.linkCtx=v}else{if(t=t||q!==b)if("text"===d&&E.children&&!E.children[0])E.textContent!==a?E.textContent=b:E.innerText=null===b?"":b;else u[h](b)}else if(t=t||q!==b)u[n?"prop":"attr"](d,b!==a||n?b:null);c._val=b}return m||t}if(d===sa&&f&&f.onBeforeLink)f.onBeforeLink()}function f(a,b){var c=this.hlp(V),e=this.hlp(Na);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,d=b.items;switch(b.change){case "insert":this.addViews(c,d);break;case "remove":this.removeViews(c,d.length);break;
case "move":this.refresh();break;case "refresh":this.refresh()}}e&&e.call(this,a,b)}}function h(b){var c,d=b.type,g=b.data,k=b._.bnd;if(!b._.useKey&&k){if(c=b._.bndArr)e([c[1]]).off(ea,c[0]),b._.bndArr=a;k!==!!k&&k._.inline?d?k._.arrVws[b._.id]=b:delete k._.arrVws[b._.id]:d&&g&&(c=function(a){a.data&&a.data.off||f.apply(b,arguments)},e([g]).on(ea,c),b._.bndArr=[c,g])}}function k(a,b,c){var e=a.nodeName.toLowerCase(),d=W.merge[e]||a.contentEditable===La&&{to:sa,from:sa};return d?b?"input"===e&&a.type===
za?za:d.to:d.from:b?c?"text":sa:""}function m(b,c,d,f,g,h,k){var l,n,q,r=b.parentElem,s=b._prv,E=b._nxt,t=b._elCnt;s&&s.parentNode!==r&&P("Missing parentNode");if(k)for(q in n=b.nodes(),t&&s&&s!==E&&p(s,E,r,b._.id,"_",!0),b.removeViews(a,a,!0),f=E,t&&(s=s?s.previousSibling:E?E.previousSibling:r.lastChild),e(n).remove(),b._.bnds)Y(q);else{if(c){l=f[c-1];if(!l)return!1;s=l._nxt}t?s=(f=s)?f.previousSibling:r.lastChild:f=s.nextSibling}c=d.render(g,h,b._.useKey&&k,b,k||c,!0);b.link(g,r,s,f,c,l)}function Ca(b,
c,e){var d;e?(d="^`",c=c._.tag,e=c._tgId,e||(Fa[e=eb++]=c,c._tgId=""+e)):(d="_`",oa[e=c._.id]=c);return"#"+e+d+(b!=a?b:"")+"/"+e+d}function fa(b,c,e){var d,f=b.tag,g=b.convertBack,h=[],k=b._bndId||""+eb++,l=b._hdlr;delete b._bndId;f&&(h=f.depends||h,h=da(h)?f.depends(f):h,d=f.linkedElem);if(!b._depends||""+b._depends!==""+h)if(b._depends&&L._apply(!1,[c],b._depends,l,!0),c=L._apply(!1,[c],b.fn.deps,h,l,b._ctxCb),c.elem=e,c.linkCtx=b,c._tgId=k,e._jsvBnd=e._jsvBnd||"",e._jsvBnd+="&"+k,b._depends=h,
b.view._.bnds[k]=k,Fa[k]=c,d&&(c.to=[[],g]),(d||g!==a)&&ua(c,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(c);f.flow||f._.inline||(e.setAttribute(ha,(e.getAttribute(ha)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(d&&d[0])for(f._.radio&&(d=d.children("input[type=radio]")),b=d.length;b--;)d[b]._jsvBnd=d[b]._jsvBnd||e._jsvBnd+"+",d[b]._jsvLkEl=f}function ba(a,b,c,e,d,f,g){return F(this,a,b,c,e,d,f,g)}function F(c,d,f,g,h,k,l,m){if(c&&d){d=d.jquery?d:e(d);y||(y=ja.body,e(y).on(x,b).on("blur","[contenteditable]",
b));for(var n,p,q,t,E,u,w,v,C=Ca,D=g&&"replace"===g.target,F=d.length;F--;)if(w=d[F],""+c===c)r(c,w,R(w),a,!0,f,g);else{k=k||R(w);if(c.markup!==a)!1===k.link&&(g=g||{},g.link=C=!1),D&&(u=w.parentNode),q=c.render(f,g,h,k,a,C),u?(l=w.previousSibling,m=w.nextSibling,e.cleanData([w],!0),u.removeChild(w),w=u):(l=m=a,e(w).empty());else if(!0===c&&k===S)v={lnk:1};else break;if(w._dfr&&!m){t=s(w._dfr,!0,fb);n=0;for(p=t.length;n<p;n++)E=t[n],(E=oa[E.id])&&E.data!==a&&E.parent.removeViews(E._.key,a,!0);w._dfr=
""}k.link(f,w,l,m,q,v,g)}}return d}function q(b,c,d,g,k,m,n,p){function q(b,c,d,e,f,g,h,T,l,ia,m,ma,n){var O,p="";if(n)return E=0,b;w=T||l||"";e=e||ia;d=d||ma;la&&!d&&(e||w||g)&&(la=a,xa=qa.shift());if(e=e||d)E=0,la=a,ea&&(d||ma?$a[xa]||/;svg;|;math;/.test(";"+qa.join(";")+";")||(O="'<"+xa+".../"):$a[e]?O="'</"+e:qa.length&&e===xa||(O="Mismatch: '</"+e),O&&Xa(O+">' in:\n"+k)),sa=ya,xa=qa.shift(),ya=Za[xa],ia=ia?"</"+ia+">":"",sa&&(wa+=Ha,Ha="",ya?wa+="-":(p=ia+Da+"@"+wa+Ea+(m||""),wa=Ja.shift()));
ya?(g?Ha+=g:c=ia||ma||"",w&&(c+=w,Ha&&(c+=" "+ha+'="'+Ha+'"',Ha=""))):c=g?c+p+f+Da+g+Ea+h+w:p||b;E&&g&&Xa(" No {^{ tags within elem markup ("+E+' ). Use data-link="..."');w&&(E=w,qa.unshift(xa),xa=w.slice(1),qa[0]&&qa[0]===mb[xa]&&P("Parent of <tr> must be <tbody>"),la=$a[xa],(ya=Za[xa])&&!sa&&(Ja.unshift(wa),wa=""),sa=ya,wa&&ya&&(wa+="+"));return c}function u(b,d){var e,g,k,T,m=[];if(b){"@"===b._tkns.charAt(0)&&(d=K.previousSibling,K.parentNode.removeChild(K),K=a);for(G=b.length;G--;){A=b[G];k=A.ch;
if(e=A.path)for(B=e.length-1;g=e.charAt(B--);)"+"===g?"-"===e.charAt(B)?(B--,d=d.previousSibling):d=d.parentNode:d=d.lastChild;if("^"===k){if(w=Fa[e=A.id]){g=d&&(!K||K.parentNode!==d);if(!K||g)w.parentElem=d;A.elCnt&&g&&(d._dfr=(A.open?"#":"/")+e+k+(d._dfr||""));m.push([g?null:K,A])}}else if(z=oa[e=A.id])(z.parentElem||(z.parentElem=d||K&&K.parentNode||c,z._.onRender=Ca,z._.onArrayChange=f,h(z)),g=z.parentElem,A.open)?(z._elCnt=A.elCnt,d&&!K?d._dfr="#"+e+k+(d._dfr||""):(z._prv||(g._dfr=l(g._dfr,"#"+
e+k)),z._prv=K)):(!d||K&&K.parentNode===d?K&&(z._nxt||(g._dfr=l(g._dfr,"/"+e+k)),z._nxt=K):(d._dfr="/"+e+k+(d._dfr||""),z._nxt=a),y=z.linkCtx,(T=z.ctx&&z.ctx.onAfterCreate||Ma)&&T.call(y,z))}for(G=m.length;G--;)va.push(m[G])}return!b||b.elCnt}function v(a){var b,c;if(a)for(G=a.length,B=0;B<G;B++)if(A=a[B],U.id)U.id=U.id!==A.id&&U.id;else if(c=w=Fa[A.id].linkCtx.tag,!w.flow){if(!Y){for(b=1;c=c.parent;)b++;fa=fa||b}!Y&&b!==fa||ba&&w.tagName!==ba||X.push(w)}}function x(){J=Ya?c.querySelectorAll(t):e(t,
c).get();F=J.length;d&&d.innerHTML&&(L=Ya?d.querySelectorAll(t):e(t,d).get(),d=L.length?L[L.length-1]:d);for(D=fa=0;D<F;D++)if(K=J[D],d&&!Aa)Aa=K===d;else if(g&&K===g)break;else K.parentNode&&(za&&(A=s(K,a,gb))&&(A=A[0])&&(ta=ta?A.id!==ta&&ta:A.open&&A.id),!ta&&Na(s(K,a,X&&qb))&&!U&&K.getAttribute(aa)&&va.push([K]));k===a&&c.getAttribute(aa)&&va.push([c]);Z(d,ya);Z(g,ya);if(!U){if(ya&&wa+Ha&&(K=g,wa&&(g?u(s(wa+"+",!0),g):u(s(wa,!0),c)),u(s(Ha,!0),c),g)){Ia=g.getAttribute(ha);if(F=Ia.indexOf(ua)+1)Ia=
Ia.slice(F+ua.length-1);g.setAttribute(ha,Ha+Ia)}F=va.length;for(D=0;D<F;D++)if(K=va[D],I=K[1],K=K[0],I){if(w=Fa[I.id]){if(y=w.linkCtx)w=y.tag,w.linkCtx=y;I.open?(K&&(w.parentElem=K.parentNode,w._prv=K),w._elCnt=I.elCnt,!w||w.onBeforeLink&&!1===w.onBeforeLink()||w._.bound||(w._.bound=!0,z=w.tagCtx.view,r(a,w._prv,z,I.id)),w._.linking=!0):(w._nxt=K,w._.linking&&(da=w.tagCtx,z=da.view,delete w._.linking,w._.bound||(w._.bound=!0,r(a,w._prv,z,I.id)),ka(w,da)))}}else r(K.getAttribute(aa),K,R(K),a,za,b,
n)}ra&&ra.resolve()}var E,y,w,D,F,B,G,J,K,z,A,I,L,H,Q,V,S,X,Y,ba,da,ea,fa,U,ga,ca,xa,la,na,Ia,ya,sa,Ha,ua,Aa,ta,ra,za,Ga=this._.id+"_",wa="",va=[],qa=[],Ja=[],Ma=this.hlp(Pa),Na=u;m&&(ra=m.lazyLink&&e.Deferred(),m.tmpl?Q="/"+m._.id+"_":(za=m.lnk,U=m.get,m.tag&&(Ga=m.tag+"^",m=!0)),m=!0===m);U&&(Na=v,X=U.tags,Y=U.deep,ba=U.name);c=c?""+c===c?e(c)[0]:c.jquery?c[0]:c:this.parentElem||ja.body;ea=!W.noValidate&&c.contentEditable!==La;xa=c.tagName.toLowerCase();ya=!!Za[xa];d=d&&pa(d,ya);g=g&&pa(g,ya)||
null;if(k!=a){na=ga=ja.createElement("div");ua=Ha="";ca="http://www.w3.org/2000/svg"===c.namespaceURI?"svg_ns":(H=kb.exec(k))&&H[1]||"";C&&H&&H[2]&&P("Unsupported: "+H[2]);if(ya){for(S=g;S&&!(V=s(S));)S=S.nextSibling;if(Ia=V?V._tkns:c._dfr){H=Q||"";if(m||!Q)H+="#"+Ga;B=Ia.indexOf(H);B+1&&(B+=H.length,ua=Ha=Ia.slice(0,B),Ia=Ia.slice(B),V?S.setAttribute(ha,Ia):c._dfr=Ia)}}la=a;k=(""+k).replace(ob,q);ea&&qa.length&&Xa("Mismatched '<"+xa+"...>' in:\n"+k);if(p)return;cb.appendChild(ga);ca=N[ca]||N.div;
m=ca[0];for(na.innerHTML=ca[1]+k+ca[2];m--;)na=na.lastChild;cb.removeChild(ga);for(ga=ja.createDocumentFragment();ca=na.firstChild;)ga.appendChild(ca);c.insertBefore(ga,g)}ra?setTimeout(x,0):x();return ra&&ra.promise()}function r(b,c,d,f,g,h,l){var m,p,q,r,s,t,x;if(f)g=Fa[f],g=g.linkCtx?g.linkCtx.tag:g,t=g.linkCtx||{data:d.data,elem:g._elCnt?g.parentElem:c,view:d,ctx:d.ctx,attr:sa,fn:g._.bnd,tag:g,_bndId:f},n(t,t.fn);else if(b&&c)for(h=g?h:d.data,f=d.tmpl,p=k(c),b=e.trim(b).replace(lb,"\\$&"),b=b.slice(-1)!==
va?u+":"+b+(p?":":"")+va:b,v.lastIndex=0;m=v.exec(b);)x=v.lastIndex,p=m[1],s=m[3],r=m[10],q=a,t={data:h,elem:c,view:d,ctx:l,attr:p,isLk:g,_initVal:!m[2]},m[6]&&(!p&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==a&&(r=-q.length-1,s=s.slice(0,r-1)+va)),null===q&&(q=a),t.convert=m[5]||""),t.expr=p+s,(m=f.links[s])||(f.links[s]=m=I.tmplFn(s,f,!0,q)),t.fn=m,p||q===a||(t.convertBack=q),n(t,m),v.lastIndex=x}function n(b,d){function e(a,f){c.call(b,a,f,d)}e.noArray=!0;b.isLk&&(b.view=new I.View(b.ctx,"link",S,b.data,
S.tmpl,a,a,Ca));b._ctxCb=la(b.view);b._hdlr=e;e(!0)}function l(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function ra(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ha)||"")}function s(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:ra(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||!a.type,f._tkns=b,b.replace(c||rb,d),f}function Z(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):
b&&""===a.getAttribute(aa)&&a.removeAttribute(aa))}function pa(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ja.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):ra(c)||c.getAttribute(aa)||c.setAttribute(aa,""));return c}function ka(b,c){var d,f,g,h,k,l,m;d=c.view;var n=b.linkCtx=b.linkCtx||{tag:b,data:d.data,view:d,ctx:d.ctx};if(b.onAfterLink)b.onAfterLink(c,n);if(f=(d=b.targetTag?b.targetTag.linkedElem:b.linkedElem)&&d[0]){if(g=b._.radio)d=d.children("input[type=radio]");
if(g||!b._.chging){h=I.cvt(b,b.convert)[0];if(g||f!==n.elem){for(m=d.length;m--;){f=d[m];k=f._jsvLkEl;if(b._.inline&&(!k||k!==b&&k.targetTag!==b))for(f._jsvLkEl=b,k=n.elem?n.elem._jsvBnd:b._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)ua(Fa[k[l]],b.convertBack);g&&(f[A]=h===f.value)}n._val=h}h!==a&&(g||f.value===a?f.contentEditable===La&&(f.innerHTML=h):f.type===ga?f[A]=h&&"false"!==h:d.val(h))}}if(f=f||":"===b.tagName&&n.elem)g=f._jsvTr,h=c.props.trigger,g!==h&&(f._jsvTr=h,
d=d||e(f),ca(d,g,"off"),ca(d,h,"on"))}function Qa(a){setTimeout(function(){b(a)},0)}function ca(a,c,d){c&&a[d](!0===c?"keydown":c,!0===c?Qa:b)}function ua(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a&&l){for(d=(l=(c=l._jsvto)||l[0])&&l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function Ga(a,
b,c){var d;d=a.tagCtx.view;var e=a.tagCtxs||[a.tagCtx],f=e.length,g=!b;b=b||a._.bnd.call(d.tmpl,(a.linkCtx||d).data,d,D);if(c)e=a.tagCtxs=b,a.tagCtx=e[0];else for(;f--;)c=e[f],d=b[f],L(c.props).setProperty(d.props),na(c.ctx,d.ctx),c.args=d.args,g&&(c.tmpl=d.tmpl);I._ths(a,e[0]);return e}function Aa(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd="",a=c.length;a--;)Y(c[a],b._jsvLkEl,b);z(ra(b)+(b._dfr||""))}}
function Y(b,c,d){var f,g,h,k=Fa[b];if(c)d===c.linkedElem[0]&&(delete d._jsvLkEl,delete c.linkedElem);else if(k){delete Fa[b];for(f in k.bnd)c=k.bnd[f],d=".obs"+k.cbId,e.isArray(c)?e([c]).off(ea+d).off(X+d):e(c).off(X+d),delete k.bnd[f];if(f=k.linkCtx){if(c=f.tag){if(d=c.tagCtxs)for(g=d.length;g--;)(h=d[g].map)&&h.unmap();if(g=(d=(h=c.linkedElem)&&h[0]||f.elem)&&d._jsvTr)ca(h||e(d),g,"off"),d._jsvTr=a;if(c.onDispose)c.onDispose();c._elCnt||(c._prv&&c._prv.parentNode.removeChild(c._prv),c._nxt&&c._nxt.parentNode.removeChild(c._nxt))}delete f.view._.bnds[b]}delete I._cbBnds[k.cbId]}}
function qa(c,d){c===a?(y&&(e(y).off(x,b).off("blur","[contenteditable]",b),y=a),c=!0,S.removeViews(),Aa(ja.body.getElementsByTagName("*"))):d&&!0===c&&(d=d.jquery?d:e(d),d.each(function(){for(var b;(b=R(this,!0))&&b.parent;)b.parent.removeViews(b._.key,a,!0);Aa(this.getElementsByTagName("*"));Aa([this])}));return d}function U(a,b){return qa(this,a,b)}function la(a){return function(b,c){var d,e,f=[c];if(a&&b){if(b._jsvOb)return b._jsvOb.call(a.tmpl,c,a,D);if("~"===b.charAt(0)){if("~tag"===b.slice(0,
4)&&(e=a.ctx,"."===b.charAt(4)&&(d=b.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];b=b.slice(1).split(".");if(c=a.hlp(b.shift()))b.length&&f.unshift(b.join(".")),f.unshift(c);return c?f:[]}if("#"===b.charAt(0))return"#data"===b?[]:[a,b.replace(nb,""),c]}}}function Ja(a){return a.type===ga?a[A]:a.value}function p(a,b,c,d,e,f){var g,h,k,m,n,p,q=0,r=a===b;if(a){k=s(a)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?oa[p]:Fa[p].linkCtx.tag,
m.open?n._prv=b:m.close&&(n._nxt=b));q+=p.length+2}q&&a.setAttribute(ha,a.getAttribute(ha).slice(q));a=b?b.getAttribute(ha):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ha,a):c._dfr=a)}else c._dfr=l(c._dfr,"#"+d+e),f||b||(c._dfr=l(c._dfr,"/"+d+e))}function z(b){var c,d,e;if(e=s(b,!0,pb))for(b=0,c=e.length;b<c;b++)d=e[b],"_"===d.ch?(d=oa[d.id])&&d.type&&d.parent.removeViews(d._.key,a,!0):Y(d.id)}function B(a,b,c){if("set"===c.change){a=a.tgt;
for(b=a.length;b--&&a[b].key!==c.path;);-1===b?c.path&&L(a).insert({key:c.path,prop:c.value}):c.remove?L(a).remove(b):L(a[b]).setProperty("prop",c.value)}}function J(a,b,c){a=a.src;var d=c.change;"set"===d?"prop"===c.path?L(a).setProperty(b.target.key,c.value):(L(a).setProperty(c.oldValue,null),delete a[c.oldValue],L(a).setProperty(c.value,b.target.prop)):"remove"===d?(b=c.items[0],L(a).removeProperty(b.key),delete a[b.key]):"insert"===d&&(b=c.items[0],b.key&&L(a).setProperty(b.key,b.prop))}function Q(a){return 0>
a.indexOf(".")}var y,R,v,u,va,G,C,P,aa,H,t,N,S,oa,ja=g.document,D=e.views,I=D.sub,W=D.settings,na=I.extend,da=e.isFunction,ab=D.converters,ta=D.tags,L=e.observable,Ra=L.observe,ha="data-jsv",X=I.propChng=I.propChng||"propertyChange",ea=I.arrChng=I.arrChng||"arrayChange",x="change.jsv",V="onBeforeChange",Na="onAfterChange",Pa="onAfterCreate",A="checked",ga="checkbox",za="radio",Ma="none",La="true",Ea='">\x3c/script>',Da='<script type="jsv',Ua="script,["+ha+"]",sa="html",Va={value:"val",input:"val",
html:sa,text:"text"},bb={from:"value",to:"value"},Wa=0,ib=e.cleanData,jb=W.delimiters,Xa=I.syntaxErr,kb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,lb=/['"\\]/g,cb=ja.createDocumentFragment(),Ya=ja.querySelector,Za={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},mb={tr:"table"},$a={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},db={},Fa={},eb=1,nb=/^#(view\.?)?/,ob=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,
fb=/(#)()(\d+)(_)/g,pb=/(#)()(\d+)([_^])/g,gb=/(?:(#)|(\/))(\d+)(_)/g,qb=/(#)()(\d+)(\^)/g,rb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,hb=g.getComputedStyle;if(!e)throw"JsViews requires jQuery";if(!D)throw"JsViews requires JsRender";if(!L)throw"JsViews requires jquery.observable";e.link||(H={contents:function(b,c){b!==!!b&&(c=b,b=a);var d,f=e(this.nodes());f[0]&&(d=c?f.filter(c):f,f=b&&c?d.add(f.find(c)):d);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;
for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(b,c){b!==!!b&&(c=b,b=a);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(a,this.parentElem,f?e.previousSibling:e,this._nxt,a,{get:{tags:g,deep:b,name:c,id:f&&this._tgId}});return g},refresh:function(b){var c,e=this.linkCtx,f=this.tagCtx.view;this.disposed&&
P("Removed tag");b===a&&(b=D._tag(this,f,f.tmpl,Ga(this),!0));b+""===b&&(c=this._.inline?sa:e.attr||k(this.parentElem,!0),c=d(b,e,c,this));ka(this,this.tagCtx);return c||this},update:function(c){var d=this.linkedElem;d&&b({target:d[0]},a,c)}},I.onStore.template=function(a,b){b.link=ba;b.unlink=U;a&&(e.link[a]=function(){return ba.apply(b,arguments)},e.unlink[a]=function(){return U.apply(b,arguments)})},I.onStore.tag=function(a,b){I._lnk(b)},I._lnk=function(a){return na(a,H)},I.viewInfos=s,(W.delimiters=
function(){var a=jb.apply(D,arguments);u=a[1];va=a[2];G=a[4];v=RegExp("(?:^|\\s*)([\\w-]*)(\\"+G+")?(\\"+u+I.rTag+"\\"+va+")","g");return this})(),na(I._lnk(I.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==m(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)L(f[a]).setProperty("index",a);return this},removeViews:function(b,c,d){function f(b){var c,g,k,l,n,q=m[b];if(q&&q.link){b=q._.id;d||(n=q.nodes());q.removeViews(a,a,!0);q.type=
a;k=q._prv;l=q._nxt;g=q.parentElem;d||(q._elCnt&&p(k,l,g,b,"_"),e(n).remove());if(!q._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(r){}h(q);for(c in q._.bnds)Y(c);delete oa[b]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(b===a)if(l){for(g=k;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(c===a&&(l?c=1:(f(b),delete m[b])),l&&c){for(g=b+c;g-- >b;)f(g);m.splice(b,c);if(k=m.length)for(;b<k;)L(m[b]).setProperty("index",b++)}return this},refresh:function(a){var b=
this.parent;b&&(m(this,this.index,this.tmpl,b.views,this.data,a,!0),h(this));return this},link:q}),oa={0:S=new I.View},ab.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},ta("on",{attr:Ma,onAfterLink:function(b,c){for(var d,f,g=0,h=b.args,k=h.length,l=b.props.data,m=b.view,n=b.props.context;g<k&&!(f=da(d=h[g++])););if(f){f=h.slice(g);
h=h.slice(0,g-1);n||(n=(n=/^(.*)[\.^][\w$]+$/.exec(b.params.args.slice(-f.length-1)[0]))&&I.tmplFn("{:"+n[1]+"}",m.tmpl,!0)(c.data,m));if(this._evs)this.onDispose();e(c.elem).on(this._evs=h[0]||"click",this._sel=h[1],l==a?null:l,this._hlr=function(a){return d.apply(n||c.data,[].concat(f,a,{change:a.type,view:m,linkCtx:c}))})}},onDispose:function(){e(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),na(ta["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===
d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,c,d,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],d=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(c=g[a])&&d!==c[0]&&(Ra(c[0],c[1],!0),delete g[a]),!g[a]&&e.isArray(d)&&(Ra(d,
b=function(a,b){f.onArrayChange(a,b)}),g[a]=[d,b]);for(a=l+1;a<k;a++)if(c=g[a])Ra(c[0],c[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)Ra(this._ars[a][0],this._ars[a][1],!0)}}),na(ta["for"],H),na(ta["if"],H),na(ta.include,H),ta("props",{baseTag:ta["for"],dataMap:D.map({getTgt:ta.props.dataMap.getTgt,obsSrc:B,obsTgt:J,tgtFlt:Q})}),na(e,{view:D.view=R=function(b,c,d){function f(a,b){if(a)for(h=s(a,b,fb),k=0,l=h.length;k<l&&(!(g=oa[h[k].id])||!(g=g&&d?g.get(!0,d):g));k++);
}c!==!!c&&(d=c,c=a);var g,h,k,l,m;m=0;var n=ja.body;if(b&&b!==n&&1<S._.useKey&&(b=""+b===b?e(b)[0]:b.jquery?b[0]:b)){if(c){f(b._dfr,!0);if(!g)for(m=Ya?b.querySelectorAll(Ua):e(Ua,b).get(),c=m.length,b=0;!g&&b<c;b++)f(m[b]);return g}for(;b;){if(h=s(b,a,gb))for(c=h.length;c--;)if(g=h[c],g.open){if(1>m)return(g=oa[g.id])&&d?g.get(d):g||S;m--}else m++;b=b.previousSibling||b.parentNode}}return S},link:D.link=F,unlink:D.unlink=qa,cleanData:function(a){a.length&&Wa&&Aa(a);ib.apply(e,arguments)}}),D.utility=
{validate:function(b){try{S.link(a,ja.createElement("div"),a,a,b,a,a,1)}catch(c){return c.message}}},na(e.fn,{link:function(a,b,c,d,e,f,g){return F(a,this,b,c,d,e,f,g)},unlink:function(a){return qa(a,this)},view:function(a){return R(this[0],a)}}),e.each([sa,"replaceWith","empty","remove"],function(a,b){var c=e.fn[b];e.fn[b]=function(){var a;Wa=1;try{a=c.apply(this,arguments)}finally{Wa=0}return a}}),na(S,{tmpl:{links:{},tags:{}}}),S._.onRender=Ca,W({wrapMap:N={option:[1,"<select multiple='multiple'>",
"</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:aa="data-link",merge:{input:{from:Ja,to:"value"},textarea:bb,select:bb,optgroup:{to:"label"}},jsrDbgMode:W.debugMode,
debugMode:function(a){W.jsrDbgMode(a);a?g._jsv={views:oa,bindings:Fa}:delete g._jsv},jsv:function(){W.debugMode(W._dbgMode);aa=W.linkAttr;P=D._err;t=Ua+",["+aa+"]";C=W.noDomLevel0;N.optgroup=N.option;N.tbody=N.tfoot=N.colgroup=N.caption=N.thead;N.th=N.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
