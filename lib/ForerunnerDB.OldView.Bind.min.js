(function(){var k=function(l){var h=l.classes.OldView,k=l.classes.OldView.prototype.init;h.prototype.init=function(){var d=this;this._binds=[];this._renderEnd=this._renderStart=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[],_bindInsert:[],_bindUpdate:[],_bindRemove:[],_bindUpsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100,_bindInsert:100,_bindUpdate:100,_bindRemove:100,_bindUpsert:100};this._deferTime={insert:100,update:1,remove:1,upsert:1,_bindInsert:100,_bindUpdate:1,
_bindRemove:1,_bindUpsert:1};k.apply(this,arguments);this.on("insert",function(c,a){d._bindEvent("insert",c,a)});this.on("update",function(c,a){d._bindEvent("update",c,a)});this.on("remove",function(c,a){d._bindEvent("remove",c,a)});this.on("change",d._bindChange)};h.prototype.bind=function(d,c){if(c&&c.template)this._binds[d]=c;else throw"Cannot bind data to element, missing options information!";return this};h.prototype.unBind=function(d){delete this._binds[d];return this};h.prototype.isBound=function(d){return Boolean(this._binds[d])};
h.prototype.bindSortDom=function(d,c){var a=$(d),b,g,e;(this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",c);for(b=0;b<c.length;b++)g=c[b],e=a.find("#"+g[this._primaryKey]),e.length?0===b?((this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",e),a.prepend(e)):((this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+b+"...",e),e.insertAfter(a.children(":eq("+
(b-1)+")"))):(this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",g)};h.prototype.bindRefresh=function(d){var c=this._binds,a,b;d||(d={data:this.find()});for(a in c)c.hasOwnProperty(a)&&(b=c[a],(this._debug||this._db&&this._db._debug)&&console.log("Bind: sorting DOM..."),this.bindSortDom(a,d.data),b.afterOperation&&b.afterOperation(),b.refresh&&b.refresh())};h.prototype.bindRender=function(d,c){var a=this._binds[d],b=$(d),g,
e,f=$("<ul></ul>"),h;if(a){g=this._data.find();for(h=0;h<g.length;h++)e=g[h],a.template(e,function(c){f.append(c)});c?c(d,f.html()):b.append(f.html())}};h.prototype.processQueue=function(d,c){var a=this._deferQueue[d],b=this._deferThreshold[d],g=this._deferTime[d];if(a.length){var e=this;a.length&&(a=a.length>b?a.splice(0,b):a.splice(0,a.length),this._bindEvent(d,a,[]));setTimeout(function(){e.processQueue(d,c)},g)}else c&&c(),this.emit("bindQueueComplete")};h.prototype._bindEvent=function(d,c,a){var b=
this._binds,g=this.find({}),e,f;for(f in b)if(b.hasOwnProperty(f))switch(e=b[f].reduce?this.find(b[f].reduce.query,b[f].reduce.options):g,d){case "insert":this._bindInsert(f,b[f],c,a,e);break;case "update":this._bindUpdate(f,b[f],c,a,e);break;case "remove":this._bindRemove(f,b[f],c,a,e)}};h.prototype._bindChange=function(d){if(this._debug||this._db&&this._db._debug)console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",d),console.log("Bind: change received");this.bindRefresh(d)};
h.prototype._bindInsert=function(d,c,a,b,g){var e=$(d),f;for(f=0;f<a.length;f++)d=e.find("#"+a[f][this._primaryKey]),d.length||c.template(a[f],function(a,d,b,f){return function(a){c.insert?c.insert(a,d,b,f):c.prependInsert?e.prepend(a):e.append(a);c.afterInsert&&c.afterInsert(a,d,b,f)}}(d,a[f],b,g))};h.prototype._bindUpdate=function(d,c,a,b,g){var e=$(d);for(b=0;b<a.length;b++)d=e.find("#"+a[b][this._primaryKey]),c.template(a[b],function(a,d){return function(b){c.update?c.update(b,d,g,a.length?"update":
"append"):a.length?a.replaceWith(b):c.prependUpdate?e.prepend(b):e.append(b);c.afterUpdate&&c.afterUpdate(b,d,g)}}(d,a[b]))};h.prototype._bindRemove=function(d,c,a,b,g){d=$(d);var e;for(e=0;e<a.length;e++)b=d.find("#"+a[e][this._primaryKey]),b.length&&(c.beforeRemove?c.beforeRemove(b,a[e],g,function(a,b,d){return function(){c.remove?c.remove(a,b,d):(a.remove(),c.afterRemove&&c.afterRemove(a,b,d))}}(b,a[e],g)):c.remove?c.remove(b,a[e],g):(b.remove(),c.afterRemove&&c.afterRemove(b,a[e],g)))}};"function"===
typeof define&&define.amd?define(["require","../ForerunnerDB","./ForerunnerDB.OldView"],function(l,h,m){return k(h)}):k(ForerunnerDB)})();
