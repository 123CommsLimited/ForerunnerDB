!function(v){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=v();else if("function"==typeof define&&define.amd)define([],v);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=v()}}(function(){return function h(p,l,g){function a(c,q){if(!l[c]){if(!p[c]){var d="function"==typeof require&&require;if(!q&&d)return d(c,!0);if(e)return e(c,!0);d=Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",
d;}d=l[c]={exports:{}};p[c][0].call(d.exports,function(b){var f=p[c][1][b];return a(f?f:b)},d,d.exports,h,p,l,g)}return l[c].exports}for(var e="function"==typeof require&&require,c=0;c<g.length;c++)a(g[c]);return a}({1:[function(h,p,l){h=h("../lib/Core");p.exports=h},{"../lib/Core":3}],2:[function(h,p,l){var g,a,e,c,k,q;g=h("./Shared");var d=function(b){this.init.apply(this,arguments)};d.prototype.init=function(b){this._primaryKey="_id";this._primaryIndex=new e("primary");this._primaryCrc=new e("primaryCrc");
this._crcLookup=new e("crcLookup");this._name=b;this._data=[];this._groups=[];this._metrics=new a;this._linked=0;this._debug={};this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};g.addModule("Collection",d);g.inherit(d.prototype,g.chainSystem);l=h("./Overload");a=h("./Metrics");e=h("./KeyValueStore");c=h("./Path");k=h("./Index");q=h("./Crc");h=g.modules.Core;
d.prototype.debug=new l([function(){return this._debug.all},function(b){return void 0!==b?"boolean"===typeof b?(this._debug.all=b,this.chainSend("debug",this._debug),this):this._debug[b]||this._db&&this._db._debug&&this._db._debug[b]||this._debug.all:this._debug.all},function(b,f){return void 0!==b?void 0!==f?(this._debug[b]=f,this.chainSend("debug",this._debug),this):this._debug[b]||this._db&&this._db._debug&&this._db._debug[b]:this._debug.all}]);d.prototype.crc=q;d.prototype.name=function(b){return void 0!==
b?(this._name=b,this):this._name};d.prototype.on=new l([function(b,f){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b]["*"]=this._listeners[b]["*"]||[];this._listeners[b]["*"].push(f);return this},function(b,f,n){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b][f]=this._listeners[b][f]||[];this._listeners[b][f].push(n);return this}]);d.prototype.off=new l([function(b){this._listeners&&this._listeners[b]&&
b in this._listeners&&delete this._listeners[b];return this},function(b,f){var n,a;"string"===typeof f?this._listeners&&this._listeners[b]&&this._listeners[b][f]&&delete this._listeners[b][f]:b in this._listeners&&(n=this._listeners[b]["*"],a=n.indexOf(f),-1<a&&n.splice(a,1));return this},function(b,f,n){this._listeners&&b in this._listeners&&(b=this._listeners[b][f],n=b.indexOf(n),-1<n&&b.splice(n,1))}]);d.prototype.emit=function(b,f){this._listeners=this._listeners||{};if(b in this._listeners){if(this._listeners[b]["*"]){var n=
this._listeners[b]["*"],a=n.length,c;for(c=0;c<a;c++)n[c].apply(this,Array.prototype.slice.call(arguments,1))}if(f instanceof Array&&f[0]&&f[0][this._primaryKey]){var n=this._listeners[b],e,g,a=f.length;for(c=0;c<a;c++)if(n[f[c][this._primaryKey]])for(e=n[f[c][this._primaryKey]].length,g=0;g<e;g++)n[f[c][this._primaryKey]][g].apply(this,Array.prototype.slice.call(arguments,1))}}return this};d.prototype.drop=function(){if(this._db&&this._name){this.debug()&&console.log("Dropping collection "+this._name);
this.emit("drop");delete this._db._collection[this._name];var b=[],f;for(f=0;f<this._groups.length;f++)b.push(this._groups[f]);for(f=0;f<b.length;f++)this._groups[f].removeCollection(this);return!0}return!1};d.prototype.primaryKey=function(b){return void 0!==b?(this._primaryKey=b,this._primaryIndex.primaryKey(b),this._rebuildPrimaryKeyIndex(),this):this._primaryKey};d.prototype._onInsert=function(b,f){this.emit("insert",b,f)};d.prototype._onUpdate=function(b){this.emit("update",b)};d.prototype._onRemove=
function(b){this.emit("remove",b)};d.prototype.db=function(b){return void 0!==b?(this._db=b,this):this._db};d.prototype.setData=function(b,f,n){if(b){var a=this._metrics.create("setData");a.start();f=f||{};f.$decouple=void 0!==f.$decouple?f.$decouple:!0;f.$decouple&&(b=this.decouple(b));b instanceof Array||(b=[b]);a.time("transformIn");b=this.transformIn(b);a.time("transformIn");var c=this._data;this._linked?this.remove():this._data=[];b.length&&(this._linked?this.insert(b):this._data=this._data.concat(b));
a.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(f);a.time("Rebuild Primary Key Index");a.time("Resolve chains");this.chainSend("setData",b,{oldData:c});a.time("Resolve chains");a.stop();this.emit("setData",this._data,c)}n&&n(!1);return this};d.prototype._rebuildPrimaryKeyIndex=function(b){var f=b&&void 0!==b.ensureKeys?b.ensureKeys:!0;b=b&&void 0!==b.violationCheck?b.violationCheck:!0;var n,a,c,e=this._primaryIndex,g=this._primaryCrc,d=this._crcLookup,k=this._primaryKey,h;e.truncate();
g.truncate();d.truncate();n=this._data;for(a=n.length;a--;)if(c=n[a],f&&this._ensurePrimaryKey(c),b){if(!e.uniqueSet(c[k],c))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+c[this._primaryKey];}else h=JSON.stringify(c),e.set(c[k],c),g.set(c[k],h),d.set(h,c)};d.prototype._ensurePrimaryKey=function(b){void 0===b[this._primaryKey]&&(b[this._primaryKey]=this.objectId())};d.prototype.truncate=function(){this.emit("truncate",
this._data);this._data.length=0;this.deferEmit("change");return this};d.prototype.upsert=function(b,f){if(b){var n=this._deferQueue.upsert,a=this._deferThreshold.upsert,c={},e;if(b instanceof Array){if(b.length>a){this._deferQueue.upsert=n.concat(b);this.processQueue("upsert",f);return}c=[];for(n=0;n<b.length;n++)c.push(this.upsert(b[n]));f&&f();return c}b[this._primaryKey]?(e={},e[this._primaryKey]=b[this._primaryKey],this.count(e)?c.op="update":c.op="insert"):c.op="insert";switch(c.op){case "insert":c.result=
this.insert(b);break;case "update":c.result=this.update(e,b)}return c}f&&f()};d.prototype.update=function(b,f,n){f=this.decouple(f);f=this.transformIn(f);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var a=this,c=this._metrics.create("update"),e=this._primaryKey,g,d,k=function(c){if(f&&void 0!==f[e]&&f[e]!=c[e]){a._primaryIndex.unSet(c[e]);var g=a._updateObject(c,f,b,n,"");if(a._primaryIndex.uniqueSet(c[e],c))return g;throw"Primary key violation in update! Key violated: "+
c[e];}return a._updateObject(c,f,b,n,"")};c.start();c.time("Retrieve documents to update");g=this.find(b,{$decouple:!1});c.time("Retrieve documents to update");g.length&&(c.time("Update documents"),d=g.filter(k),c.time("Update documents"),d.length&&(c.time("Resolve chains"),this.chainSend("update",{query:b,update:f},n),c.time("Resolve chains"),this._onUpdate(d),this.deferEmit("change",{type:"update",data:d})));c.stop();return d||[]};d.prototype.updateById=function(b,f){var n={};n[this._primaryKey]=
b;return this.update(n,f)};d.prototype._updateObject=function(b,f,n,a,e,g){f=this.decouple(f);e=e||"";"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));var d=!1,k=!1,h,q,l,m;for(m in f)if(f.hasOwnProperty(m)){h=!1;if("$"===m.substr(0,1))switch(m){case "$index":break;default:h=!0,(k=this._updateObject(b,f[m],n,a,e,m))&&(d=!0)}if(this._isPositionalKey(m)&&(h=!0,m=m.substr(0,m.length-2),k=new c(e+"."+m),b[m]&&b[m]instanceof Array&&b[m].length)){q=[];for(l=0;l<b[m].length;l++)this._match(b[m][l],k.value(n)[0])&&
q.push(l);for(l=0;l<q.length;l++)(k=this._updateObject(b[m][q[l]],f[m+".$"],n,a,e+"."+m,g))&&(d=!0)}if(!h)if(g||"object"!==typeof f[m])switch(g){case "$inc":this._updateIncrement(b,m,f[m]);d=!0;break;case "$push":void 0===b[m]&&(b[m]=[]);if(b[m]instanceof Array){if(void 0!==f[m].$position&&f[m].$each instanceof Array)for(k=f[m].$position,h=f[m].$each.length,l=0;l<h;l++)this._updateSplicePush(b[m],k+l,f[m].$each[l]);else if(f[m].$each instanceof Array)for(h=f[m].$each.length,l=0;l<h;l++)this._updatePush(b[m],
f[m].$each[l]);else this._updatePush(b[m],f[m]);d=!0}else throw"Cannot push to a key that is not an array! ("+m+")";break;case "$pull":if(b[m]instanceof Array){q=[];for(l=0;l<b[m].length;l++)this._match(b[m][l],f[m])&&q.push(l);for(h=q.length;h--;)this._updatePull(b[m],q[h]),d=!0}break;case "$pullAll":if(b[m]instanceof Array)if(f[m]instanceof Array){if(q=b[m],h=q.length,0<h)for(;h--;){for(k=0;k<f[m].length;k++)q[h]===f[m][k]&&(this._updatePull(b[m],h),h--,d=!0);if(0>h)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+
m+")";break;case "$addToSet":void 0===b[m]&&(b[m]=[]);if(b[m]instanceof Array){l=b[m];var p;q=l.length;var s;h=!0;p=a&&a.$addToSet;var r;p&&p.key?(k=!1,r=new c(p.key),s=r.value(f[m])[0]):(s=JSON.stringify(f[m]),k=!0);for(p=0;p<q;p++)if(k){if(JSON.stringify(l[p])===s){h=!1;break}}else if(s===r.value(l[p])[0]){h=!1;break}h&&(this._updatePush(b[m],f[m]),d=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===b[m]&&(b[m]=[]);if(b[m]instanceof Array)if(k=
f.$index,void 0!==k)delete f.$index,this._updateSplicePush(b[m],k,f[m]),d=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+m+")";break;case "$move":if(b[m]instanceof Array)for(l=0;l<b[m].length;l++){if(this._match(b[m][l],f[m])){d=f[m].$index;if(void 0!==d)this._updateSpliceMove(b[m],l,d),d=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+m+")";
break;case "$mul":this._updateMultiply(b,m,f[m]);d=!0;break;case "$rename":this._updateRename(b,m,f[m]);d=!0;break;case "$unset":this._updateUnset(b,m);d=!0;break;case "$pop":if(b[m]instanceof Array)this._updatePop(b[m],f[m])&&(d=!0);else throw"Cannot pop from a key that is not an array! ("+m+")";break;default:b[m]!==f[m]&&(this._updateProperty(b,m,f[m]),d=!0)}else if(null!==b[m]&&"object"===typeof b[m])if(l=b[m]instanceof Array,q=f[m]instanceof Array,l||q)if(!q&&l)for(l=0;l<b[m].length;l++)(k=this._updateObject(b[m][l],
f[m],n,a,e+"."+m,g))&&(d=!0);else b[m]!==f[m]&&(this._updateProperty(b,m,f[m]),d=!0);else(k=this._updateObject(b[m],f[m],n,a,e+"."+m,g))&&(d=!0);else b[m]!==f[m]&&(this._updateProperty(b,m,f[m]),d=!0)}return d};d.prototype._isPositionalKey=function(b){return".$"===b.substr(b.length-2,2)};d.prototype._updateProperty=function(b,f,n){this._linked?(jQuery.observable(b).setProperty(f,n),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+f+'" for collection "'+this.name()+
'"')):(b[f]=n,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+f+'" for collection "'+this.name()+'"'))};d.prototype._updateIncrement=function(b,f,n){this._linked?jQuery.observable(b).setProperty(f,b[f]+n):b[f]+=n};d.prototype._updateSpliceMove=function(b,f,n){this._linked?(jQuery.observable(b).move(f,n),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+f+'" to "'+n+'" for collection "'+this.name()+'"')):
(b.splice(n,0,b.splice(f,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+f+'" to "'+n+'" for collection "'+this.name()+'"'))};d.prototype._updateSplicePush=function(b,f,n){b.length>f?this._linked?jQuery.observable(b).insert(f,n):b.splice(f,0,n):this._linked?jQuery.observable(b).insert(n):b.push(n)};d.prototype._updatePush=function(b,f){this._linked?jQuery.observable(b).insert(f):b.push(f)};d.prototype._updatePull=function(b,f){this._linked?
jQuery.observable(b).remove(f):b.splice(f,1)};d.prototype._updateMultiply=function(b,f,n){this._linked?jQuery.observable(b).setProperty(f,b[f]*n):b[f]*=n};d.prototype._updateRename=function(b,f,n){var a=b[f];this._linked?(jQuery.observable(b).setProperty(n,a),jQuery.observable(b).removeProperty(f)):(b[n]=a,delete b[f])};d.prototype._updateUnset=function(b,f){this._linked?jQuery.observable(b).removeProperty(f):delete b[f]};d.prototype._updatePop=function(b,f){var n,a=!1;0<b.length&&(this._linked?(1===
f?n=b.length-1:-1===f&&(n=0),-1<n&&(jQuery.observable(arr).remove(n),a=!0)):1===f?(b.pop(),a=!0):-1===f&&(b.shift(),a=!0));return a};d.prototype.remove=function(b,f,n){var a,c;if(b instanceof Array){c=[];for(n=0;n<b.length;n++)c.push(this.remove(b[n],{noEmit:!0}));(!f||f&&!f.noEmit)&&this._onRemove(c);return c}n=this.find(b,{$decouple:!1});if(n.length){for(c=0;c<n.length;c++)a=n[c],this._removeIndex(a),a=this._data.indexOf(a),this._linked?jQuery.observable(this._data).remove(a):this._data.splice(a,
1);this.chainSend("remove",{query:b},f);(!f||f&&!f.noEmit)&&this._onRemove(n);this.deferEmit("change",{type:"remove",data:n})}return n};d.prototype.removeById=function(b){var f={};f[this._primaryKey]=b;return this.remove(f)};d.prototype.deferEmit=function(){var b=this,f;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(f=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+
f[0]);b.emit.apply(b,f)},100))};d.prototype.processQueue=function(b,f){var n=this._deferQueue[b],a=this._deferThreshold[b],c=this._deferTime[b];if(n.length){var e=this;n.length&&(n=n.length>a?n.splice(0,a):n.splice(0,n.length),this[b](n));setTimeout(function(){e.processQueue(b,f)},c)}else f&&f()};d.prototype.insert=function(b,f,n){"function"===typeof f?(n=f,f=this._data.length):void 0===f&&(f=this._data.length);b=this.transformIn(b);return this._insertHandle(b,f,n)};d.prototype._insertHandle=function(b,
f,n){var a=this._deferQueue.insert,c=this._deferThreshold.insert,e=[],d=[];if(b instanceof Array){if(b.length>c){this._deferQueue.insert=a.concat(b);this.processQueue("insert",n);return}for(c=0;c<b.length;c++)a=this._insert(b[c],f+c),!0===a?e.push(b[c]):d.push({doc:b[c],reason:a})}else a=this._insert(b,f),!0===a?e.push(b):d.push({doc:b,reason:a});this.chainSend("insert",b,{index:f});this._onInsert(e,d);n&&n();this.deferEmit("change",{type:"insert",data:e});return{inserted:e,failed:d}};d.prototype._insert=
function(b,f){if(b){var n;this._ensurePrimaryKey(b);if(n=this.insertIndexViolation(b))return"Index violation in index: "+n;this._insertIndex(b);this._linked?jQuery.observable(this._data).insert(f,b):this._data.splice(f,0,b);return!0}return"No document passed to insert"};d.prototype._insertIndex=function(b){var f=this._indexByName,n,a=JSON.stringify(b);this._primaryIndex.uniqueSet(b[this._primaryKey],b);this._primaryCrc.uniqueSet(b[this._primaryKey],a);this._crcLookup.uniqueSet(a,b);for(n in f)f.hasOwnProperty(n)&&
f[n].insert(b)};d.prototype._removeIndex=function(b){var f=this._indexByName,n,a=JSON.stringify(b);this._primaryIndex.unSet(b[this._primaryKey]);this._primaryCrc.unSet(b[this._primaryKey]);this._crcLookup.unSet(a);for(n in f)f.hasOwnProperty(n)&&f[n].remove(b)};d.prototype.subset=function(b,f){var n=this.find(b,f);return(new d)._subsetOf(this).primaryKey(this._primaryKey).setData(n)};d.prototype.subsetOf=function(){return this.__subsetOf};d.prototype._subsetOf=function(b){this.__subsetOf=b;return this};
d.prototype.distinct=function(b,f,n){f=this.find(f,n);b=new c(b);n={};var a=[],e,d;for(d=0;d<f.length;d++)(e=b.value(f[d])[0])&&!n[e]&&(n[e]=!0,a.push(e));return a};d.prototype.decouple=function(b){return JSON.parse(JSON.stringify(b))};d.prototype.findById=function(b,f){var a={};a[this._primaryKey]=b;return this.find(a,f)[0]};d.prototype.peek=function(b,f){var a=this._data,c=a.length,e,g,k=new d;if("string"===typeof b){for(e=0;e<c;e++)g=JSON.stringify(a[e]),-1<g.indexOf(b)&&k.insert(a[e]);return k.find({},
f)}return this.find(b,f)};d.prototype.explain=function(b,f){return this.find(b,f).__fdbOp._data};d.prototype.find=function(b,f){b=b||{};f=f||{};f.$decouple=void 0!==f.$decouple?f.$decouple:!0;var a=this._metrics.create("find"),e=this,d,g=!0,k,h,l,q,p,m,t,s,r,u=[];h=function(f){return e._match(f,b,"and")};a.start();if(b){a.time("analyseQuery");d=this._analyseQuery(b,f,a);a.time("analyseQuery");a.data("analysis",d);if(d.hasJoin&&d.queriesJoin){a.time("joinReferences");for(l=0;l<d.joinsOn.length;l++)p=
d.joinsOn[l],q=new c(d.joinQueries[p]),q=q.value(b)[0],this._db.collection(d.joinsOn[l]).subset(q);a.time("joinReferences")}d.indexMatch.length&&(!f||f&&!f.$skipIndex)?(a.data("index.potential",d.indexMatch),a.data("index.used",d.indexMatch[0].index),a.time("indexLookup"),k=d.indexMatch[0].lookup,a.time("indexLookup"),d.indexMatch[0].keyData.totalKeyCount===d.indexMatch[0].keyData.matchedKeyCount&&(g=!1)):a.flag("usedIndex",!1);g&&(k&&k.length?(d=k.length,a.time("tableScan: "+d),k=k.filter(h)):(d=
this._data.length,a.time("tableScan: "+d),k=this._data.filter(h)),f.$orderBy&&(a.time("sort"),k=this.sort(f.$orderBy,k),a.time("sort")),a.time("tableScan: "+d));f.limit&&k&&k.length>f.limit&&(k.length=f.limit,a.data("limit",f.limit));f.$decouple&&(a.time("decouple"),k=this.decouple(k),a.time("decouple"),a.data("flag.decouple",!0));if(f.join){for(h=0;h<f.join.length;h++)for(p in f.join[h])if(f.join[h].hasOwnProperty(p))for(s=p,d=this._db.collection(p),g=f.join[h][p],r=0;r<k.length;r++){t={};q=l=!1;
for(m in g)if(g.hasOwnProperty(m))if("$"===m.substr(0,1))switch(m){case "$as":s=g[m];break;case "$multi":l=g[m];break;case "$require":q=g[m];break;default:m.substr(0,3)}else t[m]=(new c(g[m])).value(k[r])[0];t=d.find(t);!q||q&&t[0]?k[r][s]=!1===l?t[0]:t:u.push(k[r])}a.data("flag.join",!0)}if(u.length){a.time("removalQueue");for(m=0;m<u.length;m++)p=k.indexOf(u[m]),-1<p&&k.splice(p,1);a.time("removalQueue")}if(f.transform){a.time("transform");for(m=0;m<k.length;m++)k.splice(m,1,f.transform(k[m]));
a.time("transform");a.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(a.time("transformOut"),k=this.transformOut(k),a.time("transformOut"));a.data("results",k.length);a.stop()}else a.stop(),k=[];k.__fdbOp=a;return k};d.prototype.indexOf=function(b){if(b=this.find(b,{$decouple:!1})[0])return this._data.indexOf(b)};d.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=
b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.transformIn=function(b){if(this._transformEnabled&&this._transformIn){if(b instanceof Array){var f=[],a;for(a=0;a<b.length;a++)f[a]=this._transformIn(b[a]);return f}return this._transformIn(b)}return b};d.prototype.transformOut=function(b){if(this._transformEnabled&&this._transformOut){if(b instanceof
Array){var f=[],a;for(a=0;a<b.length;a++)f[a]=this._transformOut(b[a]);return f}return this._transformOut(b)}return b};d.prototype.sort=function(b,f){f=f||[];var a=[],c,d;for(c in b)b.hasOwnProperty(c)&&(d={},d[c]=b[c],d.___fdbKey=c,a.push(d));return 2>a.length?this._sort(b,f):this._bucketSort(a,f)};d.prototype._bucketSort=function(b,f){var a=b.shift(),c,d,e=[];if(0<b.length){f=this._sort(a,f);c=this.bucket(a.___fdbKey,f);for(d in c)c.hasOwnProperty(d)&&(a=[].concat(b),e=e.concat(this._bucketSort(a,
c[d])));return e}return this._sort(a,f)};d.prototype._sort=function(b,f){var a=new c,d=a.parse(b,!0)[0];a.path(d.path);return f.sort(1===d.value?function(b,f){var c=a.value(b)[0],d=a.value(f)[0];return"string"===typeof c&&"string"===typeof d?c.localeCompare(d):c>d?1:c<d?-1:0}:function(b,f){var c=a.value(b)[0],d=a.value(f)[0];return"string"===typeof c&&"string"===typeof d?1===c.localeCompare(d)?-1:1:c>d?-1:c<d?1:0})};d.prototype.bucket=function(b,f){var a,c={};for(a=0;a<f.length;a++)c[f[a][b]]=c[f[a][b]]||
[],c[f[a][b]].push(f[a]);return c};d.prototype._analyseQuery=function(b,f,a){var d={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:f},e,g=[],k=[],h,l,q,p,m;a.time("checkIndexes");void 0!==b[this._primaryKey]&&(a.time("checkIndexMatch: Primary Key"),h=new c,d.indexMatch.push({lookup:this._primaryIndex.lookup(b,f),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:h.countKeys(b)},index:this._primaryIndex}),a.time("checkIndexMatch: Primary Key"));
for(m in this._indexById)if(this._indexById.hasOwnProperty(m)&&(l=this._indexById[m],q=l.name(),a.time("checkIndexMatch: "+q),h=l.match(b,f),p=l.lookup(b,f),0<h.matchedKeyCount&&d.indexMatch.push({lookup:p,keyData:h,index:l}),a.time("checkIndexMatch: "+q),h.totalKeyCount===h.matchedKeyCount))break;a.time("checkIndexes");1<d.indexMatch.length&&(a.time("findOptimalIndex"),d.indexMatch.sort(function(b,a){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?
1:b.keyData.matchedKeyCount===a.keyData.matchedKeyCount?b.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),a.time("findOptimalIndex"));if(f.join){d.hasJoin=!0;for(a=0;a<f.join.length;a++)for(e in f.join[a])f.join[a].hasOwnProperty(e)&&(g.push(e),"$as"in f.join[a][e]?k.push(f.join[a][e].$as):k.push(e));for(e=0;e<k.length;e++)if(f=this._queryReferencesCollection(b,k[e],""))d.joinQueries[g[e]]=f,d.queriesJoin=!0;d.joinsOn=g;d.queriesOn=d.queriesOn.concat(g)}return d};
d.prototype._queryReferencesCollection=function(b,a,c){for(var d in b)if(b.hasOwnProperty(d)){if(d===a)return c&&(c+="."),c+d;if("object"===typeof b[d])return c&&(c+="."),c+=d,this._queryReferencesCollection(b[d],a,c)}return!1};d.prototype._match=function(b,a,c){var d,e;d=typeof b;e=typeof a;var g=!0,k;if(!("string"!==d&&"number"!==d||"string"!==e&&"number"!==e))b!==a&&(g=!1);else for(k in a)if(a.hasOwnProperty(k)){d=!1;if("$"===k.substr(0,1))switch(k){case "$gt":if(b>a[k]){if("or"===c)return!0}else g=
!1;d=!0;break;case "$gte":if(b>=a[k]){if("or"===c)return!0}else g=!1;d=!0;break;case "$lt":if(b<a[k]){if("or"===c)return!0}else g=!1;d=!0;break;case "$lte":if(b<=a[k]){if("or"===c)return!0}else g=!1;d=!0;break;case "$exists":if(void 0===b!==a[k]){if("or"===c)return!0}else g=!1;d=!0;break;case "$or":d=!0;for(e=0;e<a[k].length;e++){if(this._match(b,a[k][e],"and"))return!0;g=!1}break;case "$and":d=!0;for(e=0;e<a[k].length;e++)if(!this._match(b,a[k][e],"and"))return!1;break;case "$in":if(a[k]instanceof
Array){d=a[k];e=d.length;var h,l=!1;for(h=0;h<e;h++)if(d[h]===b){l=!0;break}if(l){if("or"===c)return!0}else g=!1}else throw"Cannot use a $nin operator on a non-array key: "+k;d=!0;break;case "$nin":if(a[k]instanceof Array){d=a[k];e=d.length;l=!0;for(h=0;h<e;h++)if(d[h]===b){l=!1;break}if(l){if("or"===c)return!0}else g=!1}else throw"Cannot use a $nin operator on a non-array key: "+k;d=!0;break;case "$ne":if(b!=a[k]){if("or"===c)return!0}else g=!1;d=!0}if(!d&&a[k]instanceof RegExp)if(d=!0,"object"===
typeof b&&void 0!==b[k]&&a[k].test(b[k])){if("or"===c)return!0}else g=!1;if(!d)if("object"===typeof a[k])if(void 0!==b[k]){if(b[k]instanceof Array&&!(a[k]instanceof Array))for(d=!1,e=0;e<b[k].length&&!(d=this._match(b[k][e],a[k],void 0));e++);else if(!(b[k]instanceof Array)&&a[k]instanceof Array)for(d=!1,e=0;e<a[k].length&&!(d=this._match(b[k],a[k][e],void 0));e++);else d="object"===typeof b?this._match(b[k],a[k],void 0):this._match(void 0,a[k],void 0);if(d){if("or"===c)return!0}else g=!1}else if(a[k]&&
void 0!==a[k].$exists)if(d=this._match(void 0,a[k],void 0)){if("or"===c)return!0}else g=!1;else g=!1;else if(b&&b[k]===a[k]){if("or"===c)return!0}else if(b&&b[k]&&b[k]instanceof Array&&a[k]&&"object"!==typeof a[k]){d=!1;for(e=0;e<b[k].length&&!(d=this._match(b[k][e],a[k],void 0));e++);if(d){if("or"===c)return!0}else g=!1}else g=!1;if("and"===c&&!g)return!1}return g};d.prototype.count=function(b,a){return b?this.find(b,a).length:this._data.length};d.prototype.link=function(b,a){if(window.jQuery){this._links=
this._links||{};var c,d;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template),d=a.template):c=a;if(!this._links[c]){if(jQuery(b).length){if(!jQuery.templates[c]){if(!d)if(d=jQuery(a),d.length)d=jQuery(d[0]).html();else throw"Unable to bind collection to target because template does not exist: "+a;jQuery.views.templates(c,d)}jQuery.templates[c].link(b,this._data);this._links[c]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+
this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.unlink=function(b,a){if(window.jQuery){this._links=this._links||{};var c;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template)):c=a;if(this._links[c])return jQuery.templates[c].unlink(b),
delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.findSub=function(b,a,d,e){var k=new c(a);b=this.find(b);var g=b.length,h,l,q=this._db.collection("__FDB_temp_"+this.objectId()),p={parents:g,subDocTotal:0,
subDocs:[],pathFound:!1,err:""};for(h=0;h<g;h++)if(l=k.value(b[h])[0]){q.setData(l);l=q.find(d,e);if(e.returnFirst&&l.length)return l[0];p.subDocs.push(l);p.subDocTotal+=l.length;p.pathFound=!0}q.drop();if(e.noStats)return p.subDocs;p.pathFound||(p.err="No objects found in the parent documents with a matching path of: "+a);return p};d.prototype.insertIndexViolation=function(b){var a,c=this._indexByName,d,e;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(d in c)if(c.hasOwnProperty(d)&&
(e=c[d],e.unique()&&e.violation(b))){a=e;break}return a?a.name():!1};d.prototype.ensureIndex=function(b,a){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var c=new k(b,a,this),d={start:(new Date).getTime()};if(this._indexByName[c.name()])return{err:"Index with that name already exists"};if(this._indexById[c.id()])return{err:"Index with those keys already exists"};c.rebuild();this._indexByName[c.name()]=c;this._indexById[c.id()]=c;d.end=(new Date).getTime();d.total=d.end-
d.start;this._lastOp={type:"ensureIndex",stats:{time:d}};return{index:c,id:c.id(),name:c.name(),state:c.state()}};d.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};d.prototype.lastOp=function(){return this._metrics.list()};d.prototype.objectId=function(b){var a=Math.pow(10,17);if(b){var c=0,d=b.length,e;for(e=0;e<d;e++)c+=b.charCodeAt(e)*a;b=c.toString(16)}else g.idCounter++,b=(g.idCounter+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);
return b};d.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},c=this.primaryKey(),d,e,k,g;if(c===b.primaryKey()){d=b._data;g=d.length;for(e=0;e<g;e++)k=d[e],this._primaryIndex.get(k[c])?this._primaryCrc.get(k[c])!==b._primaryCrc.get(k[c])&&a.update.push(k):a.insert.push(k);d=this._data;g=d.length;for(e=0;e<g;e++)k=d[e],b._primaryIndex.get(k[c])||a.remove.push(k)}return a};h.prototype.collection=function(a,c){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+
a),this._collection[a]=this._collection[a]||(new d(a)).db(this),void 0!==c&&this._collection[a].primaryKey(c),this._collection[a];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(a){return Boolean(this._collection[a])};h.prototype.collections=function(){var a=[],c;for(c in this._collection)this._collection.hasOwnProperty(c)&&a.push({name:c,count:this._collection[c].count()});return a};p.exports=d},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,"./Overload":9,
"./Path":10,"./Shared":11}],3:[function(h,p,l){var g,a;g=h("./Shared.js");var e=function(){this.init.apply(this,arguments)};e.prototype.init=function(){this._collection={};this._debug={}};g.addModule("Core",e);g.inherit(e.prototype,g.chainSystem);l=h("./Overload.js");a=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");e.prototype._isServer=!1;e.prototype.isClient=function(){return!this._isServer};e.prototype.isServer=function(){return this._isServer};e.prototype.crc=h;e.prototype.isClient=function(){return!this._isServer};
e.prototype.isServer=function(){return this._isServer};e.prototype.decouple=function(a){return JSON.parse(JSON.stringify(a))};e.prototype.debug=new l([function(){return this._debug.all},function(a){return void 0!==a&&"boolean"===typeof a?(this._debug.all=a,this):this._debug.all},function(a,e){return void 0!==a?void 0!==e?(this._debug[a]=e,this):this._debug[a]:this._debug.all}]);e.prototype.arrayToCollection=function(c){return(new a).setData(c)};e.prototype.on=function(a,e){this._listeners=this._listeners||
{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(e);return this};e.prototype.off=function(a,e){if(a in this._listeners){var g=this._listeners[a],d=g.indexOf(e);-1<d&&g.splice(d,1)}return this};e.prototype.emit=function(a,e){this._listeners=this._listeners||{};if(a in this._listeners){var g=this._listeners[a],d=g.length,b;for(b=0;b<d;b++)g[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};e.prototype.objectId=function(a){var e,h,d=Math.pow(10,17),b;if(a){e=0;h=
a.length;for(b=0;b<h;b++)e+=a.charCodeAt(b)*d;a=e.toString(16)}else g.idCounter++,a=(g.idCounter+(Math.random()*d+Math.random()*d+Math.random()*d+Math.random()*d)).toString(16);return a};e.prototype.peek=function(a){var e,g,d=[],b=typeof a;for(e in this._collection)this._collection.hasOwnProperty(e)&&(g=this._collection[e],d="string"===b?d.concat(g.peek(a)):d.concat(g.find(a)));return d};e.prototype.peekCat=function(a){var e,g,d={},b,f=typeof a;for(e in this._collection)this._collection.hasOwnProperty(e)&&
(g=this._collection[e],(b="string"===f?g.peek(a):g.find(a))&&b.length&&(d[g.name()]=b));return d};p.exports=e},{"./Collection.js":2,"./Crc.js":4,"./Metrics.js":7,"./Overload.js":9,"./Shared.js":11}],4:[function(h,p,l){var g=function(){var a=[],e,c,g;for(c=0;256>c;c++){e=c;for(g=0;8>g;g++)e=e&1?3988292384^e>>>1:e>>>1;a[c]=e}return a}();p.exports=function(a){var e=-1,c;for(c=0;c<a.length;c++)e=e>>>8^g[(e^a.charCodeAt(c))&255];return(e^-1)>>>0}},{}],5:[function(h,p,l){l=h("./Shared");var g=h("./Path");
h=function(){this.init.apply(this,arguments)};h.prototype.init=function(a,e,c){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(e&&e.unique?e.unique:!1);void 0!==a&&this.keys(a);void 0!==c&&this.collection(c);this.name(e&&e.name?e.name:this._id)};l.addModule("Index",h);l.inherit(h.prototype,l.chainSystem);h.prototype.id=function(){return this._id};h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};h.prototype.data=
function(a){return void 0!==a?(this._data=a,this):this._data};h.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};h.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};h.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new g).parse(this._keys).length,this):this._keys};h.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};h.prototype.unique=function(a){return void 0!==a?(this._unique=
a,this):this._unique};h.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}).find(),e,c=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(e=0;e<c;e++)this.insert(a[e])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(a,e){var c,g;this._unique&&(c=this._itemHash(a,this._keys),this._uniqueLookup[c]=a);c=this._itemHashArr(a,this._keys);
for(g=0;g<c.length;g++)this.pushToPathValue(c[g],a)};h.prototype.remove=function(a,e){var c,g;this._unique&&(c=this._itemHash(a,this._keys),delete this._uniqueLookup[c]);c=this._itemHashArr(a,this._keys);for(g=0;g<c.length;g++)this.pullFromPathValue(c[g],a)};h.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};h.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};h.prototype.pushToPathValue=function(a,e){var c=this._data[a]=
this._data[a]||[];-1===c.indexOf(e)&&(c.push(e),this._size++,this.pushToCrossRef(e,c))};h.prototype.pullFromPathValue=function(a,e){var c=this._data[a],g;g=c.indexOf(e);-1<g&&(c.splice(g,1),this._size--,this.pullFromCrossRef(e,c));c.length||delete this._data[a]};h.prototype.pull=function(a){var e=a[this._collection.primaryKey()],c=this._crossRef[e],g,h=c.length,d;for(g=0;g<h;g++)d=c[g],this._pullFromArray(d,a);this._size--;delete this._crossRef[e]};h.prototype._pullFromArray=function(a,e){for(var c=
a.length;c--;)a[c]===e&&a.splice(c,1)};h.prototype.pushToCrossRef=function(a,e){var c=a[this._collection.primaryKey()];this._crossRef[c]=this._crossRef[c]||[];c=this._crossRef[c];-1===c.indexOf(e)&&c.push(e)};h.prototype.pullFromCrossRef=function(a,e){var c=a[this._collection.primaryKey()];delete this._crossRef[c]};h.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};h.prototype.match=function(a,e){return(new g).countObjectPaths(this._keys,a)};h.prototype._itemHash=
function(a,e){var c=new g,k,h="",d;k=c.parse(e);for(d=0;d<k.length;d++)h&&(h+="_"),h+=c.value(a,k[d].path).join(":");return h};h.prototype._itemKeyHash=function(a,e){var c=new g,k,h="",d;k=c.parse(e);for(d=0;d<k.length;d++)h&&(h+="_"),h+=c.keyValue(a,k[d].path);return h};h.prototype._itemHashArr=function(a,e){var c=new g,k,h=[],d,b,f,l;k=c.parse(e);for(f=0;f<k.length;f++)for(d=c.value(a,k[f].path),b=0;b<d.length;b++)if(0===f)h.push(d[b]);else for(l=0;l<h.length;l++)h[l]=h[l]+"_"+d[b];return h};p.exports=
h},{"./Path":10,"./Shared":11}],6:[function(h,p,l){h=h("./Shared");l=function(g){this.init.apply(this,arguments)};l.prototype.init=function(g){this._name=g;this._data={};this._primaryKey="_id"};h.addModule("KeyValueStore",l);h.inherit(l.prototype,h.chainSystem);l.prototype.name=function(g){return void 0!==g?(this._name=g,this):this._name};l.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey=g,this):this._primaryKey};l.prototype.truncate=function(){this._data={};return this};l.prototype.set=
function(g,a){this._data[g]=a?a:!0;return this};l.prototype.get=function(g){return this._data[g]};l.prototype.lookup=function(g){g=g[this._primaryKey];var a,e,c,k;if(g instanceof Array){e=g.length;k=[];for(a=0;a<e;a++)(c=this._data[g[a]])&&k.push(c);return k}if(g instanceof RegExp){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&g.test(a)&&k.push(this._data[a]);return k}if("object"===typeof g){if(g.$ne){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==g.$ne&&k.push(this._data[a]);
return k}if(g.$in&&g.$in instanceof Array){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<g.$in.indexOf(a)&&k.push(this._data[a]);return k}if(g.$nin&&g.$nin instanceof Array){k=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===g.$nin.indexOf(a)&&k.push(this._data[a]);return k}if(g.$or&&g.$or instanceof Array){k=[];for(a=0;a<g.$or.length;a++)k=k.concat(this.lookup(g.$or[a]));return k}}else return c=this._data[g],void 0!==c?[c]:[]};l.prototype.unSet=function(g){delete this._data[g];
return this};l.prototype.uniqueSet=function(g,a){return void 0===this._data[g]?(this._data[g]=a,!0):!1};p.exports=l},{"./Shared":11}],7:[function(h,p,l){l=h("./Shared");var g=h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};l.addModule("Metrics",h);l.inherit(h.prototype,l.chainSystem);h.prototype.create=function(a){a=new g(a);this._enabled&&this._data.push(a);return a};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=
function(){this._enabled=!1;return this};h.prototype.clear=function(){this._data=[];return this};h.prototype.list=function(){return this._data};p.exports=h},{"./Operation":8,"./Shared":11}],8:[function(h,p,l){l=h("./Shared");var g=h("./Path");h=function(a){this.pathSolver=new g;this.counter=0;this.init.apply(this,arguments)};h.prototype.init=function(a){this._data={operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};l.addModule("Operation",
h);l.inherit(h.prototype,l.chainSystem);h.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};h.prototype.log=function(a){if(a){var e=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);e&&(a.delta=a.time-e);return this}return this._data.log};h.prototype.time=function(a){if(void 0!==a){var e=this._data.time.process,e=e[a]=e[a]||{};e.startMs?(e.stopMs=(new Date).getTime(),e.totalMs=e.stopMs-e.startMs,
e.stepObj.totalMs=e.totalMs,delete e.stepObj):(e.startMs=(new Date).getTime(),e.stepObj={name:a},this._data.steps.push(e.stepObj));return this}return this._data.time};h.prototype.flag=function(a,e){if(void 0!==a&&void 0!==e)this._data.flag[a]=e;else return void 0!==a?this._data.flag[a]:this._data.flag};h.prototype.data=function(a,e,c){return void 0!==e?(this.pathSolver.set(this._data,a,e),this):this.pathSolver.get(this._data,a)};h.prototype.pushData=function(a,e,c){this.pathSolver.push(this._data,
a,e)};h.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};p.exports=h},{"./Path":10,"./Shared":11}],9:[function(h,p,l){l=function(g){if(g){var a,e=g.length;return function(){for(a=0;a<e;a++)if(g[a].length===arguments.length)return g[a].apply(this,arguments);return null}}return function(){}};h("./Shared").addModule("Overload",l);p.exports=l},{"./Shared":11}],10:[function(h,p,l){h=h("./Shared");l=function(g){this.init.apply(this,
arguments)};l.prototype.init=function(g){g&&this.path(g)};h.addModule("Path",l);h.inherit(l.prototype,h.chainSystem);l.prototype.path=function(g){return void 0!==g?(this._path=this.clean(g),this._pathParts=this._path.split("."),this):this._path};l.prototype.hasObjectPaths=function(g,a){var e=!0,c;for(c in g)if(g.hasOwnProperty(c)&&(void 0===a[c]||"object"===typeof g[c]&&(e=this.hasObjectPaths(g[c],a[c]),!e)))return!1;return e};l.prototype.countKeys=function(g){var a=0,e;for(e in g)g.hasOwnProperty(e)&&
void 0!==g[e]&&("object"!==typeof g[e]?a++:a+=this.countKeys(g[e]));return a};l.prototype.countObjectPaths=function(g,a){var e,c={},k=0,h=0,d;for(d in a)a.hasOwnProperty(d)&&("object"===typeof a[d]?(e=this.countObjectPaths(g[d],a[d]),c[d]=e.matchedKeys,h+=e.totalKeyCount,k+=e.matchedKeyCount):(h++,g&&g[d]&&"object"!==typeof g[d]?(c[d]=!0,k++):c[d]=!1));return{matchedKeys:c,matchedKeyCount:k,totalKeyCount:h}};l.prototype.parse=function(g,a){var e=[],c="",k,h,d;for(h in g)if(g.hasOwnProperty(h))if(c=
h,"object"===typeof g[h])if(a)for(k=this.parse(g[h],a),d=0;d<k.length;d++)e.push({path:c+"."+k[d].path,value:k[d].value});else for(k=this.parse(g[h]),d=0;d<k.length;d++)e.push({path:c+"."+k[d].path});else a?e.push({path:c,value:g[h]}):e.push({path:c});return e};l.prototype.parseArr=function(g,a){a=a||{};return this._parseArr(g,"",[],a)};l.prototype._parseArr=function(g,a,e,c){var h,l="";a=a||"";e=e||[];for(h in g)g.hasOwnProperty(h)&&(!c.ignore||c.ignore&&!c.ignore.test(h))&&(l=a?a+"."+h:h,"object"===
typeof g[h]?this._parseArr(g[h],l,e,c):e.push(l));return e};l.prototype.value=function(g,a){if(void 0!==g&&"object"===typeof g){var e,c,h,l,d=[],b;void 0!==a&&(a=this.clean(a),e=a.split("."));e=e||this._pathParts;c=e.length;h=g;for(b=0;b<c;b++){h=h[e[b]];if(l instanceof Array){for(c=0;c<l.length;c++)d=d.concat(this.value(l,c+"."+e[b]));return d}if(!h||"object"!==typeof h)break;l=h}return[h]}return[]};l.prototype.set=function(g,a,e){if(void 0!==g&&void 0!==a){var c;a=this.clean(a);a=a.split(".");c=
a.shift();a.length?(g[c]=g[c]||{},this.set(g[c],a.join("."),e)):g[c]=e}return g};l.prototype.get=function(g,a){return this.value(g,a)[0]};l.prototype.push=function(g,a,e){if(void 0!==g&&void 0!==a){var c;a=this.clean(a);a=a.split(".");c=a.shift();if(a.length)g[c]=g[c]||{},this.set(g[c],a.join("."),e);else if(g[c]=g[c]||[],g[c]instanceof Array)g[c].push(e);else throw"Cannot push to a path whose endpoint is not an array!";}return g};l.prototype.keyValue=function(g,a){var e,c,h,l,d;void 0!==a&&(a=this.clean(a),
e=a.split("."));e=e||this._pathParts;c=e.length;h=g;for(d=0;d<c;d++)if(h=h[e[d]],!h||"object"!==typeof h){l=e[d]+":"+h;break}return l};l.prototype.clean=function(g){"."===g.substr(0,1)&&(g=g.substr(1,g.length-1));return g};p.exports=l},{"./Shared":11}],11:[function(h,p,l){p.exports={idCounter:0,modules:{},addModule:function(g,a){this.modules[g]=a},inherit:function(g,a){for(var e in a)a.hasOwnProperty(e)&&(g[e]=a[e])},chainSystem:{chain:function(g){this._chain=this._chain||[];-1===this._chain.indexOf(g)&&
this._chain.push(g)},unChain:function(g){this._chain&&(g=this._chain.indexOf(g),-1<g&&this._chain.splice(g,1))},chainSend:function(g,a,e){if(this._chain){var c=this._chain,h=c.length,l;for(l=0;l<h;l++)c[l].chainReceive(this,g,a,e)}},chainReceive:function(g,a,e,c){(!this._chainHandler||this._chainHandler&&!this._chainHandler(g,a,e,c))&&this.chainSend(a,e,c)}}}},{}]},{},[1])(1)});
