!function(Oa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Oa();else if("function"==typeof define&&define.amd)define([],Oa);else{var g;"undefined"!=typeof window?g=window:"undefined"!=typeof global?g=global:"undefined"!=typeof self&&(g=self);g.ForerunnerDB=Oa()}}(function(){return function g(n,k,e){function a(b,c){if(!k[b]){if(!n[b]){var f="function"==typeof require&&require;if(!c&&f)return f(b,!0);if(d)return d(b,!0);f=Error("Cannot find module '"+b+"'");throw f.code="MODULE_NOT_FOUND",
f;}f=k[b]={exports:{}};n[b][0].call(f.exports,function(h){var I=n[b][1][h];return a(I?I:h)},f,f.exports,g,n,k,e)}return k[b].exports}for(var d="function"==typeof require&&require,c=0;c<e.length;c++)a(e[c]);return a}({1:[function(g,n,k){k=g("../lib/Core");g("../lib/CollectionGroup");g("../lib/View");g("../lib/Highcharts");g("../lib/Persist");g("../lib/vendor/jsviews");n.exports=k;window.ForerunnerDB=k},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Highcharts":6,"../lib/Persist":13,"../lib/View":15,
"../lib/vendor/jsviews":16}],2:[function(g,n,k){var e,a,d,c,b,l;e=g("./Shared");var f=function(h){this.init.apply(this,arguments)};f.prototype.init=function(h){this._primaryKey="_id";this._primaryIndex=new d("primary");this._primaryCrc=new d("primaryCrc");this._crcLookup=new d("crcLookup");this._name=h;this._data=[];this._groups=[];this._metrics=new a;this._linked=0;this._debug={};this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};
this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};e.modules.Collection=f;k=g("./Overload");a=g("./Metrics");d=g("./KeyValueStore");c=g("./Path");b=g("./Index");l=g("./Crc");g=e.modules.Core;f.prototype.debug=new k([function(){return this._debug.all},function(h){if(void 0!==h){if("boolean"===typeof h){this._debug.all=h;for(var I=0;I<this._views.length;I++)this._views[I].debug(h);return this}return this._debug[h]||this._db&&this._db._debug&&this._db._debug[h]||this._debug.all}return this._debug.all},
function(h,I){if(void 0!==h){if(void 0!==I){this._debug[h]=I;for(var b=0;b<this._views.length;b++)this._views[b].debug(h,I);return this}return this._debug[h]||this._db&&this._db._debug&&this._db._debug[h]}return this._debug.all}]);f.prototype.crc=l;f.prototype.name=function(h){return void 0!==h?(this._name=h,this):this._name};f.prototype.on=new k([function(h,I){this._listeners=this._listeners||{};this._listeners[h]=this._listeners[h]||{};this._listeners[h]["*"]=this._listeners[h]["*"]||[];this._listeners[h]["*"].push(I);
return this},function(h,I,b){this._listeners=this._listeners||{};this._listeners[h]=this._listeners[h]||{};this._listeners[h][I]=this._listeners[h][I]||[];this._listeners[h][I].push(b);return this}]);f.prototype.off=new k([function(h){this._listeners&&this._listeners[h]&&h in this._listeners&&delete this._listeners[h];return this},function(h,I){var b,a;"string"===typeof I?this._listeners&&this._listeners[h]&&this._listeners[h][I]&&delete this._listeners[h][I]:h in this._listeners&&(b=this._listeners[h]["*"],
a=b.indexOf(I),-1<a&&b.splice(a,1));return this},function(h,b,a){this._listeners&&h in this._listeners&&(h=this._listeners[h][b],a=h.indexOf(a),-1<a&&h.splice(a,1))}]);f.prototype.emit=function(h,b){this._listeners=this._listeners||{};if(h in this._listeners){if(this._listeners[h]["*"]){var a=this._listeners[h]["*"],d=a.length,c;for(c=0;c<d;c++)a[c].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var a=this._listeners[h],f,l,d=b.length;for(c=
0;c<d;c++)if(a[b[c][this._primaryKey]])for(f=a[b[c][this._primaryKey]].length,l=0;l<f;l++)a[b[c][this._primaryKey]][l].apply(this,Array.prototype.slice.call(arguments,1))}}return this};f.prototype.drop=function(){if(this._db&&this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var h=[],b;for(b=0;b<this._groups.length;b++)h.push(this._groups[b]);for(b=0;b<h.length;b++)this._groups[b].removeCollection(this);return!0}return!1};
f.prototype.primaryKey=function(h){return void 0!==h?(this._primaryKey=h,this._primaryIndex.primaryKey(h),this._rebuildPrimaryKeyIndex(),this):this._primaryKey};f.prototype._onInsert=function(h,b){this.emit("insert",h,b)};f.prototype._onUpdate=function(h){this.emit("update",h)};f.prototype._onRemove=function(h){this.emit("remove",h)};f.prototype.db=function(h){return void 0!==h?(this._db=h,this):this._db};f.prototype.setData=function(h,b,a){if(h){var d=this._metrics.create("setData");d.start();b=
b||{};b.decouple=void 0!==b.decouple?b.decouple:!0;b.decouple&&(h=this.decouple(h));h instanceof Array||(h=[h]);d.time("transformIn");h=this.transformIn(h);d.time("transformIn");var c=this._data;this._data=[];h.length&&(this._data=this._data.concat(h));d.time("_rebuildPrimaryKeyIndex");this._rebuildPrimaryKeyIndex(b);d.time("_rebuildPrimaryKeyIndex");d.stop();this.emit("setData",this._data,c)}a&&a(!1);return this};f.prototype._rebuildPrimaryKeyIndex=function(h){var b=h&&void 0!==h.ensureKeys?h.ensureKeys:
!0;h=h&&void 0!==h.violationCheck?h.violationCheck:!0;var a,d,c,f=this._primaryIndex,l=this._primaryCrc,e=this._crcLookup,g=this._primaryKey,k;f.truncate();l.truncate();e.truncate();a=this._data;for(d=a.length;d--;)if(c=a[d],b&&this._ensurePrimaryKey(c),h){if(!f.uniqueSet(c[g],c))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+c[this._primaryKey];}else k=JSON.stringify(c),f.set(c[g],c),l.set(c[g],k),
e.set(k,c)};f.prototype._ensurePrimaryKey=function(h){void 0===h[this._primaryKey]&&(h[this._primaryKey]=this.objectId())};f.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};f.prototype.upsert=function(h,b){if(h){var a=this._deferQueue.upsert,d=this._deferThreshold.upsert,c={},f;if(h instanceof Array){if(h.length>d){this._deferQueue.upsert=a.concat(h);this.processQueue("upsert",b);return}c=[];for(a=0;a<h.length;a++)c.push(this.upsert(h[a]));
b&&b();return c}h[this._primaryKey]?(f={},f[this._primaryKey]=h[this._primaryKey],this.count(f)?c.op="update":c.op="insert"):c.op="insert";switch(c.op){case "insert":c.result=this.insert(h);break;case "update":c.result=this.update(f,h)}return c}b&&b()};f.prototype.update=function(h,b,a){b=this.decouple(b);b=this.transformIn(b);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var d=this,c=this._metrics.create("update"),f=this._primaryKey,l,e,g=function(c){if(b&&
void 0!==b[f]&&b[f]!=c[f]){d._primaryIndex.unSet(c[f]);var l=d._updateObject(c,b,h,a,"");if(d._primaryIndex.uniqueSet(c[f],c))return l;throw"Primary key violation in update! Key violated: "+c[f];}return d._updateObject(c,b,h,a,"")},k=this._views;c.start();c.time("Retrieve documents to update");l=this.find(h,{decouple:!1});c.time("Retrieve documents to update");if(l.length&&(c.time("Update documents"),e=l.filter(g),c.time("Update documents"),e.length)){if(k&&k.length){this.debug("views")&&console.log("Updating views from collection: "+
this.name());c.time("Inform views of update");for(l=0;l<k.length;l++)k[l].update(h,b);c.time("Inform views of update")}this._onUpdate(e);this.deferEmit("change",{type:"update",data:e})}c.stop();return e||[]};f.prototype.updateById=function(h,b){var a={};a[this._primaryKey]=h;return this.update(a,b)};f.prototype._updateObject=function(h,b,a,d,f,l){b=this.decouple(b);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));var e=!1,g=!1,k,q,p,m;for(m in b)if(b.hasOwnProperty(m)){k=!1;if("$"===m.substr(0,
1))switch(m){case "$index":break;default:k=!0,(g=this._updateObject(h,b[m],a,d,f,m))&&(e=!0)}if(this._isPositionalKey(m)&&(k=!0,m=m.substr(0,m.length-2),g=new c(f+"."+m),h[m]&&h[m]instanceof Array&&h[m].length)){q=[];for(p=0;p<h[m].length;p++)this._match(h[m][p],g.value(a)[0])&&q.push(p);for(p=0;p<q.length;p++)(g=this._updateObject(h[m][q[p]],b[m+".$"],a,d,f+"."+m,l))&&(e=!0)}if(!k)if(l||"object"!==typeof b[m])switch(l){case "$inc":this._updateIncrement(h,m,b[m]);e=!0;break;case "$push":void 0===
h[m]&&(h[m]=[]);if(h[m]instanceof Array){if(void 0!==b[m].$position&&b[m].$each instanceof Array)for(g=b[m].$position,k=b[m].$each.length,p=0;p<k;p++)this._updateSplicePush(h[m],g+p,b[m].$each[p]);else if(b[m].$each instanceof Array)for(k=b[m].$each.length,p=0;p<k;p++)this._updatePush(h[m],b[m].$each[p]);else this._updatePush(h[m],b[m]);e=!0}else throw"Cannot push to a key that is not an array! ("+m+")";break;case "$pull":if(h[m]instanceof Array){q=[];for(p=0;p<h[m].length;p++)this._match(h[m][p],
b[m])&&q.push(p);for(k=q.length;k--;)this._updatePull(h[m],q[k]),e=!0}break;case "$pullAll":if(h[m]instanceof Array)if(b[m]instanceof Array){if(q=h[m],k=q.length,0<k)for(;k--;){for(g=0;g<b[m].length;g++)q[k]===b[m][g]&&(this._updatePull(h[m],k),k--,e=!0);if(0>k)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+m+")";break;case "$addToSet":void 0===h[m]&&(h[m]=[]);if(h[m]instanceof Array){p=h[m];var s;q=p.length;var n;k=!0;s=d&&d.$addToSet;var W;s&&s.key?(g=!1,W=new c(s.key),
n=W.value(b[m])[0]):(n=JSON.stringify(b[m]),g=!0);for(s=0;s<q;s++)if(g){if(JSON.stringify(p[s])===n){k=!1;break}}else if(n===W.value(p[s])[0]){k=!1;break}k&&(this._updatePush(h[m],b[m]),e=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===h[m]&&(h[m]=[]);if(h[m]instanceof Array)if(g=b.$index,void 0!==g)delete b.$index,this._updateSplicePush(h[m],g,b[m]),e=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+
m+")";break;case "$move":if(h[m]instanceof Array)for(p=0;p<h[m].length;p++){if(this._match(h[m][p],b[m])){e=b[m].$index;if(void 0!==e)this._updateSpliceMove(h[m],p,e),e=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+m+")";break;case "$mul":this._updateMultiply(h,m,b[m]);e=!0;break;case "$rename":this._updateRename(h,m,b[m]);e=!0;break;case "$unset":this._updateUnset(h,m);e=!0;break;case "$pop":if(h[m]instanceof Array)this._updatePop(h[m],
b[m])&&(e=!0);else throw"Cannot pop from a key that is not an array! ("+m+")";break;default:h[m]!==b[m]&&(this._updateProperty(h,m,b[m]),e=!0)}else if(null!==h[m]&&"object"===typeof h[m])if(p=h[m]instanceof Array,q=b[m]instanceof Array,p||q)if(!q&&p)for(p=0;p<h[m].length;p++)(g=this._updateObject(h[m][p],b[m],a,d,f+"."+m,l))&&(e=!0);else h[m]!==b[m]&&(this._updateProperty(h,m,b[m]),e=!0);else(g=this._updateObject(h[m],b[m],a,d,f+"."+m,l))&&(e=!0);else h[m]!==b[m]&&(this._updateProperty(h,m,b[m]),
e=!0)}return e};f.prototype._isPositionalKey=function(h){return".$"===h.substr(h.length-2,2)};f.prototype._updateProperty=function(h,b,a){this._linked?(jQuery.observable(h).setProperty(b,a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+b+'" for collection "'+this.name()+'"')):(h[b]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+b+'" for collection "'+this.name()+'"'))};f.prototype._updateIncrement=function(b,
a,c){this._linked?jQuery.observable(b).setProperty(a,b[a]+c):b[a]+=c};f.prototype._updateSpliceMove=function(b,a,c){this._linked?(jQuery.observable(b).move(a,c),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+a+'" to "'+c+'" for collection "'+this.name()+'"')):(b.splice(c,0,b.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+a+'" to "'+c+'" for collection "'+this.name()+'"'))};f.prototype._updateSplicePush=
function(b,a,c){b.length>a?this._linked?jQuery.observable(b).insert(a,c):b.splice(a,0,c):this._linked?jQuery.observable(b).insert(c):b.push(c)};f.prototype._updatePush=function(b,a){this._linked?jQuery.observable(b).insert(a):b.push(a)};f.prototype._updatePull=function(b,a){this._linked?jQuery.observable(b).remove(a):b.splice(a,1)};f.prototype._updateMultiply=function(b,a,c){this._linked?jQuery.observable(b).setProperty(a,b[a]*c):b[a]*=c};f.prototype._updateRename=function(b,a,c){var d=b[a];this._linked?
(jQuery.observable(b).setProperty(c,d),jQuery.observable(b).removeProperty(a)):(b[c]=d,delete b[a])};f.prototype._updateUnset=function(b,a){this._linked?jQuery.observable(b).removeProperty(a):delete b[a]};f.prototype._updatePop=function(b,a){var c,d=!1;0<b.length&&(this._linked?(1===a?c=b.length-1:-1===a&&(c=0),-1<c&&(jQuery.observable(arr).remove(c),d=!0)):1===a?(b.pop(),d=!0):-1===a&&(b.shift(),d=!0));return d};f.prototype.remove=function(b){var a,c,d=this._views,f;if(b instanceof Array){d=[];for(a=
0;a<b.length;a++)d.push(this.remove(b[a]));return d}a=this.find(b,{decouple:!1});if(a.length){for(f=0;f<a.length;f++)c=a[f],this._removeIndex(c),c=this._data.indexOf(c),this._linked?jQuery.observable(this._data).remove(c):this._data.splice(c,1);if(d&&d.length)for(f=0;f<d.length;f++)d[f].remove(b);this._onRemove(a);this.deferEmit("change",{type:"remove",data:a})}return a};f.prototype.removeById=function(b){var a={};a[this._primaryKey]=b;return this.remove(a)};f.prototype.deferEmit=function(){var b=
this,a;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(a=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+a[0]);b.emit.apply(b,a)},100))};f.prototype.processQueue=function(b,a){var c=this._deferQueue[b],d=this._deferThreshold[b],f=this._deferTime[b];if(c.length){var l=this;c.length&&(c=c.length>d?c.splice(0,d):c.splice(0,c.length),this[b](c));
setTimeout(function(){l.processQueue(b,a)},f)}else a&&a()};f.prototype.insert=function(b,a,c){"function"===typeof a?(c=a,a=this._data.length):void 0===a&&(a=this._data.length);b=this.transformIn(b);return this._insertHandle(b,a,c)};f.prototype._insertHandle=function(b,a,c){var d=this._deferQueue.insert,f=this._deferThreshold.insert,l=[],e=[],g=this._views;if(b instanceof Array){if(b.length>f){this._deferQueue.insert=d.concat(b);this.processQueue("insert",c);return}for(f=0;f<b.length;f++)d=this._insert(b[f],
a+f),!0===d?l.push(b[f]):e.push({doc:b[f],reason:d})}else d=this._insert(b,a),!0===d?l.push(b):e.push({doc:b,reason:d});if(g&&g.length)for(d=0;d<g.length;d++)g[d].insert(b,a);this._onInsert(l,e);c&&c();this.deferEmit("change",{type:"insert",data:l});return{inserted:l,failed:e}};f.prototype._insert=function(b,a){if(b){var c;this._ensurePrimaryKey(b);if(c=this.insertIndexViolation(b))return"Index violation in index: "+c;this._insertIndex(b);this._linked?jQuery.observable(this._data).insert(a,b):this._data.splice(a,
0,b);return!0}return"No document passed to insert"};f.prototype._insertIndex=function(b){var a=this._indexByName,c,d=JSON.stringify(b);this._primaryIndex.uniqueSet(b[this._primaryKey],b);this._primaryCrc.uniqueSet(b[this._primaryKey],d);this._crcLookup.uniqueSet(d,b);for(c in a)a.hasOwnProperty(c)&&a[c].insert(b)};f.prototype._removeIndex=function(b){var a=this._indexByName,c,d=JSON.stringify(b);this._primaryIndex.unSet(b[this._primaryKey]);this._primaryCrc.unSet(b[this._primaryKey]);this._crcLookup.unSet(d);
for(c in a)a.hasOwnProperty(c)&&a[c].remove(b)};f.prototype.subset=function(b,a){var c=this.find(b,a);return(new f)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};f.prototype.subsetOf=function(){return this.__subsetOf};f.prototype._subsetOf=function(b){this.__subsetOf=b;return this};f.prototype.distinct=function(b,a,d){a=this.find(a,d);b=new c(b);d={};var f=[],l,e;for(e=0;e<a.length;e++)(l=b.value(a[e])[0])&&!d[l]&&(d[l]=!0,f.push(l));return f};f.prototype.decouple=function(b){return JSON.parse(JSON.stringify(b))};
f.prototype.findById=function(b,a){var c={};c[this._primaryKey]=b;return this.find(c,a)[0]};f.prototype.peek=function(b,a){var c=this._data,d=c.length,l,e,g=new f;if("string"===typeof b){for(l=0;l<d;l++)e=JSON.stringify(c[l]),-1<e.indexOf(b)&&g.insert(c[l]);return g.find({},a)}return this.find(b,a)};f.prototype.explain=function(b,a){return this.find(b,a).__fdbOp._data};f.prototype.find=function(b,a){b=b||{};a=a||{};a.decouple=void 0!==a.decouple?a.decouple:!0;var d=this._metrics.create("find"),f=
this,l,e=!0,g,k,n,q,p,m,s,Ea,W,aa=[];k=function(a){return f._match(a,b,"and")};d.start();if(b){d.time("analyseQuery");l=this._analyseQuery(b,a,d);d.time("analyseQuery");d.data("analysis",l);if(l.hasJoin&&l.queriesJoin){d.time("joinReferences");for(n=0;n<l.joinsOn.length;n++)p=l.joinsOn[n],q=new c(l.joinQueries[p]),q=q.value(b)[0],this._db.collection(l.joinsOn[n]).subset(q);d.time("joinReferences")}l.indexMatch.length&&(!a||a&&!a.skipIndex)?(d.data("index.potential",l.indexMatch),d.data("index.used",
l.indexMatch[0].index),d.time("indexLookup"),g=l.indexMatch[0].lookup,d.time("indexLookup"),l.indexMatch[0].keyData.totalKeyCount===l.indexMatch[0].keyData.matchedKeyCount&&(e=!1)):d.flag("usedIndex",!1);e&&(g&&g.length?(l=g.length,d.time("tableScan: "+l),g=g.filter(k)):(l=this._data.length,d.time("tableScan: "+l),g=this._data.filter(k)),a.sort&&(d.time("sort"),g=this.sort(a.sort,g),d.time("sort")),d.time("tableScan: "+l));a.limit&&g&&g.length>a.limit&&(g.length=a.limit,d.data("limit",a.limit));a.decouple&&
(d.time("decouple"),g=this.decouple(g),d.time("decouple"),d.data("flag.decouple",!0));if(a.join){for(k=0;k<a.join.length;k++)for(p in a.join[k])if(a.join[k].hasOwnProperty(p))for(Ea=p,l=this._db.collection(p),e=a.join[k][p],W=0;W<g.length;W++){s={};q=n=!1;for(m in e)if(e.hasOwnProperty(m))if("$"===m.substr(0,1))switch(m){case "$as":Ea=e[m];break;case "$multi":n=e[m];break;case "$require":q=e[m];break;default:m.substr(0,3)}else s[m]=(new c(e[m])).value(g[W])[0];s=l.find(s);!q||q&&s[0]?g[W][Ea]=!1===
n?s[0]:s:aa.push(g[W])}d.data("flag.join",!0)}if(aa.length){d.time("removalQueue");for(m=0;m<aa.length;m++)p=g.indexOf(aa[m]),-1<p&&g.splice(p,1);d.time("removalQueue")}if(a.transform){d.time("transform");for(m=0;m<g.length;m++)g.splice(m,1,a.transform(g[m]));d.time("transform");d.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(d.time("transformOut"),g=this.transformOut(g),d.time("transformOut"));d.data("results",g.length);d.stop()}else d.stop(),g=[];g.__fdbOp=d;return g};f.prototype.transform=
function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this._transformEnabled=b.enabled),void 0!==b.dataIn&&(this._transformIn=b.dataIn),void 0!==b.dataOut&&(this._transformOut=b.dataOut)):this._transformEnabled=!1===b?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};f.prototype.transformIn=function(b){if(this._transformEnabled&&this._transformIn){if(b instanceof Array){var a=[],d;for(d=0;d<b.length;d++)a[d]=this._transformIn(b[d]);
return a}return this._transformIn(b)}return b};f.prototype.transformOut=function(b){if(this._transformEnabled&&this._transformOut){if(b instanceof Array){var a=[],d;for(d=0;d<b.length;d++)a[d]=this._transformOut(b[d]);return a}return this._transformOut(b)}return b};f.prototype.sort=function(b,a){a=a||[];var d=[],c,f;for(c in b)b.hasOwnProperty(c)&&(f={},f[c]=b[c],f.___fdbKey=c,d.push(f));return 2>d.length?this._sort(b,a):this._bucketSort(d,a)};f.prototype._bucketSort=function(b,a){var d=b.shift(),
c,f,l=[];if(0<b.length){a=this._sort(d,a);c=this.bucket(d.___fdbKey,a);for(f in c)c.hasOwnProperty(f)&&(d=[].concat(b),l=l.concat(this._bucketSort(d,c[f])));return l}return this._sort(d,a)};f.prototype._sort=function(b,a){var d=new c,f=d.parse(b,!0)[0];d.path(f.path);return a.sort(1===f.value?function(b,a){var c=d.value(b)[0],h=d.value(a)[0];return"string"===typeof c&&"string"===typeof h?c.localeCompare(h):c>h?1:c<h?-1:0}:function(b,a){var c=d.value(b)[0],h=d.value(a)[0];return"string"===typeof c&&
"string"===typeof h?1===c.localeCompare(h)?-1:1:c>h?-1:c<h?1:0})};f.prototype.bucket=function(b,a){var d,c={};for(d=0;d<a.length;d++)c[a[d][b]]=c[a[d][b]]||[],c[a[d][b]].push(a[d]);return c};f.prototype._analyseQuery=function(b,a,d){var f={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:b,options:a},l,e=[],g=[],k,n,q,p,m;d.time("checkIndexes");void 0!==b[this._primaryKey]&&(d.time("checkIndexMatch: Primary Key"),k=new c,f.indexMatch.push({lookup:this._primaryIndex.lookup(b,
a),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:k.countKeys(b)},index:this._primaryIndex}),d.time("checkIndexMatch: Primary Key"));for(m in this._indexById)if(this._indexById.hasOwnProperty(m)&&(n=this._indexById[m],q=n.name(),d.time("checkIndexMatch: "+q),k=n.match(b,a),p=n.lookup(b,a),0<k.matchedKeyCount&&f.indexMatch.push({lookup:p,keyData:k,index:n}),d.time("checkIndexMatch: "+q),k.totalKeyCount===k.matchedKeyCount))break;d.time("checkIndexes");1<f.indexMatch.length&&
(d.time("findOptimalIndex"),f.indexMatch.sort(function(b,a){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?1:b.keyData.matchedKeyCount===a.keyData.matchedKeyCount?b.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),d.time("findOptimalIndex"));if(a.join){f.hasJoin=!0;for(d=0;d<a.join.length;d++)for(l in a.join[d])a.join[d].hasOwnProperty(l)&&(e.push(l),"$as"in a.join[d][l]?g.push(a.join[d][l].$as):
g.push(l));for(l=0;l<g.length;l++)if(a=this._queryReferencesCollection(b,g[l],""))f.joinQueries[e[l]]=a,f.queriesJoin=!0;f.joinsOn=e;f.queriesOn=f.queriesOn.concat(e)}return f};f.prototype._queryReferencesCollection=function(b,a,d){for(var c in b)if(b.hasOwnProperty(c)){if(c===a)return d&&(d+="."),d+c;if("object"===typeof b[c])return d&&(d+="."),d+=c,this._queryReferencesCollection(b[c],a,d)}return!1};f.prototype._match=function(b,a,d){var c,f;c=typeof b;f=typeof a;var l=!0,e;if(!("string"!==c&&"number"!==
c||"string"!==f&&"number"!==f))b!==a&&(l=!1);else for(e in a)if(a.hasOwnProperty(e)){c=!1;if("$"===e.substr(0,1))switch(e){case "$gt":if(b>a[e]){if("or"===d)return!0}else l=!1;c=!0;break;case "$gte":if(b>=a[e]){if("or"===d)return!0}else l=!1;c=!0;break;case "$lt":if(b<a[e]){if("or"===d)return!0}else l=!1;c=!0;break;case "$lte":if(b<=a[e]){if("or"===d)return!0}else l=!1;c=!0;break;case "$exists":if(void 0===b!==a[e]){if("or"===d)return!0}else l=!1;c=!0;break;case "$or":c=!0;for(f=0;f<a[e].length;f++){if(this._match(b,
a[e][f],"and"))return!0;l=!1}break;case "$and":c=!0;for(f=0;f<a[e].length;f++)if(!this._match(b,a[e][f],"and"))return!1;break;case "$in":if(a[e]instanceof Array){c=a[e];f=c.length;var g,k=!1;for(g=0;g<f;g++)if(c[g]===b){k=!0;break}if(k){if("or"===d)return!0}else l=!1}else throw"Cannot use a $nin operator on a non-array key: "+e;c=!0;break;case "$nin":if(a[e]instanceof Array){c=a[e];f=c.length;k=!0;for(g=0;g<f;g++)if(c[g]===b){k=!1;break}if(k){if("or"===d)return!0}else l=!1}else throw"Cannot use a $nin operator on a non-array key: "+
e;c=!0;break;case "$ne":if(b!=a[e]){if("or"===d)return!0}else l=!1;c=!0}if(!c&&a[e]instanceof RegExp)if(c=!0,"object"===typeof b&&void 0!==b[e]&&a[e].test(b[e])){if("or"===d)return!0}else l=!1;if(!c)if("object"===typeof a[e])if(void 0!==b[e]){if(b[e]instanceof Array&&!(a[e]instanceof Array))for(c=!1,f=0;f<b[e].length&&!(c=this._match(b[e][f],a[e],void 0));f++);else if(!(b[e]instanceof Array)&&a[e]instanceof Array)for(c=!1,f=0;f<a[e].length&&!(c=this._match(b[e],a[e][f],void 0));f++);else c="object"===
typeof b?this._match(b[e],a[e],void 0):this._match(void 0,a[e],void 0);if(c){if("or"===d)return!0}else l=!1}else if(a[e]&&void 0!==a[e].$exists)if(c=this._match(void 0,a[e],void 0)){if("or"===d)return!0}else l=!1;else l=!1;else if(b&&b[e]===a[e]){if("or"===d)return!0}else if(b&&b[e]&&b[e]instanceof Array&&a[e]&&"object"!==typeof a[e]){c=!1;for(f=0;f<b[e].length&&!(c=this._match(b[e][f],a[e],void 0));f++);if(c){if("or"===d)return!0}else l=!1}else l=!1;if("and"===d&&!l)return!1}return l};f.prototype.count=
function(b,a){return b?this.find(b,a).length:this._data.length};f.prototype.link=function(b,a){if(window.jQuery){this._links=this._links||{};if(!this._links[a]){if(jQuery(b).length){if(!jQuery.templates[a]){var d=jQuery(a);if(d.length)jQuery.views.templates(a,jQuery(d[0]).html());else throw"Unable to bind collection to target because template does not exist: "+a;}jQuery.templates[a].link(b,this._data);this._links[a]=b;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+
this.name()+'" to output target: '+b);return this}throw'Cannot bind view data to output target selector "'+b+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+b+" with the template: "+a;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};f.prototype.unlink=function(b,a){if(window.jQuery){this._links=this._links||{};if(this._links[a])return jQuery.templates[a].unlink(b),delete this._links[a],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+
this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};f.prototype.findSub=function(b,a,d,f){var l=new c(a);b=this.find(b);var e=b.length,g,k,n=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:e,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(g=0;g<e;g++)if(k=l.value(b[g])[0]){n.setData(k);k=n.find(d,f);if(f.returnFirst&&
k.length)return k[0];q.subDocs.push(k);q.subDocTotal+=k.length;q.pathFound=!0}n.drop();if(f.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+a);return q};f.prototype.insertIndexViolation=function(b){var a,d=this._indexByName,c,f;if(this._primaryIndex.get(b[this._primaryKey]))a=this._primaryIndex;else for(c in d)if(d.hasOwnProperty(c)&&(f=d[c],f.unique()&&f.violation(b))){a=f;break}return a?a.name():!1};f.prototype.ensureIndex=function(a,
d){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var c=new b(a,d,this),f={start:(new Date).getTime()};if(this._indexByName[c.name()])return{err:"Index with that name already exists"};if(this._indexById[c.id()])return{err:"Index with those keys already exists"};c.rebuild();this._indexByName[c.name()]=c;this._indexById[c.id()]=c;f.end=(new Date).getTime();f.total=f.end-f.start;this._lastOp={type:"ensureIndex",stats:{time:f}};return{index:c,id:c.id(),name:c.name(),state:c.state()}};
f.prototype.index=function(b){if(this._indexByName)return this._indexByName[b]};f.prototype.lastOp=function(){return this._metrics.list()};f.prototype.objectId=function(b){var a=Math.pow(10,17);if(b){var d=0,c=b.length,f;for(f=0;f<c;f++)d+=b.charCodeAt(f)*a;b=d.toString(16)}else e.idCounter++,b=(e.idCounter+(Math.random()*a+Math.random()*a+Math.random()*a+Math.random()*a)).toString(16);return b};f.prototype.diff=function(b){var a={insert:[],update:[],remove:[]},d=this.primaryKey(),c,f,l,e;if(d===
b.primaryKey()){c=b._data;e=c.length;for(f=0;f<e;f++)l=c[f],this._primaryIndex.get(l[d])?this._primaryCrc.get(l[d])!==b._primaryCrc.get(l[d])&&a.update.push(l):a.insert.push(l);c=this._data;e=c.length;for(f=0;f<e;f++)l=c[f],b._primaryIndex.get(l[d])||a.remove.push(l)}return a};g.prototype.collection=function(b,a){if(b)return this._collection[b]||this.debug()&&console.log("Creating collection "+b),this._collection[b]=this._collection[b]||(new f(b)).db(this),void 0!==a&&this._collection[b].primaryKey(a),
this._collection[b];throw"Cannot get collection with undefined name!";};g.prototype.collectionExists=function(b){return Boolean(this._collection[b])};g.prototype.collections=function(){var b=[],a;for(a in this._collection)this._collection.hasOwnProperty(a)&&b.push({name:a,count:this._collection[a].count()});return b};n.exports=f},{"./Crc":5,"./Index":7,"./KeyValueStore":8,"./Metrics":9,"./Overload":11,"./Path":12,"./Shared":14}],3:[function(g,n,k){var e,a,d;k=g("./Shared");var c=function(){this.init.apply(this,
arguments)};c.prototype.init=function(b){var a=this;this._name=b;this._collectionArr=[];this._views=[];this._onCollectionInsert=function(){a._onInsert.apply(a,arguments)};this._onCollectionUpdate=function(){a._onUpdate.apply(a,arguments)};this._onCollectionRemove=function(){a._onRemove.apply(a,arguments)};this._onCollectionChange=function(){a._onChange.apply(a,arguments)}};k.modules.CollectionGroup=c;a=g("./Collection");d=g("./Overload");g=k.modules.Core;e=k.modules.Core.prototype.init;c.prototype.on=
new d([function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b]["*"]=this._listeners[b]["*"]||[];this._listeners[b]["*"].push(a);return this},function(b,a,d){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||{};this._listeners[b][a]=this._listeners[b][a]||[];this._listeners[b][a].push(d);return this}]);c.prototype.off=new d([function(b){this._listeners&&this._listeners[b]&&b in this._listeners&&delete this._listeners[b];
return this},function(b,a){var d,c;"string"===typeof a?this._listeners&&this._listeners[b]&&this._listeners[b][a]&&delete this._listeners[b][a]:b in this._listeners&&(d=this._listeners[b]["*"],c=d.indexOf(a),-1<c&&d.splice(c,1));return this},function(b,a,d){this._listeners&&b in this._listeners&&(b=this._listeners[b][a],d=b.indexOf(d),-1<d&&b.splice(d,1))}]);c.prototype.emit=function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){if(this._listeners[b]["*"]){var d=this._listeners[b]["*"],
c=d.length,e;for(e=0;e<c;e++)d[e].apply(this,Array.prototype.slice.call(arguments,1))}if(a instanceof Array&&a[0]&&a[0][this._primaryKey]){var d=this._listeners[b],g,k,c=a.length;for(e=0;e<c;e++)if(d[a[e][this._primaryKey]])for(g=d[a[e][this._primaryKey]].length,k=0;k<g;k++)d[a[e][this._primaryKey]][k].apply(this,Array.prototype.slice.call(arguments,1))}}return this};c.prototype.db=function(b){return void 0!==b?(this._db=b,this):this._db};c.prototype.addCollection=function(b){if(b&&-1===this._collectionArr.indexOf(b)){if(this._collectionArr.length){if(this._primaryKey!==
b.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this._primaryKey=b.primaryKey();this._collectionArr.push(b);b._groups.push(this);b.on("insert",this._onCollectionInsert);b.on("update",this._onCollectionUpdate);b.on("remove",this._onCollectionRemove);b.on("change",this._onCollectionChange)}return this};c.prototype.removeCollection=function(b){if(b){var a=this._collectionArr.indexOf(b);-1!==a&&(b.off("insert",this._onCollectionInsert),b.off("update",
this._onCollectionUpdate),b.off("remove",this._onCollectionRemove),b.off("change",this._onCollectionChange),this._collectionArr.splice(a,1),a=b._groups.indexOf(this),-1!==a&&b._groups.splice(a,1));0===this._collectionArr.length&&delete this._primaryKey}return this};c.prototype.find=function(b,d){var c=(new a).primaryKey(this._collectionArr[0].primaryKey()),e;for(e=0;e<this._collectionArr.length;e++)c.insert(this._collectionArr[e].find(b));return c.find(b,d)};c.prototype.insert=function(b,a){for(var d=
0;d<this._collectionArr.length;d++)this._collectionArr[d].insert(b,a)};c.prototype.update=function(b,a){for(var d=0;d<this._collectionArr.length;d++)this._collectionArr[d].update(b,a)};c.prototype.updateById=function(b,a){for(var d=0;d<this._collectionArr.length;d++)this._collectionArr[d].updateById(b,a)};c.prototype.remove=function(b){for(var a=0;a<this._collectionArr.length;a++)this._collectionArr[a].remove(b)};c.prototype.removeById=function(b){for(var a=0;a<this._collectionArr.length;a++)this._collectionArr[a].removeById(b)};
c.prototype._onInsert=function(b,a){this.emit("insert",b,a)};c.prototype._onUpdate=function(b,a){this.emit("update",b,a)};c.prototype._onRemove=function(b,a){this.emit("remove",b,a)};c.prototype._onChange=function(){this.emit("change")};c.prototype.subset=function(b,d){var c=this.find(b,d);return(new a)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};c.prototype.drop=function(){var b,a=[].concat(this._collectionArr),d=[].concat(this._views);this._debug&&console.log("Dropping collection group "+
this._name);for(b=0;b<a.length;b++)this.removeCollection(a[b]);for(b=0;b<d.length;b++)this._removeView(d[b]);this.emit("drop");return!0};g.prototype.init=function(){this._collectionGroup={};e.apply(this,arguments)};g.prototype.collectionGroup=function(b){return b?(this._collectionGroup[b]=this._collectionGroup[b]||(new c(b)).db(this),this._collectionGroup[b]):this._collectionGroup};n.exports=c},{"./Collection":2,"./Overload":11,"./Shared":14}],4:[function(g,n,k){var e,a;e=g("./Shared.js");var d=function(){this.init.apply(this,
arguments)};d.prototype.init=function(){this._collection={};this._debug={}};e.modules.Core=d;k=g("./Overload.js");a=g("./Collection.js");g("./Metrics.js");g=g("./Crc.js");d.prototype._isServer=!1;d.prototype.isClient=function(){return!this._isServer};d.prototype.isServer=function(){return this._isServer};d.prototype.crc=g;d.prototype.isClient=function(){return!this._isServer};d.prototype.isServer=function(){return this._isServer};d.prototype.decouple=function(a){return JSON.parse(JSON.stringify(a))};
d.prototype.debug=new k([function(){return this._debug.all},function(a){return void 0!==a&&"boolean"===typeof a?(this._debug.all=a,this):this._debug.all},function(a,b){return void 0!==a?void 0!==b?(this._debug[a]=b,this):this._debug[a]:this._debug.all}]);d.prototype.arrayToCollection=function(d){return(new a).setData(d)};d.prototype.on=function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);return this};d.prototype.off=function(a,b){if(a in
this._listeners){var d=this._listeners[a],f=d.indexOf(b);-1<f&&d.splice(f,1)}return this};d.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){var d=this._listeners[a],f=d.length,e;for(e=0;e<f;e++)d[e].apply(this,Array.prototype.slice.call(arguments,1))}return this};d.prototype.objectId=function(a){var b,d,f=Math.pow(10,17),h;if(a){b=0;d=a.length;for(h=0;h<d;h++)b+=a.charCodeAt(h)*f;a=b.toString(16)}else e.idCounter++,a=(e.idCounter+(Math.random()*f+Math.random()*
f+Math.random()*f+Math.random()*f)).toString(16);return a};d.prototype.peek=function(a){var b,d,f=[],e=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(d=this._collection[b],f="string"===e?f.concat(d.peek(a)):f.concat(d.find(a)));return f};d.prototype.peekCat=function(a){var b,d,f={},e,g=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(d=this._collection[b],(e="string"===g?d.peek(a):d.find(a))&&e.length&&(f[d.name()]=e));return f};n.exports=d},{"./Collection.js":2,
"./Crc.js":5,"./Metrics.js":9,"./Overload.js":11,"./Shared.js":14}],5:[function(g,n,k){var e=function(){var a=[],d,c,b;for(c=0;256>c;c++){d=c;for(b=0;8>b;b++)d=d&1?3988292384^d>>>1:d>>>1;a[c]=d}return a}();n.exports=function(a){var d=-1,c;for(c=0;c<a.length;c++)d=d>>>8^e[(d^a.charCodeAt(c))&255];return(d^-1)>>>0}},{}],6:[function(g,n,k){var e;g=g("./Shared");var a=function(a,c){this.init.apply(this,arguments)};a.prototype.init=function(a,c){this._options=c;this._selector=$(this._options.selector);
this._listeners={};this._collection=a;this._options.series=[];var b,e;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();b=this._collection.find();e={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};b=this.pieDataFromCollectionData(b,this._options.keyField,this._options.valField);
$.extend(e,this._options.seriesOptions);$.extend(e,{type:"pie",name:this._options.seriesName,data:b});this._chart.addSeries(e);break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=b.xAxis,this._options.chartOptions.series=b.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};g=g.modules.Collection;e=g.prototype.init;
a.prototype.pieDataFromCollectionData=function(a,c,b){var e=[],f;for(f=0;f<a.length;f++)e.push([a[f][c],a[f][b]]);return e};a.prototype.lineDataFromCollectionData=function(a,c,b,e){var f=this._collection.distinct(a),h=[],g={categories:[]},k,n,P,fa,ga;for(fa=0;fa<f.length;fa++){k=f[fa];n={};n[a]=k;P=[];n=this._collection.find(n,{orderBy:e});for(ga=0;ga<n.length;ga++)g.categories.push(n[ga][c]),P.push(n[ga][b]);h.push({name:k,data:P})}return{xAxis:g,series:h}};a.prototype._hookEvents=function(){this._collection.on("change",
this._changeListener);this._collection.on("drop",this._dropListener)};a.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var a=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField));break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);
for(var c=0;c<a.series.length;c++)this._chart.series[c].setData(a.series[c].data)}}};a.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};a.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];delete this._chart;delete this._options;delete this._collection;return this};
g.prototype.init=function(){this._highcharts={};e.apply(this,arguments)};g.prototype.chart=function(d){this._highcharts[d.selector]||(this._highcharts[d.selector]=new a(this,d));return this._highcharts[d.selector]};g.prototype.dropChart=function(a){this._highcharts[a]&&this._highcharts[a].drop()};n.exports=a},{"./Shared":14}],7:[function(g,n,k){k=g("./Shared");var e=g("./Path");g=function(){this.init.apply(this,arguments)};g.prototype.init=function(a,d,c){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,
a);this.data({});this.unique(d&&d.unique?d.unique:!1);void 0!==a&&this.keys(a);void 0!==c&&this.collection(c);this.name(d&&d.name?d.name:this._id)};k.modules.Index=g;g.prototype.id=function(){return this._id};g.prototype.state=function(){return this._state};g.prototype.size=function(){return this._size};g.prototype.data=function(a){return void 0!==a?(this._data=a,this):this._data};g.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};g.prototype.collection=function(a){return void 0!==
a?(this._collection=a,this):this._collection};g.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new e).parse(this._keys).length,this):this._keys};g.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};g.prototype.unique=function(a){return void 0!==a?(this._unique=a,this):this._unique};g.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},{decouple:!1,sort:this._keys}).find(),d,c=a.length;this._data={};this._unique&&
(this._uniqueLookup={});for(d=0;d<c;d++)this.insert(a[d])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};g.prototype.insert=function(a,d){var c,b;this._unique&&(c=this._itemHash(a,this._keys),this._uniqueLookup[c]=a);c=this._itemHashArr(a,this._keys);for(b=0;b<c.length;b++)this.pushToPathValue(c[b],a)};g.prototype.remove=function(a,d){var c,b;this._unique&&(c=this._itemHash(a,this._keys),delete this._uniqueLookup[c]);c=this._itemHashArr(a,
this._keys);for(b=0;b<c.length;b++)this.pullFromPathValue(c[b],a)};g.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};g.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};g.prototype.pushToPathValue=function(a,d){var c=this._data[a]=this._data[a]||[];-1===c.indexOf(d)&&(c.push(d),this._size++,this.pushToCrossRef(d,c))};g.prototype.pullFromPathValue=function(a,d){var c=this._data[a],b;b=c.indexOf(d);-1<b&&(c.splice(b,1),this._size--,
this.pullFromCrossRef(d,c));c.length||delete this._data[a]};g.prototype.pull=function(a){var d=a[this._collection.primaryKey()],c=this._crossRef[d],b,e=c.length,f;for(b=0;b<e;b++)f=c[b],this._pullFromArray(f,a);this._size--;delete this._crossRef[d]};g.prototype._pullFromArray=function(a,d){for(var c=a.length;c--;)a[c]===d&&a.splice(c,1)};g.prototype.pushToCrossRef=function(a,d){var c=a[this._collection.primaryKey()];this._crossRef[c]=this._crossRef[c]||[];c=this._crossRef[c];-1===c.indexOf(d)&&c.push(d)};
g.prototype.pullFromCrossRef=function(a,d){var c=a[this._collection.primaryKey()];delete this._crossRef[c]};g.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};g.prototype.match=function(a,d){return(new e).countObjectPaths(this._keys,a)};g.prototype._itemHash=function(a,d){var c=new e,b,l="",f;b=c.parse(d);for(f=0;f<b.length;f++)l&&(l+="_"),l+=c.value(a,b[f].path).join(":");return l};g.prototype._itemKeyHash=function(a,d){var c=new e,b,l="",f;b=c.parse(d);for(f=0;f<
b.length;f++)l&&(l+="_"),l+=c.keyValue(a,b[f].path);return l};g.prototype._itemHashArr=function(a,d){var c=new e,b,l=[],f,h,g,k;b=c.parse(d);for(g=0;g<b.length;g++)for(f=c.value(a,b[g].path),h=0;h<f.length;h++)if(0===g)l.push(f[h]);else for(k=0;k<l.length;k++)l[k]=l[k]+"_"+f[h];return l};n.exports=g},{"./Path":12,"./Shared":14}],8:[function(g,n,k){g=g("./Shared");k=function(e){this.init.apply(this,arguments)};k.prototype.init=function(e){this._name=e;this._data={};this._primaryKey="_id"};g.modules.KeyValueStore=
k;k.prototype.name=function(e){return void 0!==e?(this._name=e,this):this._name};k.prototype.primaryKey=function(e){return void 0!==e?(this._primaryKey=e,this):this._primaryKey};k.prototype.truncate=function(){this._data={};return this};k.prototype.set=function(e,a){this._data[e]=a?a:!0;return this};k.prototype.get=function(e){return this._data[e]};k.prototype.lookup=function(e){e=e[this._primaryKey];var a,d,c,b;if(e instanceof Array){d=e.length;b=[];for(a=0;a<d;a++)(c=this._data[e[a]])&&b.push(c);
return b}if(e instanceof RegExp){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&e.test(a)&&b.push(this._data[a]);return b}if("object"===typeof e){if(e.$ne){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==e.$ne&&b.push(this._data[a]);return b}if(e.$in&&e.$in instanceof Array){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<e.$in.indexOf(a)&&b.push(this._data[a]);return b}if(e.$nin&&e.$nin instanceof Array){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===e.$nin.indexOf(a)&&
b.push(this._data[a]);return b}if(e.$or&&e.$or instanceof Array){b=[];for(a=0;a<e.$or.length;a++)b=b.concat(this.lookup(e.$or[a]));return b}}else return c=this._data[e],void 0!==c?[c]:[]};k.prototype.unSet=function(e){delete this._data[e];return this};k.prototype.uniqueSet=function(e,a){return void 0===this._data[e]?(this._data[e]=a,!0):!1};n.exports=k},{"./Shared":14}],9:[function(g,n,k){k=g("./Shared");var e=g("./Operation");g=function(){this.init.apply(this,arguments)};g.prototype.init=function(){this._data=
[]};k.modules.Metrics=g;g.prototype.create=function(a){a=new e(a);this._enabled&&this._data.push(a);return a};g.prototype.start=function(){this._enabled=!0;return this};g.prototype.stop=function(){this._enabled=!1;return this};g.prototype.clear=function(){this._data=[];return this};g.prototype.list=function(){return this._data};n.exports=g},{"./Operation":10,"./Shared":14}],10:[function(g,n,k){k=g("./Shared");var e=g("./Path");g=function(a){this.pathSolver=new e;this.counter=0;this.init.apply(this,
arguments)};g.prototype.init=function(a){this._data={operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};k.modules.Operation=g;g.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};g.prototype.log=function(a){if(a){var d=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);d&&(a.delta=a.time-d);return this}return this._data.log};g.prototype.time=
function(a){if(void 0!==a){var d=this._data.time.process,d=d[a]=d[a]||{};d.startMs?(d.stopMs=(new Date).getTime(),d.totalMs=d.stopMs-d.startMs,d.stepObj.totalMs=d.totalMs,delete d.stepObj):(d.startMs=(new Date).getTime(),d.stepObj={name:a},this._data.steps.push(d.stepObj));return this}return this._data.time};g.prototype.flag=function(a,d){if(void 0!==a&&void 0!==d)this._data.flag[a]=d;else return void 0!==a?this._data.flag[a]:this._data.flag};g.prototype.data=function(a,d,c){return void 0!==d?(this.pathSolver.set(this._data,
a,d),this):this.pathSolver.get(this._data,a)};g.prototype.pushData=function(a,d,c){this.pathSolver.push(this._data,a,d)};g.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};n.exports=g},{"./Path":12,"./Shared":14}],11:[function(g,n,k){k=function(e){if(e){var a,d=e.length;return function(){for(a=0;a<d;a++)if(e[a].length===arguments.length)return e[a].apply(this,arguments);return null}}return function(){}};g("./Shared").modules.Overload=
k;n.exports=k},{"./Shared":14}],12:[function(g,n,k){g=g("./Shared");k=function(e){this.init.apply(this,arguments)};k.prototype.init=function(e){e&&this.path(e)};g.modules.Path=k;k.prototype.path=function(e){return void 0!==e?(this._path=this.clean(e),this._pathParts=this._path.split("."),this):this._path};k.prototype.hasObjectPaths=function(e,a){var d=!0,c;for(c in e)if(e.hasOwnProperty(c)&&(void 0===a[c]||"object"===typeof e[c]&&(d=this.hasObjectPaths(e[c],a[c]),!d)))return!1;return d};k.prototype.countKeys=
function(e){var a=0,d;for(d in e)e.hasOwnProperty(d)&&void 0!==e[d]&&("object"!==typeof e[d]?a++:a+=this.countKeys(e[d]));return a};k.prototype.countObjectPaths=function(e,a){var d,c={},b=0,l=0,f;for(f in a)a.hasOwnProperty(f)&&("object"===typeof a[f]?(d=this.countObjectPaths(e[f],a[f]),c[f]=d.matchedKeys,l+=d.totalKeyCount,b+=d.matchedKeyCount):(l++,e&&e[f]&&"object"!==typeof e[f]?(c[f]=!0,b++):c[f]=!1));return{matchedKeys:c,matchedKeyCount:b,totalKeyCount:l}};k.prototype.parse=function(e,a){var d=
[],c="",b,l,f;for(l in e)if(e.hasOwnProperty(l))if(c=l,"object"===typeof e[l])if(a)for(b=this.parse(e[l],a),f=0;f<b.length;f++)d.push({path:c+"."+b[f].path,value:b[f].value});else for(b=this.parse(e[l]),f=0;f<b.length;f++)d.push({path:c+"."+b[f].path});else a?d.push({path:c,value:e[l]}):d.push({path:c});return d};k.prototype.parseArr=function(e,a){a=a||{};return this._parseArr(e,"",[],a)};k.prototype._parseArr=function(e,a,d,c){var b,l="";a=a||"";d=d||[];for(b in e)e.hasOwnProperty(b)&&(!c.ignore||
c.ignore&&!c.ignore.test(b))&&(l=a?a+"."+b:b,"object"===typeof e[b]?this._parseArr(e[b],l,d,c):d.push(l));return d};k.prototype.value=function(e,a){if(void 0!==e&&"object"===typeof e){var d,c,b,l,f=[],h;void 0!==a&&(a=this.clean(a),d=a.split("."));d=d||this._pathParts;c=d.length;b=e;for(h=0;h<c;h++){b=b[d[h]];if(l instanceof Array){for(c=0;c<l.length;c++)f=f.concat(this.value(l,c+"."+d[h]));return f}if(!b||"object"!==typeof b)break;l=b}return[b]}return[]};k.prototype.set=function(e,a,d){if(void 0!==
e&&void 0!==a){var c;a=this.clean(a);a=a.split(".");c=a.shift();a.length?(e[c]=e[c]||{},this.set(e[c],a.join("."),d)):e[c]=d}return e};k.prototype.get=function(e,a){return this.value(e,a)[0]};k.prototype.push=function(e,a,d){if(void 0!==e&&void 0!==a){var c;a=this.clean(a);a=a.split(".");c=a.shift();if(a.length)e[c]=e[c]||{},this.set(e[c],a.join("."),d);else if(e[c]=e[c]||[],e[c]instanceof Array)e[c].push(d);else throw"Cannot push to a path whose endpoint is not an array!";}return e};k.prototype.keyValue=
function(e,a){var d,c,b,l,f;void 0!==a&&(a=this.clean(a),d=a.split("."));d=d||this._pathParts;c=d.length;b=e;for(f=0;f<c;f++)if(b=b[d[f]],!b||"object"!==typeof b){l=d[f]+":"+b;break}return l};k.prototype.clean=function(e){"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));return e};n.exports=k},{"./Shared":14}],13:[function(g,n,k){k=g("./Shared");var e,a,d,c;c=function(){this.init.apply(this,arguments)};c.prototype.init=function(b){b.isClient()&&void 0!==Storage&&this.mode("localStorage")};k.modules.Persist=
c;k=k.modules.Core;e=g("./Collection");a=e.prototype.drop;g("./CollectionGroup");g("./Overload");d=k.prototype.init;c.prototype.mode=function(b){return void 0!==b?(this._mode=b,this):this._mode};c.prototype.save=function(b,a,d){switch(this.mode()){case "localStorage":a="object"===typeof a?"json::fdb::"+JSON.stringify(a):"raw::fdb::"+a;try{localStorage.setItem(b,a)}catch(c){d&&d(c)}d&&d(!1)}d&&d("No data handler.")};c.prototype.load=function(b,a){var d,c;switch(this.mode()){case "localStorage":try{d=
localStorage.getItem(b)}catch(e){a(e,null)}if(d){d=d.split("::fdb::");switch(d[0]){case "json":c=JSON.parse(d[1]);break;case "raw":c=d[1]}a&&a(!1,c)}}a&&a("No data handler or unrecognised data type.")};c.prototype.drop=function(b,a){switch(this.mode()){case "localStorage":try{localStorage.removeItem(b)}catch(d){a&&a(d)}a&&a(!1)}a&&a("No data handler or unrecognised data type.")};e.prototype.drop=function(b){if(b)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),
"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";a.apply(this)};e.prototype.save=function(b){if(this._name)if(this._db)this._db.persist.save(this._name,this._data);else return b&&b("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";
else return b&&b("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};e.prototype.load=function(b){var a=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(d,c){if(d)return b&&b(d),d;c&&a.setData(c);b&&b(!1)});else return b&&b("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return b&&b("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};
k.prototype.init=function(){this.persist=new c(this);d.apply(this,arguments)};n.exports=c},{"./Collection":2,"./CollectionGroup":3,"./Overload":11,"./Shared":14}],14:[function(g,n,k){n.exports={idCounter:0,modules:{},prototypes:{}}},{}],15:[function(g,n,k){var e,a,d;k=g("./Shared");var c=function(b,a,d){this.init.apply(this,arguments)};c.prototype.init=function(b,a,d){this._name=b;this._collections=[];this._groups=[];this._listeners={};this._querySettings={query:a,options:d};this._debug={};this._privateData=
new e("__FDB__view_privateData_"+this._name)};k.modules.View=c;e=g("./Collection");g=g("./Overload");a=e.prototype.init;k=k.modules.Core;d=k.prototype.init;c.prototype.debug=new g([function(){return this._debug.all},function(b){return void 0!==b&&"boolean"===typeof b?(this._debug.all=b,this.privateData().debug(b),this.publicData().debug(b),this):this._debug.all},function(b,a){return void 0!==b?void 0!==a?(this._debug[b]=a,this.privateData().debug(b,a),this.publicData().debug(b,a),this):this._debug[b]:
this._debug.all}]);c.prototype.name=function(b){return void 0!==b?(this._name=b,this):this._name};c.prototype.find=function(b,a){return this.publicData().find(b,a)};c.prototype.insert=function(b,a,d){b=this._privateData.decouple(b);"function"===typeof a?(d=a,a=this._privateData.length):void 0===a&&(a=this._privateData.length);this._transformInsert(b,a);this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+
'"');return this._privateData._insertHandle(b,a,d)};c.prototype.update=function(a,d){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');var c=this._privateData.update(a,d),e,g,k;if(this._transformEnabled&&this._transformIn){e=this._publicData.primaryKey();for(var n=0;n<c.length;n++)g={},k=c[n],g[e]=k[e],this._transformUpdate(g,k)}return c};c.prototype.remove=function(a){this._transformRemove(a);
this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');return this._privateData.remove(a)};c.prototype.link=function(a,d){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);return c.link(a,d)};c.prototype.unlink=function(a,d){var c=this.publicData();
this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);return c.unlink(a,d)};c.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};c.prototype._addCollection=function(a){if(-1===this._collections.indexOf(a)){this._collections.push(a);a._addView(this);var d=a.find(this._querySettings.query,this._querySettings.options);
this._transformPrimaryKey(a.primaryKey());this._transformInsert(d);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(d)}return this};c.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a._removeView(this),this._privateData.remove(a.find(this._querySettings.query,this._querySettings.options)));return this};c.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};c.prototype.off=function(){this._privateData.off.apply(this._privateData,
arguments)};c.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};c.prototype.drop=function(){if(this._collections&&this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name);this.emit("drop");for(var a=this._collections.length;a--;)this._removeCollection(this._collections[a]);this._privateData.drop();return!0}return!1};c.prototype.db=function(a){return void 0!==a?(this._db=a,this.privateData().db(a),
this.publicData().db(a),this):this._db};c.prototype.primaryKey=function(){return this._privateData.primaryKey()};c.prototype.queryData=function(a,d,c){void 0!==a&&(this._querySettings.query=a);void 0!==d&&(this._querySettings.options=d);return void 0!==a||void 0!==d?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};c.prototype.queryAdd=function(a,d,c){var e=this._querySettings.query,g;if(void 0!==a)for(g in a)a.hasOwnProperty(g)&&(void 0===e[g]||void 0!==e[g]&&d)&&(e[g]=a[g]);void 0!==
c&&!0!==c||this.refresh()};c.prototype.queryRemove=function(a,d){var c=this._querySettings.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&delete c[e];void 0!==d&&!0!==d||this.refresh()};c.prototype.query=function(a,d){return void 0!==a?(this._querySettings.query=a,void 0!==d&&!0!==d||this.refresh(),this):this._querySettings.query};c.prototype.queryOptions=function(a,d){return void 0!==a?(this._querySettings.options=a,void 0===a.decouple&&(a.decouple=!0),void 0!==d&&!0!==d||this.refresh(),this):
this._querySettings.options};c.prototype.refresh=function(a){var d;a=this.publicData();var c;this._privateData.remove();a.remove();for(c=0;c<this._collections.length;c++)d=this._collections[c],this._privateData.insert(d.find(this._querySettings.query,this._querySettings.options));d=this._privateData.find({},this._querySettings.options);a._linked?jQuery.observable(a._data).refresh(d):(this._privateData._data.length=0,this._privateData._data=this._privateData._data.concat(d));return this};c.prototype.count=
function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};c.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,
dataIn:this._transformIn,dataOut:this._transformOut}};c.prototype.privateData=function(){return this._privateData};c.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};c.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new e("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(a))};
c.prototype._transformInsert=function(a,d){this._transformEnabled&&this._publicData&&this._publicData.insert(a,d)};c.prototype._transformUpdate=function(a,d){this._transformEnabled&&this._publicData&&this._publicData.update(a,d)};c.prototype._transformRemove=function(a){this._transformEnabled&&this._publicData&&this._publicData.remove(a)};c.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};e.prototype.init=function(){this._views=[];
a.apply(this,arguments)};e.prototype.view=function(a,d,e){a=(new c(a,d,e)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a};e.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};e.prototype._removeView=function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};k.prototype.init=function(){this._views={};d.apply(this,arguments)};k.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&
this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new c(a)).db(this);return this._views[a]};k.prototype.viewExists=function(a){return Boolean(this._views[a])};k.prototype.views=function(){var a=[],d;for(d in this._views)this._views.hasOwnProperty(d)&&a.push({name:d,count:this._views[d].count()});return a};n.exports=c},{"./Collection":2,"./Overload":11,"./Shared":14}],16:[function(g,n,k){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(e,a,
d){function c(a){return a}function b(a){debugger;return a}function g(a){ba=(ya._dbgMode=a)?"Unavailable (nested view): use #getIndex()":"";Ba("dbg",Ha.dbg=U.dbg=a?b:c)}function f(a){this.name=(y.link?"JsViews":"JsRender")+" Error";this.message=a||this.name}function h(a,b){for(var d in b)a[d]=b[d];return a}function k(a){return"function"===typeof a}function n(a,b,d){if(!ca.rTag||a)x=a?a.charAt(0):x,ka=a?a.charAt(1):ka,M=b?b.charAt(0):M,F=b?b.charAt(1):F,Q=d||Q,a="\\"+x+"(\\"+Q+")?\\"+ka,b="\\"+M+"\\"+
F,D="(?:(?:(\\w+(?=[\\/\\s\\"+M+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+M+"]|\\"+M+"(?!\\"+F+"))*?)",ca.rTag=D+")",D=RegExp(a+D+"(\\/)?|(?:\\/(\\w+)))"+b,"g"),ma=RegExp("<.*>|([^\\\\]|^)[{}]|"+a+".*"+b);return[x,ka,M,F,Q]}function Ja(a,b){b||(b=a,a=d);var c,e,f,g;f=this;c=!b||"root"===b;if(a){if(g=f.type===b?f:d,!g)if(c=f.views,f._.useKey)for(e in c){if(g=c[e].get(a,b))break}else for(e=0,f=c.length;!g&&e<f;e++)g=c[e].get(a,b)}else if(c)for(;f.parent.parent;)g=f=f.parent;
else for(;f&&!g;)g=f.type===b?f:d,f=f.parent;return g}function P(){var a=this.get("item");return a?a.index:d}function fa(){return this.index}function ga(a){var b,c=this,f=c.linkCtx,g=(c.ctx||{})[a];g===d&&f&&f.ctx&&(g=f.ctx[a]);g===d&&(g=Ha[a]);g&&k(g)&&!g._wrp&&(b=function(){return g.apply(this&&this!==e?this:c,arguments)},b._wrp=1,h(b,g));return b||g}function wa(a,b,c){var e,f,g=+c===c&&c,h=b.linkCtx;g&&(c=(g=b.tmpl.bnds[g-1])(b.data,b,B));e=c.args[0];if(a||g){e=h&&h.tag;e||(e={_:{inline:!h,bnd:g},
tagName:":",cvt:a,flow:!0,tagCtx:c,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,c.ctx=R(c.ctx,h.view.ctx)),ca._lnk(e));for(f in c.props)Ma.test(f)&&(e[f]=c.props[f]);c.view=b;e.ctx=c.ctx||{};delete c.ctx;b._.tag=e;e=xa(e,e.convert||"true"!==a&&a)[0];e=g&&b._.onRender?b._.onRender(e,b,g):e;b._.tag=d}return e!=d?e:""}function xa(a,b){var d=a.tagCtx,c=d.view,e=d.args;b=b&&(""+b===b?c.getRsc("converters",b)||na("Unknown converter: '"+b+"'"):b);e=e.length||d.index?b?e.slice():e:[c.data];b&&(b.depends&&(a.depends=
ca.getDeps(a.depends,a,b.depends,b)),e[0]=b.apply(a,e));return e}function q(a,b){for(var c,e=this;c===d&&e;)c=(c=e.tmpl[a])&&c[b],e=e.parent;return c||B[a][b]}function p(a,b,c,e,f){var g,k,l,r,m,G,u,n,t,y,p,H="",S=+e===e&&e,q=b.linkCtx||0,s=b.ctx,D=c||b.tmpl;"tag"===a._is&&(g=a,a=g.tagName,e=g.tagCtxs);g=g||q.tag;S&&(e=(n=D.bnds[S-1])(b.data,b,B));G=e.length;for(m=0;m<G;m++){m||c&&g||(t=b.getRsc("tags",a)||na("Unknown tag: {{"+a+"}}"));k=e[m];q.tag||(u=k.tmpl,u=k.content=u&&D.tmpls[u-1],h(k,{tmpl:(g?
g:t).template||u,render:X,index:m,view:b,ctx:R(k.ctx,s)}));if(c=k.props.tmpl)c=""+c===c?b.getRsc("templates",c)||Da(c):c,k.tmpl=c;g||(t._ctr?(g=new t._ctr,y=!!g.init,g.attr=g.attr||t.attr||d):ca._lnk(g={render:t.render}),g._={inline:!q},q&&(q.attr=g.attr=q.attr||g.attr,q.tag=g,g.linkCtx=q),(g._.bnd=n||q.fn)?g._.arrVws={}:g.dataBoundOnly&&na("{^{"+a+"}} tag must be data-bound"),g.tagName=a,g.parent=r=s&&s.tag,g._is="tag",g._def=t,g.tagCtxs=e);if(!m)for(p in u=k.props)Ma.test(p)&&(g[p]=u[p]);k.tag=
g;g.dataMap&&g.tagCtxs&&(k.map=g.tagCtxs[m].map);g.flow||(u=k.ctx=k.ctx||{},k=g.parents=u.parentTags=s&&R(u.parentTags,s.parentTags)||{},r&&(k[r.tagName]=r),u.tag=g)}b._.tag=g;g.rendering={};for(m=0;m<G;m++){k=g.tagCtx=g.tagCtxs[m];u=k.props;a=xa(g,g.convert);if(e=u.dataMap||g.dataMap)if(a.length||u.dataMap){r=k.map;if(!r||r.src!==a[0]||f)r&&r.src&&r.unmap(),r=k.map=e.map(a[0],u);a=[r.tgt]}g.ctx=k.ctx;!m&&y&&(e=g.template,g.init(k,q,g.ctx),y=d,g.template!==e&&(g._.tmpl=g.template));r=d;if(e=g.render)r=
e.apply(g,a);a=a.length?a:[b];r=r!==d?r:k.render(a[0],!0)||(f?d:"");H=H?H+(r||""):r}delete g.rendering;g.tagCtx=g.tagCtxs[0];g.ctx=g.tagCtx.ctx;g._.inline&&(l=g.attr)&&l!==N&&(H="text"===l?U.html(H):"");return S&&b._.onRender?b._.onRender(H,b,S):H}function m(a,b,d,c,e,f,g,h){var k="array"===b,r={key:0,useKey:k?0:1,id:""+La++,onRender:h,bnds:{}};this.data=c;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=d;this.type=b;this._=r;this.linked=!!h;d?(b=d.views,c=d._,c.useKey?(b[r.key="_"+c.useKey++]=
this,this.index=ba,this.getIndex=P,f=c.tag,r.bnd=k&&(!f||!!f._.bnd&&f)):b.splice(r.key=this.index=f,0,this),this.ctx=a||d.ctx):this.ctx=a}function s(a){var b,d,c,e,f,g;for(b in J)if(e=J[b],(f=e.compile)&&(d=a[b+"s"]))for(c in d)(e=d[c]=f(c,d[c],a))&&(g=ca.onStore[b])&&g(c,e,f)}function Ea(a,b,c){k(b)?b={depends:b.depends,render:b}:(b.baseTag&&(b.flow=!!b.flow,b=h(h({},b.baseTag),b)),(a=b.template)!==d&&(b.template=""+a===a?Da[a]||Da(a):a),!1!==b.init&&(a=b._ctr=function(){},(a.prototype=b).constructor=
a));c&&(b._parentTmpl=c);return b}function W(b,c,f,g){function h(c){if(""+c===c||0<c.nodeType){try{r=0<c.nodeType?c:!ma.test(c)&&a&&a(e.document).find(c)[0]}catch(k){}r&&(c=Da[b=b||r.getAttribute(da)],c||(b=b||"_"+ea++,r.setAttribute(da,b),c=Da[b]=W(b,r.innerHTML,f,g)),r=d);return c}}var k,r;c=c||"";k=h(c);g=g||(c.markup?c:{});g.tmplName=b;f&&(g._parentTmpl=f);!k&&c.markup&&(k=h(c.markup))&&k.fn&&(k.debug!==c.debug||k.allowCode!==c.allowCode)&&(k=k.markup);if(k!==d)return b&&!f&&(w[b]=function(){return c.render.apply(c,
arguments)}),k.fn||c.fn?k.fn&&(c=b&&b!==k.tmplName?R(g,k):k):(c=Ia(k,g),pa(k.replace(z,"\\$&"),c)),s(g),c}function aa(a){function b(d,c){this.tgt=a.getTgt(d,c)}k(a)&&(a={getTgt:a});a.baseMap&&(a=h(h({},a.baseMap),a));a.map=function(a,d){return new b(a,d)};return a}function Ia(a,b){var d,c=ya.wrapMap||{},e=h({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:ta},b);b.htmlTag||(d=Y.exec(a),e.htmlTag=d?d[1].toLowerCase():"");(d=c[e.htmlTag])&&d!==c.div&&(e.markup=y.trim(e.markup));return e}
function V(a,b){function c(f,g,h){var k,r,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(r in f)c(r,f[r],g);return B}g===d&&(g=f,f=d);f&&""+f!==f&&(h=g,g=f,f=d);l=h?h[e]=h[e]||{}:c;r=b.compile;null===g?f&&delete l[f]:(g=r?g=r(f,g,h):g,f&&(l[f]=g));r&&g&&(g._is=a);g&&(k=ca.onStore[a])&&k(f,g,r);return g}var e=a+"s";B[e]=c;J[a]=b}function Aa(a,b){var d=this.jquery&&(this[0]||na('Unknown template: "'+this.selector+'"')),c=d.getAttribute(da);return ta.call(c?Da[c]:Da(d),a,b)}function ra(a,
b,d){if(ya._dbgMode)try{return a.fn(b,d,B)}catch(c){return na(c,d)}return a.fn(b,d,B)}function ta(a,b,d,c,e,f){return c||!this.fn._nvw||y.isArray(a)?X.call(this,a,b,d,c,e,f):ra(this,a,{tmpl:this})}function X(a,b,c,e,f,g){var h,k,r,l,G,u,t,n,H;r=this;var p="";!!b===b&&(c=b,b=d);!0===f&&(h=!0,f=0);r.tag?(u=r,r=r.tag,k=r._,G=r.tagName,n=k.tmpl||u.tmpl,H=r.attr&&r.attr!==N,b=R(b,r.ctx),t=u.content,!1===u.props.link&&(b=b||{},b.link=!1),e=e||u.view,a=arguments.length?a:e):n=r;if(n&&(!e&&a&&"view"===a._is&&
(e=a),e&&(t=t||e.content,g=g||e._.onRender,a===e&&(a=e.data),b=R(b,e.ctx)),e&&e.data!==d||((b=b||{}).root=a),n.fn||(n=Da[n]||Da(n)),n)){u=g=!1!==(b&&b.link)&&!H&&g;!0===g&&(u=d,g=e._.onRender);b=n.helpers?R(n.helpers,b):b;if(y.isArray(a)&&!c)for(l=h?e:f!==d&&e||new m(b,"array",e,a,n,f,t,g),h=0,k=a.length;h<k;h++)r=a[h],G=new m(b,"item",l,r,n,(f||0)+h,t,g),r=ra(n,r,G),p+=l._.onRender?l._.onRender(r,G):r;else{if(e||!n.fn._nvw)l=h?e:new m(b,G||"data",e,a,n,f,t,g),k&&!r.flow&&(l.tag=r);p+=ra(n,a,l)}return u?
u(p,l):p}return""}function na(a,b,d){d=ya.onError(a,b,d);if(""+a===a)throw new ca.Err(d);return!b.linkCtx&&b.linked?U.html(d):d}function O(a){na("Syntax error\n"+a)}function pa(a,b,d,c){function e(b){(b-=u)&&n.push(a.substr(u,b).replace(la,"\\n"))}function f(b){b&&O('Unmatched or missing tag: "{{/'+b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,m=[],u=0,R=[],n=m,t=[,,m];d&&(a=x+a+F);f(R[0]&&R[0][2].pop()[0]);a.replace(D,function(g,m,G,p,H,y,q,S,s,D,w,x){y&&(H=":",p=N);D=D||d;m=(m||d)&&[];var B=
"",A="",sa="",ua="",ia="",Ka="",Na="",Wa="";q=!D&&!H&&!q;G=G||(s=s||"#data",H);e(x);u=x+g.length;S?l&&n.push(["*","\n"+s.replace(ja,"$1")+"\n"]):G?("else"===G&&(T.test(s)&&O('for "{{else if expr}}" use "{{else expr}}"'),m=t[7],t[8]=a.substring(t[8],x),t=R.pop(),n=t[2],q=!0),s&&r(s.replace(la," "),m,b).replace(C,function(a,b,d,c,e,f,g,h){g?(A+=f+",",ua+="'"+h+"',"):d?(sa+=c+f+",",Ka+=c+"'"+h+"',"):b?Na+=f:("trigger"===e&&(Wa+=f),B+=c+f+",",ia+=c+"'"+h+"',",k=k||Ma.test(e));return""}).slice(0,-1),h=
[G,p||!!c||k||"",q&&[],[ua.slice(0,-1),ia.slice(0,-1),Ka.slice(0,-1)],[A.slice(0,-1),B.slice(0,-1),sa.slice(0,-1)],Na,Wa,m||0],n.push(h),q&&(R.push(t),t=h,t[8]=u)):w&&(f(w!==t[0]&&"else"!==t[0]&&w),t[8]=a.substring(t[8],x),t=R.pop());f(!t&&w);n=t[2]});e(a.length);(u=m[m.length-1])&&f(""+u!==u&&+u[8]===u[8]&&u[0]);d?(g=G(m,a,d),g.paths=m[0][7]):g=G(m,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Ga(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?
",\n\tctx:{"+a[2]+"}":"")}function r(a,b,d){var c,e,f,g,h,k=0,r=d?d.links:b&&(b.links=b.links||{}),l={},m={0:-1},u=0;return(a+(d?" ":"")).replace(/\)\^/g,").").replace(Fa,function(G,R,t,n,p,H,y,q,S,s,D,w,x,B,z,A,sa,ua,ia,Ka){function Na(a,d,A,g,sa,ua,ia,h){return A&&(b&&("linkTo"===c&&(e=b._jsvto=b._jsvto||[],e.push(p)),c&&!f||b.push(p.slice(d.length))),"."!==A)?(a=(g?'view.hlp("'+g+'")':sa?"view":"data")+(h?(ua?"."+ua:g?"":sa?"":"."+A)+(ia||""):(h=g?"":sa?ua||"":A,"")),a+=h?"."+h:"",d+("view.data"===
a.slice(0,9)?a.slice(5):a)):a}H=H||"";t=t||R||w;p=p||S;s=s||sa||"";if(!y||h||g)return!b||!A||h||g||c&&!f&&!e||(A=m[u],Ka.length-1>ia-A&&(A=Ka.slice(A,ia+1),A=ka+":"+A+M,y=r[A],y||(r[A]=1,r[A]=y=pa(A,d||b,!0),y.paths.push({_jsvOb:y})),1!==y&&(e||b).push({_jsvOb:y}))),h?(h=!x,h?G:'"'):g?(g=!B,g?G:'"'):(t?(u++,m[u]=ia++,t):"")+(ua?u?"":(k=Ka.slice(k,ia),c?(c=f=e=!1,"\b"):"\b,")+k+(k=ia+G.length,"\b"):q?(u&&O(a),c=p,f=n,k=ia+G.length,p+":"):p?p.split("^").join(".").replace(Z,Na)+(s?(l[++u]=!0,"."!==p.charAt(0)&&
(m[u]=ia),s):H):H?H:z?(l[u--]=!1,z)+(s?(l[++u]=!0,s):""):D?(l[u]||O(a),","):R?"":(h=x,g=B,'"'));O(a)})}function G(b,d,c){var e,f,g,h,k,r,l,m,u,R,t,n,p,y,H,q,s,S,D,w,x,B,z,M,F=0,A="",sa={},ua=b.length;""+d===d?(H=c?'data-link="'+d.replace(la," ").slice(1,-1)+'"':d,d=0):(H=d.tmplName||"unnamed",d.allowCode&&(sa.allowCode=!0),d.debug&&(sa.debug=!0),t=d.bnds,y=d.tmpls);for(e=0;e<ua;e++)if(f=b[e],""+f===f)A+='\n+"'+f+'"';else if(g=f[0],"*"===g)A+=";\n"+f[1]+"\nret=ret";else{h=f[1];S=f[2];k=Ga(f[3],"params")+
"},"+Ga(p=f[4]);z=f[5];M=f[6];D=f[8];(x="else"===g)||(F=0,t&&(n=f[7])&&(F=t.push(n)));(f=":"===g)?h&&(g=h===N?">":h+g):(S&&(q=Ia(D,sa),q.tmplName=H+"/"+g,G(S,q),y.push(q)),x||(s=g,w=A,A=""),q=(q=b[e+1])&&"else"===q[0]);x=z?";\ntry{\nret+=":"\n+";if(f&&(n||M||h&&h!==N)){B="return {"+k+"};";z&&(B="try {\n"+B+"\n}catch(e){return {error: j._err(e,view,"+z+")}}\n");B=new Function("data,view,j,u"," // "+H+" "+F+" "+g+"\n"+B);B.paths=n;B._tag=g;if(c)return B;R=1}A+=f?(c?(z?"\ntry{\n":"")+"return ":x)+(R?
(R=0,u=m=!0,'c("'+h+'",view,'+(n?(t[F-1]=B,F):"{"+k+"}")+")"):">"===g?(l=!0,"h("+p[0]+")"):"((v="+p[0]+')!=null?v:"")'):(u=r=!0,"\n{view:view,tmpl:"+(S?y.length:"0")+","+k+"},");if(s&&!q){A="["+A.slice(0,-1)+"]";if(c||n)if(A=new Function("data,view,j,u"," // "+H+" "+F+" "+s+"\nreturn "+A+";"),n&&((t[F-1]=A).paths=n),A._tag=g,c)return A;A=w+x+'t("'+s+'",view,this,'+(F||A)+")";s=n=0}z&&(u=!0,A+=";\n}catch(e){ret"+(c?"urn ":"+=")+"j._err(e,view,"+z+");}\n"+(c?"":"ret=ret"))}A="// "+H+"\nj=j||"+(a?"jQuery.":
"jsviews.")+"views;var v"+(r?",t=j._tag":"")+(m?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(c?";\n":',ret=""\n')+(sa.debug?"debugger;":"")+A+(c?"\n":";\nreturn ret;");try{A=new Function("data,view,j,u",A)}catch(ia){O("Compiled template code:\n\n"+A+'\n: "'+ia.message+'"')}d&&(d.fn=A);u||(A._nvw=!0);return A}function R(a,b){return a&&a!==b?b?h(h({},b),a):a:b&&h({},b)}function u(a){return ha[a]||(ha[a]="&#"+a.charCodeAt(0)+";")}function H(a){var b,d,c=[];if("object"===typeof a)for(b in a)(d=a[b])&&
d.toJSON&&!d.toJSON()||k(d)||c.push({key:b,prop:d});return c}function S(a){return null!=a?L.test(a)&&(""+a).replace(qa,u)||a:""}if(!(a&&a.render||e.jsviews)){var y,t,D,ma,ba,x="{",ka="{",M="}",F="}",Q="^",Z=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,Fa=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,
la=/[ \t]*(\r\n|\n|\r)/g,ja=/\\(['"])/g,z=/['"\\]/g,C=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,T=/^if\s/,Y=/<(\w+)[>\s]/,L=/[\x00`><\"'&]/,Ma=/^on[A-Z]|^convert(Back)?$/,qa=/[\x00`><"'&]/g,ea=0,La=0,ha={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},N="html",da="data-jsv-tmpl",w={},J={template:{compile:W},tag:{compile:Ea},helper:{},converter:{}},B={jsviews:"v1.0.0-beta",settings:function(a){h(ya,a);g(ya._dbgMode);ya.jsv&&ya.jsv()},
sub:{View:m,Err:f,tmplFn:pa,cvt:xa,parse:r,extend:h,syntaxErr:O,onStore:{},_lnk:c},map:aa,_cnvt:wa,_tag:p,_err:na};(f.prototype=Error()).constructor=f;P.depends=function(){return[this.get("item"),"index"]};fa.depends=function(){return["index"]};m.prototype={get:Ja,getIndex:fa,getRsc:q,hlp:ga,_is:"view"};for(t in J)V(t,J[t]);var Da=B.templates,U=B.converters,Ha=B.helpers,Ba=B.tags,ca=B.sub,ya=B.settings;a?(y=a,y.fn.render=Aa,y.observable&&(h(ca,y.views.sub),B.map=y.views.map)):(y=e.jsviews={},y.isArray=
Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});y.render=w;y.views=B;y.templates=Da=B.templates;ya({debugMode:g,delimiters:n,onError:function(a,b,c){b&&(a=c===d?"{Error: "+a+"}":k(c)?c(a,b):c);return a==d?"":a},_dbgMode:!0});Ba({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,
b,d){var c;for(a=0;(c=this.tagCtxs[a])&&c.args.length;a++)if(c=c.args[0],b=!c!==!d[a].args[0],!this.convert&&c||b)return b;return!1},flow:!0},"for":{render:function(a){var b,c=this.tagCtx,e="",f=0;if(!this.rendering.done){if(b=!arguments.length)a=c.view.data;a!==d&&(e+=c.render(a,b),f+=y.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=c.index}return e},flow:!0},include:{flow:!0},"*":{render:c,flow:!0}});Ba("props",{baseTag:Ba["for"],dataMap:aa(H)});U({html:S,attr:S,url:function(a){return a!=
d?encodeURI(""+a):null===a?a:""}});n()}})(this,this.jQuery);(function(e,a,d){function c(a){return s(a)?new g(a):new b(a)}function b(a){this._data=a;return this}function g(a){this._data=a;return this}function f(a,b){a=s(a)?a:[a];var d,c,e=b,g=e,h=a.length,k=[];for(d=0;d<h;d++)c=a[d],X(c)?k=k.concat(f(c.call(b,b),b)):""+c!==c?(b=g=c,g!==e&&k.push(e=g)):(g!==e&&k.push(e=g),k.push(c));return k}function h(a,b){var d,c;for(d in a){c=!0;break}c||delete ra[b]}function k(a,b){if(!a.data||!a.data.off){var c,
e,f,g=b.oldValue,h=b.value,l=a.data,m=l.observeAll,n=!l.cb.noArray,p=l.paths;if(a.type===Aa)(l.cb.array||l.cb).call(l,a,b);else if(l.prop===b.path||"*"===l.prop)g=typeof g===W&&(p[0]||n&&s(g))&&g,h=typeof(h=b.value)===W&&(p[0]||n&&s(h))&&h,m?(c=m._path+"."+b.path,e=m.filter,f=[m.parents().slice()],g&&P(n,m.ns,[g],p,l.cb,!0,e,f,c),h&&P(n,m.ns,[h],p,l.cb,d,e,f,c)):(g&&P(n,[g],p,l.cb,!0),h&&P(n,[h],p,l.cb)),l.cb(a,b)}}function n(){function b(d,c,e,g){var f,h=pa(w),l=s(w)?[w]:w;d=L?d+"."+L:d;if(ba||g)h&&
a(l).off(d,k);else{if(Q=h&&a._data(w))for(M=(Q=(Q=Q&&Q.events)&&Q[e?Aa:V])&&Q.length;M--;)if((F=Q[M].data)&&F.cb._cId===x._cId&&F.ns===L){if(e)return;("*"===c&&F.prop!==c||F.prop===t)&&a(w).off(d,k)}c=e?{}:{fullPath:D,paths:c?[c]:[],prop:t};c.ns=L;c.cb=x;T&&(c.observeAll={_path:T,path:function(){f=C.length;return T.replace(/[[.]/g,function(b){f--;return"["===b?"["+a.inArray(C[f-1],C[f]):"."})},parents:function(){return C},filter:Y,ns:L});a(l).on(d,null,c,k);la&&(la[a.data(w,"obId")||a.data(w,"obId",
na++)]=w)}}function e(a,b){a._ob=Z(a,da);var d=da;return function(c,e){var f=a._ob,h=b.length;typeof f===W&&(g(f,!0),(h||ea&&s(f))&&P(ea,[f],b,x,Z,!0));f=a._ob=Z(a,d);typeof f===W&&(g(f),(h||ea&&s(f))&&P(ea,[f],b,x,Z,[d]));x(c,e)}}function g(a,e,f,h){if(ea){var k=w,l=T;w=a;h&&(w=a[h],T+="."+h,Y&&(w=c._fltr(h,a,T,Y)));w&&(f||s(w))&&b(Aa+".observe"+(x?".obs"+(ka=x._cId=x._cId||O++):""),d,!0,e);w=k;T=l}}var l,p,q,y,t,D,ma,ba,x,ka,M,F,Q,Z,aa,la,ja,z,C,T,Y,L,fa,ga,ea=!1!=this,xa=1,ha=ta,N=Array.apply(0,
arguments);l=N.pop();var da=N.shift(),w=z=da,J=N.length;da+""===da&&ea&&(L=da,da=w=z=N.shift(),J--);if(X(l))x=l;else if(l+""===l&&(T=l,C=N.pop(),Y=N.pop(),l=N.pop(),J-=3),!0===l?ba=l:l&&(da=l,xa=0),l=N[J-1],J&&l===d||X(l))x=N.pop(),J--;J&&X(N[J-1])&&(Z=x,x=N.pop(),J--);ha+=ba?x?".obs"+x._cId:"":".obs"+(ka=x._cId=x._cId||O++);ba||(la=ra[ka]=ra[ka]||{});fa=L&&L.match(Ia)||[""];for(ga=fa.length;ga--;)for(L=fa[ga],s(z)?g(z,ba,!0):ba&&0===J&&z&&b(ha,""),l=ja=0;l<J;l++)if(D=N[l],""!==D){w=z;if(""+D===D){y=
D.split("^");y[1]&&(ja=y[0].split(".").length,D=y.join("."),ja=D.split(".").length-ja);if(Z&&(aa=Z(D,z))){J+=aa.length-1;m.apply(N,[l--,1].concat(aa));continue}y=D.split(".")}else xa&&!X(D)&&(D._jsvOb&&(z=e(D,N.slice(l+1)),z.noArray=!ea,z._cId=x._cId,P(ea,[da],N.slice(0,l),z,Z),z=d,D=D._ob),w=D),z=D,y=[z];for(;w&&(t=y.shift())!==d;)if(typeof w===W){if(""+t===t){if(""===t)continue;if(y.length<ja+1&&!w.nodeType){if(!ba&&(Q=pa(w)&&a._data(w))){M=(Q=(Q=Q.events)&&Q[V])&&Q.length;for(q=0;M--;)!(F=Q[M].data)||
F.cb!==x||F.ns!==L||F.prop!==t&&"*"!==F.prop||((p=y.join("."))&&F.paths.push(p),q++);if(q){w=w[t];continue}}if("*"===t){!ba&&Q&&Q.length&&b(ha,"",!1,!0);X(w)?(ma=w.depends)&&P(ea,[ma],x,ba||da):b(ha,"");for(p in w)g(w,ba,d,p);break}else t&&b(ha+"."+t,y.join("."))}T&&(T+="."+t);t=w[t]}if(X(t)){(ma=t.depends)&&P(ea,[w],f(ma,w),x,Z,ba||[da]);break}w=t}g(w,ba)}ka&&h(la,ka);return{cbId:ka,bnd:la}}function Ja(){[].push.call(arguments,!0);return n.apply(this,arguments)}function P(){var a=[].concat.apply([],
arguments);return n.apply(a.shift(),a)}function fa(a,b,d,c){a+""!==a&&(d=b,b=a,a="");wa(a,this._data,b,d,[],"root",c)}function ga(a,b,d){fa.call(this,a,b,d,!0)}function wa(a,b,e,f,g,h,k){function l(b,d){p=b.length;for(x=h+"[]";p--;)(I=c._fltr(p,b,x,f))&&wa(a,I,e,f||"",g.slice(),x,d)}function m(b,d){h=b.data.observeAll._path;var c=g;g[0]!==b.target&&(g=g.slice(),g.unshift(b.target));switch(d.change){case "insert":l(d.items);break;case "remove":l(d.items,!0);break;case "refresh":l(d.oldItems,!0);l(b.target);
break;case "set":x=h+"."+d.path,wa(a,d.oldValue,e,0,g.slice(),x,!0),wa(a,d.value,e,0,g.slice(),x)}e.apply(this,arguments);g=c}var p,q,x,I;if(typeof b===W){q=s(b)?"":"*";g.unshift(b);if(e){if(q||0!==f)m._cId=e._cId=e._cId||O++,n(a,b,q,m,k,f,g.slice(),h)}else n(a,b,q,d,k,f,g.slice(),h);if(q)for(p in b)"_"!==p.charAt(0)&&p!==Ea&&(x=h+"."+p,(I=c._fltr(p,b,x,f))&&wa(a,I,e,f||0,g.slice(),x,k));else l(b,k)}}function xa(a,b,d){return 0>d.indexOf(".")&&0>d.indexOf("[")&&b[a]}if(!a)throw"jsViews/jsObservable require jQuery";
if(!a.observable){e=a.views=a.views||{jsviews:"v1.0.0-alpha",sub:{}};var q=e.sub,p=a.event.special,m=[].splice,s=a.isArray,Ea=a.expando,W="object",aa=parseInt,Ia=/\S+/g,V=q.propChng=q.propChng||"propertyChange",Aa=q.arrChng=q.arrChng||"arrayChange",ra=q._cbBnds=q._cbBnds||{},ta=V+".observe",X=a.isFunction,na=1,O=1,pa=a.hasData,Ga={};q.getDeps=function(){var a=arguments;return function(){for(var b,d,c=[],e=a.length;e--;)b=a[e--],(d=a[e])&&(c=c.concat(X(d)?d(b,b):d));return c}};a.observable=c;c._fltr=
function(a,b,d,c){(a=c&&X(c)?c(a,b,d):b[a])&&(a=X(a)?a.set&&a.call(b):a);return typeof a===W&&a};c.Object=b;c.Array=g;a.observe=c.observe=n;a.unobserve=c.unobserve=Ja;c._apply=P;b.prototype={_data:null,observeAll:fa,unobserveAll:ga,data:function(){return this._data},setProperty:function(a,b,c){var e,f=this._data;a=a||"";if(f)if(s(a))for(e=a.length;e--;)b=a[e],this.setProperty(b.name,b.value,c===d||c);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],b);else if(a!==Ea){for(a=a.split(".");f&&1<a.length;)f=
f[a.shift()];f&&this._setProperty(f,a[0],b,c)}return this},removeProperty:function(a){this.setProperty(a,Ga);return this},_setProperty:function(a,b,c,e){var f,g,h,k=b?a[b]:a;X(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));if(k!==c||e&&k!=c)if(!(k instanceof Date)||k>c||k<c)f?(f.call(a,c),c=g.call(a)):(h=c===Ga)?(delete a[b],c=d):b&&(a[b]=c),this._trigger(a,{change:"set",path:b,value:c,oldValue:k,remove:h})},_trigger:function(b,d){a(b).triggerHandler(V,d)}};g.prototype={_data:null,observeAll:fa,
unobserveAll:ga,data:function(){return this._data},insert:function(a,b){var d=this._data;1===arguments.length&&(b=a,a=d.length);a=aa(a);-1<a&&a<=d.length&&(b=s(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,b){var d=this._data,c=d.length;m.apply(d,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},c)},remove:function(a,b){var c;c=this._data;a===d&&(a=c.length-1);a=aa(a);b=b?aa(b):0===b?0:1;-1<b&&-1<a&&(c=c.slice(a,a+b),(b=c.length)&&this._remove(a,b,c));return this},
_remove:function(a,b,d){var c=this._data,e=c.length;c.splice(a,b);this._trigger({change:"remove",index:a,items:d},e)},move:function(a,b,d){d=d?aa(d):0===d?0:1;a=aa(a);b=aa(b);if(0<d&&-1<a&&-1<b&&a!==b){var c=this._data.slice(a,a+d);(d=c.length)&&this._move(a,b,d,c)}return this},_move:function(a,b,d,c){var e=this._data,f=e.length;e.splice(a,d);e.splice.apply(e,[b,0].concat(c));this._trigger({change:"move",oldIndex:a,index:b,items:c},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,
a);return this},_refresh:function(a,b){var d=this._data,c=d.length;m.apply(d,[0,d.length].concat(b));this._trigger({change:"refresh",oldItems:a},c)},_trigger:function(b,d){var c=this._data,e=c.length,c=a([c]);c.triggerHandler(Aa,b);e!==d&&c.triggerHandler(V,{change:"set",path:"length",value:e,oldValue:d})}};p[V]=p[Aa]={remove:function(b){var d,c,e,f,g=b.data;if(g&&(g.off=1,g=g.cb)&&(d=ra[g._cId])){b=a._data(this).events[b.type];for(e=b.length;e--&&!c;)c=(f=b[e].data)&&f.cb===g;c||(delete d[a.data(this,
"obId")],h(d,g._cId))}}};e.map=function(b){function e(a,d,f){var g,h=this;this.src&&this.unmap();"object"===typeof a&&(h.src=a,h.tgt=f||h.tgt||[],h.options=d||h.options,h.update(),b.obsSrc&&c(h.src).observeAll(h.obs=function(a,d){g||(g=1,b.obsSrc(h,a,d),g=0)},h.srcFlt),b.obsTgt&&c(h.tgt).observeAll(h.obt=function(a,d){g||(g=1,b.obsTgt(h,a,d),g=0)},h.tgtFlt))}(e.prototype={srcFlt:b.srcFlt||xa,tgtFlt:b.tgtFlt||xa,update:function(d){a.observable(this.tgt).refresh(b.getTgt(this.src,this.options=d||this.options))},
unmap:function(){this.src&&(this.obs&&a.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&a.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=d)},map:e,_def:b}).constructor=e;X(b)&&(b={getTgt:b});b.baseMap&&(b=a.extend({},b.baseMap,b));b.map=function(a,b,d){return new e(a,b,d)};return b}}})(this,this.jQuery);(function(e,a,d){function c(b,c,e){var g,f,h,l,m,n,p,q,r,E=b.target,s=E._jsvBnd,v=/&(\d+)\+?/g;if(s)for(;h=v.exec(s);)if(h=Ca[h[1]])if(c=h.to){h=h.linkCtx;p=h.view;
r=h.tag;n=a(E);m=p.hlp(J);q=p.hlp(B);f=k(E);g=Qa[f];e===d&&(e=L(f)?f(E):g?n[g]():n.attr(f));g=c[1];c=c[0];g&&(l=L(g)?g:p.getRsc("converters",g));l&&(e=l.call(r,e));g=p.linkCtx;p.linkCtx=h;f={change:"change",oldValue:h._val,value:e};if(!(m&&!1===m.call(h,b,f)||r&&r.onBeforeChange&&!1===r.onBeforeChange(b,f)||e===d)&&(m=c[0],e!==d&&m)){m=m._jsvOb?m._ob:m;r&&(r._.chging=!0);ea(m).setProperty(c[2]||c[1],e);q&&q.call(h,b,f);if(r){if(r.onAfterChange)r.onAfterChange(b,f);delete r._.chging}h._val=e}p.linkCtx=
g}}function b(b,c,e){var f,h,m,n=this.data,p=this.elem,q=this.convert;h=p.parentNode;var r=this.view,s=r.linkCtx,t=r.hlp(J);r.linkCtx=this;if(h&&!(t&&c&&!1===t.call(this,b,c)||c&&"*"!==b.data.prop&&b.data.prop!==c.path)){c&&(this.eventArgs=c);if(c||this._initVal){delete this._initVal;h=e.call(r.tmpl,n,r,z);a:{var E=h,u=m=this.tag;f=this.attr||k(p,!0,q!==d);var v,x,y=u&&u.parentElem||this.elem;if(E!==d){x=a(y);f=u&&u.attr||f;L(E)&&ka(this.expr+": missing parens");"visible"===f&&(f="css-display");if(u=
/^css-/.test(f)&&f.slice(4))v=a.style(y,u),+E===E&&(v=parseInt(v));else if("link"!==f){if("value"===f)y.type===Ha&&(v=x.prop(f=U));else if(f===Ba)if(y.value===""+E)v=x.prop(U);else break a;v===d&&(v=(v=Qa[f])?x[v]():x.attr(f))}this._val=v}}if(h&&h.error!==d)h=h.error;else if(m){h=h[0]?h:[h];e=c&&m.onUpdate&&!1===m.onUpdate(b,c,h);ra(m,h);if(e||f===ca){f===oa&&m.onBeforeLink&&m.onBeforeLink();aa(m,m.tagCtx);P(this,n,p);r.linkCtx=s;return}if(m._.chging)return;h=":"===m.tagName?z._cnvt(m.cvt,r,h[0]):
z._tag(m,r,r.tmpl,h,!0)}else e._tag&&(h=(q=""===q?ya:q)?z._cnvt(q,r,h):z._tag(e._tag,r,r.tmpl,h,!0),m=this.tag,f=this.attr||f);g(h,this,f,m)&&c&&(t=r.hlp(B))&&t.call(this,b,c);m&&aa(m,m.tagCtx)}P(this,n,p);r.linkCtx=s}}function g(b,c,f,h){var k,l,m,n,p,q,s=b!==d,t=c.data,E=h&&h.parentElem||c.elem,u=a(E),v=c.view;q=c._val;var x=v.ctx,y=v.linkCtx,w=h||f===oa;h&&(h.parentElem=h.parentElem||c.expr||h._elCnt?E:E.parentNode,l=h._prv,m=h._nxt);if(s){if(/^css-/.test(f))"visible"===c.attr&&(c=(E.currentStyle||
db.call(e,E,"")).display,b?(b=E._jsvd||c,b!==ca||(b=ab[k=E.nodeName])||(c=ja.createElement(k),ja.body.appendChild(c),b=ab[k]=(c.currentStyle||db.call(e,c,"")).display,ja.body.removeChild(c))):(E._jsvd=c,b=ca)),(w=w||q!==b)&&a.style(E,f.slice(4),b);else if("link"!==f){if(f===U)p=1,b=b&&"false"!==b;else if(f===Ba)if(E.value===""+b)b=!0,p=1,f=U;else{P(c,t,E);return}else if("selected"===f||"disabled"===f||"multiple"===f||"readonly"===f)b=b&&"false"!==b?f:null;if(k=Qa[f])if(f===oa){v.linkCtx=c;v.ctx=c.ctx;
if(h&&h._.inline){f=h.nodes(!0);if(h._elCnt){if(l&&l!==m)r(l,m,E,h._tgId,"^",!0);else if(n=E._dfr)q=h._tgId+"^",k=n.indexOf("#"+q)+1,p=n.indexOf("/"+q),k&&0<p&&(k+=q.length,p>k&&(E._dfr=n.slice(0,k)+n.slice(p),G(n.slice(k,p))));l=l?l.previousSibling:m?m.previousSibling:E.lastChild}a(f).remove();if(h&&h.onBeforeLink)h.onBeforeLink();n=v.link(v.data,E,l,m,b,h&&{tag:h._tgId,lazyLink:h.tagCtx.props.lazyLink})}else{s&&u.empty();if(h&&h.onBeforeLink)h.onBeforeLink();s&&(n=v.link(t,E,l,m,b,h&&{tag:h._tgId}))}v.linkCtx=
y;v.ctx=x}else{if(w=w||q!==b)if("text"===f&&E.children&&!E.children[0])E.textContent!==d?E.textContent=b:E.innerText=null===b?"":b;else u[k](b)}else if(w=w||q!==b)u[p?"prop":"attr"](f,b!==d||p?b:null);c._val=b}return n||w}if(f===oa&&h&&h.onBeforeLink)h.onBeforeLink()}function f(a,b){var d=this.hlp(J),c=this.hlp(B);if(!d||!1!==d.call(this,a,b)){if(b){var d=b.index,e=b.items;switch(b.change){case "insert":this.addViews(d,e);break;case "remove":this.removeViews(d,e.length);break;case "move":this.refresh();
break;case "refresh":this.refresh()}}c&&c.call(this,a,b)}}function h(b){var c,e=b.data,g=b._.bnd;if(!b._.useKey&&g){if(c=b._.bndArr)a([c[1]]).off(da,c[0]),b._.bndArr=d;g!==!!g&&g._.inline?e?g._.arrVws[b._.id]=b:delete g._.arrVws[b._.id]:e&&(c=function(a){a.data&&a.data.off||f.apply(b,arguments)},a([e]).on(da,c),b._.bndArr=[c,e])}}function k(a,b,c){var d=a.nodeName.toLowerCase(),e=T.merge[d]||a.contentEditable===ya&&{to:oa,from:oa};return e?b?"input"===d&&a.type===Ba?Ba:e.to:e.from:b?c?"text":oa:""}
function n(b,c,e,f,g,h,k){var l,m,p,q=b.parentElem,s=b._prv,E=b._nxt,t=b._elCnt;s&&s.parentNode!==q&&ka("Missing parentNode");if(k)for(p in m=b.nodes(),t&&s&&s!==E&&r(s,E,q,b._.id,"_",!0),b.removeViews(d,d,!0),f=E,t&&(s=s?s.previousSibling:E?E.previousSibling:q.lastChild),a(m).remove(),b._.bnds)X(p);else{if(c){l=f[c-1];if(!l)return!1;s=l._nxt}t?s=(f=s)?f.previousSibling:q.lastChild:f=s.nextSibling}c=e.render(g,h,b._.useKey&&k,b,k||c,!0);b.link(g,q,s,f,c,l)}function Ja(a,b,c){var e;c?(e="^`",b=b._.tag||
{_:{inline:!0,bnd:c},tagCtx:{view:b},flow:!0},c=b._tgId,c||(Ca[c=bb++]=b,b._tgId=""+c)):(e="_`",la[c=b._.id]=b);return"#"+c+e+(a!=d?a:"")+"/"+c+e}function P(a,b,c){var e,f=a.tag,g=a.convertBack,h=[],k=a._bndId||""+bb++,l=a._hdlr;delete a._bndId;f&&(h=f.depends||h,h=L(h)?f.depends(f):h,e=f.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&ea._apply(!1,[b],a._depends,l,!0),b=ea._apply(!1,[b],a.fn.paths,h,l,a._ctxCb),b.elem=c,b.linkCtx=a,b._tgId=k,c._jsvBnd=c._jsvBnd||"",c._jsvBnd+="&"+
k,a._depends=h,a.view._.bnds[k]=k,Ca[k]=b,e&&(b.to=[[],g]),(e||g!==d)&&Aa(b,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(b);f.flow||f._.inline||(c.setAttribute(ha,(c.getAttribute(ha)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||c._jsvBnd+"+",e[a]._jsvLnkdEl=f}function fa(a,b,c,d,e,f,g){return ga(this,a,b,c,d,e,f,g)}function ga(b,e,f,g,h,k,l,m){if(b&&e){e=e.jquery?e:a(e);S||(S=ja.body,a(S).on(w,
c).on("blur","[contenteditable]",c));for(var n,p,q,r,t,u,v,x=Ja,z=g&&"replace"===g.target,D=e.length;D--;)if(v=e[D],""+b===b)t=y(v),n=t.ctx,t.ctx=g,xa(b,v,t,f),t.ctx=n;else{k=k||y(v);if(b.markup!==d)!1===k.link&&(g=g||{},g.link=x=!1),z&&(u=v.parentNode),q=b.render(f,g,h,k,d,x),u?(l=v.previousSibling,m=v.nextSibling,a.cleanData([v],!0),u.removeChild(v),v=u):(l=m=d,a(v).empty());else if(!0!==b)break;if(v._dfr&&!m){r=s(v._dfr,1,cb);n=0;for(p=r.length;n<p;n++)t=r[n],(t=la[t.id])&&t.data!==d&&t.parent.removeViews(t._.key,
d,!0);v._dfr=""}k.link(f,v,l,m,q,d,g)}}return e}function wa(b,c,e,g,k,l,m,n){function q(a,b,c,e,f,g,h,A,l,m,sa,ua,n){var ia,p="";if(n)return E=0,a;v=A||l||"";e=e||m;c=c||ua;ma&&!c&&(e||v||g)&&(ma=d,O=pa.shift());if(e=e||c)E=0,ma=d,ga&&(c||ua?Va[O]||/;svg;|;math;/.test(";"+pa.join(";")+";")||(ia="'<"+O+".../"):Va[e]?ia="'</"+e:pa.length&&e===O||(ia="Mismatch: '</"+e),ia&&Sa(ia+">' in:\n"+k)),oa=za,O=pa.shift(),za=Ua[O],m=m?"</"+m+">":"",oa&&(va+=V,V="",za?va+="-":(p=m+Ya+"@"+va+Xa+(sa||""),va=Ga.shift()));
za?(g?V+=g:b=m||ua||"",v&&(b+=v,V&&(b+=" "+ha+'="'+V+'"',V=""))):b=g?b+p+f+Ya+g+Xa+h+v:p||a;E&&g&&Sa(" No {^{ tags within elem markup ("+E+' ). Use data-link="..."');v&&(E=v,pa.unshift(O),O=v.slice(1),pa[0]&&pa[0]===ib[O]&&ka("Parent of <tr> must be <tbody>"),ma=Va[O],(za=Ua[O])&&!oa&&(Ga.unshift(va),va=""),oa=za,va&&za&&(va+="+"));return b}function r(a,b){var e,g,k,A,l=[];if(a){"@"===a._tkns.charAt(0)&&(b=K.previousSibling,K.parentNode.removeChild(K),K=d);for(F=a.length;F--;){G=a[F];k=G.ch;if(e=
G.path)for(B=e.length-1;g=e.charAt(B--);)"+"===g?"-"===e.charAt(B)?(B--,b=b.previousSibling):b=b.parentNode:b=b.lastChild;if("^"===k){if(v=Ca[e=G.id]){g=b&&(!K||K.parentNode!==b);if(!K||g)v.parentElem=b;G.elCnt&&g&&(b._dfr=(G.open?"#":"/")+e+k+(b._dfr||""));l.push([g?null:K,G])}}else if(C=la[e=G.id])(C.parentElem||(C.parentElem=b||K&&K.parentNode||c,C._.onRender=Ja,C._.onArrayChange=f,h(C)),g=C.parentElem,G.open)?(C._elCnt=G.elCnt,b?b._dfr="#"+e+k+(b._dfr||""):(C._prv||(g._dfr=p(g._dfr,"#"+e+k)),
C._prv=K)):(!b||K&&K.parentNode===b?K&&(C._nxt||(g._dfr=p(g._dfr,"/"+e+k)),C._nxt=K):(b._dfr="/"+e+k+(b._dfr||""),C._nxt=d),w=C.linkCtx,(A=C.ctx&&C.ctx.onAfterCreate||Ia)&&A.call(w,C))}for(F=l.length;F--;)ta.push(l[F])}return!a||a.elCnt}function t(a){var b,c;if(a)for(F=a.length,B=0;B<F;B++)if(G=a[B],L.id)L.id=L.id!==G.id&&L.id;else if(c=v=Ca[G.id].linkCtx.tag,!v.flow){if(!da){for(b=1;c=c.parent;)b++;ba=ba||b}!da&&b!==ba||ea&&v.tagName!==ea||X.push(v)}}function u(){H=Ta?c.querySelectorAll(Q):a(Q,c).get();
D=H.length;e&&e.innerHTML&&(N=Ta?e.querySelectorAll(Q):a(Q,e).get(),e=N.length?N[N.length-1]:e);for(z=ba=0;z<D;z++)if(K=H[z],e&&!Aa)Aa=K===e;else if(g&&K===g)break;else K.parentNode&&Ha(s(K,d,X&&nb))&&!L&&K.getAttribute(M)&&ta.push([K]);wa===Fa&&k===d&&c.getAttribute(M)&&ta.push([c]);Ea(e,za);Ea(g,za);if(!L){if(za&&va+V&&(K=g,va&&(g?r(s(va+"+",1),g):r(s(va,1),c)),r(s(V,1),c),g)){U=g.getAttribute(ha);if(D=U.indexOf(ra)+1)U=U.slice(D+ra.length-1);g.setAttribute(ha,V+U)}D=ta.length;for(z=0;z<D;z++)if(K=
ta[z],I=K[1],K=K[0],I){if(v=Ca[I.id]){if(w=v.linkCtx)v=w.tag,v.linkCtx=w;I.open?(K&&(v.parentElem=K.parentNode,v._prv=K),v._elCnt=I.elCnt,!v||v.onBeforeLink&&!1===v.onBeforeLink()||v._.bound||(v._.bound=!0,C=v.tagCtx.view,xa(d,v._prv,C,b,I.id)),v._.linking=!0):(v._nxt=K,v._.linking&&(fa=v.tagCtx,C=fa.view,delete v._.linking,v._.bound||(v._.bound=!0,xa(d,v._prv,C,b,I.id)),aa(v,fa)))}}else C=y(K),xa(K.getAttribute(M),K,C,b,d,m)}qa&&qa.resolve()}var E,w,v,z,D,B,F,H,K,C,G,I,N,J,S,R,P,X,da,ea,fa,ga,ba,
L,Y,ca,O,ma,na,U,za,oa,V,ra,Aa,qa,wa=this,Ba=wa._.id+"_",va="",ta=[],pa=[],Ga=[],Ia=wa.hlp(Da),Ha=r;l&&(qa=l.lazyLink&&a.Deferred(),l.tmpl?S="/"+l._.id+"_":(L=l.get,l.tag&&(Ba=l.tag+"^",l=!0)),l=!0===l);L&&(Ha=t,X=L.tags,da=L.deep,ea=L.name);c=c?""+c===c?a(c)[0]:c.jquery?c[0]:c:wa.parentElem||ja.body;ga=!T.noValidate&&c.contentEditable!==ya;O=c.tagName.toLowerCase();za=!!Ua[O];e=e&&W(e,za);g=g&&W(g,za)||null;if(k!=d){na=Y=ja.createElement("div");ra=V="";ca="http://www.w3.org/2000/svg"===c.namespaceURI?
"svg_ns":(J=gb.exec(k))&&J[1]||"";x&&J&&J[2]&&ka("Unsupported: "+J[2]);if(za){for(P=g;P&&!(R=s(P));)P=P.nextSibling;if(U=R?R._tkns:c._dfr){J=S||"";if(l||!S)J+="#"+Ba;B=U.indexOf(J);B+1&&(B+=J.length,ra=V=U.slice(0,B),U=U.slice(B),R?P.setAttribute(ha,U):c._dfr=U)}}ma=d;k=(""+k).replace(kb,q);ga&&pa.length&&Sa("Mismatched '<"+O+"...>' in:\n"+k);if(n)return;$a.appendChild(Y);ca=Z[ca]||Z.div;l=ca[0];for(na.innerHTML=ca[1]+k+ca[2];l--;)na=na.lastChild;$a.removeChild(Y);for(Y=ja.createDocumentFragment();ca=
na.firstChild;)Y.appendChild(ca);c.insertBefore(Y,g)}qa?setTimeout(u,0):u();return qa&&qa.promise()}function xa(b,c,e,f,g,h){var l,m,n,p,r,s,u,w;f=e.data===d?f||{}:e.data;if(g)h=Ca[g],h=h.linkCtx?h.linkCtx.tag:h,u=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:c,view:e,ctx:e.ctx,attr:oa,fn:h._.bnd,tag:h,_bndId:g},q(u,u.fn);else if(b&&c)for(l=e.tmpl,n=k(c),b=a.trim(b).replace(hb,"\\$&"),b=b.slice(-1)!==ma?D+":"+b+(n?":":"")+ma:b,t.lastIndex=0;m=t.exec(b);)w=t.lastIndex,n=g?oa:m[1],s=m[3],r=m[10],p=
d,u={data:f,elem:c,view:e,ctx:h||e.ctx,attr:n,_initVal:!m[2]},m[6]&&(!n&&(p=/:([\w$]*)$/.exec(r))&&(p=p[1],p!==d&&(r=-p.length-1,s=s.slice(0,r-1)+ma)),null===p&&(p=d),u.convert=m[5]||""),u.expr=n+s,(m=l.links[s])||(l.links[s]=m=C.tmplFn(s,l,!0,p)),u.fn=m,n||p===d||(u.convertBack=p),q(u,m),t.lastIndex=w}function q(a,c){function d(e,f){b.call(a,e,f,c)}d.noArray=!0;a._ctxCb=pa(a.view);a._hdlr=d;d(!0)}function p(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function m(a){return a&&
(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ha)||"")}function s(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:m(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||!a.type,f._tkns=b,b.replace(c||ob,d),f}function Ea(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(M)&&a.removeAttribute(M))}function W(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=
ja.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):m(c)||c.getAttribute(M)||c.setAttribute(M,""));return c}function aa(b,c){var e,f,g,h,k,l,m;e=c.view;var n=b.linkCtx=b.linkCtx||{tag:b,data:e.data,view:e,ctx:e.ctx};if(b.onAfterLink)b.onAfterLink(c,n);if(f=(e=b.targetTag?b.targetTag.linkedElem:b.linkedElem)&&e[0]){if(g=b._.radio)e=e.children("input[type=radio]");if(g||!b._.chging){h=C.cvt(b,b.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(b._.inline&&
(!k||k!==b&&k.targetTag!==b))for(f._jsvLnkdEl=b,k=n.elem?n.elem._jsvBnd:b._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)Aa(Ca[k[l]],b.convertBack);g&&(f[U]=h===f.value)}n._val=h}h!==d&&(g||f.value===d?f.contentEditable===ya&&(f.innerHTML=h):f.type===Ha?f[U]=h&&"false"!==h:e.val(h))}}if(f=f||":"===b.tagName&&n.elem)g=f._jsvTr,h=c.props.trigger,g!==h&&(f._jsvTr=h,e=e||a(f),V(e,g,"off"),V(e,h,"on"))}function Ia(a){setTimeout(function(){c(a)},0)}function V(a,b,d){b&&a[d](!0===b?
"keydown":b,!0===b?Ia:c)}function Aa(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function ra(b,c){var d,e;d=b.tagCtx.view;var f=b.tagCtxs||[b.tagCtx],g=f.length,h=!c;for(c=c||b._.bnd.call(d.tmpl,(b.linkCtx||d).data,d,z);g--;)d=
f[g],e=c[g],a.observable(d.props).setProperty(e.props),Y(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function ta(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd="",a=c.length;a--;)X(c[a],b._jsvLnkdEl,b);G(m(b)+(b._dfr||""))}}function X(b,c,e){var f,g,h,k=Ca[b];if(c)e===c.linkedElem[0]&&(delete e._jsvLnkdEl,delete c.linkedElem);else if(k){delete Ca[b];for(f in k.bnd)c=k.bnd[f],e=".obs"+k.cbId,a.isArray(c)?
a([c]).off(da+e).off(N+e):a(c).off(N+e),delete k.bnd[f];if(f=k.linkCtx){if(c=f.tag){if(e=c.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=c.linkedElem)&&h[0]||f.elem)&&e._jsvTr)V(h||a(e),g,"off"),e._jsvTr=d;if(c.onDispose)c.onDispose();c._elCnt||(c._prv&&c._prv.parentNode.removeChild(c._prv),c._nxt&&c._nxt.parentNode.removeChild(c._nxt))}delete f.view._.bnds[b]}delete C._cbBnds[k.cbId]}}function na(b,e){b===d?(S&&(a(S).off(w,c).off("blur","[contenteditable]",c),S=d),b=!0,Fa.removeViews(),
ta(ja.body.getElementsByTagName("*"))):e&&!0===b&&(e=e.jquery?e:a(e),e.each(function(){for(var a;(a=y(this,!0))&&a.parent;)a.parent.removeViews(a._.key,d,!0);ta(this.getElementsByTagName("*"));ta([this])}));return e}function O(a,b){return na(this,a,b)}function pa(b){b=b||a.view();return function(a,c){var d,e,f=[c];if(b&&a){if(a._jsvOb)return a._jsvOb.call(b.tmpl,c,b,z);if("~"===a.charAt(0)){if("~tag"===a.slice(0,4)&&(e=b.ctx,"."===a.charAt(4)&&(d=a.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),
c]:[];a=a.slice(1).split(".");if(c=b.hlp(a.shift()))a.length&&f.unshift(a.join(".")),f.unshift(c);return c?f:[]}if("#"===a.charAt(0))return"#data"===a?[]:[b,a.replace(jb,""),c]}}}function Ga(a){return a.type===Ha?a[U]:a.value}function r(a,b,c,d,e,f){var g,h,k,l,m,n,q=0,r=a===b;if(a){k=s(a)||[];g=0;for(h=k.length;g<h;g++){l=k[g];n=l.id;if(n===d&&l.ch===e)if(f)h=0;else break;r||(m="_"===l.ch?la[n]:Ca[n].linkCtx.tag,l.open?m._prv=b:l.close&&(m._nxt=b));q+=n.length+2}q&&a.setAttribute(ha,a.getAttribute(ha).slice(q));
a=b?b.getAttribute(ha):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ha,a):c._dfr=a)}else c._dfr=p(c._dfr,"#"+d+e),f||b||(c._dfr=p(c._dfr,"/"+d+e))}function G(a){var b,c,e;if(e=s(a,1,lb))for(a=0,b=e.length;a<b;a++)c=e[a],"_"===c.ch?(c=la[c.id])&&c.data!==d&&c.parent.removeViews(c._.key,d,!0):X(c.id)}function R(b,c,d){switch(d.change){case "set":b=b.tgt;for(c=b.length;c--&&b[c].key!==d.path;);-1===c?d.path&&a.observable(b).insert({key:d.path,
prop:d.value}):d.remove?a.observable(b).remove(c):a.observable(b[c]).setProperty("prop",d.value)}}function u(b,c,d){b=b.src;switch(d.change){case "set":"prop"===d.path?a.observable(b).setProperty(c.target.key,d.value):(a.observable(b).setProperty(d.oldValue,null),delete b[d.oldValue],a.observable(b).setProperty(d.value,c.target.prop));break;case "remove":c=d.items[0];a.observable(b).removeProperty(c.key);delete b[c.key];break;case "insert":c=d.items[0],c.key&&a.observable(b).setProperty(c.key,c.prop)}}
function H(a,b,c){return 0>c.indexOf(".")&&b[a]}var S,y,t,D,ma,ba,x,ka,M,F,Q,Z,Fa,la,ja=e.document,z=a.views,C=z.sub,T=z.settings,Y=C.extend,L=a.isFunction,Ma=z.converters,qa=z.tags,ea=a.observable,La=ea.observe,ha="data-jsv",N=C.propChng=C.propChng||"propertyChange",da=C.arrChng=C.arrChng||"arrayChange",w="change.jsv",J="onBeforeChange",B="onAfterChange",Da="onAfterCreate",U="checked",Ha="checkbox",Ba="radio",ca="none",ya="true",Xa='">\x3c/script>',Ya='<script type="jsv',Pa="script,["+ha+"]",oa=
"html",Qa={value:"val",input:"val",html:oa,text:"text"},Za={from:"value",to:"value"},Ra=0,eb=a.cleanData,fb=T.delimiters,Sa=C.syntaxErr,gb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,hb=/['"\\]/g,$a=ja.createDocumentFragment(),Ta=ja.querySelector,Ua={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},ib={tr:"table"},Va={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},ab={},Ca={},
bb=1,jb=/^#(view\.?)?/,kb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,cb=/(#)()(\d+)(_)/g,lb=/(#)()(\d+)([_^])/g,mb=/(?:(#)|(\/))(\d+)(_)/g,nb=/(#)()(\d+)(\^)/g,ob=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,db=e.getComputedStyle;if(!a)throw"JsViews requires jQuery";if(!a.views)throw"JsViews requires JsRender";if(!a.observable)throw"JsViews requires jquery.observable";a.link||(F={contents:function(b,c){b!==!!b&&(c=b,b=d);var e,
f=a(this.nodes());f[0]&&(e=c?f.filter(c):f,f=b&&c?e.add(f.find(c)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,b){a!==!!a&&(b=a,a=d);var c=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&c.link(d,this.parentElem,
f?e.previousSibling:e,this._nxt,d,{get:{tags:g,deep:a,name:b,id:f&&this._tgId}});return g},refresh:function(a){var b,c=this.linkCtx,e=this.tagCtx.view;this.disposed&&ka("Removed tag");a===d&&(a=z._tag(this,e,e.tmpl,ra(this),!0));a+""===a&&(b=this._.inline?oa:c.attr||k(this.parentElem,!0),b=g(a,c,b,this));aa(this,this.tagCtx);return b||this},update:function(a){var b=this.linkedElem;b&&c({target:b[0]},d,a)}},C.onStore.template=function(b,c){c.link=fa;c.unlink=O;b&&(a.link[b]=function(){return fa.apply(c,
arguments)},a.unlink[b]=function(){return O.apply(c,arguments)})},C.onStore.tag=function(a,b){C._lnk(b)},C._lnk=function(a){return Y(a,F)},C.viewInfos=s,(T.delimiters=function(){var a=fb.apply(z,arguments);D=a[1];ma=a[2];ba=a[4];t=RegExp("(?:^|\\s*)([\\w-]*)(\\"+ba+")?(\\"+D+C.rTag+"\\"+ma+")","g");return this})(),Y(C._lnk(C.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==n(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)ea(f[a]).setProperty("index",
a);return this},removeViews:function(b,c,e){function f(b){var c,g,k,l,n,p=m[b];if(p&&p.link){b=p._.id;e||(n=p.nodes());p.removeViews(d,d,!0);p.data=d;k=p._prv;l=p._nxt;g=p.parentElem;e||(p._elCnt&&r(k,l,g,b,"_"),a(n).remove());if(!p._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(q){}h(p);for(c in p._.bnds)X(c);delete la[b]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(b===d)if(l){for(g=k;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(c===d&&
(l?c=1:(f(b),delete m[b])),l&&c){for(g=b+c;g-- >b;)f(g);m.splice(b,c);if(k=m.length)for(;b<k;)ea(m[b]).setProperty("index",b++)}return this},refresh:function(a){var b=this.parent;b&&(n(this,this.index,this.tmpl,b.views,this.data,a,!0),h(this));return this},link:wa}),la={0:Fa=new C.View(d,"top")},Ma.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:
""));return a},qa("on",{attr:ca,onAfterLink:function(b,c){for(var e,f,g=0,h=b.args,k=b.props.data,l=b.view,m=b.props.context;!L(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(b.params.args.slice(-f.length-1)[0]))&&C.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(c.data,l));if(e){if(this._evs)this.onDispose();a(c.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==d?null:k,this._hlr=function(a){return e.apply(m||c.data,[].concat(f,a,{change:a.type,view:l,linkCtx:c}))})}},onDispose:function(){a(this.parentElem).off(this._evs,
this._sel,this._hlr)},flow:!0}),Y(qa["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var b,c,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(b=0;b<=l;b++)c=h[b],e=c.map?c.map.tgt:
c.args.length?c.args[0]:c.view.data,(d=g[b])&&e!==d[0]&&(La(d[0],d[1],!0),delete g[b]),!g[b]&&a.isArray(e)&&(La(e,c=function(a,b){f.onArrayChange(a,b)}),g[b]=[e,c]);for(b=l+1;b<k;b++)if(d=g[b])La(d[0],d[1],!0),delete g[b];f._ars=g},onDispose:function(){for(var a in this._ars)La(this._ars[a][0],this._ars[a][1],!0)}}),Y(qa["for"],F),Y(qa["if"],F),Y(qa.include,F),qa("props",{baseTag:qa["for"],dataMap:z.map({getTgt:qa.props.dataMap.getTgt,obsSrc:R,obsTgt:u,tgtFlt:H})}),Y(a,{view:z.view=y=function(b,c,
e){c!==!!c&&(e=c,c=d);var f,g,h,k,l,m;m=0;l=ja.body;if(b&&b!==l&&1<Fa._.useKey&&(b=""+b===b?a(b)[0]:b.jquery?b[0]:b))if(c)for(m=Ta?b.querySelectorAll(Pa):a(Pa,b).get(),l=m.length,b=0;b<l;b++)for(f=m[b],g=s(f,d,cb),h=0,k=g.length;h<k;h++){if(f=g[h],f=la[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;b;){if(g=s(b,d,mb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=la[f.id])&&e?f.get(e):f||Fa;m--}else m++;b=b.previousSibling||b.parentNode}return c?d:Fa},link:z.link=ga,unlink:z.unlink=na,cleanData:function(b){b.length&&
Ra&&ta(b);eb.apply(a,arguments)}}),z.utility={validate:function(a){try{Fa.link(d,ja.createElement("div"),d,d,a,d,d,1)}catch(b){return b.message}}},Y(a.fn,{link:function(a,b,c,d,e,f,g){return ga(a,this,b,c,d,e,f,g)},unlink:function(a){return na(a,this)},view:function(a){return y(this[0],a)}}),a.each([oa,"replaceWith","empty","remove"],function(b,c){var d=a.fn[c];a.fn[c]=function(){var a;Ra=1;try{a=d.apply(this,arguments)}finally{Ra=0}return a}}),Y(Fa,{tmpl:{links:{},tags:{}}}),Fa._.onRender=Ja,T({wrapMap:Z=
{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:M="data-link",merge:{input:{from:Ga,to:"value"},textarea:Za,
select:Za,optgroup:{to:"label"}},jsrDbgMode:T.debugMode,debugMode:function(a){T.jsrDbgMode(a);a?e._jsv={views:la,bindings:Ca}:delete e._jsv},jsv:function(){T.debugMode(T._dbgMode);M=T.linkAttr;ka=z._err;Q=Pa+",["+M+"]";x=T.noDomLevel0;Z.optgroup=Z.option;Z.tbody=Z.tfoot=Z.colgroup=Z.caption=Z.thead;Z.th=Z.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
