(function(){var k=function(l){var h=l.classes.View,k=l.classes.View.prototype.init;h.prototype.init=function(){var c=this;this._binds=[];k.apply(this,arguments);this.on("insert",function(b,d){c._bindEvent("insert",b,d)});this.on("update",function(b,d){c._bindEvent("update",b,d)});this.on("remove",function(b,d){c._bindEvent("remove",b,d)});this.on("change",c._bindChange)};h.prototype.bind=function(c,b){if(b&&b.template)this._binds[c]=b;else throw"Cannot bind data to element, missing options information!";
return this};h.prototype.unBind=function(c){delete this._binds[c];return this};h.prototype.bindSortDom=function(c,b){var d=$(c),a,g,e;(this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.View.Bind: Sorting data in DOM...",b);for(a=0;a<b.length;a++)g=b[a],e=d.find("#"+g[this._primaryKey]),e.length?0===a?((this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.View.Bind: Sort, moving to index 0...",e),d.prepend(e)):((this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.View.Bind: Sort, moving to index "+
a+"...",e),e.insertAfter(d.children(":eq("+(a-1)+")"))):(this._debug||this._db&&this._db._debug)&&console.log("ForerunnerDB.View.Bind: Warning, element for array item not found!",g)};h.prototype.bindRefresh=function(c){var b=this._binds,d,a;c||(c={data:this.find()});for(d in b)b.hasOwnProperty(d)&&(a=b[d],(this._debug||this._db&&this._db._debug)&&console.log("Bind: sorting DOM..."),this.bindSortDom(d,c.data),a.afterOperation&&a.afterOperation(),a.refresh&&a.refresh())};h.prototype.bindRender=function(c,
b){var d=this._binds[c],a=$(c),g,e,f=$("<ul></ul>"),h;if(d){g=this._data.find();for(h=0;h<g.length;h++)e=g[h],d.template(e,function(b){f.append(b)});b?b(c,f.html()):a.append(f.html())}};h.prototype._bindEvent=function(c,b,d){var a=this._binds,g=this.find({}),e,f;for(f in a)if(a.hasOwnProperty(f))switch(e=a[f].reduce?this.find(a[f].reduce.query,a[f].reduce.options):g,c){case "insert":this._bindInsert(f,a[f],b,d,e);break;case "update":this._bindUpdate(f,a[f],b,d,e);break;case "remove":this._bindRemove(f,
a[f],b,d,e)}};h.prototype._bindChange=function(c){if(this._debug||this._db&&this._db._debug)console.log("ForerunnerDB.View.Bind: Bind data change, refreshing bind...",c),console.log("Bind: change received");this.bindRefresh(c)};h.prototype._bindInsert=function(c,b,d,a,g){var e=$(c),f;for(f=0;f<d.length;f++)c=e.find("#"+d[f][this._primaryKey]),c.length||b.template(d[f],function(a,d,c,f){return function(a){b.insert?b.insert(a,d,c,f):b.prependInsert?e.prepend(a):e.append(a);b.afterInsert&&b.afterInsert(a,
d,c,f)}}(c,d[f],a,g))};h.prototype._bindUpdate=function(c,b,d,a,g){var e=$(c);for(a=0;a<d.length;a++)c=e.find("#"+d[a][this._primaryKey]),b.template(d[a],function(a,d){return function(c){b.update?b.update(c,d,g,a.length?"update":"append"):a.length?a.replaceWith(c):b.prependUpdate?e.prepend(c):e.append(c);b.afterUpdate&&b.afterUpdate(c,d,g)}}(c,d[a]))};h.prototype._bindRemove=function(c,b,d,a,g){c=$(c);var e;for(e=0;e<d.length;e++)a=c.find("#"+d[e][this._primaryKey]),a.length&&(b.beforeRemove?b.beforeRemove(a,
d[e],g,function(a,c,d){return function(){b.remove?b.remove(a,c,d):(a.remove(),b.afterRemove&&b.afterRemove(a,c,d))}}(a,d[e],g)):b.remove?b.remove(a,d[e],g):(a.remove(),b.afterRemove&&b.afterRemove(a,d[e],g)))}};"function"===typeof define&&define.amd?define(["require","../ForerunnerDB","./ForerunnerDB.View"],function(l,h,m){return k(h)}):k(ForerunnerDB)})();
