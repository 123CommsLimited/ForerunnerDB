!function(Pa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Pa();else if("function"==typeof define&&define.amd)define([],Pa);else{var k;"undefined"!=typeof window?k=window:"undefined"!=typeof global?k=global:"undefined"!=typeof self&&(k=self);k.ForerunnerDB=Pa()}}(function(){return function k(m,f,h){function d(a,b){if(!f[a]){if(!m[a]){var g="function"==typeof require&&require;if(!b&&g)return g(a,!0);if(c)return c(a,!0);g=Error("Cannot find module '"+a+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=f[a]={exports:{}};m[a][0].call(g.exports,function(g){var c=m[a][1][g];return d(c?c:g)},g,g.exports,k,m,f,h)}return f[a].exports}for(var c="function"==typeof require&&require,b=0;b<h.length;b++)d(h[b]);return d}({1:[function(k,m,f){f=k("../lib/Core");k("../lib/CollectionGroup");k("../lib/View");k("../lib/Highcharts");k("../lib/Persist");k("../lib/Document");k("../lib/Overview");k("../lib/vendor/jsviews");m.exports=f},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Document":6,"../lib/Highcharts":7,
"../lib/Overview":12,"../lib/Persist":14,"../lib/View":16,"../lib/vendor/jsviews":17}],2:[function(k,m,f){var h,d,c,b,a;f=k("./Shared");var e=function(g){this.init.apply(this,arguments)};e.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new d("primary");this._primaryCrc=new d("primaryCrc");this._crcLookup=new d("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new h;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold=
{insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};f.addModule("Collection",e);f.inherit(e.prototype,f.chainSystem);h=k("./Metrics");d=k("./KeyValueStore");c=k("./Path");b=k("./Index");a=k("./Crc");k=f.modules.Core;e.prototype.debug=f.common.debug;e.prototype.crc=a;f.synthesize(e.prototype,"name");e.prototype.on=f.common.on;e.prototype.off=f.common.off;e.prototype.emit=f.common.emit;e.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],a;for(a=0;a<this._groups.length;a++)g.push(this._groups[a]);for(a=0;a<g.length;a++)this._groups[a].removeCollection(this);return!0}return!1};e.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};e.prototype._onInsert=function(g,a){this.emit("insert",
g,a)};e.prototype._onUpdate=function(g){this.emit("update",g)};e.prototype._onRemove=function(g){this.emit("remove",g)};f.synthesize(e.prototype,"db");e.prototype.setData=function(g,a,c){if(g){var b=this._metrics.create("setData");b.start();a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;a.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);b.time("transformIn");g=this.transformIn(g);b.time("transformIn");var e=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?
this.insert(g):this._data=this._data.concat(g));b.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(a);b.time("Rebuild Primary Key Index");b.time("Resolve chains");this.chainSend("setData",g,{oldData:e});b.time("Resolve chains");b.stop();this.emit("setData",this._data,e)}c&&c(!1);return this};e.prototype._rebuildPrimaryKeyIndex=function(g){var a=g&&void 0!==g.ensureKeys?g.ensureKeys:!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var c,b,e,d=this._primaryIndex,h=this._primaryCrc,
k=this._crcLookup,f=this._primaryKey,q;d.truncate();h.truncate();k.truncate();c=this._data;for(b=c.length;b--;)if(e=c[b],a&&this._ensurePrimaryKey(e),g){if(!d.uniqueSet(e[f],e))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+e[this._primaryKey];}else q=JSON.stringify(e),d.set(e[f],e),h.set(e[f],q),k.set(q,e)};e.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=
this.objectId())};e.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};e.prototype.upsert=function(g,a){if(g){var c=this._deferQueue.upsert,b=this._deferThreshold.upsert,e={},d;if(g instanceof Array){if(g.length>b){this._deferQueue.upsert=c.concat(g);this.processQueue("upsert",a);return}e=[];for(c=0;c<g.length;c++)e.push(this.upsert(g[c]));a&&a();return e}g[this._primaryKey]?(d={},d[this._primaryKey]=g[this._primaryKey],this._primaryIndex.lookup(d)[0]?
e.op="update":e.op="insert"):e.op="insert";switch(e.op){case "insert":e.result=this.insert(g);break;case "update":e.result=this.update(d,g)}return e}a&&a()};e.prototype.update=function(g,a,c){a=this.decouple(a);a=this.transformIn(a);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var b=this,e=this._metrics.create("update"),d=this._primaryKey,h,k,f=function(e){if(a&&void 0!==a[d]&&a[d]!=e[d]){b._primaryIndex.unSet(e[d]);var h=b._updateObject(e,a,g,c,"");
if(b._primaryIndex.uniqueSet(e[d],e))return h;throw"Primary key violation in update! Key violated: "+e[d];}return b._updateObject(e,a,g,c,"")};e.start();e.time("Retrieve documents to update");h=this.find(g,{$decouple:!1});e.time("Retrieve documents to update");h.length&&(e.time("Update documents"),k=h.filter(f),e.time("Update documents"),k.length&&(e.time("Resolve chains"),this.chainSend("update",{query:g,update:a},c),e.time("Resolve chains"),this._onUpdate(k),this.deferEmit("change",{type:"update",
data:k})));e.stop();return k||[]};e.prototype.updateById=function(g,a){var c={};c[this._primaryKey]=g;return this.update(c,a)};e.prototype._updateObject=function(g,a,b,e,d,h){a=this.decouple(a);d=d||"";"."===d.substr(0,1)&&(d=d.substr(1,d.length-1));var k=!1,f=!1,n,q,p,l;for(l in a)if(a.hasOwnProperty(l)){n=!1;if("$"===l.substr(0,1))switch(l){case "$index":break;default:n=!0,(f=this._updateObject(g,a[l],b,e,d,l))&&(k=!0)}if(this._isPositionalKey(l)&&(n=!0,l=l.substr(0,l.length-2),f=new c(d+"."+l),
g[l]&&g[l]instanceof Array&&g[l].length)){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],f.value(b)[0])&&q.push(p);for(p=0;p<q.length;p++)(f=this._updateObject(g[l][q[p]],a[l+".$"],b,e,d+"."+l,h))&&(k=!0)}if(!n)if(h||"object"!==typeof a[l])switch(h){case "$inc":this._updateIncrement(g,l,a[l]);k=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==a[l].$position&&a[l].$each instanceof Array)for(f=a[l].$position,n=a[l].$each.length,p=0;p<n;p++)this._updateSplicePush(g[l],
f+p,a[l].$each[p]);else if(a[l].$each instanceof Array)for(n=a[l].$each.length,p=0;p<n;p++)this._updatePush(g[l],a[l].$each[p]);else this._updatePush(g[l],a[l]);k=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],a[l])&&q.push(p);for(n=q.length;n--;)this._updatePull(g[l],q[n]),k=!0}break;case "$pullAll":if(g[l]instanceof Array)if(a[l]instanceof Array){if(q=g[l],n=q.length,0<n)for(;n--;){for(f=
0;f<a[l].length;f++)q[n]===a[l][f]&&(this._updatePull(g[l],n),n--,k=!0);if(0>n)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){p=g[l];var m;q=p.length;var F;n=!0;m=e&&e.$addToSet;var aa;m&&m.key?(f=!1,aa=new c(m.key),F=aa.value(a[l])[0]):(F=JSON.stringify(a[l]),f=!0);for(m=0;m<q;m++)if(f){if(JSON.stringify(p[m])===F){n=!1;break}}else if(F===aa.value(p[m])[0]){n=!1;break}n&&(this._updatePush(g[l],
a[l]),k=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(f=a.$index,void 0!==f)delete a.$index,this._updateSplicePush(g[l],f,a[l]),k=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(p=0;p<g[l].length;p++){if(this._match(g[l][p],a[l])){k=a[l].$index;if(void 0!==k)this._updateSpliceMove(g[l],
p,k),k=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,a[l]);k=!0;break;case "$rename":this._updateRename(g,l,a[l]);k=!0;break;case "$unset":this._updateUnset(g,l);k=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],a[l])&&(k=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),k=!0)}else if(null!==
g[l]&&"object"===typeof g[l])if(p=g[l]instanceof Array,q=a[l]instanceof Array,p||q)if(!q&&p)for(p=0;p<g[l].length;p++)(f=this._updateObject(g[l][p],a[l],b,e,d+"."+l,h))&&(k=!0);else g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),k=!0);else(f=this._updateObject(g[l],a[l],b,e,d+"."+l,h))&&(k=!0);else g[l]!==a[l]&&(this._updateProperty(g,l,a[l]),k=!0)}return k};e.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-2,2)};e.prototype._updateProperty=function(g,a,c){this._linked?(jQuery.observable(g).setProperty(a,
c),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+a+'" for collection "'+this.name()+'"')):(g[a]=c,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+a+'" for collection "'+this.name()+'"'))};e.prototype._updateIncrement=function(g,a,c){this._linked?jQuery.observable(g).setProperty(a,g[a]+c):g[a]+=c};e.prototype._updateSpliceMove=function(g,a,c){this._linked?(jQuery.observable(g).move(a,c),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+
a+'" to "'+c+'" for collection "'+this.name()+'"')):(g.splice(c,0,g.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+a+'" to "'+c+'" for collection "'+this.name()+'"'))};e.prototype._updateSplicePush=function(g,a,c){g.length>a?this._linked?jQuery.observable(g).insert(a,c):g.splice(a,0,c):this._linked?jQuery.observable(g).insert(c):g.push(c)};e.prototype._updatePush=function(g,a){this._linked?jQuery.observable(g).insert(a):g.push(a)};
e.prototype._updatePull=function(g,a){this._linked?jQuery.observable(g).remove(a):g.splice(a,1)};e.prototype._updateMultiply=function(g,a,c){this._linked?jQuery.observable(g).setProperty(a,g[a]*c):g[a]*=c};e.prototype._updateRename=function(g,a,c){var b=g[a];this._linked?(jQuery.observable(g).setProperty(c,b),jQuery.observable(g).removeProperty(a)):(g[c]=b,delete g[a])};e.prototype._updateUnset=function(g,a){this._linked?jQuery.observable(g).removeProperty(a):delete g[a]};e.prototype._updatePop=function(g,
a){var c,b=!1;0<g.length&&(this._linked?(1===a?c=g.length-1:-1===a&&(c=0),-1<c&&(jQuery.observable(arr).remove(c),b=!0)):1===a?(g.pop(),b=!0):-1===a&&(g.shift(),b=!0));return b};e.prototype.remove=function(g,a,c){var b,e;if(g instanceof Array){e=[];for(c=0;c<g.length;c++)e.push(this.remove(g[c],{noEmit:!0}));(!a||a&&!a.noEmit)&&this._onRemove(e);return e}c=this.find(g,{$decouple:!1});if(c.length){for(e=0;e<c.length;e++)b=c[e],this._removeIndex(b),b=this._data.indexOf(b),this._linked?jQuery.observable(this._data).remove(b):
this._data.splice(b,1);this.chainSend("remove",{query:g},a);(!a||a&&!a.noEmit)&&this._onRemove(c);this.deferEmit("change",{type:"remove",data:c})}return c};e.prototype.removeById=function(a){var c={};c[this._primaryKey]=a;return this.remove(c)};e.prototype.deferEmit=function(){var a=this,c;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(c=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){a.debug()&&
console.log("ForerunnerDB.Collection: Emitting "+c[0]);a.emit.apply(a,c)},100))};e.prototype.processQueue=function(a,c){var b=this._deferQueue[a],e=this._deferThreshold[a],d=this._deferTime[a];if(b.length){var h=this;b.length&&(b=b.length>e?b.splice(0,e):b.splice(0,b.length),this[a](b));setTimeout(function(){h.processQueue(a,c)},d)}else c&&c()};e.prototype.insert=function(a,c,b){"function"===typeof c?(b=c,c=this._data.length):void 0===c&&(c=this._data.length);a=this.transformIn(a);return this._insertHandle(a,
c,b)};e.prototype._insertHandle=function(a,c,b){var e=this._deferQueue.insert,d=this._deferThreshold.insert,h=[],k=[];if(a instanceof Array){if(a.length>d){this._deferQueue.insert=e.concat(a);this.processQueue("insert",b);return}for(d=0;d<a.length;d++)e=this._insert(a[d],c+d),!0===e?h.push(a[d]):k.push({doc:a[d],reason:e})}else e=this._insert(a,c),!0===e?h.push(a):k.push({doc:a,reason:e});this.chainSend("insert",a,{index:c});this._onInsert(h,k);b&&b();this.deferEmit("change",{type:"insert",data:h});
return{inserted:h,failed:k}};e.prototype._insert=function(a,c){if(a){var b;this._ensurePrimaryKey(a);if(b=this.insertIndexViolation(a))return"Index violation in index: "+b;this._insertIndex(a);c>this._data.length&&(c=this._data.length);this._linked?jQuery.observable(this._data).insert(c,a):this._data.splice(c,0,a);return!0}return"No document passed to insert"};e.prototype._insertIndex=function(a){var c=this._indexByName,b,e=JSON.stringify(a);this._primaryIndex.uniqueSet(a[this._primaryKey],a);this._primaryCrc.uniqueSet(a[this._primaryKey],
e);this._crcLookup.uniqueSet(e,a);for(b in c)c.hasOwnProperty(b)&&c[b].insert(a)};e.prototype._removeIndex=function(a){var c=this._indexByName,b,e=JSON.stringify(a);this._primaryIndex.unSet(a[this._primaryKey]);this._primaryCrc.unSet(a[this._primaryKey]);this._crcLookup.unSet(e);for(b in c)c.hasOwnProperty(b)&&c[b].remove(a)};e.prototype.subset=function(a,c){var b=this.find(a,c);return(new e)._subsetOf(this).primaryKey(this._primaryKey).setData(b)};e.prototype.subsetOf=function(){return this.__subsetOf};
e.prototype._subsetOf=function(a){this.__subsetOf=a;return this};e.prototype.distinct=function(a,b,e){b=this.find(b,e);a=new c(a);e={};var d=[],h,k;for(k=0;k<b.length;k++)(h=a.value(b[k])[0])&&!e[h]&&(e[h]=!0,d.push(h));return d};e.prototype.decouple=f.common.decouple;e.prototype.findById=function(a,c){var b={};b[this._primaryKey]=a;return this.find(b,c)[0]};e.prototype.peek=function(a,c){var b=this._data,d=b.length,h,k,f=new e;if("string"===typeof a){for(h=0;h<d;h++)k=JSON.stringify(b[h]),-1<k.indexOf(a)&&
f.insert(b[h]);return f.find({},c)}return this.find(a,c)};e.prototype.explain=function(a,c){return this.find(a,c).__fdbOp._data};e.prototype.find=function(a,b){a=a||{};b=b||{};b.$decouple=void 0!==b.$decouple?b.$decouple:!0;var e=this._metrics.create("find"),d=this,h,k=!0,f,A,n,q,p,l,m,F,aa,la=[];A=function(c){return d._match(c,a,"and")};e.start();if(a){e.time("analyseQuery");h=this._analyseQuery(a,b,e);e.time("analyseQuery");e.data("analysis",h);if(h.hasJoin&&h.queriesJoin){e.time("joinReferences");
for(n=0;n<h.joinsOn.length;n++)p=h.joinsOn[n],q=new c(h.joinQueries[p]),q=q.value(a)[0],this._db.collection(h.joinsOn[n]).subset(q);e.time("joinReferences")}h.indexMatch.length&&(!b||b&&!b.$skipIndex)?(e.data("index.potential",h.indexMatch),e.data("index.used",h.indexMatch[0].index),e.time("indexLookup"),f=h.indexMatch[0].lookup,e.time("indexLookup"),h.indexMatch[0].keyData.totalKeyCount===h.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):e.flag("usedIndex",!1);k&&(f&&f.length?(h=f.length,e.time("tableScan: "+
h),f=f.filter(A)):(h=this._data.length,e.time("tableScan: "+h),f=this._data.filter(A)),b.$orderBy&&(e.time("sort"),f=this.sort(b.$orderBy,f),e.time("sort")),e.time("tableScan: "+h));b.limit&&f&&f.length>b.limit&&(f.length=b.limit,e.data("limit",b.limit));b.$decouple&&(e.time("decouple"),f=this.decouple(f),e.time("decouple"),e.data("flag.decouple",!0));if(b.join){for(A=0;A<b.join.length;A++)for(p in b.join[A])if(b.join[A].hasOwnProperty(p))for(F=p,h=this._db.collection(p),k=b.join[A][p],aa=0;aa<f.length;aa++){m=
{};q=n=!1;for(l in k)if(k.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":F=k[l];break;case "$multi":n=k[l];break;case "$require":q=k[l];break;default:l.substr(0,3)}else m[l]=(new c(k[l])).value(f[aa])[0];m=h.find(m);!q||q&&m[0]?f[aa][F]=!1===n?m[0]:m:la.push(f[aa])}e.data("flag.join",!0)}if(la.length){e.time("removalQueue");for(l=0;l<la.length;l++)p=f.indexOf(la[l]),-1<p&&f.splice(p,1);e.time("removalQueue")}if(b.transform){e.time("transform");for(l=0;l<f.length;l++)f.splice(l,1,b.transform(f[l]));
e.time("transform");e.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(e.time("transformOut"),f=this.transformOut(f),e.time("transformOut"));e.data("results",f.length);e.stop()}else e.stop(),f=[];f.__fdbOp=e;return f};e.prototype.indexOf=function(a){if(a=this.find(a,{$decouple:!1})[0])return this._data.indexOf(a)};e.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=
a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.transformIn=function(a){if(this._transformEnabled&&this._transformIn){if(a instanceof Array){var c=[],b;for(b=0;b<a.length;b++)c[b]=this._transformIn(a[b]);return c}return this._transformIn(a)}return a};e.prototype.transformOut=function(a){if(this._transformEnabled&&this._transformOut){if(a instanceof
Array){var c=[],b;for(b=0;b<a.length;b++)c[b]=this._transformOut(a[b]);return c}return this._transformOut(a)}return a};e.prototype.sort=function(a,c){c=c||[];var b=[],e,d;for(e in a)a.hasOwnProperty(e)&&(d={},d[e]=a[e],d.___fdbKey=e,b.push(d));return 2>b.length?this._sort(a,c):this._bucketSort(b,c)};e.prototype._bucketSort=function(a,c){var b=a.shift(),e,d,h=[];if(0<a.length){c=this._sort(b,c);e=this.bucket(b.___fdbKey,c);for(d in e)e.hasOwnProperty(d)&&(b=[].concat(a),h=h.concat(this._bucketSort(b,
e[d])));return h}return this._sort(b,c)};e.prototype._sort=function(a,b){var e=new c,d=e.parse(a,!0)[0];e.path(d.path);return b.sort(1===d.value?function(a,c){var b=e.value(a)[0],g=e.value(c)[0];return"string"===typeof b&&"string"===typeof g?b.localeCompare(g):b>g?1:b<g?-1:0}:function(a,c){var b=e.value(a)[0],g=e.value(c)[0];return"string"===typeof b&&"string"===typeof g?1===b.localeCompare(g)?-1:1:b>g?-1:b<g?1:0})};e.prototype.bucket=function(a,c){var b,e={};for(b=0;b<c.length;b++)e[c[b][a]]=e[c[b][a]]||
[],e[c[b][a]].push(c[b]);return e};e.prototype._analyseQuery=function(a,b,e){var d={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:a,options:b},h,f=[],k=[],m,n,q,p,l;e.time("checkIndexes");void 0!==a[this._primaryKey]&&(e.time("checkIndexMatch: Primary Key"),m=new c,d.indexMatch.push({lookup:this._primaryIndex.lookup(a,b),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(a)},index:this._primaryIndex}),e.time("checkIndexMatch: Primary Key"));
for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],q=n.name(),e.time("checkIndexMatch: "+q),m=n.match(a,b),p=n.lookup(a,b),0<m.matchedKeyCount&&d.indexMatch.push({lookup:p,keyData:m,index:n}),e.time("checkIndexMatch: "+q),m.totalKeyCount===m.matchedKeyCount))break;e.time("checkIndexes");1<d.indexMatch.length&&(e.time("findOptimalIndex"),d.indexMatch.sort(function(a,b){return a.keyData.totalKeyCount===a.keyData.matchedKeyCount?-1:b.keyData.totalKeyCount===b.keyData.matchedKeyCount?
1:a.keyData.matchedKeyCount===b.keyData.matchedKeyCount?a.lookup.length-b.lookup.length:b.keyData.matchedKeyCount-a.keyData.matchedKeyCount}),e.time("findOptimalIndex"));if(b.join){d.hasJoin=!0;for(e=0;e<b.join.length;e++)for(h in b.join[e])b.join[e].hasOwnProperty(h)&&(f.push(h),"$as"in b.join[e][h]?k.push(b.join[e][h].$as):k.push(h));for(h=0;h<k.length;h++)if(b=this._queryReferencesCollection(a,k[h],""))d.joinQueries[f[h]]=b,d.queriesJoin=!0;d.joinsOn=f;d.queriesOn=d.queriesOn.concat(f)}return d};
e.prototype._queryReferencesCollection=function(a,b,c){for(var e in a)if(a.hasOwnProperty(e)){if(e===b)return c&&(c+="."),c+e;if("object"===typeof a[e])return c&&(c+="."),c+=e,this._queryReferencesCollection(a[e],b,c)}return!1};e.prototype._match=function(a,b,c){var e,d;e=typeof a;d=typeof b;var h=!0,f;if(!("string"!==e&&"number"!==e||"string"!==d&&"number"!==d))a!==b&&(h=!1);else for(f in b)if(b.hasOwnProperty(f)){e=!1;if("$"===f.substr(0,1))switch(f){case "$gt":if(a>b[f]){if("or"===c)return!0}else h=
!1;e=!0;break;case "$gte":if(a>=b[f]){if("or"===c)return!0}else h=!1;e=!0;break;case "$lt":if(a<b[f]){if("or"===c)return!0}else h=!1;e=!0;break;case "$lte":if(a<=b[f]){if("or"===c)return!0}else h=!1;e=!0;break;case "$exists":if(void 0===a!==b[f]){if("or"===c)return!0}else h=!1;e=!0;break;case "$or":e=!0;for(d=0;d<b[f].length;d++){if(this._match(a,b[f][d],"and"))return!0;h=!1}break;case "$and":e=!0;for(d=0;d<b[f].length;d++)if(!this._match(a,b[f][d],"and"))return!1;break;case "$in":if(b[f]instanceof
Array){e=b[f];d=e.length;var k,m=!1;for(k=0;k<d;k++)if(e[k]===a){m=!0;break}if(m){if("or"===c)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+f;e=!0;break;case "$nin":if(b[f]instanceof Array){e=b[f];d=e.length;m=!0;for(k=0;k<d;k++)if(e[k]===a){m=!1;break}if(m){if("or"===c)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+f;e=!0;break;case "$ne":if(a!=b[f]){if("or"===c)return!0}else h=!1;e=!0}if(!e&&b[f]instanceof RegExp)if(e=!0,"object"===
typeof a&&void 0!==a[f]&&b[f].test(a[f])){if("or"===c)return!0}else h=!1;if(!e)if("object"===typeof b[f])if(void 0!==a[f]){if(a[f]instanceof Array&&!(b[f]instanceof Array))for(e=!1,d=0;d<a[f].length&&!(e=this._match(a[f][d],b[f],void 0));d++);else if(!(a[f]instanceof Array)&&b[f]instanceof Array)for(e=!1,d=0;d<b[f].length&&!(e=this._match(a[f],b[f][d],void 0));d++);else e="object"===typeof a?this._match(a[f],b[f],void 0):this._match(void 0,b[f],void 0);if(e){if("or"===c)return!0}else h=!1}else if(b[f]&&
void 0!==b[f].$exists)if(e=this._match(void 0,b[f],void 0)){if("or"===c)return!0}else h=!1;else h=!1;else if(a&&a[f]===b[f]){if("or"===c)return!0}else if(a&&a[f]&&a[f]instanceof Array&&b[f]&&"object"!==typeof b[f]){e=!1;for(d=0;d<a[f].length&&!(e=this._match(a[f][d],b[f],void 0));d++);if(e){if("or"===c)return!0}else h=!1}else h=!1;if("and"===c&&!h)return!1}return h};e.prototype.count=function(a,b){return a?this.find(a,b).length:this._data.length};e.prototype.link=function(a,b){if(window.jQuery){this._links=
this._links||{};var c,e;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(c=this.objectId(b.template),e=b.template):c=b;if(!this._links[c]){if(jQuery(a).length){if(!jQuery.templates[c]){if(!e)if(e=jQuery(b),e.length)e=jQuery(e[0]).html();else throw"Unable to bind collection to target because template does not exist: "+b;jQuery.views.templates(c,e)}jQuery.templates[c].link(a,this._data);this._links[c]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+
this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.unlink=function(a,b){if(window.jQuery){this._links=this._links||{};var c;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(c=this.objectId(b.template)):c=b;if(this._links[c])return jQuery.templates[c].unlink(a),
delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+b)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.findSub=function(a,b,e,d){var h=new c(b);a=this.find(a);var f=a.length,k,m,n=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:f,subDocTotal:0,
subDocs:[],pathFound:!1,err:""};for(k=0;k<f;k++)if(m=h.value(a[k])[0]){n.setData(m);m=n.find(e,d);if(d.returnFirst&&m.length)return m[0];q.subDocs.push(m);q.subDocTotal+=m.length;q.pathFound=!0}n.drop();if(d.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+b);return q};e.prototype.insertIndexViolation=function(a){var b,c=this._indexByName,e,d;if(this._primaryIndex.get(a[this._primaryKey]))b=this._primaryIndex;else for(e in c)if(c.hasOwnProperty(e)&&
(d=c[e],d.unique()&&d.violation(a))){b=d;break}return b?b.name():!1};e.prototype.ensureIndex=function(a,c){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var e=new b(a,c,this),d={start:(new Date).getTime()};if(this._indexByName[e.name()])return{err:"Index with that name already exists"};if(this._indexById[e.id()])return{err:"Index with those keys already exists"};e.rebuild();this._indexByName[e.name()]=e;this._indexById[e.id()]=e;d.end=(new Date).getTime();d.total=d.end-
d.start;this._lastOp={type:"ensureIndex",stats:{time:d}};return{index:e,id:e.id(),name:e.name(),state:e.state()}};e.prototype.index=function(a){if(this._indexByName)return this._indexByName[a]};e.prototype.lastOp=function(){return this._metrics.list()};e.prototype.objectId=f.common.objectId;e.prototype.diff=function(a){var b={insert:[],update:[],remove:[]},c=this.primaryKey(),e,d,h,f;if(c===a.primaryKey()){e=a._data;f=e.length;for(d=0;d<f;d++)h=e[d],this._primaryIndex.get(h[c])?this._primaryCrc.get(h[c])!==
a._primaryCrc.get(h[c])&&b.update.push(h):b.insert.push(h);e=this._data;f=e.length;for(d=0;d<f;d++)h=e[d],a._primaryIndex.get(h[c])||b.remove.push(h)}return b};k.prototype.collection=function(a,b){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+a),this._collection[a]=this._collection[a]||(new e(a)).db(this),void 0!==b&&this._collection[a].primaryKey(b),this._collection[a];throw"Cannot get collection with undefined name!";};k.prototype.collectionExists=function(a){return Boolean(this._collection[a])};
k.prototype.collections=function(){var a=[],b;for(b in this._collection)this._collection.hasOwnProperty(b)&&a.push({name:b,count:this._collection[b].count()});return a};m.exports=e},{"./Crc":5,"./Index":8,"./KeyValueStore":9,"./Metrics":10,"./Path":13,"./Shared":15}],3:[function(k,m,f){var h,d;f=k("./Shared");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(b){this._name=b;this._data=new d("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};f.addModule("CollectionGroup",
c);f.inherit(c.prototype,f.chainSystem);d=k("./Collection");k=f.modules.Core;h=f.modules.Core.prototype.init;c.prototype.debug=f.common.debug;c.prototype.on=function(){this._data.on.apply(this._data,arguments)};c.prototype.off=function(){this._data.off.apply(this._data,arguments)};c.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};c.prototype.primaryKey=function(b){return void 0!==b?(this._primaryKey=b,this):this._primaryKey};f.synthesize(c.prototype,"db");c.prototype.addCollection=
function(b){if(b&&-1===this._collections.indexOf(b)){if(this._collections.length){if(this._primaryKey!==b.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(b.primaryKey());this._collections.push(b);b._groups.push(this);b.chain(this);this._data.insert(b.find())}return this};c.prototype.removeCollection=function(b){if(b){var a=this._collections.indexOf(b);-1!==a&&(b.unChain(this),this._collections.splice(a,1),a=b._groups.indexOf(this),-1!==
a&&b._groups.splice(a,1));0===this._collections.length&&delete this._primaryKey}return this};c.prototype.decouple=f.common.decouple;c.prototype._chainHandler=function(b,a,c,d){switch(a){case "setData":c=this.decouple(c);this._data.remove(d.oldData);this._data.insert(c);break;case "insert":c=this.decouple(c);this._data.insert(c);break;case "update":this._data.update(c.query,c.update,d);break;case "remove":this._data.remove(c.query,d)}};c.prototype.insert=function(){this._collectionsRun("insert",arguments)};
c.prototype.update=function(){this._collectionsRun("update",arguments)};c.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};c.prototype.remove=function(){this._collectionsRun("remove",arguments)};c.prototype._collectionsRun=function(b,a){for(var c=0;c<this._collections.length;c++)this._collections[c][b].apply(this._collections[c],a)};c.prototype.find=function(b,a){return this._data.find(b,a)};c.prototype.removeById=function(b){for(var a=0;a<this._collections.length;a++)this._collections[a].removeById(b)};
c.prototype.subset=function(b,a){var c=this.find(b,a);return(new d)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};c.prototype.drop=function(){var b,a=[].concat(this._collections),c=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(b=0;b<a.length;b++)this.removeCollection(a[b]);for(b=0;b<c.length;b++)this._removeView(c[b]);this.emit("drop");return!0};k.prototype.init=function(){this._collectionGroup={};h.apply(this,arguments)};k.prototype.collectionGroup=
function(b){return b?(this._collectionGroup[b]=this._collectionGroup[b]||(new c(b)).db(this),this._collectionGroup[b]):this._collectionGroup};m.exports=c},{"./Collection":2,"./Shared":15}],4:[function(k,m,f){var h,d;h=k("./Shared.js");f=function(){this.init.apply(this,arguments)};f.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};f.prototype.moduleLoaded=h.overload({string:function(c){if(void 0!==c){c=c.replace(/ /g,"");var b=c.split(","),a;for(a=0;a<b.length;a++)if(!h.modules[c])return!1;
return!0}return!1},"string, function":function(c,b){if(void 0!==c){c=c.replace(/ /g,"");var a=c.split(","),e;for(e=0;e<a.length;e++)if(!h.modules[c])return!1;b()}},"string, function, function":function(c,b,a){if(void 0!==c){c=c.replace(/ /g,"");var e=c.split(","),d;for(d=0;d<e.length;d++)if(!h.modules[c])return a(),!1;b()}}});f.moduleLoaded=f.prototype.moduleLoaded;f.shared=h;f.prototype.shared=h;h.addModule("Core",f);h.inherit(f.prototype,h.chainSystem);d=k("./Collection.js");k("./Metrics.js");k=
k("./Crc.js");f.prototype._isServer=!1;f.prototype.isClient=function(){return!this._isServer};f.prototype.isServer=function(){return this._isServer};f.prototype.crc=k;f.prototype.isClient=function(){return!this._isServer};f.prototype.isServer=function(){return this._isServer};f.prototype.decouple=h.common.decouple;f.prototype.debug=h.common.debug;f.prototype.arrayToCollection=function(c){return(new d).setData(c)};f.prototype.on=function(c,b){this._listeners=this._listeners||{};this._listeners[c]=
this._listeners[c]||[];this._listeners[c].push(b);return this};f.prototype.off=function(c,b){if(c in this._listeners){var a=this._listeners[c],e=a.indexOf(b);-1<e&&a.splice(e,1)}return this};f.prototype.emit=function(c,b){this._listeners=this._listeners||{};if(c in this._listeners){var a=this._listeners[c],e=a.length,d;for(d=0;d<e;d++)a[d].apply(this,Array.prototype.slice.call(arguments,1))}return this};f.prototype.objectId=h.common.objectId;f.prototype.peek=function(c){var b,a,e=[],d=typeof c;for(b in this._collection)this._collection.hasOwnProperty(b)&&
(a=this._collection[b],e="string"===d?e.concat(a.peek(c)):e.concat(a.find(c)));return e};f.prototype.peekCat=function(c){var b,a,e={},d,h=typeof c;for(b in this._collection)this._collection.hasOwnProperty(b)&&(a=this._collection[b],(d="string"===h?a.peek(c):a.find(c))&&d.length&&(e[a.name()]=d));return e};m.exports=f},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":10,"./Shared.js":15}],5:[function(k,m,f){var h=function(){var d=[],c,b,a;for(b=0;256>b;b++){c=b;for(a=0;8>a;a++)c=c&1?3988292384^c>>>
1:c>>>1;d[b]=c}return d}();m.exports=function(d){var c=-1,b;for(b=0;b<d.length;b++)c=c>>>8^h[(c^d.charCodeAt(b))&255];return(c^-1)>>>0}},{}],6:[function(k,m,f){var h,d;f=k("./Shared");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(b){this._name=b;this._data={}};f.addModule("Document",c);f.inherit(c.prototype,f.chainSystem);k=k("./Collection");h=f.modules.Core;d=f.modules.Core.prototype.init;f.synthesize(c.prototype,"db");f.synthesize(c.prototype,"name");c.prototype.setData=
function(b){var a,c;if(b)if(b=this.decouple(b),this._linked){c={};for(a in this._data)"jQuery"!==a.substr(0,6)&&this._data.hasOwnProperty(a)&&void 0===b[a]&&(c[a]=1);b.$unset=c;this._updateObject(this._data,b,{})}else this._data=b;return this};c.prototype.decouple=f.common.decouple;c.prototype.objectId=f.common.objectId;c.prototype.on=f.common.on;c.prototype.off=f.common.off;c.prototype.emit=f.common.emit;c.prototype.debug=f.common.debug;c.prototype.update=function(b,a,c){this._updateObject(this._data,
a,b,c)};c.prototype._updateObject=k.prototype._updateObject;c.prototype._isPositionalKey=function(b){return".$"===b.substr(b.length-2,2)};c.prototype._updateProperty=function(b,a,c){this._linked?(jQuery.observable(b).setProperty(a,c),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+a+'" for collection "'+this.name()+'"')):(b[a]=c,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+a+'" for collection "'+this.name()+
'"'))};c.prototype._updateIncrement=function(b,a,c){this._linked?jQuery.observable(b).setProperty(a,b[a]+c):b[a]+=c};c.prototype._updateSpliceMove=function(b,a,c){this._linked?(jQuery.observable(b).move(a,c),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+a+'" to "'+c+'" for collection "'+this.name()+'"')):(b.splice(c,0,b.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+a+'" to "'+
c+'" for collection "'+this.name()+'"'))};c.prototype._updateSplicePush=function(b,a,c){b.length>a?this._linked?jQuery.observable(b).insert(a,c):b.splice(a,0,c):this._linked?jQuery.observable(b).insert(c):b.push(c)};c.prototype._updatePush=function(b,a){this._linked?jQuery.observable(b).insert(a):b.push(a)};c.prototype._updatePull=function(b,a){this._linked?jQuery.observable(b).remove(a):b.splice(a,1)};c.prototype._updateMultiply=function(b,a,c){this._linked?jQuery.observable(b).setProperty(a,b[a]*
c):b[a]*=c};c.prototype._updateRename=function(b,a,c){var d=b[a];this._linked?(jQuery.observable(b).setProperty(c,d),jQuery.observable(b).removeProperty(a)):(b[c]=d,delete b[a])};c.prototype._updateUnset=function(c,a){this._linked?jQuery.observable(c).removeProperty(a):delete c[a]};c.prototype._updatePop=function(c,a){var e,d=!1;0<c.length&&(this._linked?(1===a?e=c.length-1:-1===a&&(e=0),-1<e&&(jQuery.observable(arr).remove(e),d=!0)):1===a?(c.pop(),d=!0):-1===a&&(c.shift(),d=!0));return d};c.prototype.link=
function(c,a){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var e,d;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(e=this.objectId(a.template),d=a.template):e=a;if(!this._links[e]){if(jQuery(c).length){if(!jQuery.templates[e]){if(!d)if(d=jQuery(a),d.length)d=jQuery(d[0]).html();else throw"Unable to bind document to target because template does not exist: "+a;jQuery.views.templates(e,d)}jQuery.templates[e].link(c,this._data);this._links[e]=c;this._linked++;
this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+c);return this}throw'Cannot bind view data to output target selector "'+c+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+c+" with the template: "+e;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};c.prototype.unlink=function(c,a){if(window.jQuery){this._links=this._links||{};var e;a&&"object"===typeof a?a.template&&
"string"===typeof a.template&&(e=this.objectId(a.template)):e=a;if(this._links[e])return jQuery.templates[e].unlink(c),delete this._links[e],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+this.name()+'" to output target: '+c),this;console.log("Cannot remove link, one does not exist to the target: "+c+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};c.prototype.drop=function(){this._db&&this._name&&
this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};h.prototype.init=function(){d.apply(this,arguments)};h.prototype.document=function(b){return b?(this._document=this._document||{},this._document[b]=this._document[b]||(new c(b)).db(this),this._document[b]):this._document};m.exports=c},{"./Collection":2,"./Shared":15}],7:[function(k,m,f){var h;k=k("./Shared");var d=function(c,b){this.init.apply(this,arguments)};d.prototype.init=function(c,
b){this._options=b;this._selector=$(this._options.selector);this._listeners={};this._collection=c;this._options.series=[];var a,e;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();a=this._collection.find();e={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};a=this.pieDataFromCollectionData(a,
this._options.keyField,this._options.valField);$.extend(e,this._options.seriesOptions);$.extend(e,{type:"pie",name:this._options.seriesName,data:a});this._chart.addSeries(e);break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=a.xAxis,this._options.chartOptions.series=a.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};
k=k.modules.Collection;h=k.prototype.init;d.prototype.pieDataFromCollectionData=function(c,b,a){var e=[],d;for(d=0;d<c.length;d++)e.push([c[d][b],c[d][a]]);return e};d.prototype.lineDataFromCollectionData=function(c,b,a,e){var d=this._collection.distinct(c),h=[],f={categories:[]},k,m,R,Y,A;for(Y=0;Y<d.length;Y++){k=d[Y];m={};m[c]=k;R=[];m=this._collection.find(m,{orderBy:e});for(A=0;A<m.length;A++)f.categories.push(m[A][b]),R.push(m[A][a]);h.push({name:k,data:R})}return{xAxis:f,series:h}};d.prototype._hookEvents=
function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};d.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var c=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(c,this._options.keyField,this._options.valField));break;case "line":c=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,
this._options.orderBy);this._chart.xAxis[0].setCategories(c.xAxis.categories);for(var b=0;b<c.series.length;b++)this._chart.series[b].setData(c.series[b].data)}}};d.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};d.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];
delete this._chart;delete this._options;delete this._collection;return this};k.prototype.init=function(){this._highcharts={};h.apply(this,arguments)};k.prototype.chart=function(c){this._highcharts[c.selector]||(this._highcharts[c.selector]=new d(this,c));return this._highcharts[c.selector]};k.prototype.dropChart=function(c){this._highcharts[c]&&this._highcharts[c].drop()};m.exports=d},{"./Shared":15}],8:[function(k,m,f){f=k("./Shared");var h=k("./Path");k=function(){this.init.apply(this,arguments)};
k.prototype.init=function(d,c,b){this._crossRef={};this._size=0;this._id=this._itemKeyHash(d,d);this.data({});this.unique(c&&c.unique?c.unique:!1);void 0!==d&&this.keys(d);void 0!==b&&this.collection(b);this.name(c&&c.name?c.name:this._id)};f.addModule("Index",k);f.inherit(k.prototype,f.chainSystem);k.prototype.id=function(){return this._id};k.prototype.state=function(){return this._state};k.prototype.size=function(){return this._size};k.prototype.data=function(d){return void 0!==d?(this._data=d,
this):this._data};f.synthesize(k.prototype,"name");k.prototype.collection=function(d){return void 0!==d?(this._collection=d,this):this._collection};k.prototype.keys=function(d){return void 0!==d?(this._keys=d,this._keyCount=(new h).parse(this._keys).length,this):this._keys};k.prototype.type=function(d){return void 0!==d?(this._type=d,this):this._type};k.prototype.unique=function(d){return void 0!==d?(this._unique=d,this):this._unique};k.prototype.rebuild=function(){if(this._collection){var d=this._collection.subset({},
{$decouple:!1,$orderBy:this._keys}).find(),c,b=d.length;this._data={};this._unique&&(this._uniqueLookup={});for(c=0;c<b;c++)this.insert(d[c])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};k.prototype.insert=function(d,c){var b,a;this._unique&&(b=this._itemHash(d,this._keys),this._uniqueLookup[b]=d);b=this._itemHashArr(d,this._keys);for(a=0;a<b.length;a++)this.pushToPathValue(b[a],d)};k.prototype.remove=function(d,c){var b,a;this._unique&&
(b=this._itemHash(d,this._keys),delete this._uniqueLookup[b]);b=this._itemHashArr(d,this._keys);for(a=0;a<b.length;a++)this.pullFromPathValue(b[a],d)};k.prototype.violation=function(d){d=this._itemHash(d,this._keys);return Boolean(this._uniqueLookup[d])};k.prototype.hashViolation=function(d){return Boolean(this._uniqueLookup[d])};k.prototype.pushToPathValue=function(d,c){var b=this._data[d]=this._data[d]||[];-1===b.indexOf(c)&&(b.push(c),this._size++,this.pushToCrossRef(c,b))};k.prototype.pullFromPathValue=
function(d,c){var b=this._data[d],a;a=b.indexOf(c);-1<a&&(b.splice(a,1),this._size--,this.pullFromCrossRef(c,b));b.length||delete this._data[d]};k.prototype.pull=function(d){var c=d[this._collection.primaryKey()],b=this._crossRef[c],a,e=b.length,g;for(a=0;a<e;a++)g=b[a],this._pullFromArray(g,d);this._size--;delete this._crossRef[c]};k.prototype._pullFromArray=function(d,c){for(var b=d.length;b--;)d[b]===c&&d.splice(b,1)};k.prototype.pushToCrossRef=function(d,c){var b=d[this._collection.primaryKey()];
this._crossRef[b]=this._crossRef[b]||[];b=this._crossRef[b];-1===b.indexOf(c)&&b.push(c)};k.prototype.pullFromCrossRef=function(d,c){var b=d[this._collection.primaryKey()];delete this._crossRef[b]};k.prototype.lookup=function(d){return this._data[this._itemHash(d,this._keys)]||[]};k.prototype.match=function(d,c){return(new h).countObjectPaths(this._keys,d)};k.prototype._itemHash=function(d,c){var b=new h,a,e="",g;a=b.parse(c);for(g=0;g<a.length;g++)e&&(e+="_"),e+=b.value(d,a[g].path).join(":");return e};
k.prototype._itemKeyHash=function(d,c){var b=new h,a,e="",g;a=b.parse(c);for(g=0;g<a.length;g++)e&&(e+="_"),e+=b.keyValue(d,a[g].path);return e};k.prototype._itemHashArr=function(d,c){var b=new h,a,e=[],g,f,k,m;a=b.parse(c);for(k=0;k<a.length;k++)for(g=b.value(d,a[k].path),f=0;f<g.length;f++)if(0===k)e.push(g[f]);else for(m=0;m<e.length;m++)e[m]=e[m]+"_"+g[f];return e};m.exports=k},{"./Path":13,"./Shared":15}],9:[function(k,m,f){k=k("./Shared");f=function(h){this.init.apply(this,arguments)};f.prototype.init=
function(h){this._name=h;this._data={};this._primaryKey="_id"};k.addModule("KeyValueStore",f);k.inherit(f.prototype,k.chainSystem);k.synthesize(f.prototype,"name");f.prototype.primaryKey=function(h){return void 0!==h?(this._primaryKey=h,this):this._primaryKey};f.prototype.truncate=function(){this._data={};return this};f.prototype.set=function(h,d){this._data[h]=d?d:!0;return this};f.prototype.get=function(h){return this._data[h]};f.prototype.lookup=function(h){h=h[this._primaryKey];var d,c,b,a;if(h instanceof
Array){c=h.length;a=[];for(d=0;d<c;d++)(b=this._data[h[d]])&&a.push(b);return a}if(h instanceof RegExp){a=[];for(d in this._data)this._data.hasOwnProperty(d)&&h.test(d)&&a.push(this._data[d]);return a}if("object"===typeof h){if(h.$ne){a=[];for(d in this._data)this._data.hasOwnProperty(d)&&d!==h.$ne&&a.push(this._data[d]);return a}if(h.$in&&h.$in instanceof Array){a=[];for(d in this._data)this._data.hasOwnProperty(d)&&-1<h.$in.indexOf(d)&&a.push(this._data[d]);return a}if(h.$nin&&h.$nin instanceof
Array){a=[];for(d in this._data)this._data.hasOwnProperty(d)&&-1===h.$nin.indexOf(d)&&a.push(this._data[d]);return a}if(h.$or&&h.$or instanceof Array){a=[];for(d=0;d<h.$or.length;d++)a=a.concat(this.lookup(h.$or[d]));return a}}else return b=this._data[h],void 0!==b?[b]:[]};f.prototype.unSet=function(h){delete this._data[h];return this};f.prototype.uniqueSet=function(h,d){return void 0===this._data[h]?(this._data[h]=d,!0):!1};m.exports=f},{"./Shared":15}],10:[function(k,m,f){f=k("./Shared");var h=
k("./Operation");k=function(){this.init.apply(this,arguments)};k.prototype.init=function(){this._data=[]};f.addModule("Metrics",k);f.inherit(k.prototype,f.chainSystem);k.prototype.create=function(d){d=new h(d);this._enabled&&this._data.push(d);return d};k.prototype.start=function(){this._enabled=!0;return this};k.prototype.stop=function(){this._enabled=!1;return this};k.prototype.clear=function(){this._data=[];return this};k.prototype.list=function(){return this._data};m.exports=k},{"./Operation":11,
"./Shared":15}],11:[function(k,m,f){f=k("./Shared");var h=k("./Path");k=function(d){this.pathSolver=new h;this.counter=0;this.init.apply(this,arguments)};k.prototype.init=function(d){this._data={operation:d,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};f.addModule("Operation",k);f.inherit(k.prototype,f.chainSystem);k.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};k.prototype.log=function(d){if(d){var c=0<this._log.length?
this._data.log[this._data.log.length-1].time:0;d={event:d,time:(new Date).getTime(),delta:0};this._data.log.push(d);c&&(d.delta=d.time-c);return this}return this._data.log};k.prototype.time=function(d){if(void 0!==d){var c=this._data.time.process,c=c[d]=c[d]||{};c.startMs?(c.stopMs=(new Date).getTime(),c.totalMs=c.stopMs-c.startMs,c.stepObj.totalMs=c.totalMs,delete c.stepObj):(c.startMs=(new Date).getTime(),c.stepObj={name:d},this._data.steps.push(c.stepObj));return this}return this._data.time};k.prototype.flag=
function(d,c){if(void 0!==d&&void 0!==c)this._data.flag[d]=c;else return void 0!==d?this._data.flag[d]:this._data.flag};k.prototype.data=function(d,c,b){return void 0!==c?(this.pathSolver.set(this._data,d,c),this):this.pathSolver.get(this._data,d)};k.prototype.pushData=function(d,c,b){this.pathSolver.push(this._data,d,c)};k.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=k},{"./Path":13,"./Shared":15}],
12:[function(k,m,f){var h,d,c;f=k("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){this._name=a;this._data=new c("__FDB__dc_data_"+this._name);this._collData=new d;this._collections=[]};f.addModule("Overview",b);f.inherit(b.prototype,f.chainSystem);d=k("./Collection");c=k("./Document");k=f.modules.Core;h=f.modules.Core.prototype.init;f.synthesize(b.prototype,"db");f.synthesize(b.prototype,"name");f.synthesize(b.prototype,"query",function(a){var c=this.$super(a);
void 0!==a&&this._refresh();return c});f.synthesize(b.prototype,"queryOptions",function(a){var c=this.$super(a);void 0!==a&&this._refresh();return c});f.synthesize(b.prototype,"reduce",function(a){var c=this.$super(a);void 0!==a&&this._refresh();return c});b.prototype.debug=f.common.debug;b.prototype.objectId=f.common.objectId;b.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};b.prototype.find=function(){return this._collData.find.apply(this._collData,
arguments)};b.prototype.count=function(){return this._collData.count.apply(this._collData,arguments)};b.prototype._addCollection=function(a){-1===this._collections.indexOf(a)&&(this._collections.push(a),a.chain(this),this._refresh());return this};b.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._refresh());return this};b.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());
var a=[],c;for(c=0;c<this._collections.length;c++)a=a.concat(this._collections[c].find(this._query,this._queryOptions));this._collData.setData(a)}this._reduce&&(a=this._reduce(),this._data.setData(a))};b.prototype._chainHandler=function(a,c,b,d){switch(c){case "setData":case "insert":case "update":case "remove":this._refresh()}};b.prototype.link=function(a,c){this._data.link.apply(this._data,arguments);this._refresh()};b.prototype.unlink=function(a,c){this._data.unlink.apply(this._data,arguments);
this._refresh()};k.prototype.init=function(){this._overview={};h.apply(this,arguments)};k.prototype.overview=function(a){return a?(this._overview[a]=this._overview[a]||(new b(a)).db(this),this._overview[a]):this._overview};m.exports=b},{"./Collection":2,"./Document":6,"./Shared":15}],13:[function(k,m,f){k=k("./Shared");f=function(h){this.init.apply(this,arguments)};f.prototype.init=function(h){h&&this.path(h)};k.addModule("Path",f);k.inherit(f.prototype,k.chainSystem);f.prototype.path=function(h){return void 0!==
h?(this._path=this.clean(h),this._pathParts=this._path.split("."),this):this._path};f.prototype.hasObjectPaths=function(h,d){var c=!0,b;for(b in h)if(h.hasOwnProperty(b)&&(void 0===d[b]||"object"===typeof h[b]&&(c=this.hasObjectPaths(h[b],d[b]),!c)))return!1;return c};f.prototype.countKeys=function(h){var d=0,c;for(c in h)h.hasOwnProperty(c)&&void 0!==h[c]&&("object"!==typeof h[c]?d++:d+=this.countKeys(h[c]));return d};f.prototype.countObjectPaths=function(h,d){var c,b={},a=0,e=0,g;for(g in d)d.hasOwnProperty(g)&&
("object"===typeof d[g]?(c=this.countObjectPaths(h[g],d[g]),b[g]=c.matchedKeys,e+=c.totalKeyCount,a+=c.matchedKeyCount):(e++,h&&h[g]&&"object"!==typeof h[g]?(b[g]=!0,a++):b[g]=!1));return{matchedKeys:b,matchedKeyCount:a,totalKeyCount:e}};f.prototype.parse=function(h,d){var c=[],b="",a,e,g;for(e in h)if(h.hasOwnProperty(e))if(b=e,"object"===typeof h[e])if(d)for(a=this.parse(h[e],d),g=0;g<a.length;g++)c.push({path:b+"."+a[g].path,value:a[g].value});else for(a=this.parse(h[e]),g=0;g<a.length;g++)c.push({path:b+
"."+a[g].path});else d?c.push({path:b,value:h[e]}):c.push({path:b});return c};f.prototype.parseArr=function(h,d){d=d||{};return this._parseArr(h,"",[],d)};f.prototype._parseArr=function(h,d,c,b){var a,e="";d=d||"";c=c||[];for(a in h)h.hasOwnProperty(a)&&(!b.ignore||b.ignore&&!b.ignore.test(a))&&(e=d?d+"."+a:a,"object"===typeof h[a]?this._parseArr(h[a],e,c,b):c.push(e));return c};f.prototype.value=function(h,d){if(void 0!==h&&"object"===typeof h){var c,b,a,e,g=[],f;void 0!==d&&(d=this.clean(d),c=d.split("."));
c=c||this._pathParts;b=c.length;a=h;for(f=0;f<b;f++){a=a[c[f]];if(e instanceof Array){for(b=0;b<e.length;b++)g=g.concat(this.value(e,b+"."+c[f]));return g}if(!a||"object"!==typeof a)break;e=a}return[a]}return[]};f.prototype.set=function(f,d,c){if(void 0!==f&&void 0!==d){var b;d=this.clean(d);d=d.split(".");b=d.shift();d.length?(f[b]=f[b]||{},this.set(f[b],d.join("."),c)):f[b]=c}return f};f.prototype.get=function(f,d){return this.value(f,d)[0]};f.prototype.push=function(f,d,c){if(void 0!==f&&void 0!==
d){var b;d=this.clean(d);d=d.split(".");b=d.shift();if(d.length)f[b]=f[b]||{},this.set(f[b],d.join("."),c);else if(f[b]=f[b]||[],f[b]instanceof Array)f[b].push(c);else throw"Cannot push to a path whose endpoint is not an array!";}return f};f.prototype.keyValue=function(f,d){var c,b,a,e,g;void 0!==d&&(d=this.clean(d),c=d.split("."));c=c||this._pathParts;b=c.length;a=f;for(g=0;g<b;g++)if(a=a[c[g]],!a||"object"!==typeof a){e=c[g]+":"+a;break}return e};f.prototype.clean=function(f){"."===f.substr(0,1)&&
(f=f.substr(1,f.length-1));return f};m.exports=f},{"./Shared":15}],14:[function(k,m,f){f=k("./Shared");var h,d,c,b;b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};f.addModule("Persist",b);f.inherit(b.prototype,f.chainSystem);f=f.modules.Core;h=k("./Collection");d=h.prototype.drop;k("./CollectionGroup");c=f.prototype.init;b.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};b.prototype.save=
function(a,c,b){switch(this.mode()){case "localStorage":c="object"===typeof c?"json::fdb::"+JSON.stringify(c):"raw::fdb::"+c;try{localStorage.setItem(a,c)}catch(d){if(b)b(d);else throw d;break}if(b)b(!1);else return!1;break;default:if(b)b("No data handler.");else throw"No data handler.";}};b.prototype.load=function(a,c){var b,d;switch(this.mode()){case "localStorage":try{b=localStorage.getItem(a)}catch(f){c(f,null)}if(b){b=b.split("::fdb::");switch(b[0]){case "json":d=JSON.parse(b[1]);break;case "raw":d=
b[1]}if(c)c(!1,d);else return d}break;default:if(c)c("No data handler or unrecognised data type.");else throw"No data handler or unrecognised data type.";}};b.prototype.drop=function(a,c){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(b){c&&c(b)}c&&c(!1);break;default:c&&c("No data handler or unrecognised data type.")}};h.prototype.drop=function(a){if(a)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),
"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";d.apply(this)};h.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,a);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";
else return a&&a("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};h.prototype.load=function(a){var c=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(b,d){if(b)return a&&a(b),b;d&&c.setData(d);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};
f.prototype.init=function(){this.persist=new b(this);c.apply(this,arguments)};m.exports=b},{"./Collection":2,"./CollectionGroup":3,"./Shared":15}],15:[function(k,m,f){var h=0,d=function(c){var b=[],a,e=["string","object","number","function","undefined"],g;if(-1<c.indexOf("*"))for(g=0;g<e.length;g++)a=c.replace("*",e[g]),b=b.concat(d(a));else b.push(c);return b};k=function(c){if(c){var b,a,e,g,f;if(!(c instanceof Array)){e={};for(b in c)if(c.hasOwnProperty(b))if(g=b.replace(/ /g,""),-1===g.indexOf("*"))e[g]=
c[b];else for(f=d(g),g=0;g<f.length;g++)e[f[g]]||(e[f[g]]=c[b]);c=e}return function(){if(c instanceof Array)for(a=c.length,b=0;b<a;b++){if(c[b].length===arguments.length)return c[b].apply(this,arguments)}else{var d=[],e;for(b=0;b<arguments.length;b++)d.push(typeof arguments[b]);e=d.join(",");if(c[e])return c[e].apply(this,arguments);for(b=d.length;0<=b;b--)if(e=d.slice(0,b).join(","),c[e+",..."])return c[e+",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments!";
}}return function(){}};k={modules:{},common:{decouple:function(c){return JSON.parse(JSON.stringify(c))},objectId:function(c){var b=Math.pow(10,17);if(c){var a=0,d=c.length,g;for(g=0;g<d;g++)a+=c.charCodeAt(g)*b;c=a.toString(16)}else h++,c=(h+(Math.random()*b+Math.random()*b+Math.random()*b+Math.random()*b)).toString(16);return c},debug:new k([function(){return this._debug&&this._debug.all},function(c){return void 0!==c?"boolean"===typeof c?(this._debug=this._debug||{},this._debug.all=c,this.chainSend("debug",
this._debug),this):this._debug&&this._debug[c]||this._db&&this._db._debug&&this._db._debug[c]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(c,b){return void 0!==c?void 0!==b?(this._debug=this._debug||{},this._debug[c]=b,this.chainSend("debug",this._debug),this):this._debug&&this._debug[b]||this._db&&this._db._debug&&this._db._debug[c]:this._debug&&this._debug.all}]),on:new k({"string, function":function(c,b){this._listeners=this._listeners||{};this._listeners[c]=this._listeners[c]||
{};this._listeners[c]["*"]=this._listeners[c]["*"]||[];this._listeners[c]["*"].push(b);return this},"string, *, function":function(c,b,a){this._listeners=this._listeners||{};this._listeners[c]=this._listeners[c]||{};this._listeners[c][b]=this._listeners[c][b]||[];this._listeners[c][b].push(a);return this}}),off:new k({string:function(c){this._listeners&&this._listeners[c]&&c in this._listeners&&delete this._listeners[c];return this},"string, function":function(c,b){var a,d;"string"===typeof b?this._listeners&&
this._listeners[c]&&this._listeners[c][b]&&delete this._listeners[c][b]:c in this._listeners&&(a=this._listeners[c]["*"],d=a.indexOf(b),-1<d&&a.splice(d,1));return this},"string, *, function":function(c,b,a){this._listeners&&c in this._listeners&&(c=this._listeners[c][b],a=c.indexOf(a),-1<a&&c.splice(a,1))}}),emit:function(c,b){this._listeners=this._listeners||{};if(c in this._listeners){if(this._listeners[c]["*"]){var a=this._listeners[c]["*"],d=a.length,g;for(g=0;g<d;g++)a[g].apply(this,Array.prototype.slice.call(arguments,
1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var a=this._listeners[c],f,h,d=b.length;for(g=0;g<d;g++)if(a[b[g][this._primaryKey]])for(f=a[b[g][this._primaryKey]].length,h=0;h<f;h++)a[b[g][this._primaryKey]][h].apply(this,Array.prototype.slice.call(arguments,1))}}return this}},_synth:{},addModule:function(c,b){this.modules[c]=b},inherit:function(c,b){for(var a in b)b.hasOwnProperty(a)&&(c[a]=b[a])},synthesize:function(c,b,a){this._synth[b]=this._synth[b]||function(a){return void 0!==a?
(this["_"+b]=a,this):this["_"+b]};if(a){var d=this;c[b]=function(){var c=this.$super,f;this.$super=d._synth[b];f=a.apply(this,arguments);this.$super=c;return f}}else c[b]=this._synth[b]},overload:k,chainSystem:{chain:function(c){this._chain=this._chain||[];-1===this._chain.indexOf(c)&&this._chain.push(c)},unChain:function(c){this._chain&&(c=this._chain.indexOf(c),-1<c&&this._chain.splice(c,1))},chainSend:function(c,b,a){if(this._chain){var d=this._chain,g=d.length,f;for(f=0;f<g;f++)d[f].chainReceive(this,
c,b,a)}},chainReceive:function(c,b,a,d){(!this._chainHandler||this._chainHandler&&!this._chainHandler(c,b,a,d))&&this.chainSend(b,a,d)}}};m.exports=k},{}],16:[function(k,m,f){var h,d,c;f=k("./Shared");var b=function(a,c,b){this.init.apply(this,arguments)};b.prototype.init=function(a,c,b){this._name=a;this._collections=[];this._groups=[];this._listeners={};this._querySettings={query:c,options:b};this._debug={};this._privateData=new h("__FDB__view_privateData_"+this._name)};f.addModule("View",b);f.inherit(b.prototype,
f.chainSystem);h=k("./Collection");CollectionGroup=k("./CollectionGroup");d=h.prototype.init;k=f.modules.Core;c=k.prototype.init;f.synthesize(b.prototype,"name");b.prototype.debug=f.common.debug;b.prototype.insert=function(){this._collectionsRun("insert",arguments)};b.prototype.update=function(){this._collectionsRun("update",arguments)};b.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};b.prototype.remove=function(){this._collectionsRun("remove",arguments)};b.prototype._collectionsRun=
function(a,c){for(var b=0;b<this._collections.length;b++)this._collections[b][a].apply(this._collections[b],c)};b.prototype.find=function(a,c){return this.publicData().find(a,c)};b.prototype.link=function(a,c){var b=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+b.name()+'" for output target: '+a);return b.link(a,c)};b.prototype.unlink=function(a,c){var b=this.publicData();this.debug()&&
console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+b.name()+'" for output target: '+a);return b.unlink(a,c)};b.prototype.decouple=f.common.decouple;b.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};b.prototype._addCollection=function(a){if(-1===this._collections.indexOf(a)){this._collections.push(a);a.chain(this);var c=a.find(this._querySettings.query,
this._querySettings.options);this._transformPrimaryKey(a.primaryKey());this._transformInsert(c);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(c)}return this};b.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._privateData.remove(a.find(this._querySettings.query,this._querySettings.options)));return this};b.prototype._chainHandler=function(a,c,b,d){var f,h;switch(c){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b=this.decouple(b);this._transformSetData(b);this._privateData.setData(b);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b=this.decouple(b);if(this._querySettings.options&&this._querySettings.options.$orderBy)if(f=[].concat(this._privateData._data),(a=b instanceof Array)?f=
f.concat(b):f.push(b),f=this._privateData.sort(this._querySettings.options.$orderBy,f),a)for(b.sort(function(a,c){return f.indexOf(a)-f.indexOf(c)}),a=0;a<b.length;a++)c=f.indexOf(b[a]),this._transformInsert(b,c),this._privateData._insertHandle(b,c);else c=f.indexOf(b),this._transformInsert(b,c),this._privateData._insertHandle(b,c);else c=d&&d.index?d.index:this._privateData._data.length,this._transformInsert(b,c),this._privateData._insertHandle(b,c);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b=this._privateData.update(b.query,b.update,b.options);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(f=[].concat(this._privateData._data),f=this._privateData.sort(this._querySettings.options.$orderBy,f),b.sort(function(a,c){return f.indexOf(a)-f.indexOf(c)}),a=0;a<b.length;a++)d=this._privateData._data.indexOf(b[a]),c=f.indexOf(b[a]),this._privateData._updateSpliceMove(this._privateData._data,
d,c);if(this._transformEnabled&&this._transformIn)for(c=this._publicData.primaryKey(),a=0;a<b.length;a++)d={},h=b[a],d[c]=h[c],this._transformUpdate(d,h);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(b.query,d),this._privateData.remove(b.query,d)}};b.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};b.prototype.off=
function(){this._privateData.off.apply(this._privateData,arguments)};b.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};b.prototype.drop=function(){if(this._collections&&this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name);for(var a=this._collections.length;a--;)this._removeCollection(this._collections[a]);this._privateData.drop();return!0}return!1};b.prototype.db=function(a){return void 0!==
a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};b.prototype.primaryKey=function(){return this._privateData.primaryKey()};b.prototype.queryData=function(a,c,b){void 0!==a&&(this._querySettings.query=a);void 0!==c&&(this._querySettings.options=c);return void 0!==a||void 0!==c?(void 0!==b&&!0!==b||this.refresh(),this):this._querySettings};b.prototype.queryAdd=function(a,c,b){var d=this._querySettings.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&(void 0===d[f]||
void 0!==d[f]&&c)&&(d[f]=a[f]);void 0!==b&&!0!==b||this.refresh()};b.prototype.queryRemove=function(a,c){var b=this._querySettings.query,d;if(void 0!==a)for(d in a)a.hasOwnProperty(d)&&delete b[d];void 0!==c&&!0!==c||this.refresh()};b.prototype.query=function(a,c){return void 0!==a?(this._querySettings.query=a,void 0!==c&&!0!==c||this.refresh(),this):this._querySettings.query};b.prototype.queryOptions=function(a,c){return void 0!==a?(this._querySettings.options=a,void 0===a.$decouple&&(a.$decouple=
!0),void 0!==c&&!0!==c||this.refresh(),this):this._querySettings.options};b.prototype.refresh=function(){var a,c=this.publicData(),b;this._privateData.remove();c.remove();for(b=0;b<this._collections.length;b++)a=this._collections[b],this._privateData.insert(a.find(this._querySettings.query,this._querySettings.options));a=this._privateData.find({},this._querySettings.options);c._linked?jQuery.observable(c._data).refresh(a):(this._privateData._data.length=0,this._privateData._data=this._privateData._data.concat(a));
return this};b.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};b.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):
{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};b.prototype.privateData=function(){return this._privateData};b.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};b.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new h("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),
this._publicData.setData(a))};b.prototype._transformInsert=function(a,c){this._transformEnabled&&this._publicData&&this._publicData.insert(a,c)};b.prototype._transformUpdate=function(a,c,b){this._transformEnabled&&this._publicData&&this._publicData.update(a,c,b)};b.prototype._transformRemove=function(a,c){this._transformEnabled&&this._publicData&&this._publicData.remove(a,c)};b.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};h.prototype.init=
function(){this._views=[];d.apply(this,arguments)};h.prototype.view=function(a,c,d){if(this._db&&this._db._views){if(this._db._views[a])throw"Cannot create a view using this collection because one with this name already exists: "+a;a=(new b(a,c,d)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a}};h.prototype._addView=CollectionGroup.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};h.prototype._removeView=CollectionGroup.prototype._removeView=
function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};k.prototype.init=function(){this._views={};c.apply(this,arguments)};k.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new b(a)).db(this);return this._views[a]};k.prototype.viewExists=function(a){return Boolean(this._views[a])};k.prototype.views=function(){var a=[],c;for(c in this._views)this._views.hasOwnProperty(c)&&
a.push({name:c,count:this._views[c].count()});return a};m.exports=b},{"./Collection":2,"./CollectionGroup":3,"./Shared":15}],17:[function(k,m,f){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(f,d,c){function b(a){return a}function a(a){debugger;return a}function e(c){Ma=(va._dbgMode=c)?"Unavailable (nested view): use #getIndex()":"";wa("dbg",Ia.dbg=na.dbg=c?a:b)}function g(a){this.name=(r.link?"JsViews":"JsRender")+" Error";this.message=a||this.name}function k(a,c){for(var b in c)a[b]=
c[b];return a}function m(a){return"function"===typeof a}function ja(a,c,b){if(!S.rTag||a)x=a?a.charAt(0):x,ha=a?a.charAt(1):ha,N=c?c.charAt(0):N,z=c?c.charAt(1):z,O=b||O,a="\\"+x+"(\\"+O+")?\\"+ha,c="\\"+N+"\\"+z,G="(?:(?:(\\w+(?=[\\/\\s\\"+N+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+N+"]|\\"+N+"(?!\\"+z+"))*?)",S.rTag=G+")",G=RegExp(a+G+"(\\/)?|(?:\\/(\\w+)))"+c,"g"),xa=RegExp("<.*>|([^\\\\]|^)[{}]|"+a+".*"+c);return[x,ha,N,z,O]}function Ja(a,b){b||(b=a,a=c);var d,e,f,g;
f=this;d=!b||"root"===b;if(a){if(g=f.type===b?f:c,!g)if(d=f.views,f._.useKey)for(e in d){if(g=d[e].get(a,b))break}else for(e=0,f=d.length;!g&&e<f;e++)g=d[e].get(a,b)}else if(d)for(;f.parent.parent;)g=f=f.parent;else for(;f&&!g;)g=f.type===b?f:c,f=f.parent;return g}function R(){var a=this.get("item");return a?a.index:c}function Y(){return this.index}function A(a){var b,d=this,e=d.linkCtx,g=(d.ctx||{})[a];g===c&&e&&e.ctx&&(g=e.ctx[a]);g===c&&(g=Ia[a]);g&&m(g)&&!g._wrp&&(b=function(){return g.apply(this&&
this!==f?this:d,arguments)},b._wrp=1,k(b,g));return b||g}function n(a,b,d){var e,f,g=+d===d&&d,h=b.linkCtx;g&&(d=(g=b.tmpl.bnds[g-1])(b.data,b,I));e=d.args[0];if(a||g){e=h&&h.tag;e||(e={_:{inline:!h,bnd:g},tagName:":",cvt:a,flow:!0,tagCtx:d,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,d.ctx=J(d.ctx,h.view.ctx)),S._lnk(e));for(f in d.props)Na.test(f)&&(e[f]=d.props[f]);d.view=b;e.ctx=d.ctx||{};delete d.ctx;b._.tag=e;e=q(e,e.convert||"true"!==a&&a)[0];e=g&&b._.onRender?b._.onRender(e,b,g):e;b._.tag=c}return e!=
c?e:""}function q(a,c){var b=a.tagCtx,d=b.view,e=b.args;c=c&&(""+c===c?d.getRsc("converters",c)||ka("Unknown converter: '"+c+"'"):c);e=e.length||b.index?c?e.slice():e:[d.data];c&&(c.depends&&(a.depends=S.getDeps(a.depends,a,c.depends,c)),e[0]=c.apply(a,e));return e}function p(a,b){for(var d,e=this;d===c&&e;)d=(d=e.tmpl[a])&&d[b],e=e.parent;return d||I[a][b]}function l(a,b,d,e,f){var g,h,s,l,H,m,u,t,r,p,E,D="",n=+e===e&&e,G=b.linkCtx||0,w=b.ctx,x=d||b.tmpl;"tag"===a._is&&(g=a,a=g.tagName,e=g.tagCtxs);
g=g||G.tag;n&&(e=(t=x.bnds[n-1])(b.data,b,I));m=e.length;for(H=0;H<m;H++){H||d&&g||(r=b.getRsc("tags",a)||ka("Unknown tag: {{"+a+"}}"));h=e[H];G.tag||(u=h.tmpl,u=h.content=u&&x.tmpls[u-1],k(h,{tmpl:(g?g:r).template||u,render:P,index:H,view:b,ctx:J(h.ctx,w)}));if(d=h.props.tmpl)d=""+d===d?b.getRsc("templates",d)||Ca(d):d,h.tmpl=d;g||(r._ctr?(g=new r._ctr,p=!!g.init,g.attr=g.attr||r.attr||c):S._lnk(g={render:r.render}),g._={inline:!G},G&&(G.attr=g.attr=G.attr||g.attr,G.tag=g,g.linkCtx=G),(g._.bnd=t||
G.fn)?g._.arrVws={}:g.dataBoundOnly&&ka("{^{"+a+"}} tag must be data-bound"),g.tagName=a,g.parent=l=w&&w.tag,g._is="tag",g._def=r,g.tagCtxs=e);if(!H)for(E in u=h.props)Na.test(E)&&(g[E]=u[E]);h.tag=g;g.dataMap&&g.tagCtxs&&(h.map=g.tagCtxs[H].map);g.flow||(u=h.ctx=h.ctx||{},h=g.parents=u.parentTags=w&&J(u.parentTags,w.parentTags)||{},l&&(h[l.tagName]=l),u.tag=g)}b._.tag=g;g.rendering={};for(H=0;H<m;H++){h=g.tagCtx=g.tagCtxs[H];u=h.props;a=q(g,g.convert);if(e=u.dataMap||g.dataMap)if(a.length||u.dataMap){l=
h.map;if(!l||l.src!==a[0]||f)l&&l.src&&l.unmap(),l=h.map=e.map(a[0],u);a=[l.tgt]}g.ctx=h.ctx;!H&&p&&(e=g.template,g.init(h,G,g.ctx),p=c,g.template!==e&&(g._.tmpl=g.template));l=c;if(e=g.render)l=e.apply(g,a);a=a.length?a:[b];l=l!==c?l:h.render(a[0],!0)||(f?c:"");D=D?D+(l||""):l}delete g.rendering;g.tagCtx=g.tagCtxs[0];g.ctx=g.tagCtx.ctx;g._.inline&&(s=g.attr)&&s!==K&&(D="text"===s?na.html(D):"");return n&&b._.onRender?b._.onRender(D,b,n):D}function Z(a,c,b,d,e,f,g,h){var k="array"===c,s={key:0,useKey:k?
0:1,id:""+Ha++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=b;this.type=c;this._=s;this.linked=!!h;b?(c=b.views,d=b._,d.useKey?(c[s.key="_"+d.useKey++]=this,this.index=Ma,this.getIndex=R,f=d.tag,s.bnd=k&&(!f||!!f._.bnd&&f)):c.splice(s.key=this.index=f,0,this),this.ctx=a||b.ctx):this.ctx=a}function F(a){var c,b,d,e,f,g;for(c in Q)if(e=Q[c],(f=e.compile)&&(b=a[c+"s"]))for(d in b)(e=b[d]=f(d,b[d],a))&&(g=S.onStore[c])&&g(d,e,f)}function aa(a,b,d){m(b)?b={depends:b.depends,
render:b}:(b.baseTag&&(b.flow=!!b.flow,b=k(k({},b.baseTag),b)),(a=b.template)!==c&&(b.template=""+a===a?Ca[a]||Ca(a):a),!1!==b.init&&(a=b._ctr=function(){},(a.prototype=b).constructor=a));d&&(b._parentTmpl=d);return b}function la(a,b,e,g){function k(b){if(""+b===b||0<b.nodeType){try{l=0<b.nodeType?b:!xa.test(b)&&d&&d(f.document).find(b)[0]}catch(s){}l&&(b=Ca[a=a||l.getAttribute(W)],b||(a=a||"_"+X++,l.setAttribute(W,a),b=Ca[a]=la(a,l.innerHTML,e,g)),l=c);return b}}var s,l;b=b||"";s=k(b);g=g||(b.markup?
b:{});g.tmplName=a;e&&(g._parentTmpl=e);!s&&b.markup&&(s=k(b.markup))&&s.fn&&(s.debug!==b.debug||s.allowCode!==b.allowCode)&&(s=s.markup);if(s!==c)return a&&!e&&(w[a]=function(){return b.render.apply(b,arguments)}),s.fn||b.fn?s.fn&&(b=a&&a!==s.tmplName?J(g,s):s):(b=La(s,g),oa(s.replace(y,"\\$&"),b)),F(g),b}function ma(a){function b(c,d){this.tgt=a.getTgt(c,d)}m(a)&&(a={getTgt:a});a.baseMap&&(a=k(k({},a.baseMap),a));a.map=function(a,c){return new b(a,c)};return a}function La(a,b){var c,d=va.wrapMap||
{},e=k({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:Da},b);b.htmlTag||(c=da.exec(a),e.htmlTag=c?c[1].toLowerCase():"");(c=d[e.htmlTag])&&c!==d.div&&(e.markup=r.trim(e.markup));return e}function pa(a,b){function d(f,g,h){var k,s,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(s in f)d(s,f[s],g);return I}g===c&&(g=f,f=c);f&&""+f!==f&&(h=g,g=f,f=c);l=h?h[e]=h[e]||{}:d;s=b.compile;null===g?f&&delete l[f]:(g=s?g=s(f,g,h):g,f&&(l[f]=g));s&&g&&(g._is=a);g&&(k=S.onStore[a])&&
k(f,g,s);return g}var e=a+"s";I[e]=d;Q[a]=b}function Aa(a,b){var c=this.jquery&&(this[0]||ka('Unknown template: "'+this.selector+'"')),d=c.getAttribute(W);return Da.call(d?Ca[d]:Ca(c),a,b)}function ra(a,b,c){if(va._dbgMode)try{return a.fn(b,c,I)}catch(d){return ka(d,c)}return a.fn(b,c,I)}function Da(a,b,c,d,e,f){return d||!this.fn._nvw||r.isArray(a)?P.call(this,a,b,c,d,e,f):ra(this,a,{tmpl:this})}function P(a,b,d,e,f,g){var h,k,s,l,H,u,m,t,p;s=this;var E="";!!b===b&&(d=b,b=c);!0===f&&(h=!0,f=0);s.tag?
(u=s,s=s.tag,k=s._,H=s.tagName,t=k.tmpl||u.tmpl,p=s.attr&&s.attr!==K,b=J(b,s.ctx),m=u.content,!1===u.props.link&&(b=b||{},b.link=!1),e=e||u.view,a=arguments.length?a:e):t=s;if(t&&(!e&&a&&"view"===a._is&&(e=a),e&&(m=m||e.content,g=g||e._.onRender,a===e&&(a=e.data),b=J(b,e.ctx)),e&&e.data!==c||((b=b||{}).root=a),t.fn||(t=Ca[t]||Ca(t)),t)){u=g=!1!==(b&&b.link)&&!p&&g;!0===g&&(u=c,g=e._.onRender);b=t.helpers?J(t.helpers,b):b;if(r.isArray(a)&&!d)for(l=h?e:f!==c&&e||new Z(b,"array",e,a,t,f,m,g),h=0,k=a.length;h<
k;h++)s=a[h],H=new Z(b,"item",l,s,t,(f||0)+h,m,g),s=ra(t,s,H),E+=l._.onRender?l._.onRender(s,H):s;else{if(e||!t.fn._nvw)l=h?e:new Z(b,H||"data",e,a,t,f,m,g),k&&!s.flow&&(l.tag=s);E+=ra(t,a,l)}return u?u(E,l):E}return""}function ka(a,b,c){c=va.onError(a,b,c);if(""+a===a)throw new S.Err(c);return!b.linkCtx&&b.linked?na.html(c):c}function ea(a){ka("Syntax error\n"+a)}function oa(a,b,c,d){function e(b){(b-=J)&&t.push(a.substr(J,b).replace(ia,"\\n"))}function f(b){b&&ea('Unmatched or missing tag: "{{/'+
b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,u=[],J=0,m=[],t=u,r=[,,u];c&&(a=x+a+z);f(m[0]&&m[0][2].pop()[0]);a.replace(G,function(g,H,u,p,E,D,n,q,G,w,x,I){D&&(E=":",p=K);w=w||c;H=(H||c)&&[];var y="",B="",fa="",sa="",ta="",Ka="",Oa="",Xa="";n=!w&&!E&&!n;u=u||(G=G||"#data",E);e(I);J=I+g.length;q?l&&t.push(["*","\n"+G.replace(ga,"$1")+"\n"]):u?("else"===u&&(T.test(G)&&ea('for "{{else if expr}}" use "{{else expr}}"'),H=r[7],r[8]=a.substring(r[8],I),r=m.pop(),t=r[2],n=!0),G&&s(G.replace(ia," "),
H,b).replace(M,function(a,b,c,d,e,f,g,h){g?(B+=f+",",sa+="'"+h+"',"):c?(fa+=d+f+",",Ka+=d+"'"+h+"',"):b?Oa+=f:("trigger"===e&&(Xa+=f),y+=d+f+",",ta+=d+"'"+h+"',",k=k||Na.test(e));return""}).slice(0,-1),h=[u,p||!!d||k||"",n&&[],[sa.slice(0,-1),ta.slice(0,-1),Ka.slice(0,-1)],[B.slice(0,-1),y.slice(0,-1),fa.slice(0,-1)],Oa,Xa,H||0],t.push(h),n&&(m.push(r),r=h,r[8]=J)):x&&(f(x!==r[0]&&"else"!==r[0]&&x),r[8]=a.substring(r[8],I),r=m.pop());f(!r&&x);t=r[2]});e(a.length);(J=u[u.length-1])&&f(""+J!==J&&+J[8]===
J[8]&&J[0]);c?(g=H(u,a,c),g.paths=u[0][7]):g=H(u,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Ga(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function s(a,b,c){var d,e,f,g,h,k=0,s=c?c.links:b&&(b.links=b.links||{}),l={},H={0:-1},u=0;return(a+(c?" ":"")).replace(/\)\^/g,").").replace(Fa,function(J,m,t,r,E,p,D,n,G,q,w,x,I,y,F,B,fa,sa,ta,Ka){function Oa(a,c,g,B,fa,h,sa,k){return g&&(b&&("linkTo"===d&&(e=b._jsvto=b._jsvto||
[],e.push(E)),d&&!f||b.push(E.slice(c.length))),"."!==g)?(a=(B?'view.hlp("'+B+'")':fa?"view":"data")+(k?(h?"."+h:B?"":fa?"":"."+g)+(sa||""):(k=B?"":fa?h||"":g,"")),a+=k?"."+k:"",c+("view.data"===a.slice(0,9)?a.slice(5):a)):a}p=p||"";t=t||m||x;E=E||G;q=q||fa||"";if(!D||h||g)return!b||!B||h||g||d&&!f&&!e||(B=H[u],Ka.length-1>ta-B&&(B=Ka.slice(B,ta+1),B=ha+":"+B+N,D=s[B],D||(s[B]=1,s[B]=D=oa(B,c||b,!0),D.paths.push({_jsvOb:D})),1!==D&&(e||b).push({_jsvOb:D}))),h?(h=!I,h?J:'"'):g?(g=!y,g?J:'"'):(t?(u++,
H[u]=ta++,t):"")+(sa?u?"":(k=Ka.slice(k,ta),d?(d=f=e=!1,"\b"):"\b,")+k+(k=ta+J.length,"\b"):n?(u&&ea(a),d=E,f=r,k=ta+J.length,E+":"):E?E.split("^").join(".").replace(V,Oa)+(q?(l[++u]=!0,"."!==E.charAt(0)&&(H[u]=ta),q):p):p?p:F?(l[u--]=!1,F)+(q?(l[++u]=!0,q):""):w?(l[u]||ea(a),","):m?"":(h=I,g=y,'"'));ea(a)})}function H(a,b,c){var e,f,g,h,k,s,l,u,J,m,t,r,E,p,D,n,q,G,w,x,I,y,F,N,z=0,B="",fa={},sa=a.length;""+b===b?(D=c?'data-link="'+b.replace(ia," ").slice(1,-1)+'"':b,b=0):(D=b.tmplName||"unnamed",
b.allowCode&&(fa.allowCode=!0),b.debug&&(fa.debug=!0),t=b.bnds,p=b.tmpls);for(e=0;e<sa;e++)if(f=a[e],""+f===f)B+='\n+"'+f+'"';else if(g=f[0],"*"===g)B+=";\n"+f[1]+"\nret=ret";else{h=f[1];G=f[2];k=Ga(f[3],"params")+"},"+Ga(E=f[4]);F=f[5];N=f[6];w=f[8];(I="else"===g)||(z=0,t&&(r=f[7])&&(z=t.push(r)));(f=":"===g)?h&&(g=h===K?">":h+g):(G&&(n=La(w,fa),n.tmplName=D+"/"+g,H(G,n),p.push(n)),I||(q=g,x=B,B=""),n=(n=a[e+1])&&"else"===n[0]);I=F?";\ntry{\nret+=":"\n+";if(f&&(r||N||h&&h!==K)){y="return {"+k+"};";
F&&(y="try {\n"+y+"\n}catch(e){return {error: j._err(e,view,"+F+")}}\n");y=new Function("data,view,j,u"," // "+D+" "+z+" "+g+"\n"+y);y.paths=r;y._tag=g;if(c)return y;m=1}B+=f?(c?(F?"\ntry{\n":"")+"return ":I)+(m?(m=0,J=u=!0,'c("'+h+'",view,'+(r?(t[z-1]=y,z):"{"+k+"}")+")"):">"===g?(l=!0,"h("+E[0]+")"):"((v="+E[0]+')!=null?v:"")'):(J=s=!0,"\n{view:view,tmpl:"+(G?p.length:"0")+","+k+"},");if(q&&!n){B="["+B.slice(0,-1)+"]";if(c||r)if(B=new Function("data,view,j,u"," // "+D+" "+z+" "+q+"\nreturn "+B+
";"),r&&((t[z-1]=B).paths=r),B._tag=g,c)return B;B=x+I+'t("'+q+'",view,this,'+(z||B)+")";q=r=0}F&&(J=!0,B+=";\n}catch(e){ret"+(c?"urn ":"+=")+"j._err(e,view,"+F+");}\n"+(c?"":"ret=ret"))}B="// "+D+"\nj=j||"+(d?"jQuery.":"jsviews.")+"views;var v"+(s?",t=j._tag":"")+(u?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(c?";\n":',ret=""\n')+(fa.debug?"debugger;":"")+B+(c?"\n":";\nreturn ret;");try{B=new Function("data,view,j,u",B)}catch(ta){ea("Compiled template code:\n\n"+B+'\n: "'+ta.message+'"')}b&&
(b.fn=B);J||(B._nvw=!0);return B}function J(a,b){return a&&a!==b?b?k(k({},b),a):a:b&&k({},b)}function u(a){return ba[a]||(ba[a]="&#"+a.charCodeAt(0)+";")}function E(a){var b,c,d=[];if("object"===typeof a)for(b in a)(c=a[b])&&c.toJSON&&!c.toJSON()||m(c)||d.push({key:b,prop:c});return d}function D(a){return null!=a?ca.test(a)&&(""+a).replace(qa,u)||a:""}if(!(d&&d.render||f.jsviews)){var r,t,G,xa,Ma,x="{",ha="{",N="}",z="}",O="^",V=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,
Fa=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,ia=/[ \t]*(\r\n|\n|\r)/g,ga=/\\(['"])/g,y=/['"\\]/g,M=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,T=/^if\s/,da=/<(\w+)[>\s]/,ca=/[\x00`><\"'&]/,Na=/^on[A-Z]|^convert(Back)?$/,qa=/[\x00`><"'&]/g,X=0,Ha=0,ba={"&":"&amp;","<":"&lt;",">":"&gt;",
"\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},K="html",W="data-jsv-tmpl",w={},Q={template:{compile:la},tag:{compile:aa},helper:{},converter:{}},I={jsviews:"v1.0.0-beta",settings:function(a){k(va,a);e(va._dbgMode);va.jsv&&va.jsv()},sub:{View:Z,Err:g,tmplFn:oa,cvt:q,parse:s,extend:k,syntaxErr:ea,onStore:{},_lnk:b},map:ma,_cnvt:n,_tag:l,_err:ka};(g.prototype=Error()).constructor=g;R.depends=function(){return[this.get("item"),"index"]};Y.depends=function(){return["index"]};Z.prototype={get:Ja,getIndex:Y,
getRsc:p,hlp:A,_is:"view"};for(t in Q)pa(t,Q[t]);var Ca=I.templates,na=I.converters,Ia=I.helpers,wa=I.tags,S=I.sub,va=I.settings;d?(r=d,r.fn.render=Aa,r.observable&&(k(S,r.views.sub),I.map=r.views.map)):(r=f.jsviews={},r.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});r.render=w;r.views=I;r.templates=Ca=I.templates;va({debugMode:e,delimiters:ja,onError:function(a,b,d){b&&(a=d===c?"{Error: "+a+"}":m(d)?d(a,b):d);return a==c?"":a},_dbgMode:!0});
wa({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,b,c){var d;for(a=0;(d=this.tagCtxs[a])&&d.args.length;a++)if(d=d.args[0],b=!d!==!c[a].args[0],!this.convert&&d||b)return b;return!1},flow:!0},"for":{render:function(a){var b,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(b=!arguments.length)a=d.view.data;a!==
c&&(e+=d.render(a,b),f+=r.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:b,flow:!0}});wa("props",{baseTag:wa["for"],dataMap:ma(E)});na({html:D,attr:D,url:function(a){return a!=c?encodeURI(""+a):null===a?a:""}});ja()}})(this,this.jQuery);(function(f,d,c){function b(b){return F(b)?new e(b):new a(b)}function a(a){this._data=a;return this}function e(a){this._data=a;return this}function g(a,b){a=F(a)?a:[a];var c,d,e=b,f=e,h=a.length,
k=[];for(c=0;c<h;c++)d=a[c],P(d)?k=k.concat(g(d.call(b,b),b)):""+d!==d?(b=f=d,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(d));return k}function k(a,b){var c,d;for(c in a){d=!0;break}d||delete ra[b]}function m(a,b){if(!a.data||!a.data.off){var d,e,f,g=b.oldValue,h=b.value,k=a.data,l=k.observeAll,p=!k.cb.noArray,n=k.paths;if(a.type===Aa)(k.cb.array||k.cb).call(k,a,b);else if(k.prop===b.path||"*"===k.prop)g=typeof g===la&&(n[0]||p&&F(g))&&g,h=typeof(h=b.value)===la&&(n[0]||p&&F(h))&&h,l?(d=l._path+
"."+b.path,e=l.filter,f=[l.parents().slice()],g&&R(p,l.ns,[g],n,k.cb,!0,e,f,d),h&&R(p,l.ns,[h],n,k.cb,c,e,f,d)):(g&&R(p,[g],n,k.cb,!0),h&&R(p,[h],n,k.cb)),k.cb(a,b)}}function ja(){function a(b,c,e,f){var g,h=oa(w),k=F(w)?[w]:w;b=ca?b+"."+ca:b;if(A||f)h&&d(k).off(b,m);else{if(O=h&&d._data(w))for(N=(O=(O=O&&O.events)&&O[e?Aa:pa])&&O.length;N--;)if((z=O[N].data)&&z.cb._cId===x._cId&&z.ns===ca){if(e)return;("*"===c&&z.prop!==c||z.prop===t)&&d(w).off(b,m)}c=e?{}:{fullPath:n,paths:c?[c]:[],prop:t};c.ns=
ca;c.cb=x;T&&(c.observeAll={_path:T,path:function(){g=M.length;return T.replace(/[[.]/g,function(a){g--;return"["===a?"["+d.inArray(M[g-1],M[g]):"."})},parents:function(){return M},filter:da,ns:ca});d(k).on(b,null,c,m);ia&&(ia[d.data(w,"obId")||d.data(w,"obId",ka++)]=w)}}function e(a,b){a._ob=V(a,W);var c=W;return function(d,e){var g=a._ob,h=b.length;typeof g===la&&(f(g,!0),(h||X&&F(g))&&R(X,[g],b,x,V,!0));g=a._ob=V(a,c);typeof g===la&&(f(g),(h||X&&F(g))&&R(X,[g],b,x,V,[c]));x(d,e)}}function f(d,
e,g,h){if(X){var k=w,l=T;w=d;h&&(w=d[h],T+="."+h,da&&(w=b._fltr(h,d,T,da)));w&&(g||F(w))&&a(Aa+".observe"+(x?".obs"+(ha=x._cId=x._cId||ea++):""),c,!0,e);w=k;T=l}}var h,l,p,r,t,n,q,A,x,ha,N,z,O,V,aa,ia,ga,y,M,T,da,ca,Y,ma,X=!1!=this,ja=1,ba=Da,K=Array.apply(0,arguments);h=K.pop();var W=K.shift(),w=y=W,Q=K.length;W+""===W&&X&&(ca=W,W=w=y=K.shift(),Q--);if(P(h))x=h;else if(h+""===h&&(T=h,M=K.pop(),da=K.pop(),h=K.pop(),Q-=3),!0===h?A=h:h&&(W=h,ja=0),h=K[Q-1],Q&&h===c||P(h))x=K.pop(),Q--;Q&&P(K[Q-1])&&
(V=x,x=K.pop(),Q--);ba+=A?x?".obs"+x._cId:"":".obs"+(ha=x._cId=x._cId||ea++);A||(ia=ra[ha]=ra[ha]||{});Y=ca&&ca.match(La)||[""];for(ma=Y.length;ma--;)for(ca=Y[ma],F(y)?f(y,A,!0):A&&0===Q&&y&&a(ba,""),h=ga=0;h<Q;h++)if(n=K[h],""!==n){w=y;if(""+n===n){r=n.split("^");r[1]&&(ga=r[0].split(".").length,n=r.join("."),ga=n.split(".").length-ga);if(V&&(aa=V(n,y))){Q+=aa.length-1;Z.apply(K,[h--,1].concat(aa));continue}r=n.split(".")}else ja&&!P(n)&&(n._jsvOb&&(y=e(n,K.slice(h+1)),y.noArray=!X,y._cId=x._cId,
R(X,[W],K.slice(0,h),y,V),y=c,n=n._ob),w=n),y=n,r=[y];for(;w&&(t=r.shift())!==c;)if(typeof w===la){if(""+t===t){if(""===t)continue;if(r.length<ga+1&&!w.nodeType){if(!A&&(O=oa(w)&&d._data(w))){N=(O=(O=O.events)&&O[pa])&&O.length;for(p=0;N--;)!(z=O[N].data)||z.cb!==x||z.ns!==ca||z.prop!==t&&"*"!==z.prop||((l=r.join("."))&&z.paths.push(l),p++);if(p){w=w[t];continue}}if("*"===t){!A&&O&&O.length&&a(ba,"",!1,!0);P(w)?(q=w.depends)&&R(X,[q],x,A||W):a(ba,"");for(l in w)f(w,A,c,l);break}else t&&a(ba+"."+t,
r.join("."))}T&&(T+="."+t);t=w[t]}if(P(t)){(q=t.depends)&&R(X,[w],g(q,w),x,V,A||[W]);break}w=t}f(w,A)}ha&&k(ia,ha);return{cbId:ha,bnd:ia}}function Ja(){[].push.call(arguments,!0);return ja.apply(this,arguments)}function R(){var a=[].concat.apply([],arguments);return ja.apply(a.shift(),a)}function Y(a,b,c,d){a+""!==a&&(c=b,b=a,a="");n(a,this._data,b,c,[],"root",d)}function A(a,b,c){Y.call(this,a,b,c,!0)}function n(a,d,e,f,g,h,k){function l(c,d){p=c.length;for(x=h+"[]";p--;)(A=b._fltr(p,c,x,f))&&n(a,
A,e,f||"",g.slice(),x,d)}function m(b,c){h=b.data.observeAll._path;var d=g;g[0]!==b.target&&(g=g.slice(),g.unshift(b.target));switch(c.change){case "insert":l(c.items);break;case "remove":l(c.items,!0);break;case "refresh":l(c.oldItems,!0);l(b.target);break;case "set":x=h+"."+c.path,n(a,c.oldValue,e,0,g.slice(),x,!0),n(a,c.value,e,0,g.slice(),x)}e.apply(this,arguments);g=d}var p,q,x,A;if(typeof d===la){q=F(d)?"":"*";g.unshift(d);if(e){if(q||0!==f)m._cId=e._cId=e._cId||ea++,ja(a,d,q,m,k,f,g.slice(),
h)}else ja(a,d,q,c,k,f,g.slice(),h);if(q)for(p in d)"_"!==p.charAt(0)&&p!==aa&&(x=h+"."+p,(A=b._fltr(p,d,x,f))&&n(a,A,e,f||0,g.slice(),x,k));else l(d,k)}}function q(a,b,c){return 0>c.indexOf(".")&&0>c.indexOf("[")&&b[a]}if(!d)throw"jsViews/jsObservable require jQuery";if(!d.observable){f=d.views=d.views||{jsviews:"v1.0.0-alpha",sub:{}};var p=f.sub,l=d.event.special,Z=[].splice,F=d.isArray,aa=d.expando,la="object",ma=parseInt,La=/\S+/g,pa=p.propChng=p.propChng||"propertyChange",Aa=p.arrChng=p.arrChng||
"arrayChange",ra=p._cbBnds=p._cbBnds||{},Da=pa+".observe",P=d.isFunction,ka=1,ea=1,oa=d.hasData,Ga={};p.getDeps=function(){var a=arguments;return function(){for(var b,c,d=[],e=a.length;e--;)b=a[e--],(c=a[e])&&(d=d.concat(P(c)?c(b,b):c));return d}};d.observable=b;b._fltr=function(a,b,c,d){(a=d&&P(d)?d(a,b,c):b[a])&&(a=P(a)?a.set&&a.call(b):a);return typeof a===la&&a};b.Object=a;b.Array=e;d.observe=b.observe=ja;d.unobserve=b.unobserve=Ja;b._apply=R;a.prototype={_data:null,observeAll:Y,unobserveAll:A,
data:function(){return this._data},setProperty:function(a,b,d){var e,f=this._data;a=a||"";if(f)if(F(a))for(e=a.length;e--;)b=a[e],this.setProperty(b.name,b.value,d===c||d);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],b);else if(a!==aa){for(a=a.split(".");f&&1<a.length;)f=f[a.shift()];f&&this._setProperty(f,a[0],b,d)}return this},removeProperty:function(a){this.setProperty(a,Ga);return this},_setProperty:function(a,b,d,e){var f,g,h,k=b?a[b]:a;P(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));
if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)f?(f.call(a,d),d=g.call(a)):(h=d===Ga)?(delete a[b],d=c):b&&(a[b]=d),this._trigger(a,{change:"set",path:b,value:d,oldValue:k,remove:h})},_trigger:function(a,b){d(a).triggerHandler(pa,b)}};e.prototype={_data:null,observeAll:Y,unobserveAll:A,data:function(){return this._data},insert:function(a,b){var c=this._data;1===arguments.length&&(b=a,a=c.length);a=ma(a);-1<a&&a<=c.length&&(b=F(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,
b){var c=this._data,d=c.length;Z.apply(c,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},d)},remove:function(a,b){var d;d=this._data;a===c&&(a=d.length-1);a=ma(a);b=b?ma(b):0===b?0:1;-1<b&&-1<a&&(d=d.slice(a,a+b),(b=d.length)&&this._remove(a,b,d));return this},_remove:function(a,b,c){var d=this._data,e=d.length;d.splice(a,b);this._trigger({change:"remove",index:a,items:c},e)},move:function(a,b,c){c=c?ma(c):0===c?0:1;a=ma(a);b=ma(b);if(0<c&&-1<a&&-1<b&&a!==b){var d=this._data.slice(a,
a+c);(c=d.length)&&this._move(a,b,c,d)}return this},_move:function(a,b,c,d){var e=this._data,f=e.length;e.splice(a,c);e.splice.apply(e,[b,0].concat(d));this._trigger({change:"move",oldIndex:a,index:b,items:d},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,b){var c=this._data,d=c.length;Z.apply(c,[0,c.length].concat(b));this._trigger({change:"refresh",oldItems:a},d)},_trigger:function(a,b){var c=this._data,e=c.length,c=d([c]);c.triggerHandler(Aa,
a);e!==b&&c.triggerHandler(pa,{change:"set",path:"length",value:e,oldValue:b})}};l[pa]=l[Aa]={remove:function(a){var b,c,e,f,g=a.data;if(g&&(g.off=1,g=g.cb)&&(b=ra[g._cId])){a=d._data(this).events[a.type];for(e=a.length;e--&&!c;)c=(f=a[e].data)&&f.cb===g;c||(delete b[d.data(this,"obId")],k(b,g._cId))}}};f.map=function(a){function e(c,d,f){var g,h=this;this.src&&this.unmap();"object"===typeof c&&(h.src=c,h.tgt=f||h.tgt||[],h.options=d||h.options,h.update(),a.obsSrc&&b(h.src).observeAll(h.obs=function(b,
c){g||(g=1,a.obsSrc(h,b,c),g=0)},h.srcFlt),a.obsTgt&&b(h.tgt).observeAll(h.obt=function(b,c){g||(g=1,a.obsTgt(h,b,c),g=0)},h.tgtFlt))}(e.prototype={srcFlt:a.srcFlt||q,tgtFlt:a.tgtFlt||q,update:function(b){d.observable(this.tgt).refresh(a.getTgt(this.src,this.options=b||this.options))},unmap:function(){this.src&&(this.obs&&d.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&d.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=c)},map:e,_def:a}).constructor=e;P(a)&&(a=
{getTgt:a});a.baseMap&&(a=d.extend({},a.baseMap,a));a.map=function(a,b,c){return new e(a,b,c)};return a}}})(this,this.jQuery);(function(f,d,c){function b(a,b,e){var f,g,h,k,l,p,n,q,r,C=a.target,s=C._jsvBnd,v=/&(\d+)\+?/g;if(s)for(;h=v.exec(s);)if(h=Ba[h[1]])if(b=h.to){h=h.linkCtx;n=h.view;r=h.tag;p=d(C);l=n.hlp(Q);q=n.hlp(I);g=m(C);f=Ra[g];e===c&&(e=ca(g)?g(C):f?p[f]():p.attr(g));f=b[1];b=b[0];f&&(k=ca(f)?f:n.getRsc("converters",f));k&&(e=k.call(r,e));f=n.linkCtx;n.linkCtx=h;g={change:"change",oldValue:h._val,
value:e};if(!(l&&!1===l.call(h,a,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(a,g)||e===c)&&(l=b[0],e!==c&&l)){l=l._jsvOb?l._ob:l;r&&(r._.chging=!0);X(l).setProperty(b[2]||b[1],e);q&&q.call(h,a,g);if(r){if(r.onAfterChange)r.onAfterChange(a,g);delete r._.chging}h._val=e}n.linkCtx=f}}function a(a,b,f){var g,h,k,l=this.data,p=this.elem,n=this.convert;h=p.parentNode;var q=this.view,r=q.linkCtx,s=q.hlp(Q);q.linkCtx=this;if(h&&!(s&&b&&!1===s.call(this,a,b)||b&&"*"!==a.data.prop&&a.data.prop!==b.path)){b&&
(this.eventArgs=b);if(b||this._initVal){delete this._initVal;h=f.call(q.tmpl,l,q,y);a:{var C=h,t=k=this.tag;g=this.attr||m(p,!0,n!==c);var v,u,w=t&&t.parentElem||this.elem;if(C!==c){u=d(w);g=t&&t.attr||g;ca(C)&&ha(this.expr+": missing parens");"visible"===g&&(g="css-display");if(t=/^css-/.test(g)&&g.slice(4))v=d.style(w,t),+C===C&&(v=parseInt(v));else if("link"!==g){if("value"===g)w.type===Ia&&(v=u.prop(g=na));else if(g===wa)if(w.value===""+C)v=u.prop(na);else break a;v===c&&(v=(v=Ra[g])?u[v]():u.attr(g))}this._val=
v}}if(h&&h.error!==c)h=h.error;else if(k){h=h[0]?h:[h];f=b&&k.onUpdate&&!1===k.onUpdate(a,b,h);ra(k,h);if(f||g===S){g===U&&k.onBeforeLink&&k.onBeforeLink();ma(k,k.tagCtx);R(this,l,p);q.linkCtx=r;return}if(k._.chging)return;h=":"===k.tagName?y._cnvt(k.cvt,q,h[0]):y._tag(k,q,q.tmpl,h,!0)}else f._tag&&(h=(n=""===n?va:n)?y._cnvt(n,q,h):y._tag(f._tag,q,q.tmpl,h,!0),k=this.tag,g=this.attr||g);e(h,this,g,k)&&b&&(s=q.hlp(I))&&s.call(this,a,b);k&&ma(k,k.tagCtx)}R(this,l,p);q.linkCtx=r}}function e(a,b,e,g){var k,
l,m,p,n,q,r=a!==c,t=b.data,C=g&&g.parentElem||b.elem,u=d(C),v=b.view;q=b._val;var w=v.ctx,y=v.linkCtx,x=g||e===U;g&&(g.parentElem=g.parentElem||b.expr||g._elCnt?C:C.parentNode,l=g._prv,m=g._nxt);if(r){if(/^css-/.test(e))"visible"===b.attr&&(b=(C.currentStyle||eb.call(f,C,"")).display,a?(a=C._jsvd||b,a!==S||(a=bb[k=C.nodeName])||(b=ga.createElement(k),ga.body.appendChild(b),a=bb[k]=(b.currentStyle||eb.call(f,b,"")).display,ga.body.removeChild(b))):(C._jsvd=b,a=S)),(x=x||q!==a)&&d.style(C,e.slice(4),
a);else if("link"!==e){if(e===na)n=1,a=a&&"false"!==a;else if(e===wa)if(C.value===""+a)a=!0,n=1,e=na;else{R(b,t,C);return}else if("selected"===e||"disabled"===e||"multiple"===e||"readonly"===e)a=a&&"false"!==a?e:null;if(k=Ra[e])if(e===U){v.linkCtx=b;v.ctx=b.ctx;if(g&&g._.inline){e=g.nodes(!0);if(g._elCnt){if(l&&l!==m)s(l,m,C,g._tgId,"^",!0);else if(p=C._dfr)q=g._tgId+"^",k=p.indexOf("#"+q)+1,n=p.indexOf("/"+q),k&&0<n&&(k+=q.length,n>k&&(C._dfr=p.slice(0,k)+p.slice(n),H(p.slice(k,n))));l=l?l.previousSibling:
m?m.previousSibling:C.lastChild}d(e).remove();if(g&&g.onBeforeLink)g.onBeforeLink();p=v.link(v.data,C,l,m,a,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{r&&u.empty();if(g&&g.onBeforeLink)g.onBeforeLink();r&&(p=v.link(t,C,l,m,a,g&&{tag:g._tgId}))}v.linkCtx=y;v.ctx=w}else{if(x=x||q!==a)if("text"===e&&C.children&&!C.children[0])C.textContent!==c?C.textContent=a:C.innerText=null===a?"":a;else u[k](a)}else if(x=x||q!==a)u[n?"prop":"attr"](e,a!==c||n?a:null);b._val=a}return p||x}if(e===U&&g&&
g.onBeforeLink)g.onBeforeLink()}function g(a,b){var c=this.hlp(Q),d=this.hlp(I);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,e=b.items;switch(b.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,a,b)}}function k(a){var b,e=a.data,f=a._.bnd;if(!a._.useKey&&f){if(b=a._.bndArr)d([b[1]]).off(W,b[0]),a._.bndArr=c;f!==!!f&&f._.inline?e?f._.arrVws[a._.id]=a:delete f._.arrVws[a._.id]:
e&&(b=function(b){b.data&&b.data.off||g.apply(a,arguments)},d([e]).on(W,b),a._.bndArr=[b,e])}}function m(a,b,c){var d=a.nodeName.toLowerCase(),e=T.merge[d]||a.contentEditable===va&&{to:U,from:U};return e?b?"input"===d&&a.type===wa?wa:e.to:e.from:b?c?"text":U:""}function ja(a,b,e,g,f,h,k){var l,m,p,n=a.parentElem,q=a._prv,r=a._nxt,t=a._elCnt;q&&q.parentNode!==n&&ha("Missing parentNode");if(k)for(p in m=a.nodes(),t&&q&&q!==r&&s(q,r,n,a._.id,"_",!0),a.removeViews(c,c,!0),g=r,t&&(q=q?q.previousSibling:
r?r.previousSibling:n.lastChild),d(m).remove(),a._.bnds)P(p);else{if(b){l=g[b-1];if(!l)return!1;q=l._nxt}t?q=(g=q)?g.previousSibling:n.lastChild:g=q.nextSibling}b=e.render(f,h,a._.useKey&&k,a,k||b,!0);a.link(f,n,q,g,b,l)}function Ja(a,b,d){var e;d?(e="^`",b=b._.tag||{_:{inline:!0,bnd:d},tagCtx:{view:b},flow:!0},d=b._tgId,d||(Ba[d=cb++]=b,b._tgId=""+d)):(e="_`",ia[d=b._.id]=b);return"#"+d+e+(a!=c?a:"")+"/"+d+e}function R(a,b,d){var e,g=a.tag,f=a.convertBack,h=[],k=a._bndId||""+cb++,l=a._hdlr;delete a._bndId;
g&&(h=g.depends||h,h=ca(h)?g.depends(g):h,e=g.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&X._apply(!1,[b],a._depends,l,!0),b=X._apply(!1,[b],a.fn.paths,h,l,a._ctxCb),b.elem=d,b.linkCtx=a,b._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Ba[k]=b,e&&(b.to=[[],f]),(e||f!==c)&&Aa(b,g&&g.convertBack||f),g){if(g.onAfterBind)g.onAfterBind(b);g.flow||g._.inline||(d.setAttribute(ba,(d.getAttribute(ba)||"")+"#"+k+"^/"+k+"^"),g._tgId=""+k)}if(e&&e[0])for(g._.radio&&
(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=g}function Y(a,b,c,d,e,g,f){return A(this,a,b,c,d,e,g,f)}function A(a,e,g,f,h,k,l,m){if(a&&e){e=e.jquery?e:d(e);D||(D=ga.body,d(D).on(w,b).on("blur","[contenteditable]",b));for(var n,p,t,s,C,u,v,x=Ja,y=f&&"replace"===f.target,A=e.length;A--;)if(v=e[A],""+a===a)C=r(v),n=C.ctx,C.ctx=f,q(a,v,C,g),C.ctx=n;else{k=k||r(v);if(a.markup!==c)!1===k.link&&(f=f||{},f.link=x=!1),y&&(u=v.parentNode),t=a.render(g,
f,h,k,c,x),u?(l=v.previousSibling,m=v.nextSibling,d.cleanData([v],!0),u.removeChild(v),v=u):(l=m=c,d(v).empty());else if(!0!==a)break;if(v._dfr&&!m){s=F(v._dfr,1,db);n=0;for(p=s.length;n<p;n++)C=s[n],(C=ia[C.id])&&C.data!==c&&C.parent.removeViews(C._.key,c,!0);v._dfr=""}k.link(g,v,l,m,t,c,f)}}return e}function n(a,b,e,f,h,m,n,p){function s(a,b,d,e,g,f,k,B,l,fa,sa,m,ta){var n,p="";if(ta)return C=0,a;v=B||l||"";e=e||fa;d=d||m;ka&&!d&&(e||v||f)&&(ka=c,ya=oa.shift());if(e=e||d)C=0,ka=c,da&&(d||m?Wa[ya]||
/;svg;|;math;/.test(";"+oa.join(";")+";")||(n="'<"+ya+".../"):Wa[e]?n="'</"+e:oa.length&&e===ya||(n="Mismatch: '</"+e),n&&Ta(n+">' in:\n"+h)),pa=za,ya=oa.shift(),za=Va[ya],fa=fa?"</"+fa+">":"",pa&&(ua+=Ea,Ea="",za?ua+="-":(p=fa+Za+"@"+ua+Ya+(sa||""),ua=Ga.shift()));za?(f?Ea+=f:b=fa||m||"",v&&(b+=v,Ea&&(b+=" "+ba+'="'+Ea+'"',Ea=""))):b=f?b+p+g+Za+f+Ya+k+v:p||a;C&&f&&Ta(" No {^{ tags within elem markup ("+C+' ). Use data-link="..."');v&&(C=v,oa.unshift(ya),ya=v.slice(1),oa[0]&&oa[0]===jb[ya]&&ha("Parent of <tr> must be <tbody>"),
ka=Wa[ya],(za=Va[ya])&&!pa&&(Ga.unshift(ua),ua=""),pa=za,ua&&za&&(ua+="+"));return b}function t(a,d){var e,f,h,B,sa=[];if(a){"@"===a._tkns.charAt(0)&&(d=L.previousSibling,L.parentNode.removeChild(L),L=c);for(G=a.length;G--;){E=a[G];h=E.ch;if(e=E.path)for(D=e.length-1;f=e.charAt(D--);)"+"===f?"-"===e.charAt(D)?(D--,d=d.previousSibling):d=d.parentNode:d=d.lastChild;if("^"===h){if(v=Ba[e=E.id]){f=d&&(!L||L.parentNode!==d);if(!L||f)v.parentElem=d;E.elCnt&&f&&(d._dfr=(E.open?"#":"/")+e+h+(d._dfr||""));
sa.push([f?null:L,E])}}else if(z=ia[e=E.id])(z.parentElem||(z.parentElem=d||L&&L.parentNode||b,z._.onRender=Ja,z._.onArrayChange=g,k(z)),f=z.parentElem,E.open)?(z._elCnt=E.elCnt,d?d._dfr="#"+e+h+(d._dfr||""):(z._prv||(f._dfr=l(f._dfr,"#"+e+h)),z._prv=L)):(!d||L&&L.parentNode===d?L&&(z._nxt||(f._dfr=l(f._dfr,"/"+e+h)),z._nxt=L):(d._dfr="/"+e+h+(d._dfr||""),z._nxt=c),y=z.linkCtx,(B=z.ctx&&z.ctx.onAfterCreate||Ia)&&B.call(y,z))}for(G=sa.length;G--;)xa.push(sa[G])}return!a||a.elCnt}function u(a){var b,
c;if(a)for(G=a.length,D=0;D<G;D++)if(E=a[D],S.id)S.id=S.id!==E.id&&S.id;else if(c=v=Ba[E.id].linkCtx.tag,!v.flow){if(!X){for(b=1;c=c.parent;)b++;ja=ja||b}!X&&b!==ja||Y&&v.tagName!==Y||W.push(v)}}function w(){I=Ua?b.querySelectorAll(O):d(O,b).get();H=I.length;e&&e.innerHTML&&(M=Ua?e.querySelectorAll(O):d(O,e).get(),e=M.length?M[M.length-1]:e);for(A=ja=0;A<H;A++)if(L=I[A],e&&!Aa)Aa=L===e;else if(f&&L===f)break;else L.parentNode&&Ha(F(L,c,W&&ob))&&!S&&L.getAttribute(N)&&xa.push([L]);wa===Fa&&h===c&&
b.getAttribute(N)&&xa.push([b]);aa(e,za);aa(f,za);if(!S){if(za&&ua+Ea&&(L=f,ua&&(f?t(F(ua+"+",1),f):t(F(ua,1),b)),t(F(Ea,1),b),f)){U=f.getAttribute(ba);if(H=U.indexOf(ra)+1)U=U.slice(H+ra.length-1);f.setAttribute(ba,Ea+U)}H=xa.length;for(A=0;A<H;A++)if(L=xa[A],J=L[1],L=L[0],J){if(v=Ba[J.id]){if(y=v.linkCtx)v=y.tag,v.linkCtx=y;J.open?(L&&(v.parentElem=L.parentNode,v._prv=L),v._elCnt=J.elCnt,!v||v.onBeforeLink&&!1===v.onBeforeLink()||v._.bound||(v._.bound=!0,z=v.tagCtx.view,q(c,v._prv,z,a,J.id)),v._.linking=
!0):(v._nxt=L,v._.linking&&(ca=v.tagCtx,z=ca.view,delete v._.linking,v._.bound||(v._.bound=!0,q(c,v._prv,z,a,J.id)),ma(v,ca)))}}else z=r(L),q(L.getAttribute(N),L,z,a,c,n)}qa&&qa.resolve()}var C,y,v,A,H,D,G,I,L,z,E,J,M,K,Q,R,P,W,X,Y,ca,da,ja,S,ea,Z,ya,ka,na,U,za,pa,Ea,ra,Aa,qa,wa=this,Da=wa._.id+"_",ua="",xa=[],oa=[],Ga=[],Ia=wa.hlp(Ca),Ha=t;m&&(qa=m.lazyLink&&d.Deferred(),m.tmpl?Q="/"+m._.id+"_":(S=m.get,m.tag&&(Da=m.tag+"^",m=!0)),m=!0===m);S&&(Ha=u,W=S.tags,X=S.deep,Y=S.name);b=b?""+b===b?d(b)[0]:
b.jquery?b[0]:b:wa.parentElem||ga.body;da=!T.noValidate&&b.contentEditable!==va;ya=b.tagName.toLowerCase();za=!!Va[ya];e=e&&la(e,za);f=f&&la(f,za)||null;if(h!=c){na=ea=ga.createElement("div");ra=Ea="";Z="http://www.w3.org/2000/svg"===b.namespaceURI?"svg_ns":(K=hb.exec(h))&&K[1]||"";x&&K&&K[2]&&ha("Unsupported: "+K[2]);if(za){for(P=f;P&&!(R=F(P));)P=P.nextSibling;if(U=R?R._tkns:b._dfr){K=Q||"";if(m||!Q)K+="#"+Da;D=U.indexOf(K);D+1&&(D+=K.length,ra=Ea=U.slice(0,D),U=U.slice(D),R?P.setAttribute(ba,U):
b._dfr=U)}}ka=c;h=(""+h).replace(lb,s);da&&oa.length&&Ta("Mismatched '<"+ya+"...>' in:\n"+h);if(p)return;ab.appendChild(ea);Z=V[Z]||V.div;m=Z[0];for(na.innerHTML=Z[1]+h+Z[2];m--;)na=na.lastChild;ab.removeChild(ea);for(ea=ga.createDocumentFragment();Z=na.firstChild;)ea.appendChild(Z);b.insertBefore(ea,f)}qa?setTimeout(w,0):w();return qa&&qa.promise()}function q(a,b,e,f,g,h){var k,l,n,q,r,s,u,w;f=e.data===c?f||{}:e.data;if(g)h=Ba[g],h=h.linkCtx?h.linkCtx.tag:h,u=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:
b,view:e,ctx:e.ctx,attr:U,fn:h._.bnd,tag:h,_bndId:g},p(u,u.fn);else if(a&&b)for(k=e.tmpl,n=m(b),a=d.trim(a).replace(ib,"\\$&"),a=a.slice(-1)!==xa?G+":"+a+(n?":":"")+xa:a,t.lastIndex=0;l=t.exec(a);)w=t.lastIndex,n=g?U:l[1],s=l[3],r=l[10],q=c,u={data:f,elem:b,view:e,ctx:h||e.ctx,attr:n,_initVal:!l[2]},l[6]&&(!n&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==c&&(r=-q.length-1,s=s.slice(0,r-1)+xa)),null===q&&(q=c),u.convert=l[5]||""),u.expr=n+s,(l=k.links[s])||(k.links[s]=l=M.tmplFn(s,k,!0,q)),u.fn=l,n||q===
c||(u.convertBack=q),p(u,l),t.lastIndex=w}function p(b,c){function d(e,f){a.call(b,e,f,c)}d.noArray=!0;b._ctxCb=oa(b.view);b._hdlr=d;d(!0)}function l(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function Z(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ba)||"")}function F(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:Z(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||
!a.type,f._tkns=b,b.replace(c||pb,d),f}function aa(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(N)&&a.removeAttribute(N))}function la(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ga.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):Z(c)||c.getAttribute(N)||c.setAttribute(N,""));return c}function ma(a,b){var e,f,g,h,k,l,m;e=b.view;var n=a.linkCtx=a.linkCtx||{tag:a,data:e.data,view:e,ctx:e.ctx};if(a.onAfterLink)a.onAfterLink(b,
n);if(f=(e=a.targetTag?a.targetTag.linkedElem:a.linkedElem)&&e[0]){if(g=a._.radio)e=e.children("input[type=radio]");if(g||!a._.chging){h=M.cvt(a,a.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(a._.inline&&(!k||k!==a&&k.targetTag!==a))for(f._jsvLnkdEl=a,k=n.elem?n.elem._jsvBnd:a._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)Aa(Ba[k[l]],a.convertBack);g&&(f[na]=h===f.value)}n._val=h}h!==c&&(g||f.value===c?f.contentEditable===va&&(f.innerHTML=h):f.type===
Ia?f[na]=h&&"false"!==h:e.val(h))}}if(f=f||":"===a.tagName&&n.elem)g=f._jsvTr,h=b.props.trigger,g!==h&&(f._jsvTr=h,e=e||d(f),pa(e,g,"off"),pa(e,h,"on"))}function La(a){setTimeout(function(){b(a)},0)}function pa(a,c,d){c&&a[d](!0===c?"keydown":c,!0===c?La:b)}function Aa(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],
b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function ra(a,b){var c,e;c=a.tagCtx.view;var f=a.tagCtxs||[a.tagCtx],g=f.length,h=!b;for(b=b||a._.bnd.call(c.tmpl,(a.linkCtx||c).data,c,y);g--;)c=f[g],e=b[g],d.observable(c.props).setProperty(e.props),da(c.ctx,e.ctx),c.args=e.args,h&&(c.tmpl=e.tmpl);return f}function Da(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd=
"",a=c.length;a--;)P(c[a],b._jsvLnkdEl,b);H(Z(b)+(b._dfr||""))}}function P(a,b,e){var f,g,h,k=Ba[a];if(b)e===b.linkedElem[0]&&(delete e._jsvLnkdEl,delete b.linkedElem);else if(k){delete Ba[a];for(f in k.bnd)b=k.bnd[f],e=".obs"+k.cbId,d.isArray(b)?d([b]).off(W+e).off(K+e):d(b).off(K+e),delete k.bnd[f];if(f=k.linkCtx){if(b=f.tag){if(e=b.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=b.linkedElem)&&h[0]||f.elem)&&e._jsvTr)pa(h||d(e),g,"off"),e._jsvTr=c;if(b.onDispose)b.onDispose();b._elCnt||
(b._prv&&b._prv.parentNode.removeChild(b._prv),b._nxt&&b._nxt.parentNode.removeChild(b._nxt))}delete f.view._.bnds[a]}delete M._cbBnds[k.cbId]}}function ka(a,e){a===c?(D&&(d(D).off(w,b).off("blur","[contenteditable]",b),D=c),a=!0,Fa.removeViews(),Da(ga.body.getElementsByTagName("*"))):e&&!0===a&&(e=e.jquery?e:d(e),e.each(function(){for(var a;(a=r(this,!0))&&a.parent;)a.parent.removeViews(a._.key,c,!0);Da(this.getElementsByTagName("*"));Da([this])}));return e}function ea(a,b){return ka(this,a,b)}function oa(a){a=
a||d.view();return function(b,c){var d,e,f=[c];if(a&&b){if(b._jsvOb)return b._jsvOb.call(a.tmpl,c,a,y);if("~"===b.charAt(0)){if("~tag"===b.slice(0,4)&&(e=a.ctx,"."===b.charAt(4)&&(d=b.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];b=b.slice(1).split(".");if(c=a.hlp(b.shift()))b.length&&f.unshift(b.join(".")),f.unshift(c);return c?f:[]}if("#"===b.charAt(0))return"#data"===b?[]:[a,b.replace(kb,""),c]}}}function Ga(a){return a.type===Ia?a[na]:a.value}function s(a,b,c,d,e,f){var g,h,k,
m,n,p,q=0,r=a===b;if(a){k=F(a)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?ia[p]:Ba[p].linkCtx.tag,m.open?n._prv=b:m.close&&(n._nxt=b));q+=p.length+2}q&&a.setAttribute(ba,a.getAttribute(ba).slice(q));a=b?b.getAttribute(ba):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ba,a):c._dfr=a)}else c._dfr=l(c._dfr,"#"+d+e),f||b||(c._dfr=l(c._dfr,"/"+d+e))}function H(a){var b,d,e;if(e=F(a,1,mb))for(a=
0,b=e.length;a<b;a++)d=e[a],"_"===d.ch?(d=ia[d.id])&&d.data!==c&&d.parent.removeViews(d._.key,c,!0):P(d.id)}function J(a,b,c){switch(c.change){case "set":a=a.tgt;for(b=a.length;b--&&a[b].key!==c.path;);-1===b?c.path&&d.observable(a).insert({key:c.path,prop:c.value}):c.remove?d.observable(a).remove(b):d.observable(a[b]).setProperty("prop",c.value)}}function u(a,b,c){a=a.src;switch(c.change){case "set":"prop"===c.path?d.observable(a).setProperty(b.target.key,c.value):(d.observable(a).setProperty(c.oldValue,
null),delete a[c.oldValue],d.observable(a).setProperty(c.value,b.target.prop));break;case "remove":b=c.items[0];d.observable(a).removeProperty(b.key);delete a[b.key];break;case "insert":b=c.items[0],b.key&&d.observable(a).setProperty(b.key,b.prop)}}function E(a,b,c){return 0>c.indexOf(".")&&b[a]}var D,r,t,G,xa,Ma,x,ha,N,z,O,V,Fa,ia,ga=f.document,y=d.views,M=y.sub,T=y.settings,da=M.extend,ca=d.isFunction,Na=y.converters,qa=y.tags,X=d.observable,Ha=X.observe,ba="data-jsv",K=M.propChng=M.propChng||"propertyChange",
W=M.arrChng=M.arrChng||"arrayChange",w="change.jsv",Q="onBeforeChange",I="onAfterChange",Ca="onAfterCreate",na="checked",Ia="checkbox",wa="radio",S="none",va="true",Ya='">\x3c/script>',Za='<script type="jsv',Qa="script,["+ba+"]",U="html",Ra={value:"val",input:"val",html:U,text:"text"},$a={from:"value",to:"value"},Sa=0,fb=d.cleanData,gb=T.delimiters,Ta=M.syntaxErr,hb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,ib=/['"\\]/g,ab=ga.createDocumentFragment(),Ua=ga.querySelector,Va={ol:1,ul:1,table:1,
tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},jb={tr:"table"},Wa={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},bb={},Ba={},cb=1,kb=/^#(view\.?)?/,lb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,db=/(#)()(\d+)(_)/g,mb=/(#)()(\d+)([_^])/g,nb=/(?:(#)|(\/))(\d+)(_)/g,ob=/(#)()(\d+)(\^)/g,pb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,
eb=f.getComputedStyle;if(!d)throw"JsViews requires jQuery";if(!d.views)throw"JsViews requires JsRender";if(!d.observable)throw"JsViews requires jquery.observable";d.link||(z={contents:function(a,b){a!==!!a&&(b=a,a=c);var e,f=d(this.nodes());f[0]&&(e=b?f.filter(b):f,f=a&&b?e.add(f.find(b)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&
(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,b){a!==!!a&&(b=a,a=c);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(c,this.parentElem,f?e.previousSibling:e,this._nxt,c,{get:{tags:g,deep:a,name:b,id:f&&this._tgId}});return g},refresh:function(a){var b,d=this.linkCtx,f=this.tagCtx.view;this.disposed&&ha("Removed tag");a===c&&(a=y._tag(this,f,f.tmpl,ra(this),!0));a+""===a&&(b=this._.inline?U:d.attr||m(this.parentElem,
!0),b=e(a,d,b,this));ma(this,this.tagCtx);return b||this},update:function(a){var d=this.linkedElem;d&&b({target:d[0]},c,a)}},M.onStore.template=function(a,b){b.link=Y;b.unlink=ea;a&&(d.link[a]=function(){return Y.apply(b,arguments)},d.unlink[a]=function(){return ea.apply(b,arguments)})},M.onStore.tag=function(a,b){M._lnk(b)},M._lnk=function(a){return da(a,z)},M.viewInfos=F,(T.delimiters=function(){var a=gb.apply(y,arguments);G=a[1];xa=a[2];Ma=a[4];t=RegExp("(?:^|\\s*)([\\w-]*)(\\"+Ma+")?(\\"+G+M.rTag+
"\\"+xa+")","g");return this})(),da(M._lnk(M.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==ja(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)X(f[a]).setProperty("index",a);return this},removeViews:function(a,b,e){function f(a){var b,g,h,l,n,p=m[a];if(p&&p.link){a=p._.id;e||(n=p.nodes());p.removeViews(c,c,!0);p.data=c;h=p._prv;l=p._nxt;g=p.parentElem;e||(p._elCnt&&s(h,l,g,a,"_"),d(n).remove());if(!p._elCnt)try{h.parentNode.removeChild(h),
l.parentNode.removeChild(l)}catch(q){}k(p);for(b in p._.bnds)P(b);delete ia[a]}}var g,h,l=!this._.useKey,m=this.views;l&&(h=m.length);if(a===c)if(l){for(g=h;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(b===c&&(l?b=1:(f(a),delete m[a])),l&&b){for(g=a+b;g-- >a;)f(g);m.splice(a,b);if(h=m.length)for(;a<h;)X(m[a]).setProperty("index",a++)}return this},refresh:function(a){var b=this.parent;b&&(ja(this,this.index,this.tmpl,b.views,this.data,a,!0),k(this));return this},link:n}),ia={0:Fa=
new M.View(c,"top")},Na.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},qa("on",{attr:S,onAfterLink:function(a,b){for(var e,f,g=0,h=a.args,k=a.props.data,l=a.view,m=a.props.context;!ca(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(a.params.args.slice(-f.length-1)[0]))&&M.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(b.data,
l));if(e){if(this._evs)this.onDispose();d(b.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==c?null:k,this._hlr=function(a){return e.apply(m||b.data,[].concat(f,a,{change:a.type,view:l,linkCtx:b}))})}},onDispose:function(){d(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),da(qa["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();
else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,c,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],e=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(c=g[a])&&e!==c[0]&&(Ha(c[0],c[1],!0),delete g[a]),!g[a]&&d.isArray(e)&&(Ha(e,b=function(a,b){f.onArrayChange(a,b)}),g[a]=[e,b]);for(a=l+1;a<k;a++)if(c=g[a])Ha(c[0],c[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)Ha(this._ars[a][0],
this._ars[a][1],!0)}}),da(qa["for"],z),da(qa["if"],z),da(qa.include,z),qa("props",{baseTag:qa["for"],dataMap:y.map({getTgt:qa.props.dataMap.getTgt,obsSrc:J,obsTgt:u,tgtFlt:E})}),da(d,{view:y.view=r=function(a,b,e){b!==!!b&&(e=b,b=c);var f,g,h,k,l,m;m=0;l=ga.body;if(a&&a!==l&&1<Fa._.useKey&&(a=""+a===a?d(a)[0]:a.jquery?a[0]:a))if(b)for(m=Ua?a.querySelectorAll(Qa):d(Qa,a).get(),l=m.length,a=0;a<l;a++)for(f=m[a],g=F(f,c,db),h=0,k=g.length;h<k;h++){if(f=g[h],f=ia[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;a;){if(g=
F(a,c,nb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=ia[f.id])&&e?f.get(e):f||Fa;m--}else m++;a=a.previousSibling||a.parentNode}return b?c:Fa},link:y.link=A,unlink:y.unlink=ka,cleanData:function(a){a.length&&Sa&&Da(a);fb.apply(d,arguments)}}),y.utility={validate:function(a){try{Fa.link(c,ga.createElement("div"),c,c,a,c,c,1)}catch(b){return b.message}}},da(d.fn,{link:function(a,b,c,d,e,f,g){return A(a,this,b,c,d,e,f,g)},unlink:function(a){return ka(a,this)},view:function(a){return r(this[0],
a)}}),d.each([U,"replaceWith","empty","remove"],function(a,b){var c=d.fn[b];d.fn[b]=function(){var a;Sa=1;try{a=c.apply(this,arguments)}finally{Sa=0}return a}}),da(Fa,{tmpl:{links:{},tags:{}}}),Fa._.onRender=Ja,T({wrapMap:V={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],
col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:N="data-link",merge:{input:{from:Ga,to:"value"},textarea:$a,select:$a,optgroup:{to:"label"}},jsrDbgMode:T.debugMode,debugMode:function(a){T.jsrDbgMode(a);a?f._jsv={views:ia,bindings:Ba}:delete f._jsv},jsv:function(){T.debugMode(T._dbgMode);N=T.linkAttr;ha=y._err;O=Qa+",["+N+"]";x=T.noDomLevel0;V.optgroup=V.option;V.tbody=V.tfoot=V.colgroup=
V.caption=V.thead;V.th=V.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
