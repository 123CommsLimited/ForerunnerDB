!function(Pa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Pa();else if("function"==typeof define&&define.amd)define([],Pa);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.ForerunnerDB=Pa()}}(function(){return function h(p,l,g){function a(b,d){if(!l[b]){if(!p[b]){var e="function"==typeof require&&require;if(!d&&e)return e(b,!0);if(c)return c(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",
e;}e=l[b]={exports:{}};p[b][0].call(e.exports,function(f){var k=p[b][1][f];return a(k?k:f)},e,e.exports,h,p,l,g)}return l[b].exports}for(var c="function"==typeof require&&require,d=0;d<g.length;d++)a(g[d]);return a}({1:[function(h,p,l){l=h("../lib/Core");h("../lib/CollectionGroup");h("../lib/View");h("../lib/Highcharts");h("../lib/Persist");h("../lib/vendor/jsviews");p.exports=l;window.ForerunnerDB=l},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Highcharts":6,"../lib/Persist":13,"../lib/View":15,
"../lib/vendor/jsviews":16}],2:[function(h,p,l){var g,a,c,d,b,m;g=h("./Shared");var e=function(f){this.init.apply(this,arguments)};e.prototype.init=function(f){this._primaryKey="_id";this._primaryIndex=new c("primary");this._primaryCrc=new c("primaryCrc");this._crcLookup=new c("crcLookup");this._name=f;this._data=[];this._groups=[];this._metrics=new a;this._linked=0;this._debug={};this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};
this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};g.addModule("Collection",e);g.inherit(e.prototype,g.chainSystem);l=h("./Overload");a=h("./Metrics");c=h("./KeyValueStore");d=h("./Path");b=h("./Index");m=h("./Crc");h=g.modules.Core;e.prototype.debug=new l([function(){return this._debug.all},function(f){return void 0!==f?"boolean"===typeof f?(this._debug.all=f,this.chainSend("debug",this._debug),this):this._debug[f]||this._db&&this._db._debug&&this._db._debug[f]||this._debug.all:
this._debug.all},function(f,k){return void 0!==f?void 0!==k?(this._debug[f]=k,this.chainSend("debug",this._debug),this):this._debug[f]||this._db&&this._db._debug&&this._db._debug[f]:this._debug.all}]);e.prototype.crc=m;e.prototype.name=function(f){return void 0!==f?(this._name=f,this):this._name};e.prototype.on=new l([function(f,k){this._listeners=this._listeners||{};this._listeners[f]=this._listeners[f]||{};this._listeners[f]["*"]=this._listeners[f]["*"]||[];this._listeners[f]["*"].push(k);return this},
function(f,k,b){this._listeners=this._listeners||{};this._listeners[f]=this._listeners[f]||{};this._listeners[f][k]=this._listeners[f][k]||[];this._listeners[f][k].push(b);return this}]);e.prototype.off=new l([function(f){this._listeners&&this._listeners[f]&&f in this._listeners&&delete this._listeners[f];return this},function(f,k){var b,a;"string"===typeof k?this._listeners&&this._listeners[f]&&this._listeners[f][k]&&delete this._listeners[f][k]:f in this._listeners&&(b=this._listeners[f]["*"],a=
b.indexOf(k),-1<a&&b.splice(a,1));return this},function(f,k,b){this._listeners&&f in this._listeners&&(f=this._listeners[f][k],b=f.indexOf(b),-1<b&&f.splice(b,1))}]);e.prototype.emit=function(f,k){this._listeners=this._listeners||{};if(f in this._listeners){if(this._listeners[f]["*"]){var b=this._listeners[f]["*"],a=b.length,c;for(c=0;c<a;c++)b[c].apply(this,Array.prototype.slice.call(arguments,1))}if(k instanceof Array&&k[0]&&k[0][this._primaryKey]){var b=this._listeners[f],d,e,a=k.length;for(c=
0;c<a;c++)if(b[k[c][this._primaryKey]])for(d=b[k[c][this._primaryKey]].length,e=0;e<d;e++)b[k[c][this._primaryKey]][e].apply(this,Array.prototype.slice.call(arguments,1))}}return this};e.prototype.drop=function(){if(this._db&&this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var f=[],k;for(k=0;k<this._groups.length;k++)f.push(this._groups[k]);for(k=0;k<f.length;k++)this._groups[k].removeCollection(this);return!0}return!1};
e.prototype.primaryKey=function(f){return void 0!==f?(this._primaryKey=f,this._primaryIndex.primaryKey(f),this._rebuildPrimaryKeyIndex(),this):this._primaryKey};e.prototype._onInsert=function(f,k){this.emit("insert",f,k)};e.prototype._onUpdate=function(f){this.emit("update",f)};e.prototype._onRemove=function(f){this.emit("remove",f)};e.prototype.db=function(f){return void 0!==f?(this._db=f,this):this._db};e.prototype.setData=function(f,k,b){if(f){var a=this._metrics.create("setData");a.start();k=
k||{};k.$decouple=void 0!==k.$decouple?k.$decouple:!0;k.$decouple&&(f=this.decouple(f));f instanceof Array||(f=[f]);a.time("transformIn");f=this.transformIn(f);a.time("transformIn");var c=this._data;this._linked?this.remove():this._data=[];f.length&&(this._linked?this.insert(f):this._data=this._data.concat(f));a.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(k);a.time("Rebuild Primary Key Index");a.time("Resolve chains");this.chainSend("setData",f,{oldData:c});a.time("Resolve chains");
a.stop();this.emit("setData",this._data,c)}b&&b(!1);return this};e.prototype._rebuildPrimaryKeyIndex=function(f){var k=f&&void 0!==f.ensureKeys?f.ensureKeys:!0;f=f&&void 0!==f.violationCheck?f.violationCheck:!0;var b,a,c,d=this._primaryIndex,e=this._primaryCrc,m=this._crcLookup,g=this._primaryKey,h;d.truncate();e.truncate();m.truncate();b=this._data;for(a=b.length;a--;)if(c=b[a],k&&this._ensurePrimaryKey(c),f){if(!d.uniqueSet(c[g],c))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+
c[this._primaryKey];}else h=JSON.stringify(c),d.set(c[g],c),e.set(c[g],h),m.set(h,c)};e.prototype._ensurePrimaryKey=function(f){void 0===f[this._primaryKey]&&(f[this._primaryKey]=this.objectId())};e.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};e.prototype.upsert=function(f,k){if(f){var b=this._deferQueue.upsert,a=this._deferThreshold.upsert,c={},d;if(f instanceof Array){if(f.length>a){this._deferQueue.upsert=b.concat(f);this.processQueue("upsert",
k);return}c=[];for(b=0;b<f.length;b++)c.push(this.upsert(f[b]));k&&k();return c}f[this._primaryKey]?(d={},d[this._primaryKey]=f[this._primaryKey],this.count(d)?c.op="update":c.op="insert"):c.op="insert";switch(c.op){case "insert":c.result=this.insert(f);break;case "update":c.result=this.update(d,f)}return c}k&&k()};e.prototype.update=function(f,k,b){k=this.decouple(k);k=this.transformIn(k);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var c=this,a=this._metrics.create("update"),
d=this._primaryKey,e,m,g=function(a){if(k&&void 0!==k[d]&&k[d]!=a[d]){c._primaryIndex.unSet(a[d]);var e=c._updateObject(a,k,f,b,"");if(c._primaryIndex.uniqueSet(a[d],a))return e;throw"Primary key violation in update! Key violated: "+a[d];}return c._updateObject(a,k,f,b,"")};a.start();a.time("Retrieve documents to update");e=this.find(f,{$decouple:!1});a.time("Retrieve documents to update");e.length&&(a.time("Update documents"),m=e.filter(g),a.time("Update documents"),m.length&&(a.time("Resolve chains"),
this.chainSend("update",{query:f,update:k},b),a.time("Resolve chains"),this._onUpdate(m),this.deferEmit("change",{type:"update",data:m})));a.stop();return m||[]};e.prototype.updateById=function(f,k){var a={};a[this._primaryKey]=f;return this.update(a,k)};e.prototype._updateObject=function(f,k,a,b,c,e){k=this.decouple(k);c=c||"";"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));var m=!1,g=!1,h,l,q,n;for(n in k)if(k.hasOwnProperty(n)){h=!1;if("$"===n.substr(0,1))switch(n){case "$index":break;default:h=
!0,(g=this._updateObject(f,k[n],a,b,c,n))&&(m=!0)}if(this._isPositionalKey(n)&&(h=!0,n=n.substr(0,n.length-2),g=new d(c+"."+n),f[n]&&f[n]instanceof Array&&f[n].length)){l=[];for(q=0;q<f[n].length;q++)this._match(f[n][q],g.value(a)[0])&&l.push(q);for(q=0;q<l.length;q++)(g=this._updateObject(f[n][l[q]],k[n+".$"],a,b,c+"."+n,e))&&(m=!0)}if(!h)if(e||"object"!==typeof k[n])switch(e){case "$inc":this._updateIncrement(f,n,k[n]);m=!0;break;case "$push":void 0===f[n]&&(f[n]=[]);if(f[n]instanceof Array){if(void 0!==
k[n].$position&&k[n].$each instanceof Array)for(g=k[n].$position,h=k[n].$each.length,q=0;q<h;q++)this._updateSplicePush(f[n],g+q,k[n].$each[q]);else if(k[n].$each instanceof Array)for(h=k[n].$each.length,q=0;q<h;q++)this._updatePush(f[n],k[n].$each[q]);else this._updatePush(f[n],k[n]);m=!0}else throw"Cannot push to a key that is not an array! ("+n+")";break;case "$pull":if(f[n]instanceof Array){l=[];for(q=0;q<f[n].length;q++)this._match(f[n][q],k[n])&&l.push(q);for(h=l.length;h--;)this._updatePull(f[n],
l[h]),m=!0}break;case "$pullAll":if(f[n]instanceof Array)if(k[n]instanceof Array){if(l=f[n],h=l.length,0<h)for(;h--;){for(g=0;g<k[n].length;g++)l[h]===k[n][g]&&(this._updatePull(f[n],h),h--,m=!0);if(0>h)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+n+")";break;case "$addToSet":void 0===f[n]&&(f[n]=[]);if(f[n]instanceof Array){q=f[n];var s;l=q.length;var p;h=!0;s=b&&b.$addToSet;var V;s&&s.key?(g=!1,V=new d(s.key),p=V.value(k[n])[0]):(p=JSON.stringify(k[n]),g=!0);
for(s=0;s<l;s++)if(g){if(JSON.stringify(q[s])===p){h=!1;break}}else if(p===V.value(q[s])[0]){h=!1;break}h&&(this._updatePush(f[n],k[n]),m=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===f[n]&&(f[n]=[]);if(f[n]instanceof Array)if(g=k.$index,void 0!==g)delete k.$index,this._updateSplicePush(f[n],g,k[n]),m=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+n+")";
break;case "$move":if(f[n]instanceof Array)for(q=0;q<f[n].length;q++){if(this._match(f[n][q],k[n])){m=k[n].$index;if(void 0!==m)this._updateSpliceMove(f[n],q,m),m=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+n+")";break;case "$mul":this._updateMultiply(f,n,k[n]);m=!0;break;case "$rename":this._updateRename(f,n,k[n]);m=!0;break;case "$unset":this._updateUnset(f,n);m=!0;break;case "$pop":if(f[n]instanceof Array)this._updatePop(f[n],
k[n])&&(m=!0);else throw"Cannot pop from a key that is not an array! ("+n+")";break;default:f[n]!==k[n]&&(this._updateProperty(f,n,k[n]),m=!0)}else if(null!==f[n]&&"object"===typeof f[n])if(q=f[n]instanceof Array,l=k[n]instanceof Array,q||l)if(!l&&q)for(q=0;q<f[n].length;q++)(g=this._updateObject(f[n][q],k[n],a,b,c+"."+n,e))&&(m=!0);else f[n]!==k[n]&&(this._updateProperty(f,n,k[n]),m=!0);else(g=this._updateObject(f[n],k[n],a,b,c+"."+n,e))&&(m=!0);else f[n]!==k[n]&&(this._updateProperty(f,n,k[n]),
m=!0)}return m};e.prototype._isPositionalKey=function(f){return".$"===f.substr(f.length-2,2)};e.prototype._updateProperty=function(f,k,a){this._linked?(jQuery.observable(f).setProperty(k,a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+k+'" for collection "'+this.name()+'"')):(f[k]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+k+'" for collection "'+this.name()+'"'))};e.prototype._updateIncrement=function(f,
k,a){this._linked?jQuery.observable(f).setProperty(k,f[k]+a):f[k]+=a};e.prototype._updateSpliceMove=function(f,k,a){this._linked?(jQuery.observable(f).move(k,a),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+k+'" to "'+a+'" for collection "'+this.name()+'"')):(f.splice(a,0,f.splice(k,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+k+'" to "'+a+'" for collection "'+this.name()+'"'))};e.prototype._updateSplicePush=
function(f,k,a){f.length>k?this._linked?jQuery.observable(f).insert(k,a):f.splice(k,0,a):this._linked?jQuery.observable(f).insert(a):f.push(a)};e.prototype._updatePush=function(f,k){this._linked?jQuery.observable(f).insert(k):f.push(k)};e.prototype._updatePull=function(f,k){this._linked?jQuery.observable(f).remove(k):f.splice(k,1)};e.prototype._updateMultiply=function(f,k,a){this._linked?jQuery.observable(f).setProperty(k,f[k]*a):f[k]*=a};e.prototype._updateRename=function(f,k,a){var b=f[k];this._linked?
(jQuery.observable(f).setProperty(a,b),jQuery.observable(f).removeProperty(k)):(f[a]=b,delete f[k])};e.prototype._updateUnset=function(f,k){this._linked?jQuery.observable(f).removeProperty(k):delete f[k]};e.prototype._updatePop=function(f,k){var a,b=!1;0<f.length&&(this._linked?(1===k?a=f.length-1:-1===k&&(a=0),-1<a&&(jQuery.observable(arr).remove(a),b=!0)):1===k?(f.pop(),b=!0):-1===k&&(f.shift(),b=!0));return b};e.prototype.remove=function(f,a,b){var c,d;if(f instanceof Array){d=[];for(b=0;b<f.length;b++)d.push(this.remove(f[b],
{noEmit:!0}));(!a||a&&!a.noEmit)&&this._onRemove(d);return d}b=this.find(f,{$decouple:!1});if(b.length){for(d=0;d<b.length;d++)c=b[d],this._removeIndex(c),c=this._data.indexOf(c),this._linked?jQuery.observable(this._data).remove(c):this._data.splice(c,1);this.chainSend("remove",{query:f},a);(!a||a&&!a.noEmit)&&this._onRemove(b);this.deferEmit("change",{type:"remove",data:b})}return b};e.prototype.removeById=function(f){var a={};a[this._primaryKey]=f;return this.remove(a)};e.prototype.deferEmit=function(){var f=
this,a;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(a=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){f.debug()&&console.log("ForerunnerDB.Collection: Emitting "+a[0]);f.emit.apply(f,a)},100))};e.prototype.processQueue=function(f,a){var b=this._deferQueue[f],c=this._deferThreshold[f],d=this._deferTime[f];if(b.length){var e=this;b.length&&(b=b.length>c?b.splice(0,c):b.splice(0,b.length),this[f](b));
setTimeout(function(){e.processQueue(f,a)},d)}else a&&a()};e.prototype.insert=function(f,a,b){"function"===typeof a?(b=a,a=this._data.length):void 0===a&&(a=this._data.length);f=this.transformIn(f);return this._insertHandle(f,a,b)};e.prototype._insertHandle=function(f,a,b){var c=this._deferQueue.insert,d=this._deferThreshold.insert,e=[],m=[];if(f instanceof Array){if(f.length>d){this._deferQueue.insert=c.concat(f);this.processQueue("insert",b);return}for(d=0;d<f.length;d++)c=this._insert(f[d],a+d),
!0===c?e.push(f[d]):m.push({doc:f[d],reason:c})}else c=this._insert(f,a),!0===c?e.push(f):m.push({doc:f,reason:c});this.chainSend("insert",f,{index:a});this._onInsert(e,m);b&&b();this.deferEmit("change",{type:"insert",data:e});return{inserted:e,failed:m}};e.prototype._insert=function(f,a){if(f){var b;this._ensurePrimaryKey(f);if(b=this.insertIndexViolation(f))return"Index violation in index: "+b;this._insertIndex(f);this._linked?jQuery.observable(this._data).insert(a,f):this._data.splice(a,0,f);return!0}return"No document passed to insert"};
e.prototype._insertIndex=function(f){var a=this._indexByName,b,c=JSON.stringify(f);this._primaryIndex.uniqueSet(f[this._primaryKey],f);this._primaryCrc.uniqueSet(f[this._primaryKey],c);this._crcLookup.uniqueSet(c,f);for(b in a)a.hasOwnProperty(b)&&a[b].insert(f)};e.prototype._removeIndex=function(f){var a=this._indexByName,b,c=JSON.stringify(f);this._primaryIndex.unSet(f[this._primaryKey]);this._primaryCrc.unSet(f[this._primaryKey]);this._crcLookup.unSet(c);for(b in a)a.hasOwnProperty(b)&&a[b].remove(f)};
e.prototype.subset=function(f,a){var b=this.find(f,a);return(new e)._subsetOf(this).primaryKey(this._primaryKey).setData(b)};e.prototype.subsetOf=function(){return this.__subsetOf};e.prototype._subsetOf=function(f){this.__subsetOf=f;return this};e.prototype.distinct=function(f,a,b){a=this.find(a,b);f=new d(f);b={};var c=[],e,m;for(m=0;m<a.length;m++)(e=f.value(a[m])[0])&&!b[e]&&(b[e]=!0,c.push(e));return c};e.prototype.decouple=function(f){return JSON.parse(JSON.stringify(f))};e.prototype.findById=
function(f,a){var b={};b[this._primaryKey]=f;return this.find(b,a)[0]};e.prototype.peek=function(f,a){var b=this._data,c=b.length,d,m,g=new e;if("string"===typeof f){for(d=0;d<c;d++)m=JSON.stringify(b[d]),-1<m.indexOf(f)&&g.insert(b[d]);return g.find({},a)}return this.find(f,a)};e.prototype.explain=function(f,a){return this.find(f,a).__fdbOp._data};e.prototype.find=function(f,a){f=f||{};a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;var b=this._metrics.create("find"),c=this,e,m=!0,g,h,l,
p,q,n,s,Ea,V,Y=[];h=function(a){return c._match(a,f,"and")};b.start();if(f){b.time("analyseQuery");e=this._analyseQuery(f,a,b);b.time("analyseQuery");b.data("analysis",e);if(e.hasJoin&&e.queriesJoin){b.time("joinReferences");for(l=0;l<e.joinsOn.length;l++)q=e.joinsOn[l],p=new d(e.joinQueries[q]),p=p.value(f)[0],this._db.collection(e.joinsOn[l]).subset(p);b.time("joinReferences")}e.indexMatch.length&&(!a||a&&!a.$skipIndex)?(b.data("index.potential",e.indexMatch),b.data("index.used",e.indexMatch[0].index),
b.time("indexLookup"),g=e.indexMatch[0].lookup,b.time("indexLookup"),e.indexMatch[0].keyData.totalKeyCount===e.indexMatch[0].keyData.matchedKeyCount&&(m=!1)):b.flag("usedIndex",!1);m&&(g&&g.length?(e=g.length,b.time("tableScan: "+e),g=g.filter(h)):(e=this._data.length,b.time("tableScan: "+e),g=this._data.filter(h)),a.$orderBy&&(b.time("sort"),g=this.sort(a.$orderBy,g),b.time("sort")),b.time("tableScan: "+e));a.limit&&g&&g.length>a.limit&&(g.length=a.limit,b.data("limit",a.limit));a.$decouple&&(b.time("decouple"),
g=this.decouple(g),b.time("decouple"),b.data("flag.decouple",!0));if(a.join){for(h=0;h<a.join.length;h++)for(q in a.join[h])if(a.join[h].hasOwnProperty(q))for(Ea=q,e=this._db.collection(q),m=a.join[h][q],V=0;V<g.length;V++){s={};p=l=!1;for(n in m)if(m.hasOwnProperty(n))if("$"===n.substr(0,1))switch(n){case "$as":Ea=m[n];break;case "$multi":l=m[n];break;case "$require":p=m[n];break;default:n.substr(0,3)}else s[n]=(new d(m[n])).value(g[V])[0];s=e.find(s);!p||p&&s[0]?g[V][Ea]=!1===l?s[0]:s:Y.push(g[V])}b.data("flag.join",
!0)}if(Y.length){b.time("removalQueue");for(n=0;n<Y.length;n++)q=g.indexOf(Y[n]),-1<q&&g.splice(q,1);b.time("removalQueue")}if(a.transform){b.time("transform");for(n=0;n<g.length;n++)g.splice(n,1,a.transform(g[n]));b.time("transform");b.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(b.time("transformOut"),g=this.transformOut(g),b.time("transformOut"));b.data("results",g.length);b.stop()}else b.stop(),g=[];g.__fdbOp=b;return g};e.prototype.indexOf=function(f){if(f=this.find(f,
{$decouple:!1})[0])return this._data.indexOf(f)};e.prototype.transform=function(f){return void 0!==f?("object"===typeof f?(void 0!==f.enabled&&(this._transformEnabled=f.enabled),void 0!==f.dataIn&&(this._transformIn=f.dataIn),void 0!==f.dataOut&&(this._transformOut=f.dataOut)):this._transformEnabled=!1===f?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.transformIn=function(f){if(this._transformEnabled&&this._transformIn){if(f instanceof
Array){var a=[],b;for(b=0;b<f.length;b++)a[b]=this._transformIn(f[b]);return a}return this._transformIn(f)}return f};e.prototype.transformOut=function(f){if(this._transformEnabled&&this._transformOut){if(f instanceof Array){var a=[],b;for(b=0;b<f.length;b++)a[b]=this._transformOut(f[b]);return a}return this._transformOut(f)}return f};e.prototype.sort=function(f,a){a=a||[];var b=[],c,d;for(c in f)f.hasOwnProperty(c)&&(d={},d[c]=f[c],d.___fdbKey=c,b.push(d));return 2>b.length?this._sort(f,a):this._bucketSort(b,
a)};e.prototype._bucketSort=function(f,a){var b=f.shift(),c,d,e=[];if(0<f.length){a=this._sort(b,a);c=this.bucket(b.___fdbKey,a);for(d in c)c.hasOwnProperty(d)&&(b=[].concat(f),e=e.concat(this._bucketSort(b,c[d])));return e}return this._sort(b,a)};e.prototype._sort=function(a,b){var c=new d,e=c.parse(a,!0)[0];c.path(e.path);return b.sort(1===e.value?function(a,f){var b=c.value(a)[0],d=c.value(f)[0];return"string"===typeof b&&"string"===typeof d?b.localeCompare(d):b>d?1:b<d?-1:0}:function(a,f){var b=
c.value(a)[0],d=c.value(f)[0];return"string"===typeof b&&"string"===typeof d?1===b.localeCompare(d)?-1:1:b>d?-1:b<d?1:0})};e.prototype.bucket=function(a,b){var c,d={};for(c=0;c<b.length;c++)d[b[c][a]]=d[b[c][a]]||[],d[b[c][a]].push(b[c]);return d};e.prototype._analyseQuery=function(a,b,c){var e={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:a,options:b},m,g=[],h=[],l,p,F,q,n;c.time("checkIndexes");void 0!==a[this._primaryKey]&&(c.time("checkIndexMatch: Primary Key"),
l=new d,e.indexMatch.push({lookup:this._primaryIndex.lookup(a,b),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:l.countKeys(a)},index:this._primaryIndex}),c.time("checkIndexMatch: Primary Key"));for(n in this._indexById)if(this._indexById.hasOwnProperty(n)&&(p=this._indexById[n],F=p.name(),c.time("checkIndexMatch: "+F),l=p.match(a,b),q=p.lookup(a,b),0<l.matchedKeyCount&&e.indexMatch.push({lookup:q,keyData:l,index:p}),c.time("checkIndexMatch: "+F),l.totalKeyCount===l.matchedKeyCount))break;
c.time("checkIndexes");1<e.indexMatch.length&&(c.time("findOptimalIndex"),e.indexMatch.sort(function(b,a){return b.keyData.totalKeyCount===b.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?1:b.keyData.matchedKeyCount===a.keyData.matchedKeyCount?b.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-b.keyData.matchedKeyCount}),c.time("findOptimalIndex"));if(b.join){e.hasJoin=!0;for(c=0;c<b.join.length;c++)for(m in b.join[c])b.join[c].hasOwnProperty(m)&&(g.push(m),
"$as"in b.join[c][m]?h.push(b.join[c][m].$as):h.push(m));for(m=0;m<h.length;m++)if(b=this._queryReferencesCollection(a,h[m],""))e.joinQueries[g[m]]=b,e.queriesJoin=!0;e.joinsOn=g;e.queriesOn=e.queriesOn.concat(g)}return e};e.prototype._queryReferencesCollection=function(b,a,c){for(var d in b)if(b.hasOwnProperty(d)){if(d===a)return c&&(c+="."),c+d;if("object"===typeof b[d])return c&&(c+="."),c+=d,this._queryReferencesCollection(b[d],a,c)}return!1};e.prototype._match=function(b,a,c){var d,e;d=typeof b;
e=typeof a;var m=!0,g;if(!("string"!==d&&"number"!==d||"string"!==e&&"number"!==e))b!==a&&(m=!1);else for(g in a)if(a.hasOwnProperty(g)){d=!1;if("$"===g.substr(0,1))switch(g){case "$gt":if(b>a[g]){if("or"===c)return!0}else m=!1;d=!0;break;case "$gte":if(b>=a[g]){if("or"===c)return!0}else m=!1;d=!0;break;case "$lt":if(b<a[g]){if("or"===c)return!0}else m=!1;d=!0;break;case "$lte":if(b<=a[g]){if("or"===c)return!0}else m=!1;d=!0;break;case "$exists":if(void 0===b!==a[g]){if("or"===c)return!0}else m=!1;
d=!0;break;case "$or":d=!0;for(e=0;e<a[g].length;e++){if(this._match(b,a[g][e],"and"))return!0;m=!1}break;case "$and":d=!0;for(e=0;e<a[g].length;e++)if(!this._match(b,a[g][e],"and"))return!1;break;case "$in":if(a[g]instanceof Array){d=a[g];e=d.length;var h,l=!1;for(h=0;h<e;h++)if(d[h]===b){l=!0;break}if(l){if("or"===c)return!0}else m=!1}else throw"Cannot use a $nin operator on a non-array key: "+g;d=!0;break;case "$nin":if(a[g]instanceof Array){d=a[g];e=d.length;l=!0;for(h=0;h<e;h++)if(d[h]===b){l=
!1;break}if(l){if("or"===c)return!0}else m=!1}else throw"Cannot use a $nin operator on a non-array key: "+g;d=!0;break;case "$ne":if(b!=a[g]){if("or"===c)return!0}else m=!1;d=!0}if(!d&&a[g]instanceof RegExp)if(d=!0,"object"===typeof b&&void 0!==b[g]&&a[g].test(b[g])){if("or"===c)return!0}else m=!1;if(!d)if("object"===typeof a[g])if(void 0!==b[g]){if(b[g]instanceof Array&&!(a[g]instanceof Array))for(d=!1,e=0;e<b[g].length&&!(d=this._match(b[g][e],a[g],void 0));e++);else if(!(b[g]instanceof Array)&&
a[g]instanceof Array)for(d=!1,e=0;e<a[g].length&&!(d=this._match(b[g],a[g][e],void 0));e++);else d="object"===typeof b?this._match(b[g],a[g],void 0):this._match(void 0,a[g],void 0);if(d){if("or"===c)return!0}else m=!1}else if(a[g]&&void 0!==a[g].$exists)if(d=this._match(void 0,a[g],void 0)){if("or"===c)return!0}else m=!1;else m=!1;else if(b&&b[g]===a[g]){if("or"===c)return!0}else if(b&&b[g]&&b[g]instanceof Array&&a[g]&&"object"!==typeof a[g]){d=!1;for(e=0;e<b[g].length&&!(d=this._match(b[g][e],a[g],
void 0));e++);if(d){if("or"===c)return!0}else m=!1}else m=!1;if("and"===c&&!m)return!1}return m};e.prototype.count=function(a,b){return a?this.find(a,b).length:this._data.length};e.prototype.link=function(a,b){if(window.jQuery){this._links=this._links||{};var c,d;b&&"object"===typeof b?b.template&&"string"===typeof b.template&&(c=this.objectId(b.template),d=b.template):c=b;if(!this._links[c]){if(jQuery(a).length){if(!jQuery.templates[c]){if(!d)if(d=jQuery(b),d.length)d=jQuery(d[0]).html();else throw"Unable to bind collection to target because template does not exist: "+
b;jQuery.views.templates(c,d)}jQuery.templates[c].link(a,this._data);this._links[c]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+c;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};e.prototype.unlink=
function(b,a){if(window.jQuery){this._links=this._links||{};var c;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(c=this.objectId(a.template)):c=a;if(this._links[c])return jQuery.templates[c].unlink(b),delete this._links[c],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+b),this;console.log("Cannot remove link, one does not exist to the target: "+b+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";
};e.prototype.findSub=function(a,b,c,e){var g=new d(b);a=this.find(a);var m=a.length,h,l,p=this._db.collection("__FDB_temp_"+this.objectId()),F={parents:m,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(h=0;h<m;h++)if(l=g.value(a[h])[0]){p.setData(l);l=p.find(c,e);if(e.returnFirst&&l.length)return l[0];F.subDocs.push(l);F.subDocTotal+=l.length;F.pathFound=!0}p.drop();if(e.noStats)return F.subDocs;F.pathFound||(F.err="No objects found in the parent documents with a matching path of: "+b);return F};
e.prototype.insertIndexViolation=function(a){var b,c=this._indexByName,d,e;if(this._primaryIndex.get(a[this._primaryKey]))b=this._primaryIndex;else for(d in c)if(c.hasOwnProperty(d)&&(e=c[d],e.unique()&&e.violation(a))){b=e;break}return b?b.name():!1};e.prototype.ensureIndex=function(a,c){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var d=new b(a,c,this),e={start:(new Date).getTime()};if(this._indexByName[d.name()])return{err:"Index with that name already exists"};if(this._indexById[d.id()])return{err:"Index with those keys already exists"};
d.rebuild();this._indexByName[d.name()]=d;this._indexById[d.id()]=d;e.end=(new Date).getTime();e.total=e.end-e.start;this._lastOp={type:"ensureIndex",stats:{time:e}};return{index:d,id:d.id(),name:d.name(),state:d.state()}};e.prototype.index=function(a){if(this._indexByName)return this._indexByName[a]};e.prototype.lastOp=function(){return this._metrics.list()};e.prototype.objectId=function(a){var b=Math.pow(10,17);if(a){var c=0,d=a.length,e;for(e=0;e<d;e++)c+=a.charCodeAt(e)*b;a=c.toString(16)}else g.idCounter++,
a=(g.idCounter+(Math.random()*b+Math.random()*b+Math.random()*b+Math.random()*b)).toString(16);return a};e.prototype.diff=function(a){var b={insert:[],update:[],remove:[]},c=this.primaryKey(),d,e,g,m;if(c===a.primaryKey()){d=a._data;m=d.length;for(e=0;e<m;e++)g=d[e],this._primaryIndex.get(g[c])?this._primaryCrc.get(g[c])!==a._primaryCrc.get(g[c])&&b.update.push(g):b.insert.push(g);d=this._data;m=d.length;for(e=0;e<m;e++)g=d[e],a._primaryIndex.get(g[c])||b.remove.push(g)}return b};h.prototype.collection=
function(a,b){if(a)return this._collection[a]||this.debug()&&console.log("Creating collection "+a),this._collection[a]=this._collection[a]||(new e(a)).db(this),void 0!==b&&this._collection[a].primaryKey(b),this._collection[a];throw"Cannot get collection with undefined name!";};h.prototype.collectionExists=function(a){return Boolean(this._collection[a])};h.prototype.collections=function(){var a=[],b;for(b in this._collection)this._collection.hasOwnProperty(b)&&a.push({name:b,count:this._collection[b].count()});
return a};p.exports=e},{"./Crc":5,"./Index":7,"./KeyValueStore":8,"./Metrics":9,"./Overload":11,"./Path":12,"./Shared":14}],3:[function(h,p,l){var g,a;l=h("./Shared");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(c){this._name=c;this._data=new a("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};l.addModule("CollectionGroup",c);l.inherit(c.prototype,l.chainSystem);a=h("./Collection");h("./Overload");h=l.modules.Core;g=l.modules.Core.prototype.init;c.prototype.on=
function(){this._data.on.apply(this._data,arguments)};c.prototype.off=function(){this._data.off.apply(this._data,arguments)};c.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};c.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};c.prototype.db=function(a){return void 0!==a?(this._db=a,this):this._db};c.prototype.addCollection=function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";
}else this.primaryKey(a.primaryKey());this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};c.prototype.removeCollection=function(a){if(a){var b=this._collections.indexOf(a);-1!==b&&(a.unChain(this),this._collections.splice(b,1),b=a._groups.indexOf(this),-1!==b&&a._groups.splice(b,1));0===this._collections.length&&delete this._primaryKey}return this};c.prototype._chainHandler=function(a,b,c,e){switch(b){case "setData":c=this._data.decouple(c);this._data.remove(e.oldData);
this._data.insert(c);break;case "insert":c=this._data.decouple(c);this._data.insert(c);break;case "update":this._data.update(c.query,c.update,e);break;case "remove":this._data.remove(c.query,e)}};c.prototype.insert=function(){this._collectionsRun("insert",arguments)};c.prototype.update=function(){this._collectionsRun("update",arguments)};c.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};c.prototype.remove=function(){this._collectionsRun("remove",arguments)};c.prototype._collectionsRun=
function(a,b){for(var c=0;c<this._collections.length;c++)this._collections[c][a].apply(this._collections[c],b)};c.prototype.find=function(a,b){return this._data.find(a,b)};c.prototype.removeById=function(a){for(var b=0;b<this._collections.length;b++)this._collections[b].removeById(a)};c.prototype.subset=function(c,b){var g=this.find(c,b);return(new a)._subsetOf(this).primaryKey(this._primaryKey).setData(g)};c.prototype.drop=function(){var a,b=[].concat(this._collections),c=[].concat(this._views);
this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<c.length;a++)this._removeView(c[a]);this.emit("drop");return!0};h.prototype.init=function(){this._collectionGroup={};g.apply(this,arguments)};h.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new c(a)).db(this),this._collectionGroup[a]):this._collectionGroup};p.exports=c},{"./Collection":2,"./Overload":11,"./Shared":14}],
4:[function(h,p,l){var g,a;g=h("./Shared.js");var c=function(){this.init.apply(this,arguments)};c.prototype.init=function(){this._collection={};this._debug={}};g.addModule("Core",c);g.inherit(c.prototype,g.chainSystem);l=h("./Overload.js");a=h("./Collection.js");h("./Metrics.js");h=h("./Crc.js");c.prototype._isServer=!1;c.prototype.isClient=function(){return!this._isServer};c.prototype.isServer=function(){return this._isServer};c.prototype.crc=h;c.prototype.isClient=function(){return!this._isServer};
c.prototype.isServer=function(){return this._isServer};c.prototype.decouple=function(a){return JSON.parse(JSON.stringify(a))};c.prototype.debug=new l([function(){return this._debug.all},function(a){return void 0!==a&&"boolean"===typeof a?(this._debug.all=a,this):this._debug.all},function(a,b){return void 0!==a?void 0!==b?(this._debug[a]=b,this):this._debug[a]:this._debug.all}]);c.prototype.arrayToCollection=function(c){return(new a).setData(c)};c.prototype.on=function(a,b){this._listeners=this._listeners||
{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);return this};c.prototype.off=function(a,b){if(a in this._listeners){var c=this._listeners[a],e=c.indexOf(b);-1<e&&c.splice(e,1)}return this};c.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){var c=this._listeners[a],e=c.length,f;for(f=0;f<e;f++)c[f].apply(this,Array.prototype.slice.call(arguments,1))}return this};c.prototype.objectId=function(a){var b,c,e=Math.pow(10,17),f;if(a){b=0;c=
a.length;for(f=0;f<c;f++)b+=a.charCodeAt(f)*e;a=b.toString(16)}else g.idCounter++,a=(g.idCounter+(Math.random()*e+Math.random()*e+Math.random()*e+Math.random()*e)).toString(16);return a};c.prototype.peek=function(a){var b,c,e=[],f=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(c=this._collection[b],e="string"===f?e.concat(c.peek(a)):e.concat(c.find(a)));return e};c.prototype.peekCat=function(a){var b,c,e={},f,g=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&
(c=this._collection[b],(f="string"===g?c.peek(a):c.find(a))&&f.length&&(e[c.name()]=f));return e};p.exports=c},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":9,"./Overload.js":11,"./Shared.js":14}],5:[function(h,p,l){var g=function(){var a=[],c,d,b;for(d=0;256>d;d++){c=d;for(b=0;8>b;b++)c=c&1?3988292384^c>>>1:c>>>1;a[d]=c}return a}();p.exports=function(a){var c=-1,d;for(d=0;d<a.length;d++)c=c>>>8^g[(c^a.charCodeAt(d))&255];return(c^-1)>>>0}},{}],6:[function(h,p,l){var g;h=h("./Shared");var a=function(a,
d){this.init.apply(this,arguments)};a.prototype.init=function(a,d){this._options=d;this._selector=$(this._options.selector);this._listeners={};this._collection=a;this._options.series=[];var b,g;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();b=this._collection.find();g={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&
Highcharts.theme.contrastTextColor||"black"}}};b=this.pieDataFromCollectionData(b,this._options.keyField,this._options.valField);$.extend(g,this._options.seriesOptions);$.extend(g,{type:"pie",name:this._options.seriesName,data:b});this._chart.addSeries(g);break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=b.xAxis,this._options.chartOptions.series=b.series,this._selector.highcharts(this._options.chartOptions),
this._chart=this._selector.highcharts()}this._hookEvents()};h=h.modules.Collection;g=h.prototype.init;a.prototype.pieDataFromCollectionData=function(a,d,b){var g=[],e;for(e=0;e<a.length;e++)g.push([a[e][d],a[e][b]]);return g};a.prototype.lineDataFromCollectionData=function(a,d,b,g){var e=this._collection.distinct(a),f=[],k={categories:[]},h,l,p,ca,da;for(ca=0;ca<e.length;ca++){h=e[ca];l={};l[a]=h;p=[];l=this._collection.find(l,{orderBy:g});for(da=0;da<l.length;da++)k.categories.push(l[da][d]),p.push(l[da][b]);
f.push({name:h,data:p})}return{xAxis:k,series:f}};a.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};a.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var a=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField));break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,
this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);for(var d=0;d<a.series.length;d++)this._chart.series[d].setData(a.series[d].data)}}};a.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};a.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];
delete this._chart;delete this._options;delete this._collection;return this};h.prototype.init=function(){this._highcharts={};g.apply(this,arguments)};h.prototype.chart=function(c){this._highcharts[c.selector]||(this._highcharts[c.selector]=new a(this,c));return this._highcharts[c.selector]};h.prototype.dropChart=function(a){this._highcharts[a]&&this._highcharts[a].drop()};p.exports=a},{"./Shared":14}],7:[function(h,p,l){l=h("./Shared");var g=h("./Path");h=function(){this.init.apply(this,arguments)};
h.prototype.init=function(a,c,d){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(c&&c.unique?c.unique:!1);void 0!==a&&this.keys(a);void 0!==d&&this.collection(d);this.name(c&&c.name?c.name:this._id)};l.addModule("Index",h);l.inherit(h.prototype,l.chainSystem);h.prototype.id=function(){return this._id};h.prototype.state=function(){return this._state};h.prototype.size=function(){return this._size};h.prototype.data=function(a){return void 0!==a?(this._data=a,
this):this._data};h.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};h.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};h.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new g).parse(this._keys).length,this):this._keys};h.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};h.prototype.unique=function(a){return void 0!==a?(this._unique=a,this):this._unique};h.prototype.rebuild=
function(){if(this._collection){var a=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}).find(),c,d=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(c=0;c<d;c++)this.insert(a[c])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};h.prototype.insert=function(a,c){var d,b;this._unique&&(d=this._itemHash(a,this._keys),this._uniqueLookup[d]=a);d=this._itemHashArr(a,this._keys);for(b=0;b<d.length;b++)this.pushToPathValue(d[b],
a)};h.prototype.remove=function(a,c){var d,b;this._unique&&(d=this._itemHash(a,this._keys),delete this._uniqueLookup[d]);d=this._itemHashArr(a,this._keys);for(b=0;b<d.length;b++)this.pullFromPathValue(d[b],a)};h.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};h.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};h.prototype.pushToPathValue=function(a,c){var d=this._data[a]=this._data[a]||[];-1===d.indexOf(c)&&(d.push(c),
this._size++,this.pushToCrossRef(c,d))};h.prototype.pullFromPathValue=function(a,c){var d=this._data[a],b;b=d.indexOf(c);-1<b&&(d.splice(b,1),this._size--,this.pullFromCrossRef(c,d));d.length||delete this._data[a]};h.prototype.pull=function(a){var c=a[this._collection.primaryKey()],d=this._crossRef[c],b,g=d.length,e;for(b=0;b<g;b++)e=d[b],this._pullFromArray(e,a);this._size--;delete this._crossRef[c]};h.prototype._pullFromArray=function(a,c){for(var d=a.length;d--;)a[d]===c&&a.splice(d,1)};h.prototype.pushToCrossRef=
function(a,c){var d=a[this._collection.primaryKey()];this._crossRef[d]=this._crossRef[d]||[];d=this._crossRef[d];-1===d.indexOf(c)&&d.push(c)};h.prototype.pullFromCrossRef=function(a,c){var d=a[this._collection.primaryKey()];delete this._crossRef[d]};h.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};h.prototype.match=function(a,c){return(new g).countObjectPaths(this._keys,a)};h.prototype._itemHash=function(a,c){var d=new g,b,m="",e;b=d.parse(c);for(e=0;e<b.length;e++)m&&
(m+="_"),m+=d.value(a,b[e].path).join(":");return m};h.prototype._itemKeyHash=function(a,c){var d=new g,b,m="",e;b=d.parse(c);for(e=0;e<b.length;e++)m&&(m+="_"),m+=d.keyValue(a,b[e].path);return m};h.prototype._itemHashArr=function(a,c){var d=new g,b,m=[],e,f,k,h;b=d.parse(c);for(k=0;k<b.length;k++)for(e=d.value(a,b[k].path),f=0;f<e.length;f++)if(0===k)m.push(e[f]);else for(h=0;h<m.length;h++)m[h]=m[h]+"_"+e[f];return m};p.exports=h},{"./Path":12,"./Shared":14}],8:[function(h,p,l){h=h("./Shared");
l=function(g){this.init.apply(this,arguments)};l.prototype.init=function(g){this._name=g;this._data={};this._primaryKey="_id"};h.addModule("KeyValueStore",l);h.inherit(l.prototype,h.chainSystem);l.prototype.name=function(g){return void 0!==g?(this._name=g,this):this._name};l.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey=g,this):this._primaryKey};l.prototype.truncate=function(){this._data={};return this};l.prototype.set=function(g,a){this._data[g]=a?a:!0;return this};l.prototype.get=
function(g){return this._data[g]};l.prototype.lookup=function(g){g=g[this._primaryKey];var a,c,d,b;if(g instanceof Array){c=g.length;b=[];for(a=0;a<c;a++)(d=this._data[g[a]])&&b.push(d);return b}if(g instanceof RegExp){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&g.test(a)&&b.push(this._data[a]);return b}if("object"===typeof g){if(g.$ne){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==g.$ne&&b.push(this._data[a]);return b}if(g.$in&&g.$in instanceof Array){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&
-1<g.$in.indexOf(a)&&b.push(this._data[a]);return b}if(g.$nin&&g.$nin instanceof Array){b=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===g.$nin.indexOf(a)&&b.push(this._data[a]);return b}if(g.$or&&g.$or instanceof Array){b=[];for(a=0;a<g.$or.length;a++)b=b.concat(this.lookup(g.$or[a]));return b}}else return d=this._data[g],void 0!==d?[d]:[]};l.prototype.unSet=function(g){delete this._data[g];return this};l.prototype.uniqueSet=function(g,a){return void 0===this._data[g]?(this._data[g]=a,
!0):!1};p.exports=l},{"./Shared":14}],9:[function(h,p,l){l=h("./Shared");var g=h("./Operation");h=function(){this.init.apply(this,arguments)};h.prototype.init=function(){this._data=[]};l.addModule("Metrics",h);l.inherit(h.prototype,l.chainSystem);h.prototype.create=function(a){a=new g(a);this._enabled&&this._data.push(a);return a};h.prototype.start=function(){this._enabled=!0;return this};h.prototype.stop=function(){this._enabled=!1;return this};h.prototype.clear=function(){this._data=[];return this};
h.prototype.list=function(){return this._data};p.exports=h},{"./Operation":10,"./Shared":14}],10:[function(h,p,l){l=h("./Shared");var g=h("./Path");h=function(a){this.pathSolver=new g;this.counter=0;this.init.apply(this,arguments)};h.prototype.init=function(a){this._data={operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};l.addModule("Operation",h);l.inherit(h.prototype,l.chainSystem);h.prototype.start=function(){this._data.time.startMs=
(new Date).getTime()};h.prototype.log=function(a){if(a){var c=0<this._log.length?this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);c&&(a.delta=a.time-c);return this}return this._data.log};h.prototype.time=function(a){if(void 0!==a){var c=this._data.time.process,c=c[a]=c[a]||{};c.startMs?(c.stopMs=(new Date).getTime(),c.totalMs=c.stopMs-c.startMs,c.stepObj.totalMs=c.totalMs,delete c.stepObj):(c.startMs=(new Date).getTime(),c.stepObj=
{name:a},this._data.steps.push(c.stepObj));return this}return this._data.time};h.prototype.flag=function(a,c){if(void 0!==a&&void 0!==c)this._data.flag[a]=c;else return void 0!==a?this._data.flag[a]:this._data.flag};h.prototype.data=function(a,c,d){return void 0!==c?(this.pathSolver.set(this._data,a,c),this):this.pathSolver.get(this._data,a)};h.prototype.pushData=function(a,c,d){this.pathSolver.push(this._data,a,c)};h.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=
this._data.time.stopMs-this._data.time.startMs};p.exports=h},{"./Path":12,"./Shared":14}],11:[function(h,p,l){l=function(g){if(g){var a,c=g.length;return function(){for(a=0;a<c;a++)if(g[a].length===arguments.length)return g[a].apply(this,arguments);return null}}return function(){}};h("./Shared").addModule("Overload",l);p.exports=l},{"./Shared":14}],12:[function(h,p,l){h=h("./Shared");l=function(g){this.init.apply(this,arguments)};l.prototype.init=function(g){g&&this.path(g)};h.addModule("Path",l);
h.inherit(l.prototype,h.chainSystem);l.prototype.path=function(g){return void 0!==g?(this._path=this.clean(g),this._pathParts=this._path.split("."),this):this._path};l.prototype.hasObjectPaths=function(g,a){var c=!0,d;for(d in g)if(g.hasOwnProperty(d)&&(void 0===a[d]||"object"===typeof g[d]&&(c=this.hasObjectPaths(g[d],a[d]),!c)))return!1;return c};l.prototype.countKeys=function(g){var a=0,c;for(c in g)g.hasOwnProperty(c)&&void 0!==g[c]&&("object"!==typeof g[c]?a++:a+=this.countKeys(g[c]));return a};
l.prototype.countObjectPaths=function(g,a){var c,d={},b=0,m=0,e;for(e in a)a.hasOwnProperty(e)&&("object"===typeof a[e]?(c=this.countObjectPaths(g[e],a[e]),d[e]=c.matchedKeys,m+=c.totalKeyCount,b+=c.matchedKeyCount):(m++,g&&g[e]&&"object"!==typeof g[e]?(d[e]=!0,b++):d[e]=!1));return{matchedKeys:d,matchedKeyCount:b,totalKeyCount:m}};l.prototype.parse=function(g,a){var c=[],d="",b,m,e;for(m in g)if(g.hasOwnProperty(m))if(d=m,"object"===typeof g[m])if(a)for(b=this.parse(g[m],a),e=0;e<b.length;e++)c.push({path:d+
"."+b[e].path,value:b[e].value});else for(b=this.parse(g[m]),e=0;e<b.length;e++)c.push({path:d+"."+b[e].path});else a?c.push({path:d,value:g[m]}):c.push({path:d});return c};l.prototype.parseArr=function(g,a){a=a||{};return this._parseArr(g,"",[],a)};l.prototype._parseArr=function(g,a,c,d){var b,m="";a=a||"";c=c||[];for(b in g)g.hasOwnProperty(b)&&(!d.ignore||d.ignore&&!d.ignore.test(b))&&(m=a?a+"."+b:b,"object"===typeof g[b]?this._parseArr(g[b],m,c,d):c.push(m));return c};l.prototype.value=function(g,
a){if(void 0!==g&&"object"===typeof g){var c,d,b,m,e=[],f;void 0!==a&&(a=this.clean(a),c=a.split("."));c=c||this._pathParts;d=c.length;b=g;for(f=0;f<d;f++){b=b[c[f]];if(m instanceof Array){for(d=0;d<m.length;d++)e=e.concat(this.value(m,d+"."+c[f]));return e}if(!b||"object"!==typeof b)break;m=b}return[b]}return[]};l.prototype.set=function(g,a,c){if(void 0!==g&&void 0!==a){var d;a=this.clean(a);a=a.split(".");d=a.shift();a.length?(g[d]=g[d]||{},this.set(g[d],a.join("."),c)):g[d]=c}return g};l.prototype.get=
function(g,a){return this.value(g,a)[0]};l.prototype.push=function(g,a,c){if(void 0!==g&&void 0!==a){var d;a=this.clean(a);a=a.split(".");d=a.shift();if(a.length)g[d]=g[d]||{},this.set(g[d],a.join("."),c);else if(g[d]=g[d]||[],g[d]instanceof Array)g[d].push(c);else throw"Cannot push to a path whose endpoint is not an array!";}return g};l.prototype.keyValue=function(g,a){var c,d,b,m,e;void 0!==a&&(a=this.clean(a),c=a.split("."));c=c||this._pathParts;d=c.length;b=g;for(e=0;e<d;e++)if(b=b[c[e]],!b||
"object"!==typeof b){m=c[e]+":"+b;break}return m};l.prototype.clean=function(g){"."===g.substr(0,1)&&(g=g.substr(1,g.length-1));return g};p.exports=l},{"./Shared":14}],13:[function(h,p,l){l=h("./Shared");var g,a,c,d;d=function(){this.init.apply(this,arguments)};d.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};l.addModule("Persist",d);l.inherit(d.prototype,l.chainSystem);l=l.modules.Core;g=h("./Collection");a=g.prototype.drop;h("./CollectionGroup");h("./Overload");
c=l.prototype.init;d.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};d.prototype.save=function(a,c,e){switch(this.mode()){case "localStorage":c="object"===typeof c?"json::fdb::"+JSON.stringify(c):"raw::fdb::"+c;try{localStorage.setItem(a,c)}catch(f){e&&e(f)}e&&e(!1)}e&&e("No data handler.")};d.prototype.load=function(a,c){var e,f;switch(this.mode()){case "localStorage":try{e=localStorage.getItem(a)}catch(d){c(d,null)}if(e){e=e.split("::fdb::");switch(e[0]){case "json":f=
JSON.parse(e[1]);break;case "raw":f=e[1]}c&&c(!1,f)}}c&&c("No data handler or unrecognised data type.")};d.prototype.drop=function(a,c){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(e){c&&c(e)}c&&c(!1)}c&&c("No data handler or unrecognised data type.")};g.prototype.drop=function(b){if(b)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),
"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";a.apply(this)};g.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";
else return a&&a("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};g.prototype.load=function(a){var c=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(e,f){if(e)return a&&a(e),e;f&&c.setData(f);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};
l.prototype.init=function(){this.persist=new d(this);c.apply(this,arguments)};p.exports=d},{"./Collection":2,"./CollectionGroup":3,"./Overload":11,"./Shared":14}],14:[function(h,p,l){p.exports={idCounter:0,modules:{},addModule:function(g,a){this.modules[g]=a},inherit:function(g,a){for(var c in a)a.hasOwnProperty(c)&&(g[c]=a[c])},chainSystem:{chain:function(g){this._chain=this._chain||[];-1===this._chain.indexOf(g)&&this._chain.push(g)},unChain:function(g){this._chain&&(g=this._chain.indexOf(g),-1<
g&&this._chain.splice(g,1))},chainSend:function(g,a,c){if(this._chain){var d=this._chain,b=d.length,m;for(m=0;m<b;m++)d[m].chainReceive(this,g,a,c)}},chainReceive:function(g,a,c,d){(!this._chainHandler||this._chainHandler&&!this._chainHandler(g,a,c,d))&&this.chainSend(a,c,d)}}}},{}],15:[function(h,p,l){var g,a,c;l=h("./Shared");var d=function(a,c,e){this.init.apply(this,arguments)};d.prototype.init=function(a,c,e){this._name=a;this._collections=[];this._groups=[];this._listeners={};this._querySettings=
{query:c,options:e};this._debug={};this._privateData=new g("__FDB__view_privateData_"+this._name)};l.addModule("View",d);l.inherit(d.prototype,l.chainSystem);g=h("./Collection");CollectionGroup=h("./CollectionGroup");h=h("./Overload");a=g.prototype.init;l=l.modules.Core;c=l.prototype.init;d.prototype.debug=new h([function(){return this._debug.all},function(a){return void 0!==a&&"boolean"===typeof a?(this._debug.all=a,this.privateData().debug(a),this.publicData().debug(a),this):this._debug.all},function(a,
c){return void 0!==a?void 0!==c?(this._debug[a]=c,this.privateData().debug(a,c),this.publicData().debug(a,c),this):this._debug[a]:this._debug.all}]);d.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};d.prototype.insert=function(){this._collectionsRun("insert",arguments)};d.prototype.update=function(){this._collectionsRun("update",arguments)};d.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};d.prototype.remove=function(){this._collectionsRun("remove",
arguments)};d.prototype._collectionsRun=function(a,c){for(var e=0;e<this._collections.length;e++)this._collections[e][a].apply(this._collections[e],c)};d.prototype.find=function(a,c){return this.publicData().find(a,c)};d.prototype.link=function(a,c){var e=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+e.name()+'" for output target: '+a);return e.link(a,c)};d.prototype.unlink=function(a,c){var e=
this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+e.name()+'" for output target: '+a);return e.unlink(a,c)};d.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};d.prototype._addCollection=function(a){if(-1===this._collections.indexOf(a)){this._collections.push(a);a.chain(this);var c=a.find(this._querySettings.query,this._querySettings.options);
this._transformPrimaryKey(a.primaryKey());this._transformInsert(c);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(c)}return this};d.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._privateData.remove(a.find(this._querySettings.query,this._querySettings.options)));return this};d.prototype._chainHandler=function(a,c,e,f){var d,g;switch(c){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');e=this._privateData.decouple(e);this._transformSetData(e);this._privateData.setData(e);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');e=this._privateData.decouple(e);if(this._querySettings.options&&this._querySettings.options.$orderBy)if(d=[].concat(this._privateData._data),
(a=e instanceof Array)?d=d.concat(e):d.push(e),d=this._privateData.sort(this._querySettings.options.$orderBy,d),a)for(e.sort(function(a,c){return d.indexOf(a)-d.indexOf(c)}),a=0;a<e.length;a++)c=d.indexOf(e[a]),this._transformInsert(e,c),this._privateData._insertHandle(e,c);else c=d.indexOf(e),this._transformInsert(e,c),this._privateData._insertHandle(e,c);else c=f&&f.index?f.index:this._privateData.length,this._transformInsert(e,c),this._privateData._insertHandle(e,c);break;case "update":this.debug()&&
console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');e=this._privateData.update(e.query,e.update,e.options);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(d=[].concat(this._privateData._data),d=this._privateData.sort(this._querySettings.options.$orderBy,d),e.sort(function(a,c){return d.indexOf(a)-d.indexOf(c)}),a=0;a<e.length;a++)f=this._privateData._data.indexOf(e[a]),c=d.indexOf(e[a]),
this._privateData._updateSpliceMove(this._privateData._data,f,c);if(this._transformEnabled&&this._transformIn)for(c=this._publicData.primaryKey(),a=0;a<e.length;a++)f={},g=e[a],f[c]=g[c],this._transformUpdate(f,g);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"'),this._transformRemove(e.query,f),this._privateData.remove(e.query,f)}};d.prototype.on=function(){this._privateData.on.apply(this._privateData,
arguments)};d.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};d.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};d.prototype.drop=function(){if(this._collections&&this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name);for(var a=this._collections.length;a--;)this._removeCollection(this._collections[a]);this._privateData.drop();return!0}return!1};d.prototype.db=
function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};d.prototype.primaryKey=function(){return this._privateData.primaryKey()};d.prototype.queryData=function(a,c,e){void 0!==a&&(this._querySettings.query=a);void 0!==c&&(this._querySettings.options=c);return void 0!==a||void 0!==c?(void 0!==e&&!0!==e||this.refresh(),this):this._querySettings};d.prototype.queryAdd=function(a,c,e){var f=this._querySettings.query,d;if(void 0!==a)for(d in a)a.hasOwnProperty(d)&&
(void 0===f[d]||void 0!==f[d]&&c)&&(f[d]=a[d]);void 0!==e&&!0!==e||this.refresh()};d.prototype.queryRemove=function(a,c){var d=this._querySettings.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&delete d[f];void 0!==c&&!0!==c||this.refresh()};d.prototype.query=function(a,c){return void 0!==a?(this._querySettings.query=a,void 0!==c&&!0!==c||this.refresh(),this):this._querySettings.query};d.prototype.queryOptions=function(a,c){return void 0!==a?(this._querySettings.options=a,void 0===a.$decouple&&
(a.$decouple=!0),void 0!==c&&!0!==c||this.refresh(),this):this._querySettings.options};d.prototype.refresh=function(a){var c;a=this.publicData();var d;this._privateData.remove();a.remove();for(d=0;d<this._collections.length;d++)c=this._collections[d],this._privateData.insert(c.find(this._querySettings.query,this._querySettings.options));c=this._privateData.find({},this._querySettings.options);a._linked?jQuery.observable(a._data).refresh(c):(this._privateData._data.length=0,this._privateData._data=
this._privateData._data.concat(c));return this};d.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};d.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),
this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.privateData=function(){return this._privateData};d.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};d.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new g("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),
this._publicData.setData(a))};d.prototype._transformInsert=function(a,c){this._transformEnabled&&this._publicData&&this._publicData.insert(a,c)};d.prototype._transformUpdate=function(a,c,d){this._transformEnabled&&this._publicData&&this._publicData.update(a,c,d)};d.prototype._transformRemove=function(a,c){this._transformEnabled&&this._publicData&&this._publicData.remove(a,c)};d.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};g.prototype.init=
function(){this._views=[];a.apply(this,arguments)};g.prototype.view=function(a,c,e){a=(new d(a,c,e)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a};g.prototype._addView=CollectionGroup.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};g.prototype._removeView=CollectionGroup.prototype._removeView=function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};l.prototype.init=function(){this._views=
{};c.apply(this,arguments)};l.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new d(a)).db(this);return this._views[a]};l.prototype.viewExists=function(a){return Boolean(this._views[a])};l.prototype.views=function(){var a=[],c;for(c in this._views)this._views.hasOwnProperty(c)&&a.push({name:c,count:this._views[c].count()});return a};p.exports=d},{"./Collection":2,"./CollectionGroup":3,
"./Overload":11,"./Shared":14}],16:[function(h,p,l){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(g,a,c){function d(a){return a}function b(a){debugger;return a}function h(a){ea=(wa._dbgMode=a)?"Unavailable (nested view): use #getIndex()":"";Aa("dbg",La.dbg=ma.dbg=a?b:d)}function e(a){this.name=(u.link?"JsViews":"JsRender")+" Error";this.message=a||this.name}function f(a,c){for(var b in c)a[b]=c[b];return a}function k(a){return"function"===typeof a}function l(a,c,b){if(!ha.rTag||a)v=
a?a.charAt(0):v,ja=a?a.charAt(1):ja,M=c?c.charAt(0):M,D=c?c.charAt(1):D,P=b||P,a="\\"+v+"(\\"+P+")?\\"+ja,c="\\"+M+"\\"+D,E="(?:(?:(\\w+(?=[\\/\\s\\"+M+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+M+"]|\\"+M+"(?!\\"+D+"))*?)",ha.rTag=E+")",E=RegExp(a+E+"(\\/)?|(?:\\/(\\w+)))"+c,"g"),na=RegExp("<.*>|([^\\\\]|^)[{}]|"+a+".*"+c);return[v,ja,M,D,P]}function p(a,b){b||(b=a,a=c);var d,f,e,g;e=this;d=!b||"root"===b;if(a){if(g=e.type===b?e:c,!g)if(d=e.views,e._.useKey)for(f in d){if(g=
d[f].get(a,b))break}else for(f=0,e=d.length;!g&&f<e;f++)g=d[f].get(a,b)}else if(d)for(;e.parent.parent;)g=e=e.parent;else for(;e&&!g;)g=e.type===b?e:c,e=e.parent;return g}function ba(){var a=this.get("item");return a?a.index:c}function ca(){return this.index}function da(a){var b,d=this,e=d.linkCtx,h=(d.ctx||{})[a];h===c&&e&&e.ctx&&(h=e.ctx[a]);h===c&&(h=La[a]);h&&k(h)&&!h._wrp&&(b=function(){return h.apply(this&&this!==g?this:d,arguments)},b._wrp=1,f(b,h));return b||h}function ua(a,b,d){var f,e,g=
+d===d&&d,h=b.linkCtx;g&&(d=(g=b.tmpl.bnds[g-1])(b.data,b,C));f=d.args[0];if(a||g){f=h&&h.tag;f||(f={_:{inline:!h,bnd:g},tagName:":",cvt:a,flow:!0,tagCtx:d,_is:"tag"},h&&(h.tag=f,f.linkCtx=h,d.ctx=Q(d.ctx,h.view.ctx)),ha._lnk(f));for(e in d.props)Na.test(e)&&(f[e]=d.props[e]);d.view=b;f.ctx=d.ctx||{};delete d.ctx;b._.tag=f;f=va(f,f.convert||"true"!==a&&a)[0];f=g&&b._.onRender?b._.onRender(f,b,g):f;b._.tag=c}return f!=c?f:""}function va(a,c){var b=a.tagCtx,d=b.view,f=b.args;c=c&&(""+c===c?d.getRsc("converters",
c)||la("Unknown converter: '"+c+"'"):c);f=f.length||b.index?c?f.slice():f:[d.data];c&&(c.depends&&(a.depends=ha.getDeps(a.depends,a,c.depends,c)),f[0]=c.apply(a,f));return f}function F(a,b){for(var f,d=this;f===c&&d;)f=(f=d.tmpl[a])&&f[b],d=d.parent;return f||C[a][b]}function q(a,b,d,e,g){var h,k,J,l,m,n,z,H,r,u,p,q="",L=+e===e&&e,A=b.linkCtx||0,s=b.ctx,E=d||b.tmpl;"tag"===a._is&&(h=a,a=h.tagName,e=h.tagCtxs);h=h||A.tag;L&&(e=(H=E.bnds[L-1])(b.data,b,C));n=e.length;for(m=0;m<n;m++){m||d&&h||(r=b.getRsc("tags",
a)||la("Unknown tag: {{"+a+"}}"));k=e[m];A.tag||(z=k.tmpl,z=k.content=z&&E.tmpls[z-1],f(k,{tmpl:(h?h:r).template||z,render:U,index:m,view:b,ctx:Q(k.ctx,s)}));if(d=k.props.tmpl)d=""+d===d?b.getRsc("templates",d)||Ca(d):d,k.tmpl=d;h||(r._ctr?(h=new r._ctr,u=!!h.init,h.attr=h.attr||r.attr||c):ha._lnk(h={render:r.render}),h._={inline:!A},A&&(A.attr=h.attr=A.attr||h.attr,A.tag=h,h.linkCtx=A),(h._.bnd=H||A.fn)?h._.arrVws={}:h.dataBoundOnly&&la("{^{"+a+"}} tag must be data-bound"),h.tagName=a,h.parent=l=
s&&s.tag,h._is="tag",h._def=r,h.tagCtxs=e);if(!m)for(p in z=k.props)Na.test(p)&&(h[p]=z[p]);k.tag=h;h.dataMap&&h.tagCtxs&&(k.map=h.tagCtxs[m].map);h.flow||(z=k.ctx=k.ctx||{},k=h.parents=z.parentTags=s&&Q(z.parentTags,s.parentTags)||{},l&&(k[l.tagName]=l),z.tag=h)}b._.tag=h;h.rendering={};for(m=0;m<n;m++){k=h.tagCtx=h.tagCtxs[m];z=k.props;a=va(h,h.convert);if(e=z.dataMap||h.dataMap)if(a.length||z.dataMap){l=k.map;if(!l||l.src!==a[0]||g)l&&l.src&&l.unmap(),l=k.map=e.map(a[0],z);a=[l.tgt]}h.ctx=k.ctx;
!m&&u&&(e=h.template,h.init(k,A,h.ctx),u=c,h.template!==e&&(h._.tmpl=h.template));l=c;if(e=h.render)l=e.apply(h,a);a=a.length?a:[b];l=l!==c?l:k.render(a[0],!0)||(g?c:"");q=q?q+(l||""):l}delete h.rendering;h.tagCtx=h.tagCtxs[0];h.ctx=h.tagCtx.ctx;h._.inline&&(J=h.attr)&&J!==N&&(q="text"===J?ma.html(q):"");return L&&b._.onRender?b._.onRender(q,b,L):q}function n(a,c,b,d,f,e,g,h){var k="array"===c,l={key:0,useKey:k?0:1,id:""+Ma++,onRender:h,bnds:{}};this.data=d;this.tmpl=f;this.content=g;this.views=k?
[]:{};this.parent=b;this.type=c;this._=l;this.linked=!!h;b?(c=b.views,d=b._,d.useKey?(c[l.key="_"+d.useKey++]=this,this.index=ea,this.getIndex=ba,e=d.tag,l.bnd=k&&(!e||!!e._.bnd&&e)):c.splice(l.key=this.index=e,0,this),this.ctx=a||b.ctx):this.ctx=a}function s(a){var c,b,d,f,e,g;for(c in I)if(f=I[c],(e=f.compile)&&(b=a[c+"s"]))for(d in b)(f=b[d]=e(d,b[d],a))&&(g=ha.onStore[c])&&g(d,f,e)}function Ea(a,b,d){k(b)?b={depends:b.depends,render:b}:(b.baseTag&&(b.flow=!!b.flow,b=f(f({},b.baseTag),b)),(a=b.template)!==
c&&(b.template=""+a===a?Ca[a]||Ca(a):a),!1!==b.init&&(a=b._ctr=function(){},(a.prototype=b).constructor=a));d&&(b._parentTmpl=d);return b}function V(b,d,f,e){function h(d){if(""+d===d||0<d.nodeType){try{l=0<d.nodeType?d:!na.test(d)&&a&&a(g.document).find(d)[0]}catch(k){}l&&(d=Ca[b=b||l.getAttribute(R)],d||(b=b||"_"+Z++,l.setAttribute(R,b),d=Ca[b]=V(b,l.innerHTML,f,e)),l=c);return d}}var k,l;d=d||"";k=h(d);e=e||(d.markup?d:{});e.tmplName=b;f&&(e._parentTmpl=f);!k&&d.markup&&(k=h(d.markup))&&k.fn&&
(k.debug!==d.debug||k.allowCode!==d.allowCode)&&(k=k.markup);if(k!==c)return b&&!f&&(x[b]=function(){return d.render.apply(d,arguments)}),k.fn||d.fn?k.fn&&(d=b&&b!==k.tmplName?Q(e,k):k):(d=Ia(k,e),Fa(k.replace(w,"\\$&"),d)),s(e),d}function Y(a){function c(b,d){this.tgt=a.getTgt(b,d)}k(a)&&(a={getTgt:a});a.baseMap&&(a=f(f({},a.baseMap),a));a.map=function(a,b){return new c(a,b)};return a}function Ia(a,c){var b,d=wa.wrapMap||{},e=f({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:sa},
c);c.htmlTag||(b=O.exec(a),e.htmlTag=b?b[1].toLowerCase():"");(b=d[e.htmlTag])&&b!==d.div&&(e.markup=u.trim(e.markup));return e}function oa(a,b){function d(e,g,h){var k,l,J;if(e&&"object"===typeof e&&!e.nodeType&&!e.markup&&!e.getTgt){for(l in e)d(l,e[l],g);return C}g===c&&(g=e,e=c);e&&""+e!==e&&(h=g,g=e,e=c);J=h?h[f]=h[f]||{}:d;l=b.compile;null===g?e&&delete J[e]:(g=l?g=l(e,g,h):g,e&&(J[e]=g));l&&g&&(g._is=a);g&&(k=ha.onStore[a])&&k(e,g,l);return g}var f=a+"s";C[f]=d;I[a]=b}function za(a,c){var b=
this.jquery&&(this[0]||la('Unknown template: "'+this.selector+'"')),d=b.getAttribute(R);return sa.call(d?Ca[d]:Ca(b),a,c)}function qa(a,c,b){if(wa._dbgMode)try{return a.fn(c,b,C)}catch(d){return la(d,b)}return a.fn(c,b,C)}function sa(a,c,b,d,e,f){return d||!this.fn._nvw||u.isArray(a)?U.call(this,a,c,b,d,e,f):qa(this,a,{tmpl:this})}function U(a,b,d,e,f,g){var h,k,l,J,m,z,H,r,q;l=this;var p="";!!b===b&&(d=b,b=c);!0===f&&(h=!0,f=0);l.tag?(z=l,l=l.tag,k=l._,m=l.tagName,r=k.tmpl||z.tmpl,q=l.attr&&l.attr!==
N,b=Q(b,l.ctx),H=z.content,!1===z.props.link&&(b=b||{},b.link=!1),e=e||z.view,a=arguments.length?a:e):r=l;if(r&&(!e&&a&&"view"===a._is&&(e=a),e&&(H=H||e.content,g=g||e._.onRender,a===e&&(a=e.data),b=Q(b,e.ctx)),e&&e.data!==c||((b=b||{}).root=a),r.fn||(r=Ca[r]||Ca(r)),r)){z=g=!1!==(b&&b.link)&&!q&&g;!0===g&&(z=c,g=e._.onRender);b=r.helpers?Q(r.helpers,b):b;if(u.isArray(a)&&!d)for(J=h?e:f!==c&&e||new n(b,"array",e,a,r,f,H,g),h=0,k=a.length;h<k;h++)l=a[h],m=new n(b,"item",J,l,r,(f||0)+h,H,g),l=qa(r,
l,m),p+=J._.onRender?J._.onRender(l,m):l;else{if(e||!r.fn._nvw)J=h?e:new n(b,m||"data",e,a,r,f,H,g),k&&!l.flow&&(J.tag=l);p+=qa(r,a,J)}return z?z(p,J):p}return""}function la(a,c,b){b=wa.onError(a,c,b);if(""+a===a)throw new ha.Err(b);return!c.linkCtx&&c.linked?ma.html(b):b}function aa(a){la("Syntax error\n"+a)}function Fa(a,c,b,d){function e(c){(c-=n)&&H.push(a.substr(n,c).replace(ka,"\\n"))}function f(c){c&&aa('Unmatched or missing tag: "{{/'+c+'}}" in template:\n'+a)}var g,h,k,l=c&&c.allowCode,m=
[],n=0,Q=[],H=m,r=[,,m];b&&(a=v+a+D);f(Q[0]&&Q[0][2].pop()[0]);a.replace(E,function(g,m,z,p,q,u,L,A,s,E,x,v){u&&(q=":",p=N);E=E||b;m=(m||b)&&[];var C="",B="",ra="",Ga="",W="",Ka="",Oa="",Xa="";L=!E&&!q&&!L;z=z||(s=s||"#data",q);e(v);n=v+g.length;A?l&&H.push(["*","\n"+s.replace(ia,"$1")+"\n"]):z?("else"===z&&(S.test(s)&&aa('for "{{else if expr}}" use "{{else expr}}"'),m=r[7],r[8]=a.substring(r[8],v),r=Q.pop(),H=r[2],L=!0),s&&J(s.replace(ka," "),m,c).replace(G,function(a,c,b,d,e,f,g,h){g?(B+=f+",",
Ga+="'"+h+"',"):b?(ra+=d+f+",",Ka+=d+"'"+h+"',"):c?Oa+=f:("trigger"===e&&(Xa+=f),C+=d+f+",",W+=d+"'"+h+"',",k=k||Na.test(e));return""}).slice(0,-1),h=[z,p||!!d||k||"",L&&[],[Ga.slice(0,-1),W.slice(0,-1),Ka.slice(0,-1)],[B.slice(0,-1),C.slice(0,-1),ra.slice(0,-1)],Oa,Xa,m||0],H.push(h),L&&(Q.push(r),r=h,r[8]=n)):x&&(f(x!==r[0]&&"else"!==r[0]&&x),r[8]=a.substring(r[8],v),r=Q.pop());f(!r&&x);H=r[2]});e(a.length);(n=m[m.length-1])&&f(""+n!==n&&+n[8]===n[8]&&n[0]);b?(g=z(m,a,b),g.paths=m[0][7]):g=z(m,
c);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Ja(a,c){return"\n\t"+(c?c+":{":"")+"args:["+a[0]+"]"+(a[1]||!c?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function J(a,c,b){var d,e,f,g,h,k=0,l=b?b.links:c&&(c.links=c.links||{}),m={},J={0:-1},n=0;return(a+(b?" ":"")).replace(/\)\^/g,").").replace(Ha,function(z,Q,r,H,p,q,u,L,A,s,E,x,v,C,w,B,ra,Ga,W,Ka){function Oa(a,b,B,g,ra,h,Ga,W){return B&&(c&&("linkTo"===d&&(e=c._jsvto=c._jsvto||[],e.push(p)),d&&!f||c.push(p.slice(b.length))),
"."!==B)?(a=(g?'view.hlp("'+g+'")':ra?"view":"data")+(W?(h?"."+h:g?"":ra?"":"."+B)+(Ga||""):(W=g?"":ra?h||"":B,"")),a+=W?"."+W:"",b+("view.data"===a.slice(0,9)?a.slice(5):a)):a}q=q||"";r=r||Q||x;p=p||A;s=s||ra||"";if(!u||h||g)return!c||!B||h||g||d&&!f&&!e||(B=J[n],Ka.length-1>W-B&&(B=Ka.slice(B,W+1),B=ja+":"+B+M,u=l[B],u||(l[B]=1,l[B]=u=Fa(B,b||c,!0),u.paths.push({_jsvOb:u})),1!==u&&(e||c).push({_jsvOb:u}))),h?(h=!v,h?z:'"'):g?(g=!C,g?z:'"'):(r?(n++,J[n]=W++,r):"")+(Ga?n?"":(k=Ka.slice(k,W),d?(d=
f=e=!1,"\b"):"\b,")+k+(k=W+z.length,"\b"):L?(n&&aa(a),d=p,f=H,k=W+z.length,p+":"):p?p.split("^").join(".").replace(X,Oa)+(s?(m[++n]=!0,"."!==p.charAt(0)&&(J[n]=W),s):q):q?q:w?(m[n--]=!1,w)+(s?(m[++n]=!0,s):""):E?(m[n]||aa(a),","):Q?"":(h=v,g=C,'"'));aa(a)})}function z(c,b,d){var e,f,g,h,k,l,m,J,n,Q,r,H,p,q,u,L,A,s,E,x,v,C,w,M,D=0,B="",ra={},Ga=c.length;""+b===b?(u=d?'data-link="'+b.replace(ka," ").slice(1,-1)+'"':b,b=0):(u=b.tmplName||"unnamed",b.allowCode&&(ra.allowCode=!0),b.debug&&(ra.debug=!0),
r=b.bnds,q=b.tmpls);for(e=0;e<Ga;e++)if(f=c[e],""+f===f)B+='\n+"'+f+'"';else if(g=f[0],"*"===g)B+=";\n"+f[1]+"\nret=ret";else{h=f[1];s=f[2];k=Ja(f[3],"params")+"},"+Ja(p=f[4]);w=f[5];M=f[6];E=f[8];(v="else"===g)||(D=0,r&&(H=f[7])&&(D=r.push(H)));(f=":"===g)?h&&(g=h===N?">":h+g):(s&&(L=Ia(E,ra),L.tmplName=u+"/"+g,z(s,L),q.push(L)),v||(A=g,x=B,B=""),L=(L=c[e+1])&&"else"===L[0]);v=w?";\ntry{\nret+=":"\n+";if(f&&(H||M||h&&h!==N)){C="return {"+k+"};";w&&(C="try {\n"+C+"\n}catch(e){return {error: j._err(e,view,"+
w+")}}\n");C=new Function("data,view,j,u"," // "+u+" "+D+" "+g+"\n"+C);C.paths=H;C._tag=g;if(d)return C;Q=1}B+=f?(d?(w?"\ntry{\n":"")+"return ":v)+(Q?(Q=0,n=J=!0,'c("'+h+'",view,'+(H?(r[D-1]=C,D):"{"+k+"}")+")"):">"===g?(m=!0,"h("+p[0]+")"):"((v="+p[0]+')!=null?v:"")'):(n=l=!0,"\n{view:view,tmpl:"+(s?q.length:"0")+","+k+"},");if(A&&!L){B="["+B.slice(0,-1)+"]";if(d||H)if(B=new Function("data,view,j,u"," // "+u+" "+D+" "+A+"\nreturn "+B+";"),H&&((r[D-1]=B).paths=H),B._tag=g,d)return B;B=x+v+'t("'+A+
'",view,this,'+(D||B)+")";A=H=0}w&&(n=!0,B+=";\n}catch(e){ret"+(d?"urn ":"+=")+"j._err(e,view,"+w+");}\n"+(d?"":"ret=ret"))}B="// "+u+"\nj=j||"+(a?"jQuery.":"jsviews.")+"views;var v"+(l?",t=j._tag":"")+(J?",c=j._cnvt":"")+(m?",h=j.converters.html":"")+(d?";\n":',ret=""\n')+(ra.debug?"debugger;":"")+B+(d?"\n":";\nreturn ret;");try{B=new Function("data,view,j,u",B)}catch(W){aa("Compiled template code:\n\n"+B+'\n: "'+W.message+'"')}b&&(b.fn=B);n||(B._nvw=!0);return B}function Q(a,c){return a&&a!==c?
c?f(f({},c),a):a:c&&f({},c)}function H(a){return fa[a]||(fa[a]="&#"+a.charCodeAt(0)+";")}function L(a){var c,b,d=[];if("object"===typeof a)for(c in a)(b=a[c])&&b.toJSON&&!b.toJSON()||k(b)||d.push({key:c,prop:b});return d}function A(a){return null!=a?ga.test(a)&&(""+a).replace(pa,H)||a:""}if(!(a&&a.render||g.jsviews)){var u,r,E,na,ea,v="{",ja="{",M="}",D="}",P="^",X=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,Ha=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,
ka=/[ \t]*(\r\n|\n|\r)/g,ia=/\\(['"])/g,w=/['"\\]/g,G=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,S=/^if\s/,O=/<(\w+)[>\s]/,ga=/[\x00`><\"'&]/,Na=/^on[A-Z]|^convert(Back)?$/,pa=/[\x00`><"'&]/g,Z=0,Ma=0,fa={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},N="html",R="data-jsv-tmpl",x={},I={template:{compile:V},tag:{compile:Ea},helper:{},converter:{}},C={jsviews:"v1.0.0-beta",settings:function(a){f(wa,a);h(wa._dbgMode);wa.jsv&&wa.jsv()},
sub:{View:n,Err:e,tmplFn:Fa,cvt:va,parse:J,extend:f,syntaxErr:aa,onStore:{},_lnk:d},map:Y,_cnvt:ua,_tag:q,_err:la};(e.prototype=Error()).constructor=e;ba.depends=function(){return[this.get("item"),"index"]};ca.depends=function(){return["index"]};n.prototype={get:p,getIndex:ca,getRsc:F,hlp:da,_is:"view"};for(r in I)oa(r,I[r]);var Ca=C.templates,ma=C.converters,La=C.helpers,Aa=C.tags,ha=C.sub,wa=C.settings;a?(u=a,u.fn.render=za,u.observable&&(f(ha,u.views.sub),C.map=u.views.map)):(u=g.jsviews={},u.isArray=
Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});u.render=x;u.views=C;u.templates=Ca=C.templates;wa({debugMode:h,delimiters:l,onError:function(a,b,d){b&&(a=d===c?"{Error: "+a+"}":k(d)?d(a,b):d);return a==c?"":a},_dbgMode:!0});Aa({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,
c,b){var d;for(a=0;(d=this.tagCtxs[a])&&d.args.length;a++)if(d=d.args[0],c=!d!==!b[a].args[0],!this.convert&&d||c)return c;return!1},flow:!0},"for":{render:function(a){var b,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(b=!arguments.length)a=d.view.data;a!==c&&(e+=d.render(a,b),f+=u.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:d,flow:!0}});Aa("props",{baseTag:Aa["for"],dataMap:Y(L)});ma({html:A,attr:A,url:function(a){return a!=
c?encodeURI(""+a):null===a?a:""}});l()}})(this,this.jQuery);(function(g,a,c){function d(a){return s(a)?new h(a):new b(a)}function b(a){this._data=a;return this}function h(a){this._data=a;return this}function e(a,c){a=s(a)?a:[a];var b,d,f=c,g=f,h=a.length,k=[];for(b=0;b<h;b++)d=a[b],U(d)?k=k.concat(e(d.call(c,c),c)):""+d!==d?(c=g=d,g!==f&&k.push(f=g)):(g!==f&&k.push(f=g),k.push(d));return k}function f(a,c){var b,d;for(b in a){d=!0;break}d||delete qa[c]}function k(a,b){if(!a.data||!a.data.off){var d,
e,f,g=b.oldValue,h=b.value,k=a.data,l=k.observeAll,m=!k.cb.noArray,n=k.paths;if(a.type===za)(k.cb.array||k.cb).call(k,a,b);else if(k.prop===b.path||"*"===k.prop)g=typeof g===V&&(n[0]||m&&s(g))&&g,h=typeof(h=b.value)===V&&(n[0]||m&&s(h))&&h,l?(d=l._path+"."+b.path,e=l.filter,f=[l.parents().slice()],g&&ba(m,l.ns,[g],n,k.cb,!0,e,f,d),h&&ba(m,l.ns,[h],n,k.cb,c,e,f,d)):(g&&ba(m,[g],n,k.cb,!0),h&&ba(m,[h],n,k.cb)),k.cb(a,b)}}function l(){function b(c,d,e,f){var g,h=Fa(x),l=s(x)?[x]:x;c=ga?c+"."+ga:c;if(ea||
f)h&&a(l).off(c,k);else{if(P=h&&a._data(x))for(M=(P=(P=P&&P.events)&&P[e?za:oa])&&P.length;M--;)if((D=P[M].data)&&D.cb._cId===v._cId&&D.ns===ga){if(e)return;("*"===d&&D.prop!==d||D.prop===r)&&a(x).off(c,k)}d=e?{}:{fullPath:E,paths:d?[d]:[],prop:r};d.ns=ga;d.cb=v;S&&(d.observeAll={_path:S,path:function(){g=G.length;return S.replace(/[[.]/g,function(c){g--;return"["===c?"["+a.inArray(G[g-1],G[g]):"."})},parents:function(){return G},filter:O,ns:ga});a(l).on(c,null,d,k);ka&&(ka[a.data(x,"obId")||a.data(x,
"obId",la++)]=x)}}function g(a,c){a._ob=X(a,R);var b=R;return function(d,e){var f=a._ob,g=c.length;typeof f===V&&(h(f,!0),(g||Z&&s(f))&&ba(Z,[f],c,v,X,!0));f=a._ob=X(a,b);typeof f===V&&(h(f),(g||Z&&s(f))&&ba(Z,[f],c,v,X,[b]));v(d,e)}}function h(a,f,e,g){if(Z){var k=x,l=S;x=a;g&&(x=a[g],S+="."+g,O&&(x=d._fltr(g,a,S,O)));x&&(e||s(x))&&b(za+".observe"+(v?".obs"+(ja=v._cId=v._cId||aa++):""),c,!0,f);x=k;S=l}}var m,p,q,u,r,E,F,ea,v,ja,M,D,P,X,Y,ka,ia,w,G,S,O,ga,ca,da,Z=!1!=this,va=1,fa=sa,N=Array.apply(0,
arguments);m=N.pop();var R=N.shift(),x=w=R,I=N.length;R+""===R&&Z&&(ga=R,R=x=w=N.shift(),I--);if(U(m))v=m;else if(m+""===m&&(S=m,G=N.pop(),O=N.pop(),m=N.pop(),I-=3),!0===m?ea=m:m&&(R=m,va=0),m=N[I-1],I&&m===c||U(m))v=N.pop(),I--;I&&U(N[I-1])&&(X=v,v=N.pop(),I--);fa+=ea?v?".obs"+v._cId:"":".obs"+(ja=v._cId=v._cId||aa++);ea||(ka=qa[ja]=qa[ja]||{});ca=ga&&ga.match(Ia)||[""];for(da=ca.length;da--;)for(ga=ca[da],s(w)?h(w,ea,!0):ea&&0===I&&w&&b(fa,""),m=ia=0;m<I;m++)if(E=N[m],""!==E){x=w;if(""+E===E){u=
E.split("^");u[1]&&(ia=u[0].split(".").length,E=u.join("."),ia=E.split(".").length-ia);if(X&&(Y=X(E,w))){I+=Y.length-1;n.apply(N,[m--,1].concat(Y));continue}u=E.split(".")}else va&&!U(E)&&(E._jsvOb&&(w=g(E,N.slice(m+1)),w.noArray=!Z,w._cId=v._cId,ba(Z,[R],N.slice(0,m),w,X),w=c,E=E._ob),x=E),w=E,u=[w];for(;x&&(r=u.shift())!==c;)if(typeof x===V){if(""+r===r){if(""===r)continue;if(u.length<ia+1&&!x.nodeType){if(!ea&&(P=Fa(x)&&a._data(x))){M=(P=(P=P.events)&&P[oa])&&P.length;for(q=0;M--;)!(D=P[M].data)||
D.cb!==v||D.ns!==ga||D.prop!==r&&"*"!==D.prop||((p=u.join("."))&&D.paths.push(p),q++);if(q){x=x[r];continue}}if("*"===r){!ea&&P&&P.length&&b(fa,"",!1,!0);U(x)?(F=x.depends)&&ba(Z,[F],v,ea||R):b(fa,"");for(p in x)h(x,ea,c,p);break}else r&&b(fa+"."+r,u.join("."))}S&&(S+="."+r);r=x[r]}if(U(r)){(F=r.depends)&&ba(Z,[x],e(F,x),v,X,ea||[R]);break}x=r}h(x,ea)}ja&&f(ka,ja);return{cbId:ja,bnd:ka}}function p(){[].push.call(arguments,!0);return l.apply(this,arguments)}function ba(){var a=[].concat.apply([],arguments);
return l.apply(a.shift(),a)}function ca(a,c,b,d){a+""!==a&&(b=c,c=a,a="");ua(a,this._data,c,b,[],"root",d)}function da(a,c,b){ca.call(this,a,c,b,!0)}function ua(a,b,f,e,g,h,k){function m(c,b){p=c.length;for(v=h+"[]";p--;)(F=d._fltr(p,c,v,e))&&ua(a,F,f,e||"",g.slice(),v,b)}function n(c,b){h=c.data.observeAll._path;var d=g;g[0]!==c.target&&(g=g.slice(),g.unshift(c.target));switch(b.change){case "insert":m(b.items);break;case "remove":m(b.items,!0);break;case "refresh":m(b.oldItems,!0);m(c.target);break;
case "set":v=h+"."+b.path,ua(a,b.oldValue,f,0,g.slice(),v,!0),ua(a,b.value,f,0,g.slice(),v)}f.apply(this,arguments);g=d}var p,q,v,F;if(typeof b===V){q=s(b)?"":"*";g.unshift(b);if(f){if(q||0!==e)n._cId=f._cId=f._cId||aa++,l(a,b,q,n,k,e,g.slice(),h)}else l(a,b,q,c,k,e,g.slice(),h);if(q)for(p in b)"_"!==p.charAt(0)&&p!==Ea&&(v=h+"."+p,(F=d._fltr(p,b,v,e))&&ua(a,F,f,e||0,g.slice(),v,k));else m(b,k)}}function va(a,c,b){return 0>b.indexOf(".")&&0>b.indexOf("[")&&c[a]}if(!a)throw"jsViews/jsObservable require jQuery";
if(!a.observable){g=a.views=a.views||{jsviews:"v1.0.0-alpha",sub:{}};var F=g.sub,q=a.event.special,n=[].splice,s=a.isArray,Ea=a.expando,V="object",Y=parseInt,Ia=/\S+/g,oa=F.propChng=F.propChng||"propertyChange",za=F.arrChng=F.arrChng||"arrayChange",qa=F._cbBnds=F._cbBnds||{},sa=oa+".observe",U=a.isFunction,la=1,aa=1,Fa=a.hasData,Ja={};F.getDeps=function(){var a=arguments;return function(){for(var c,b,d=[],f=a.length;f--;)c=a[f--],(b=a[f])&&(d=d.concat(U(b)?b(c,c):b));return d}};a.observable=d;d._fltr=
function(a,c,b,d){(a=d&&U(d)?d(a,c,b):c[a])&&(a=U(a)?a.set&&a.call(c):a);return typeof a===V&&a};d.Object=b;d.Array=h;a.observe=d.observe=l;a.unobserve=d.unobserve=p;d._apply=ba;b.prototype={_data:null,observeAll:ca,unobserveAll:da,data:function(){return this._data},setProperty:function(a,b,d){var f,e=this._data;a=a||"";if(e)if(s(a))for(f=a.length;f--;)b=a[f],this.setProperty(b.name,b.value,d===c||d);else if(""+a!==a)for(f in a)this.setProperty(f,a[f],b);else if(a!==Ea){for(a=a.split(".");e&&1<a.length;)e=
e[a.shift()];e&&this._setProperty(e,a[0],b,d)}return this},removeProperty:function(a){this.setProperty(a,Ja);return this},_setProperty:function(a,b,d,f){var e,g,h,k=b?a[b]:a;U(k)&&k.set&&(g=k,e=!0===k.set?k:k.set,k=k.call(a));if(k!==d||f&&k!=d)if(!(k instanceof Date)||k>d||k<d)e?(e.call(a,d),d=g.call(a)):(h=d===Ja)?(delete a[b],d=c):b&&(a[b]=d),this._trigger(a,{change:"set",path:b,value:d,oldValue:k,remove:h})},_trigger:function(c,b){a(c).triggerHandler(oa,b)}};h.prototype={_data:null,observeAll:ca,
unobserveAll:da,data:function(){return this._data},insert:function(a,c){var b=this._data;1===arguments.length&&(c=a,a=b.length);a=Y(a);-1<a&&a<=b.length&&(c=s(c)?c:[c],c.length&&this._insert(a,c));return this},_insert:function(a,c){var b=this._data,d=b.length;n.apply(b,[a,0].concat(c));this._trigger({change:"insert",index:a,items:c},d)},remove:function(a,b){var d;d=this._data;a===c&&(a=d.length-1);a=Y(a);b=b?Y(b):0===b?0:1;-1<b&&-1<a&&(d=d.slice(a,a+b),(b=d.length)&&this._remove(a,b,d));return this},
_remove:function(a,c,b){var d=this._data,f=d.length;d.splice(a,c);this._trigger({change:"remove",index:a,items:b},f)},move:function(a,c,b){b=b?Y(b):0===b?0:1;a=Y(a);c=Y(c);if(0<b&&-1<a&&-1<c&&a!==c){var d=this._data.slice(a,a+b);(b=d.length)&&this._move(a,c,b,d)}return this},_move:function(a,c,b,d){var f=this._data,e=f.length;f.splice(a,b);f.splice.apply(f,[c,0].concat(d));this._trigger({change:"move",oldIndex:a,index:c,items:d},e)},refresh:function(a){var c=this._data.slice();this._refresh(c,a);
return this},_refresh:function(a,c){var b=this._data,d=b.length;n.apply(b,[0,b.length].concat(c));this._trigger({change:"refresh",oldItems:a},d)},_trigger:function(c,b){var d=this._data,f=d.length,d=a([d]);d.triggerHandler(za,c);f!==b&&d.triggerHandler(oa,{change:"set",path:"length",value:f,oldValue:b})}};q[oa]=q[za]={remove:function(c){var b,d,e,g,h=c.data;if(h&&(h.off=1,h=h.cb)&&(b=qa[h._cId])){c=a._data(this).events[c.type];for(e=c.length;e--&&!d;)d=(g=c[e].data)&&g.cb===h;d||(delete b[a.data(this,
"obId")],f(b,h._cId))}}};g.map=function(b){function f(a,c,e){var g,h=this;this.src&&this.unmap();"object"===typeof a&&(h.src=a,h.tgt=e||h.tgt||[],h.options=c||h.options,h.update(),b.obsSrc&&d(h.src).observeAll(h.obs=function(a,c){g||(g=1,b.obsSrc(h,a,c),g=0)},h.srcFlt),b.obsTgt&&d(h.tgt).observeAll(h.obt=function(a,c){g||(g=1,b.obsTgt(h,a,c),g=0)},h.tgtFlt))}(f.prototype={srcFlt:b.srcFlt||va,tgtFlt:b.tgtFlt||va,update:function(c){a.observable(this.tgt).refresh(b.getTgt(this.src,this.options=c||this.options))},
unmap:function(){this.src&&(this.obs&&a.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&a.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=c)},map:f,_def:b}).constructor=f;U(b)&&(b={getTgt:b});b.baseMap&&(b=a.extend({},b.baseMap,b));b.map=function(a,c,b){return new f(a,c,b)};return b}}})(this,this.jQuery);(function(g,a,c){function d(b,d,f){var e,g,h,l,m,n,p,q,r,y=b.target,s=y._jsvBnd,t=/&(\d+)\+?/g;if(s)for(;h=t.exec(s);)if(h=Ba[h[1]])if(d=h.to){h=h.linkCtx;p=h.view;
r=h.tag;n=a(y);m=p.hlp(I);q=p.hlp(C);g=k(y);e=Ra[g];f===c&&(f=ga(g)?g(y):e?n[e]():n.attr(g));e=d[1];d=d[0];e&&(l=ga(e)?e:p.getRsc("converters",e));l&&(f=l.call(r,f));e=p.linkCtx;p.linkCtx=h;g={change:"change",oldValue:h._val,value:f};if(!(m&&!1===m.call(h,b,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(b,g)||f===c)&&(m=d[0],f!==c&&m)){m=m._jsvOb?m._ob:m;r&&(r._.chging=!0);Z(m).setProperty(d[2]||d[1],f);q&&q.call(h,b,g);if(r){if(r.onAfterChange)r.onAfterChange(b,g);delete r._.chging}h._val=f}p.linkCtx=
e}}function b(b,d,f){var e,g,l,n=this.data,p=this.elem,q=this.convert;g=p.parentNode;var r=this.view,s=r.linkCtx,u=r.hlp(I);r.linkCtx=this;if(g&&!(u&&d&&!1===u.call(this,b,d)||d&&"*"!==b.data.prop&&b.data.prop!==d.path)){d&&(this.eventArgs=d);if(d||this._initVal){delete this._initVal;g=f.call(r.tmpl,n,r,w);a:{var y=g,v=l=this.tag;e=this.attr||k(p,!0,q!==c);var t,x,z=v&&v.parentElem||this.elem;if(y!==c){x=a(z);e=v&&v.attr||e;ga(y)&&ja(this.expr+": missing parens");"visible"===e&&(e="css-display");
if(v=/^css-/.test(e)&&e.slice(4))t=a.style(z,v),+y===y&&(t=parseInt(t));else if("link"!==e){if("value"===e)z.type===La&&(t=x.prop(e=ma));else if(e===Aa)if(z.value===""+y)t=x.prop(ma);else break a;t===c&&(t=(t=Ra[e])?x[t]():x.attr(e))}this._val=t}}if(g&&g.error!==c)g=g.error;else if(l){g=g[0]?g:[g];f=d&&l.onUpdate&&!1===l.onUpdate(b,d,g);qa(l,g);if(f||e===ha){e===T&&l.onBeforeLink&&l.onBeforeLink();Y(l,l.tagCtx);ba(this,n,p);r.linkCtx=s;return}if(l._.chging)return;g=":"===l.tagName?w._cnvt(l.cvt,r,
g[0]):w._tag(l,r,r.tmpl,g,!0)}else f._tag&&(g=(q=""===q?wa:q)?w._cnvt(q,r,g):w._tag(f._tag,r,r.tmpl,g,!0),l=this.tag,e=this.attr||e);h(g,this,e,l)&&d&&(u=r.hlp(C))&&u.call(this,b,d);l&&Y(l,l.tagCtx)}ba(this,n,p);r.linkCtx=s}}function h(b,d,f,e){var k,l,m,n,p,q,r=b!==c,s=d.data,y=e&&e.parentElem||d.elem,u=a(y),t=d.view;q=d._val;var v=t.ctx,x=t.linkCtx,w=e||f===T;e&&(e.parentElem=e.parentElem||d.expr||e._elCnt?y:y.parentNode,l=e._prv,m=e._nxt);if(r){if(/^css-/.test(f))"visible"===d.attr&&(d=(y.currentStyle||
eb.call(g,y,"")).display,b?(b=y._jsvd||d,b!==ha||(b=bb[k=y.nodeName])||(d=ia.createElement(k),ia.body.appendChild(d),b=bb[k]=(d.currentStyle||eb.call(g,d,"")).display,ia.body.removeChild(d))):(y._jsvd=d,b=ha)),(w=w||q!==b)&&a.style(y,f.slice(4),b);else if("link"!==f){if(f===ma)p=1,b=b&&"false"!==b;else if(f===Aa)if(y.value===""+b)b=!0,p=1,f=ma;else{ba(d,s,y);return}else if("selected"===f||"disabled"===f||"multiple"===f||"readonly"===f)b=b&&"false"!==b?f:null;if(k=Ra[f])if(f===T){t.linkCtx=d;t.ctx=
d.ctx;if(e&&e._.inline){f=e.nodes(!0);if(e._elCnt){if(l&&l!==m)J(l,m,y,e._tgId,"^",!0);else if(n=y._dfr)q=e._tgId+"^",k=n.indexOf("#"+q)+1,p=n.indexOf("/"+q),k&&0<p&&(k+=q.length,p>k&&(y._dfr=n.slice(0,k)+n.slice(p),z(n.slice(k,p))));l=l?l.previousSibling:m?m.previousSibling:y.lastChild}a(f).remove();if(e&&e.onBeforeLink)e.onBeforeLink();n=t.link(t.data,y,l,m,b,e&&{tag:e._tgId,lazyLink:e.tagCtx.props.lazyLink})}else{r&&u.empty();if(e&&e.onBeforeLink)e.onBeforeLink();r&&(n=t.link(s,y,l,m,b,e&&{tag:e._tgId}))}t.linkCtx=
x;t.ctx=v}else{if(w=w||q!==b)if("text"===f&&y.children&&!y.children[0])y.textContent!==c?y.textContent=b:y.innerText=null===b?"":b;else u[k](b)}else if(w=w||q!==b)u[p?"prop":"attr"](f,b!==c||p?b:null);d._val=b}return n||w}if(f===T&&e&&e.onBeforeLink)e.onBeforeLink()}function e(a,c){var b=this.hlp(I),d=this.hlp(C);if(!b||!1!==b.call(this,a,c)){if(c){var b=c.index,e=c.items;switch(c.change){case "insert":this.addViews(b,e);break;case "remove":this.removeViews(b,e.length);break;case "move":this.refresh();
break;case "refresh":this.refresh()}}d&&d.call(this,a,c)}}function f(b){var d,f=b.data,g=b._.bnd;if(!b._.useKey&&g){if(d=b._.bndArr)a([d[1]]).off(R,d[0]),b._.bndArr=c;g!==!!g&&g._.inline?f?g._.arrVws[b._.id]=b:delete g._.arrVws[b._.id]:f&&(d=function(a){a.data&&a.data.off||e.apply(b,arguments)},a([f]).on(R,d),b._.bndArr=[d,f])}}function k(a,c,b){var d=a.nodeName.toLowerCase(),e=S.merge[d]||a.contentEditable===wa&&{to:T,from:T};return e?c?"input"===d&&a.type===Aa?Aa:e.to:e.from:c?b?"text":T:""}function l(b,
d,e,f,g,h,k){var m,n,p,q=b.parentElem,r=b._prv,s=b._nxt,u=b._elCnt;r&&r.parentNode!==q&&ja("Missing parentNode");if(k)for(p in n=b.nodes(),u&&r&&r!==s&&J(r,s,q,b._.id,"_",!0),b.removeViews(c,c,!0),f=s,u&&(r=r?r.previousSibling:s?s.previousSibling:q.lastChild),a(n).remove(),b._.bnds)U(p);else{if(d){m=f[d-1];if(!m)return!1;r=m._nxt}u?r=(f=r)?f.previousSibling:q.lastChild:f=r.nextSibling}d=e.render(g,h,b._.useKey&&k,b,k||d,!0);b.link(g,q,r,f,d,m)}function p(a,b,d){var e;d?(e="^`",b=b._.tag||{_:{inline:!0,
bnd:d},tagCtx:{view:b},flow:!0},d=b._tgId,d||(Ba[d=cb++]=b,b._tgId=""+d)):(e="_`",ka[d=b._.id]=b);return"#"+d+e+(a!=c?a:"")+"/"+d+e}function ba(a,b,d){var e,f=a.tag,g=a.convertBack,h=[],k=a._bndId||""+cb++,l=a._hdlr;delete a._bndId;f&&(h=f.depends||h,h=ga(h)?f.depends(f):h,e=f.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&Z._apply(!1,[b],a._depends,l,!0),b=Z._apply(!1,[b],a.fn.paths,h,l,a._ctxCb),b.elem=d,b.linkCtx=a,b._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=
h,a.view._.bnds[k]=k,Ba[k]=b,e&&(b.to=[[],g]),(e||g!==c)&&za(b,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(b);f.flow||f._.inline||(d.setAttribute(fa,(d.getAttribute(fa)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=f}function ca(a,b,c,d,e,f,g){return da(this,a,b,c,d,e,f,g)}function da(b,e,f,g,h,k,l,m){if(b&&e){e=e.jquery?e:a(e);A||(A=ia.body,a(A).on(x,d).on("blur",
"[contenteditable]",d));for(var n,r,q,v,y,w,t,z=p,E=g&&"replace"===g.target,C=e.length;C--;)if(t=e[C],""+b===b)y=u(t),n=y.ctx,y.ctx=g,va(b,t,y,f),y.ctx=n;else{k=k||u(t);if(b.markup!==c)!1===k.link&&(g=g||{},g.link=z=!1),E&&(w=t.parentNode),q=b.render(f,g,h,k,c,z),w?(l=t.previousSibling,m=t.nextSibling,a.cleanData([t],!0),w.removeChild(t),t=w):(l=m=c,a(t).empty());else if(!0!==b)break;if(t._dfr&&!m){v=s(t._dfr,1,db);n=0;for(r=v.length;n<r;n++)y=v[n],(y=ka[y.id])&&y.data!==c&&y.parent.removeViews(y._.key,
c,!0);t._dfr=""}k.link(f,t,l,m,q,c,g)}}return e}function ua(b,d,g,h,k,l,m,n){function r(a,b,d,e,f,g,h,B,l,m,ra,n,Ga){var W,p="";if(Ga)return y=0,a;t=B||l||"";e=e||m;d=d||n;la&&!d&&(e||t||g)&&(la=c,xa=na.shift());if(e=e||d)y=0,la=c,ga&&(d||n?Wa[xa]||/;svg;|;math;/.test(";"+na.join(";")+";")||(W="'<"+xa+".../"):Wa[e]?W="'</"+e:na.length&&e===xa||(W="Mismatch: '</"+e),W&&Ta(W+">' in:\n"+k)),oa=ya,xa=na.shift(),ya=Va[xa],m=m?"</"+m+">":"",oa&&(ta+=Da,Da="",ya?ta+="-":(p=m+Za+"@"+ta+Ya+(ra||""),ta=Fa.shift()));
ya?(g?Da+=g:b=m||n||"",t&&(b+=t,Da&&(b+=" "+fa+'="'+Da+'"',Da=""))):b=g?b+p+f+Za+g+Ya+h+t:p||a;y&&g&&Ta(" No {^{ tags within elem markup ("+y+' ). Use data-link="..."');t&&(y=t,na.unshift(xa),xa=t.slice(1),na[0]&&na[0]===jb[xa]&&ja("Parent of <tr> must be <tbody>"),la=Wa[xa],(ya=Va[xa])&&!oa&&(Fa.unshift(ta),ta=""),oa=ya,ta&&ya&&(ta+="+"));return b}function w(a,b){var g,h,k,B,l=[];if(a){"@"===a._tkns.charAt(0)&&(b=K.previousSibling,K.parentNode.removeChild(K),K=c);for(H=a.length;H--;){G=a[H];k=G.ch;
if(g=G.path)for(D=g.length-1;h=g.charAt(D--);)"+"===h?"-"===g.charAt(D)?(D--,b=b.previousSibling):b=b.parentNode:b=b.lastChild;if("^"===k){if(t=Ba[g=G.id]){h=b&&(!K||K.parentNode!==b);if(!K||h)t.parentElem=b;G.elCnt&&h&&(b._dfr=(G.open?"#":"/")+g+k+(b._dfr||""));l.push([h?null:K,G])}}else if(A=ka[g=G.id])(A.parentElem||(A.parentElem=b||K&&K.parentNode||d,A._.onRender=p,A._.onArrayChange=e,f(A)),h=A.parentElem,G.open)?(A._elCnt=G.elCnt,b?b._dfr="#"+g+k+(b._dfr||""):(A._prv||(h._dfr=q(h._dfr,"#"+g+
k)),A._prv=K)):(!b||K&&K.parentNode===b?K&&(A._nxt||(h._dfr=q(h._dfr,"/"+g+k)),A._nxt=K):(b._dfr="/"+g+k+(b._dfr||""),A._nxt=c),E=A.linkCtx,(B=A.ctx&&A.ctx.onAfterCreate||Ja)&&B.call(E,A))}for(H=l.length;H--;)sa.push(l[H])}return!a||a.elCnt}function x(a){var b,c;if(a)for(H=a.length,D=0;D<H;D++)if(G=a[D],O.id)O.id=O.id!==G.id&&O.id;else if(c=t=Ba[G.id].linkCtx.tag,!t.flow){if(!ca){for(b=1;c=c.parent;)b++;ba=ba||b}!ca&&b!==ba||da&&t.tagName!==da||Z.push(t)}}function z(){J=Ua?d.querySelectorAll(P):a(P,
d).get();F=J.length;g&&g.innerHTML&&(N=Ua?g.querySelectorAll(P):a(P,g).get(),g=N.length?N[N.length-1]:g);for(C=ba=0;C<F;C++)if(K=J[C],g&&!za)za=K===g;else if(h&&K===h)break;else K.parentNode&&Ia(s(K,c,Z&&ob))&&!O&&K.getAttribute(M)&&sa.push([K]);ua===Ha&&k===c&&d.getAttribute(M)&&sa.push([d]);Ea(g,ya);Ea(h,ya);if(!O){if(ya&&ta+Da&&(K=h,ta&&(h?w(s(ta+"+",1),h):w(s(ta,1),d)),w(s(Da,1),d),h)){T=h.getAttribute(fa);if(F=T.indexOf(qa)+1)T=T.slice(F+qa.length-1);h.setAttribute(fa,Da+T)}F=sa.length;for(C=
0;C<F;C++)if(K=sa[C],L=K[1],K=K[0],L){if(t=Ba[L.id]){if(E=t.linkCtx)t=E.tag,t.linkCtx=E;L.open?(K&&(t.parentElem=K.parentNode,t._prv=K),t._elCnt=L.elCnt,!t||t.onBeforeLink&&!1===t.onBeforeLink()||t._.bound||(t._.bound=!0,A=t.tagCtx.view,va(c,t._prv,A,b,L.id)),t._.linking=!0):(t._nxt=K,t._.linking&&(ea=t.tagCtx,A=ea.view,delete t._.linking,t._.bound||(t._.bound=!0,va(c,t._prv,A,b,L.id)),Y(t,ea)))}}else A=u(K),va(K.getAttribute(M),K,A,b,c,m)}pa&&pa.resolve()}var y,E,t,C,F,D,H,J,K,A,G,L,N,I,Q,U,R,Z,
ca,da,ea,ga,ba,O,ha,aa,xa,la,ma,T,ya,oa,Da,qa,za,pa,ua=this,Aa=ua._.id+"_",ta="",sa=[],na=[],Fa=[],Ja=ua.hlp(Ca),Ia=w;l&&(pa=l.lazyLink&&a.Deferred(),l.tmpl?Q="/"+l._.id+"_":(O=l.get,l.tag&&(Aa=l.tag+"^",l=!0)),l=!0===l);O&&(Ia=x,Z=O.tags,ca=O.deep,da=O.name);d=d?""+d===d?a(d)[0]:d.jquery?d[0]:d:ua.parentElem||ia.body;ga=!S.noValidate&&d.contentEditable!==wa;xa=d.tagName.toLowerCase();ya=!!Va[xa];g=g&&V(g,ya);h=h&&V(h,ya)||null;if(k!=c){ma=ha=ia.createElement("div");qa=Da="";aa="http://www.w3.org/2000/svg"===
d.namespaceURI?"svg_ns":(I=hb.exec(k))&&I[1]||"";v&&I&&I[2]&&ja("Unsupported: "+I[2]);if(ya){for(R=h;R&&!(U=s(R));)R=R.nextSibling;if(T=U?U._tkns:d._dfr){I=Q||"";if(l||!Q)I+="#"+Aa;D=T.indexOf(I);D+1&&(D+=I.length,qa=Da=T.slice(0,D),T=T.slice(D),U?R.setAttribute(fa,T):d._dfr=T)}}la=c;k=(""+k).replace(lb,r);ga&&na.length&&Ta("Mismatched '<"+xa+"...>' in:\n"+k);if(n)return;ab.appendChild(ha);aa=X[aa]||X.div;l=aa[0];for(ma.innerHTML=aa[1]+k+aa[2];l--;)ma=ma.lastChild;ab.removeChild(ha);for(ha=ia.createDocumentFragment();aa=
ma.firstChild;)ha.appendChild(aa);d.insertBefore(ha,h)}pa?setTimeout(z,0):z();return pa&&pa.promise()}function va(b,d,e,f,g,h){var l,m,n,p,q,s,y,u;f=e.data===c?f||{}:e.data;if(g)h=Ba[g],h=h.linkCtx?h.linkCtx.tag:h,y=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:d,view:e,ctx:e.ctx,attr:T,fn:h._.bnd,tag:h,_bndId:g},F(y,y.fn);else if(b&&d)for(l=e.tmpl,n=k(d),b=a.trim(b).replace(ib,"\\$&"),b=b.slice(-1)!==na?E+":"+b+(n?":":"")+na:b,r.lastIndex=0;m=r.exec(b);)u=r.lastIndex,n=g?T:m[1],s=m[3],q=m[10],p=
c,y={data:f,elem:d,view:e,ctx:h||e.ctx,attr:n,_initVal:!m[2]},m[6]&&(!n&&(p=/:([\w$]*)$/.exec(q))&&(p=p[1],p!==c&&(q=-p.length-1,s=s.slice(0,q-1)+na)),null===p&&(p=c),y.convert=m[5]||""),y.expr=n+s,(m=l.links[s])||(l.links[s]=m=G.tmplFn(s,l,!0,p)),y.fn=m,n||p===c||(y.convertBack=p),F(y,m),r.lastIndex=u}function F(a,c){function d(e,f){b.call(a,e,f,c)}d.noArray=!0;a._ctxCb=Fa(a.view);a._hdlr=d;d(!0)}function q(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function n(a){return a&&
(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(fa)||"")}function s(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:n(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||!a.type,f._tkns=b,b.replace(c||pb,d),f}function Ea(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(M)&&a.removeAttribute(M))}function V(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=
ia.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):n(c)||c.getAttribute(M)||c.setAttribute(M,""));return c}function Y(b,d){var e,f,g,h,k,l,m;e=d.view;var n=b.linkCtx=b.linkCtx||{tag:b,data:e.data,view:e,ctx:e.ctx};if(b.onAfterLink)b.onAfterLink(d,n);if(f=(e=b.targetTag?b.targetTag.linkedElem:b.linkedElem)&&e[0]){if(g=b._.radio)e=e.children("input[type=radio]");if(g||!b._.chging){h=G.cvt(b,b.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(b._.inline&&
(!k||k!==b&&k.targetTag!==b))for(f._jsvLnkdEl=b,k=n.elem?n.elem._jsvBnd:b._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)za(Ba[k[l]],b.convertBack);g&&(f[ma]=h===f.value)}n._val=h}h!==c&&(g||f.value===c?f.contentEditable===wa&&(f.innerHTML=h):f.type===La?f[ma]=h&&"false"!==h:e.val(h))}}if(f=f||":"===b.tagName&&n.elem)g=f._jsvTr,h=d.props.trigger,g!==h&&(f._jsvTr=h,e=e||a(f),oa(e,g,"off"),oa(e,h,"on"))}function Ia(a){setTimeout(function(){d(a)},0)}function oa(a,b,c){b&&a[c](!0===
b?"keydown":b,!0===b?Ia:d)}function za(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function qa(b,c){var d,e;d=b.tagCtx.view;var f=b.tagCtxs||[b.tagCtx],g=f.length,h=!c;for(c=c||b._.bnd.call(d.tmpl,(b.linkCtx||d).data,d,
w);g--;)d=f[g],e=c[g],a.observable(d.props).setProperty(e.props),O(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function sa(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd="",a=c.length;a--;)U(c[a],b._jsvLnkdEl,b);z(n(b)+(b._dfr||""))}}function U(b,d,e){var f,g,h,k=Ba[b];if(d)e===d.linkedElem[0]&&(delete e._jsvLnkdEl,delete d.linkedElem);else if(k){delete Ba[b];for(f in k.bnd)d=k.bnd[f],e=".obs"+
k.cbId,a.isArray(d)?a([d]).off(R+e).off(N+e):a(d).off(N+e),delete k.bnd[f];if(f=k.linkCtx){if(d=f.tag){if(e=d.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=d.linkedElem)&&h[0]||f.elem)&&e._jsvTr)oa(h||a(e),g,"off"),e._jsvTr=c;if(d.onDispose)d.onDispose();d._elCnt||(d._prv&&d._prv.parentNode.removeChild(d._prv),d._nxt&&d._nxt.parentNode.removeChild(d._nxt))}delete f.view._.bnds[b]}delete G._cbBnds[k.cbId]}}function la(b,e){b===c?(A&&(a(A).off(x,d).off("blur","[contenteditable]",d),
A=c),b=!0,Ha.removeViews(),sa(ia.body.getElementsByTagName("*"))):e&&!0===b&&(e=e.jquery?e:a(e),e.each(function(){for(var a;(a=u(this,!0))&&a.parent;)a.parent.removeViews(a._.key,c,!0);sa(this.getElementsByTagName("*"));sa([this])}));return e}function aa(a,b){return la(this,a,b)}function Fa(b){b=b||a.view();return function(a,c){var d,e,f=[c];if(b&&a){if(a._jsvOb)return a._jsvOb.call(b.tmpl,c,b,w);if("~"===a.charAt(0)){if("~tag"===a.slice(0,4)&&(e=b.ctx,"."===a.charAt(4)&&(d=a.slice(5).split("."),
e=e.tag),d))return e?[e,d.join("."),c]:[];a=a.slice(1).split(".");if(c=b.hlp(a.shift()))a.length&&f.unshift(a.join(".")),f.unshift(c);return c?f:[]}if("#"===a.charAt(0))return"#data"===a?[]:[b,a.replace(kb,""),c]}}}function Ja(a){return a.type===La?a[ma]:a.value}function J(a,b,c,d,e,f){var g,h,k,l,m,n,p=0,r=a===b;if(a){k=s(a)||[];g=0;for(h=k.length;g<h;g++){l=k[g];n=l.id;if(n===d&&l.ch===e)if(f)h=0;else break;r||(m="_"===l.ch?ka[n]:Ba[n].linkCtx.tag,l.open?m._prv=b:l.close&&(m._nxt=b));p+=n.length+
2}p&&a.setAttribute(fa,a.getAttribute(fa).slice(p));a=b?b.getAttribute(fa):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,p)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(fa,a):c._dfr=a)}else c._dfr=q(c._dfr,"#"+d+e),f||b||(c._dfr=q(c._dfr,"/"+d+e))}function z(a){var b,d,e;if(e=s(a,1,mb))for(a=0,b=e.length;a<b;a++)d=e[a],"_"===d.ch?(d=ka[d.id])&&d.data!==c&&d.parent.removeViews(d._.key,c,!0):U(d.id)}function Q(b,c,d){switch(d.change){case "set":b=b.tgt;for(c=b.length;c--&&b[c].key!==d.path;);
-1===c?d.path&&a.observable(b).insert({key:d.path,prop:d.value}):d.remove?a.observable(b).remove(c):a.observable(b[c]).setProperty("prop",d.value)}}function H(b,c,d){b=b.src;switch(d.change){case "set":"prop"===d.path?a.observable(b).setProperty(c.target.key,d.value):(a.observable(b).setProperty(d.oldValue,null),delete b[d.oldValue],a.observable(b).setProperty(d.value,c.target.prop));break;case "remove":c=d.items[0];a.observable(b).removeProperty(c.key);delete b[c.key];break;case "insert":c=d.items[0],
c.key&&a.observable(b).setProperty(c.key,c.prop)}}function L(a,b,c){return 0>c.indexOf(".")&&b[a]}var A,u,r,E,na,ea,v,ja,M,D,P,X,Ha,ka,ia=g.document,w=a.views,G=w.sub,S=w.settings,O=G.extend,ga=a.isFunction,Na=w.converters,pa=w.tags,Z=a.observable,Ma=Z.observe,fa="data-jsv",N=G.propChng=G.propChng||"propertyChange",R=G.arrChng=G.arrChng||"arrayChange",x="change.jsv",I="onBeforeChange",C="onAfterChange",Ca="onAfterCreate",ma="checked",La="checkbox",Aa="radio",ha="none",wa="true",Ya='">\x3c/script>',
Za='<script type="jsv',Qa="script,["+fa+"]",T="html",Ra={value:"val",input:"val",html:T,text:"text"},$a={from:"value",to:"value"},Sa=0,fb=a.cleanData,gb=S.delimiters,Ta=G.syntaxErr,hb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,ib=/['"\\]/g,ab=ia.createDocumentFragment(),Ua=ia.querySelector,Va={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},jb={tr:"table"},Wa={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,
param:1,source:1,track:1,wbr:1},bb={},Ba={},cb=1,kb=/^#(view\.?)?/,lb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,db=/(#)()(\d+)(_)/g,mb=/(#)()(\d+)([_^])/g,nb=/(?:(#)|(\/))(\d+)(_)/g,ob=/(#)()(\d+)(\^)/g,pb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,eb=g.getComputedStyle;if(!a)throw"JsViews requires jQuery";if(!a.views)throw"JsViews requires JsRender";if(!a.observable)throw"JsViews requires jquery.observable";a.link||(D={contents:function(b,
d){b!==!!b&&(d=b,b=c);var e,f=a(this.nodes());f[0]&&(e=d?f.filter(d):f,f=b&&d?e.add(f.find(d)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,b){a!==!!a&&(b=a,a=c);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=
[];e&&d.link(c,this.parentElem,f?e.previousSibling:e,this._nxt,c,{get:{tags:g,deep:a,name:b,id:f&&this._tgId}});return g},refresh:function(a){var b,d=this.linkCtx,e=this.tagCtx.view;this.disposed&&ja("Removed tag");a===c&&(a=w._tag(this,e,e.tmpl,qa(this),!0));a+""===a&&(b=this._.inline?T:d.attr||k(this.parentElem,!0),b=h(a,d,b,this));Y(this,this.tagCtx);return b||this},update:function(a){var b=this.linkedElem;b&&d({target:b[0]},c,a)}},G.onStore.template=function(b,c){c.link=ca;c.unlink=aa;b&&(a.link[b]=
function(){return ca.apply(c,arguments)},a.unlink[b]=function(){return aa.apply(c,arguments)})},G.onStore.tag=function(a,b){G._lnk(b)},G._lnk=function(a){return O(a,D)},G.viewInfos=s,(S.delimiters=function(){var a=gb.apply(w,arguments);E=a[1];na=a[2];ea=a[4];r=RegExp("(?:^|\\s*)([\\w-]*)(\\"+ea+")?(\\"+E+G.rTag+"\\"+na+")","g");return this})(),O(G._lnk(G.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==l(this,a,c,f,b,this.ctx)))for(a+=
e;a<d;a++)Z(f[a]).setProperty("index",a);return this},removeViews:function(b,d,e){function g(b){var d,h,k,l,n,p=m[b];if(p&&p.link){b=p._.id;e||(n=p.nodes());p.removeViews(c,c,!0);p.data=c;k=p._prv;l=p._nxt;h=p.parentElem;e||(p._elCnt&&J(k,l,h,b,"_"),a(n).remove());if(!p._elCnt)try{k.parentNode.removeChild(k),l.parentNode.removeChild(l)}catch(q){}f(p);for(d in p._.bnds)U(d);delete ka[b]}}var h,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(b===c)if(l){for(h=k;h--;)g(h);this.views=[]}else{for(h in m)g(h);
this.views={}}else if(d===c&&(l?d=1:(g(b),delete m[b])),l&&d){for(h=b+d;h-- >b;)g(h);m.splice(b,d);if(k=m.length)for(;b<k;)Z(m[b]).setProperty("index",b++)}return this},refresh:function(a){var b=this.parent;b&&(l(this,this.index,this.tmpl,b.views,this.data,a,!0),f(this));return this},link:ua}),ka={0:Ha=new G.View(c,"top")},Na.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),
"$2"),a=c+(a?(c&&" ")+d:""));return a},pa("on",{attr:ha,onAfterLink:function(b,d){for(var e,f,g=0,h=b.args,k=b.props.data,l=b.view,m=b.props.context;!ga(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(b.params.args.slice(-f.length-1)[0]))&&G.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(d.data,l));if(e){if(this._evs)this.onDispose();a(d.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==c?null:k,this._hlr=function(a){return e.apply(m||d.data,[].concat(f,a,{change:a.type,view:l,linkCtx:d}))})}},
onDispose:function(){a(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),O(pa["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var b,c,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,
l=f.selected||0;for(b=0;b<=l;b++)c=h[b],e=c.map?c.map.tgt:c.args.length?c.args[0]:c.view.data,(d=g[b])&&e!==d[0]&&(Ma(d[0],d[1],!0),delete g[b]),!g[b]&&a.isArray(e)&&(Ma(e,c=function(a,b){f.onArrayChange(a,b)}),g[b]=[e,c]);for(b=l+1;b<k;b++)if(d=g[b])Ma(d[0],d[1],!0),delete g[b];f._ars=g},onDispose:function(){for(var a in this._ars)Ma(this._ars[a][0],this._ars[a][1],!0)}}),O(pa["for"],D),O(pa["if"],D),O(pa.include,D),pa("props",{baseTag:pa["for"],dataMap:w.map({getTgt:pa.props.dataMap.getTgt,obsSrc:Q,
obsTgt:H,tgtFlt:L})}),O(a,{view:w.view=u=function(b,d,e){d!==!!d&&(e=d,d=c);var f,g,h,k,l,m;m=0;l=ia.body;if(b&&b!==l&&1<Ha._.useKey&&(b=""+b===b?a(b)[0]:b.jquery?b[0]:b))if(d)for(m=Ua?b.querySelectorAll(Qa):a(Qa,b).get(),l=m.length,b=0;b<l;b++)for(f=m[b],g=s(f,c,db),h=0,k=g.length;h<k;h++){if(f=g[h],f=ka[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;b;){if(g=s(b,c,nb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=ka[f.id])&&e?f.get(e):f||Ha;m--}else m++;b=b.previousSibling||b.parentNode}return d?
c:Ha},link:w.link=da,unlink:w.unlink=la,cleanData:function(b){b.length&&Sa&&sa(b);fb.apply(a,arguments)}}),w.utility={validate:function(a){try{Ha.link(c,ia.createElement("div"),c,c,a,c,c,1)}catch(b){return b.message}}},O(a.fn,{link:function(a,b,c,d,e,f,g){return da(a,this,b,c,d,e,f,g)},unlink:function(a){return la(a,this)},view:function(a){return u(this[0],a)}}),a.each([T,"replaceWith","empty","remove"],function(b,c){var d=a.fn[c];a.fn[c]=function(){var a;Sa=1;try{a=d.apply(this,arguments)}finally{Sa=
0}return a}}),O(Ha,{tmpl:{links:{},tags:{}}}),Ha._.onRender=p,S({wrapMap:X={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>",
"</div>"]},linkAttr:M="data-link",merge:{input:{from:Ja,to:"value"},textarea:$a,select:$a,optgroup:{to:"label"}},jsrDbgMode:S.debugMode,debugMode:function(a){S.jsrDbgMode(a);a?g._jsv={views:ka,bindings:Ba}:delete g._jsv},jsv:function(){S.debugMode(S._dbgMode);M=S.linkAttr;ja=w._err;P=Qa+",["+M+"]";v=S.noDomLevel0;X.optgroup=X.option;X.tbody=X.tfoot=X.colgroup=X.caption=X.thead;X.th=X.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
