!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.ForerunnerDB=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
var Core=_dereq_("../lib/Core");module.exports=Core;
},{"../lib/Core":3}],2:[function(_dereq_,module,exports){
var Shared,Core,Metrics,KeyValueStore,Path,Index,Crc;Shared=_dereq_("./Shared");var Collection=function(){this.init.apply(this,arguments)};Collection.prototype.init=function(e){this._primaryKey="_id",this._primaryIndex=new KeyValueStore("primary"),this._primaryCrc=new KeyValueStore("primaryCrc"),this._crcLookup=new KeyValueStore("crcLookup"),this._name=e,this._data=[],this._groups=[],this._metrics=new Metrics,this._deferQueue={insert:[],update:[],remove:[],upsert:[]},this._deferThreshold={insert:100,update:100,remove:100,upsert:100},this._deferTime={insert:1,update:1,remove:1,upsert:1},this._subsetOf(this)},Shared.addModule("Collection",Collection),Shared.mixin(Collection.prototype,"Mixin.Common"),Shared.mixin(Collection.prototype,"Mixin.Events"),Shared.mixin(Collection.prototype,"Mixin.ChainReactor"),Shared.mixin(Collection.prototype,"Mixin.CRUD"),Metrics=_dereq_("./Metrics"),KeyValueStore=_dereq_("./KeyValueStore"),Path=_dereq_("./Path"),Index=_dereq_("./Index"),Crc=_dereq_("./Crc"),Core=Shared.modules.Core,Collection.prototype.crc=Crc,Shared.synthesize(Collection.prototype,"name"),Collection.prototype.data=function(){return this._data},Collection.prototype.drop=function(){if(this._db&&this._db._collection&&this._name){this.debug()&&console.log("Dropping collection "+this._name),this.emit("drop"),delete this._db._collection[this._name];var e,t=[];for(e=0;e<this._groups.length;e++)t.push(this._groups[e]);for(e=0;e<t.length;e++)this._groups[e].removeCollection(this);return!0}return!1},Collection.prototype.primaryKey=function(e){return void 0!==e?(this._primaryKey!==e&&(this._primaryKey=e,this._primaryIndex.primaryKey(e),this.rebuildPrimaryKeyIndex()),this):this._primaryKey},Collection.prototype._onInsert=function(e,t){this.emit("insert",e,t)},Collection.prototype._onUpdate=function(e){this.emit("update",e)},Collection.prototype._onRemove=function(e){this.emit("remove",e)},Shared.synthesize(Collection.prototype,"db"),Collection.prototype.setData=function(e,t,i){if(e){var n=this._metrics.create("setData");n.start(),t=this.options(t),this.preSetData(e,t,i),t.$decouple&&(e=this.decouple(e)),e instanceof Array||(e=[e]),n.time("transformIn"),e=this.transformIn(e),n.time("transformIn");var r=[].concat(this._data);this._dataReplace(e),n.time("Rebuild Primary Key Index"),this.rebuildPrimaryKeyIndex(t),n.time("Rebuild Primary Key Index"),n.time("Resolve chains"),this.chainSend("setData",e,{oldData:r}),n.time("Resolve chains"),n.stop(),this.emit("setData",this._data,r)}return i&&i(!1),this},Collection.prototype.rebuildPrimaryKeyIndex=function(e){var t,i,n,r,o=e&&void 0!==e.$ensureKeys?e.$ensureKeys:!0,a=e&&void 0!==e.$violationCheck?e.$violationCheck:!0,s=this._primaryIndex,h=this._primaryCrc,l=this._crcLookup,u=this._primaryKey;for(s.truncate(),h.truncate(),l.truncate(),t=this._data,i=t.length;i--;){if(n=t[i],o&&this.ensurePrimaryKey(n),a){if(!s.uniqueSet(n[u],n))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+n[this._primaryKey]}else s.set(n[u],n);r=JSON.stringify(n),h.set(n[u],r),l.set(r,n)}},Collection.prototype.ensurePrimaryKey=function(e){void 0===e[this._primaryKey]&&(e[this._primaryKey]=this.objectId())},Collection.prototype.truncate=function(){return this.emit("truncate",this._data),this._data.length=0,this.deferEmit("change",{type:"truncate"}),this},Collection.prototype.upsert=function(e,t){if(e){var i,n,r=this._deferQueue.upsert,o=this._deferThreshold.upsert,a={};if(e instanceof Array){if(e.length>o)return this._deferQueue.upsert=r.concat(e),this.processQueue("upsert",t),{};for(a=[],n=0;n<e.length;n++)a.push(this.upsert(e[n]));return t&&t(),a}switch(e[this._primaryKey]?(i={},i[this._primaryKey]=e[this._primaryKey],a.op=this._primaryIndex.lookup(i)[0]?"update":"insert"):a.op="insert",a.op){case"insert":a.result=this.insert(e);break;case"update":a.result=this.update(i,e)}return a}return t&&t(),{}},Collection.prototype.update=function(e,t,i){t=this.decouple(t),t=this.transformIn(t),this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var n,r,o=this,a=this._metrics.create("update"),s=this._primaryKey,h=function(n){if(t&&void 0!==t[s]&&t[s]!=n[s]){o._removeIndex(n);var r=o.updateObject(n,t,e,i,"");if(o._insertIndex(n))return r;throw"Primary key violation in update! Key violated: "+n[s]}return o.updateObject(n,t,e,i,"")};return a.start(),a.time("Retrieve documents to update"),n=this.find(e,{$decouple:!1}),a.time("Retrieve documents to update"),n.length&&(a.time("Update documents"),r=n.filter(h),a.time("Update documents"),r.length&&(a.time("Resolve chains"),this.chainSend("update",{query:e,update:t,dataSet:n},i),a.time("Resolve chains"),this._onUpdate(r),this.deferEmit("change",{type:"update",data:r}))),a.stop(),r||[]},Collection.prototype.updateById=function(e,t){var i={};return i[this._primaryKey]=e,this.update(i,t)},Collection.prototype.updateObject=function(e,t,i,n,r,o){t=this.decouple(t),r=r||"","."===r.substr(0,1)&&(r=r.substr(1,r.length-1));var a,s,h,l,u,c,p,d,f,y=!1,m=!1;for(d in t)if(t.hasOwnProperty(d)){if(a=!1,"$"===d.substr(0,1))switch(d){case"$index":a=!0;break;default:a=!0,m=this.updateObject(e,t[d],i,n,r,d),y=y||m}if(this._isPositionalKey(d)&&(a=!0,d=d.substr(0,d.length-2),u=new Path(r+"."+d),e[d]&&e[d]instanceof Array&&e[d].length)){for(s=[],h=0;h<e[d].length;h++)this._match(e[d][h],u.value(i)[0])&&s.push(h);for(h=0;h<s.length;h++)m=this.updateObject(e[d][s[h]],t[d+".$"],i,n,r+"."+d,o),y=y||m}if(!a)if(o||"object"!=typeof t[d])switch(o){case"$inc":this._updateIncrement(e,d,t[d]),y=!0;break;case"$push":if(void 0===e[d]&&(e[d]=[]),!(e[d]instanceof Array))throw"Cannot push to a key that is not an array! ("+d+")";if(void 0!==t[d].$position&&t[d].$each instanceof Array)for($=t[d].$position,l=t[d].$each.length,h=0;l>h;h++)this._updateSplicePush(e[d],$+h,t[d].$each[h]);else if(t[d].$each instanceof Array)for(l=t[d].$each.length,h=0;l>h;h++)this._updatePush(e[d],t[d].$each[h]);else this._updatePush(e[d],t[d]);y=!0;break;case"$pull":if(e[d]instanceof Array){for(s=[],h=0;h<e[d].length;h++)this._match(e[d][h],t[d])&&s.push(h);for(l=s.length;l--;)this._updatePull(e[d],s[l]),y=!0}break;case"$pullAll":if(e[d]instanceof Array){if(!(t[d]instanceof Array))throw"Cannot pullAll without being given an array of values to pull! ("+d+")";if(s=e[d],l=s.length,l>0)for(;l--;){for($=0;$<t[d].length;$++)s[l]===t[d][$]&&(this._updatePull(e[d],l),l--,y=!0);if(0>l)break}}break;case"$addToSet":if(void 0===e[d]&&(e[d]=[]),!(e[d]instanceof Array))throw"Cannot addToSet on a key that is not an array! ("+f+")!";var _,g,v,C,b=e[d],x=b.length,k=!0,I=n&&n.$addToSet;for(I&&I.key?(v=!1,C=new Path(I.key),g=C.value(t[d])[0]):(g=JSON.stringify(t[d]),v=!0),_=0;x>_;_++)if(v){if(JSON.stringify(b[_])===g){k=!1;break}}else if(g===C.value(b[_])[0]){k=!1;break}k&&(this._updatePush(e[d],t[d]),y=!0);break;case"$splicePush":if(void 0===e[d]&&(e[d]=[]),!(e[d]instanceof Array))throw"Cannot splicePush with a key that is not an array! ("+d+")";var $=t.$index;if(void 0===$)throw"Cannot splicePush without a $index integer value!";delete t.$index,$>e[d].length&&($=e[d].length),this._updateSplicePush(e[d],$,t[d]),y=!0;break;case"$move":if(!(e[d]instanceof Array))throw"Cannot move on a key that is not an array! ("+d+")";for(h=0;h<e[d].length;h++)if(this._match(e[d][h],t[d])){var K=t.$index;if(void 0===K)throw"Cannot move without a $index integer value!";delete t.$index,this._updateSpliceMove(e[d],h,K),y=!0;break}break;case"$mul":this._updateMultiply(e,d,t[d]),y=!0;break;case"$rename":this._updateRename(e,d,t[d]),y=!0;break;case"$unset":this._updateUnset(e,d),y=!0;break;case"$pop":if(!(e[d]instanceof Array))throw"Cannot pop from a key that is not an array! ("+d+")";this._updatePop(e[d],t[d])&&(y=!0);break;default:e[d]!==t[d]&&(this._updateProperty(e,d,t[d]),y=!0)}else if(null!==e[d]&&"object"==typeof e[d])if(c=e[d]instanceof Array,p=t[d]instanceof Array,c||p)if(!p&&c)for(h=0;h<e[d].length;h++)m=this.updateObject(e[d][h],t[d],i,n,r+"."+d,o),y=y||m;else e[d]!==t[d]&&(this._updateProperty(e,d,t[d]),y=!0);else m=this.updateObject(e[d],t[d],i,n,r+"."+d,o),y=y||m;else e[d]!==t[d]&&(this._updateProperty(e,d,t[d]),y=!0)}return y},Collection.prototype._isPositionalKey=function(e){return".$"===e.substr(e.length-2,2)},Collection.prototype._updateProperty=function(e,t,i){e[t]=i,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+t+'" for collection "'+this.name()+'"')},Collection.prototype._updateIncrement=function(e,t,i){e[t]+=i},Collection.prototype._updateSpliceMove=function(e,t,i){e.splice(i,0,e.splice(t,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+t+'" to "'+i+'" for collection "'+this.name()+'"')},Collection.prototype._updateSplicePush=function(e,t,i){e.length>t?e.splice(t,0,i):e.push(i)},Collection.prototype._updatePush=function(e,t){e.push(t)},Collection.prototype._updatePull=function(e,t){e.splice(t,1)},Collection.prototype._updateMultiply=function(e,t,i){e[t]*=i},Collection.prototype._updateRename=function(e,t,i){e[i]=e[t],delete e[t]},Collection.prototype._updateUnset=function(e,t){delete e[t]},Collection.prototype._updatePop=function(e,t){var i=!1;return e.length>0&&(1===t?(e.pop(),i=!0):-1===t&&(e.shift(),i=!0)),i},Collection.prototype.remove=function(e,t){var i,n,r,o,a;if(e instanceof Array){for(a=[],o=0;o<e.length;o++)a.push(this.remove(e[o],{noEmit:!0}));return(!t||t&&!t.noEmit)&&this._onRemove(a),a}if(i=this.find(e,{$decouple:!1}),i.length){for(var s=0;s<i.length;s++)r=i[s],this._removeIndex(r),n=this._data.indexOf(r),this._dataRemoveIndex(n);this.chainSend("remove",{query:e,dataSet:i},t),(!t||t&&!t.noEmit)&&this._onRemove(i),this.deferEmit("change",{type:"remove",data:i})}return i},Collection.prototype.removeById=function(e){var t={};return t[this._primaryKey]=e,this.remove(t)},Collection.prototype.deferEmit=function(){var e,t=this;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(e=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){t.debug()&&console.log("ForerunnerDB.Collection: Emitting "+e[0]),t.emit.apply(t,e)},100))},Collection.prototype.processQueue=function(e,t){var i=this._deferQueue[e],n=this._deferThreshold[e],r=this._deferTime[e];if(i.length){var o,a=this;i.length&&(o=i.length>n?i.splice(0,n):i.splice(0,i.length),this[e](o)),setTimeout(function(){a.processQueue(e,t)},r)}else t&&t()},Collection.prototype.insert=function(e,t,i){return"function"==typeof t?(i=t,t=this._data.length):void 0===t&&(t=this._data.length),e=this.transformIn(e),this._insertHandle(e,t,i)},Collection.prototype._insertHandle=function(e,t,i){var n,r,o=this._deferQueue.insert,a=this._deferThreshold.insert,s=(this._deferTime.insert,[]),h=[];if(e instanceof Array){if(e.length>a)return this._deferQueue.insert=o.concat(e),void this.processQueue("insert",i);for(r=0;r<e.length;r++)n=this._insert(e[r],t+r),n===!0?s.push(e[r]):h.push({doc:e[r],reason:n})}else n=this._insert(e,t),n===!0?s.push(e):h.push({doc:e,reason:n});return this.chainSend("insert",e,{index:t}),this._onInsert(s,h),i&&i(),this.deferEmit("change",{type:"insert",data:s}),{inserted:s,failed:h}},Collection.prototype._insert=function(e,t){if(e){var i;return this.ensurePrimaryKey(e),i=this.insertIndexViolation(e),i?"Index violation in index: "+i:(this._insertIndex(e),t>this._data.length&&(t=this._data.length),this._dataInsertIndex(t,e),!0)}return"No document passed to insert"},Collection.prototype._dataInsertIndex=function(e,t){this._data.splice(e,0,t)},Collection.prototype._dataRemoveIndex=function(e){this._data.splice(e,1)},Collection.prototype._dataReplace=function(e){for(;this._data.length;)this._data.pop();this._data=this._data.concat(e)},Collection.prototype._insertIndex=function(e){var t,i,n=this._indexByName,r=JSON.stringify(e);i=this._primaryIndex.uniqueSet(e[this._primaryKey],e),this._primaryCrc.uniqueSet(e[this._primaryKey],r),this._crcLookup.uniqueSet(r,e);for(t in n)n.hasOwnProperty(t)&&n[t].insert(e);return i},Collection.prototype._removeIndex=function(e){var t,i=this._indexByName,n=JSON.stringify(e);this._primaryIndex.unSet(e[this._primaryKey]),this._primaryCrc.unSet(e[this._primaryKey]),this._crcLookup.unSet(n);for(t in i)i.hasOwnProperty(t)&&i[t].remove(e)},Collection.prototype.subset=function(e,t){var i=this.find(e,t);return(new Collection)._subsetOf(this).primaryKey(this._primaryKey).setData(i)},Collection.prototype.subsetOf=function(){return this.__subsetOf},Collection.prototype._subsetOf=function(e){return this.__subsetOf=e,this},Collection.prototype.distinct=function(e,t,i){var n,r,o=this.find(t,i),a=new Path(e),s={},h=[];for(r=0;r<o.length;r++)n=a.value(o[r])[0],n&&!s[n]&&(s[n]=!0,h.push(n));return h},Collection.prototype.findById=function(e,t){var i={};return i[this._primaryKey]=e,this.find(i,t)[0]},Collection.prototype.peek=function(e,t){var i,n,r=this._data,o=r.length,a=new Collection,s=typeof e;if("string"===s){for(i=0;o>i;i++)n=JSON.stringify(r[i]),n.indexOf(e)>-1&&a.insert(r[i]);return a.find({},t)}return this.find(e,t)},Collection.prototype.explain=function(e,t){var i=this.find(e,t);return i.__fdbOp._data},Collection.prototype.options=function(e){return e=e||{},e.$decouple=void 0!==e.$decouple?e.$decouple:!0,e.$explain=void 0!==e.$explain?e.$explain:!1,e},Collection.prototype.find=function(e,t){e=e||{},t=this.options(t);var i,n,r,o,a,s,h,l,u,c,p,d,f,y,m,_,g,v,C,b=this._metrics.create("find"),x=this,k=!0,I={},$=[],K=function(t){return x._match(t,e,"and")};if(b.start(),e){if(b.time("analyseQuery"),i=this._analyseQuery(e,t,b),b.time("analyseQuery"),b.data("analysis",i),i.hasJoin&&i.queriesJoin){for(b.time("joinReferences"),a=0;a<i.joinsOn.length;a++)l=i.joinsOn[a],h=new Path(i.joinQueries[l]),s=h.value(e)[0],I[i.joinsOn[a]]=this._db.collection(i.joinsOn[a]).subset(s);b.time("joinReferences")}if(i.indexMatch.length&&(!t||t&&!t.$skipIndex)?(b.data("index.potential",i.indexMatch),b.data("index.used",i.indexMatch[0].index),b.time("indexLookup"),r=i.indexMatch[0].lookup,b.time("indexLookup"),i.indexMatch[0].keyData.totalKeyCount===i.indexMatch[0].keyData.matchedKeyCount&&(k=!1)):b.flag("usedIndex",!1),k&&(r&&r.length?(n=r.length,b.time("tableScan: "+n),r=r.filter(K)):(n=this._data.length,b.time("tableScan: "+n),r=this._data.filter(K)),t.$orderBy&&(b.time("sort"),r=this.sort(t.$orderBy,r),b.time("sort")),b.time("tableScan: "+n)),t.limit&&r&&r.length>t.limit&&(r.length=t.limit,b.data("limit",t.limit)),t.$decouple&&(b.time("decouple"),r=this.decouple(r),b.time("decouple"),b.data("flag.decouple",!0)),t.join){for(o=0;o<t.join.length;o++)for(l in t.join[o])if(t.join[o].hasOwnProperty(l))for(_=l,u=this._db.collection(l),c=t.join[o][l],g=0;g<r.length;g++){d={},f=!1,y=!1;for(p in c)if(c.hasOwnProperty(p))if("$"===p.substr(0,1))switch(p){case"$as":_=c[p];break;case"$multi":f=c[p];break;case"$require":y=c[p];break;default:"$$."===p.substr(0,3)}else d[p]=new Path(c[p]).value(r[g])[0];m=u.find(d),!y||y&&m[0]?r[g][_]=f===!1?m[0]:m:$.push(r[g])}b.data("flag.join",!0)}if($.length){for(b.time("removalQueue"),C=0;C<$.length;C++)v=r.indexOf($[C]),v>-1&&r.splice(v,1);b.time("removalQueue")}if(t.transform){for(b.time("transform"),C=0;C<r.length;C++)r.splice(C,1,t.transform(r[C]));b.time("transform"),b.data("flag.transform",!0)}return this._transformEnabled&&this._transformOut&&(b.time("transformOut"),r=this.transformOut(r),b.time("transformOut")),b.data("results",r.length),b.stop(),r.__fdbOp=b,r}return b.stop(),r=[],r.__fdbOp=b,r},Collection.prototype.indexOf=function(e){var t=this.find(e,{$decouple:!1})[0];return t?this._data.indexOf(t):void 0},Collection.prototype.transform=function(e){return void 0!==e?("object"==typeof e?(void 0!==e.enabled&&(this._transformEnabled=e.enabled),void 0!==e.dataIn&&(this._transformIn=e.dataIn),void 0!==e.dataOut&&(this._transformOut=e.dataOut)):this._transformEnabled=e===!1?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}},Collection.prototype.transformIn=function(e){if(this._transformEnabled&&this._transformIn){if(e instanceof Array){var t,i=[];for(t=0;t<e.length;t++)i[t]=this._transformIn(e[t]);return i}return this._transformIn(e)}return e},Collection.prototype.transformOut=function(e){if(this._transformEnabled&&this._transformOut){if(e instanceof Array){var t,i=[];for(t=0;t<e.length;t++)i[t]=this._transformOut(e[t]);return i}return this._transformOut(e)}return e},Collection.prototype.sort=function(e,t){t=t||[];var i,n,r=[];for(i in e)e.hasOwnProperty(i)&&(n={},n[i]=e[i],n.___fdbKey=i,r.push(n));return r.length<2?this._sort(e,t):this._bucketSort(r,t)},Collection.prototype._bucketSort=function(e,t){var i,n,r,o=e.shift(),a=[];if(e.length>0){t=this._sort(o,t),n=this.bucket(o.___fdbKey,t);for(r in n)n.hasOwnProperty(r)&&(i=[].concat(e),a=a.concat(this._bucketSort(i,n[r])));return a}return this._sort(o,t)},Collection.prototype._sort=function(e,t){var i,n=new Path,r=n.parse(e,!0)[0];if(n.path(r.path),1===r.value)i=function(e,t){var i=n.value(e)[0],r=n.value(t)[0];return"string"==typeof i&&"string"==typeof r?i.localeCompare(r):i>r?1:r>i?-1:0};else{if(-1!==r.value)throw this._name+": $orderBy clause has invalid direction: "+r.value+", accepted values are 1 or -1 for ascending or descending!";i=function(e,t){var i=n.value(e)[0],r=n.value(t)[0];return"string"==typeof i&&"string"==typeof r?r.localeCompare(i):i>r?-1:r>i?1:0}}return t.sort(i)},Collection.prototype.bucket=function(e,t){var i,n={};for(i=0;i<t.length;i++)n[t[i][e]]=n[t[i][e]]||[],n[t[i][e]].push(t[i]);return n},Collection.prototype._analyseQuery=function(e,t,i){var n,r,o,a,s,h,l,u,c,p,d={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:e,options:t},f=[],y=[];i.time("checkIndexes"),void 0!==e[this._primaryKey]&&(i.time("checkIndexMatch: Primary Key"),c=new Path,d.indexMatch.push({lookup:this._primaryIndex.lookup(e,t),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:c.countKeys(e)},index:this._primaryIndex}),i.time("checkIndexMatch: Primary Key"));for(p in this._indexById)if(this._indexById.hasOwnProperty(p)&&(h=this._indexById[p],l=h.name(),i.time("checkIndexMatch: "+l),s=h.match(e,t),u=h.lookup(e,t),s.matchedKeyCount>0&&d.indexMatch.push({lookup:u,keyData:s,index:h}),i.time("checkIndexMatch: "+l),s.totalKeyCount===s.matchedKeyCount))break;if(i.time("checkIndexes"),d.indexMatch.length>1&&(i.time("findOptimalIndex"),d.indexMatch.sort(function(e,t){return e.keyData.totalKeyCount===e.keyData.matchedKeyCount?-1:t.keyData.totalKeyCount===t.keyData.matchedKeyCount?1:e.keyData.matchedKeyCount===t.keyData.matchedKeyCount?e.lookup.length-t.lookup.length:t.keyData.matchedKeyCount-e.keyData.matchedKeyCount}),i.time("findOptimalIndex")),t.join){for(d.hasJoin=!0,n=0;n<t.join.length;n++)for(r in t.join[n])t.join[n].hasOwnProperty(r)&&(f.push(r),y.push("$as"in t.join[n][r]?t.join[n][r].$as:r));for(a=0;a<y.length;a++)o=this._queryReferencesCollection(e,y[a],""),o&&(d.joinQueries[f[a]]=o,d.queriesJoin=!0);d.joinsOn=f,d.queriesOn=d.queriesOn.concat(f)}return d},Collection.prototype._queryReferencesCollection=function(e,t,i){var n;for(n in e)if(e.hasOwnProperty(n)){if(n===t)return i&&(i+="."),i+n;if("object"==typeof e[n])return i&&(i+="."),i+=n,this._queryReferencesCollection(e[n],t,i)}return!1},Collection.prototype._match=function(e,t,i){var n,r,o,a,s,h=typeof e,l=typeof t,u=!0;if("string"!==h&&"number"!==h||"string"!==l&&"number"!==l){for(s in t)if(t.hasOwnProperty(s)){if(n=!1,"$"===s.substr(0,1))switch(s){case"$gt":if(e>t[s]){if("or"===i)return!0}else u=!1;n=!0;break;case"$gte":if(e>=t[s]){if("or"===i)return!0}else u=!1;n=!0;break;case"$lt":if(e<t[s]){if("or"===i)return!0}else u=!1;n=!0;break;case"$lte":if(e<=t[s]){if("or"===i)return!0}else u=!1;n=!0;break;case"$exists":if(void 0===e!==t[s]){if("or"===i)return!0}else u=!1;n=!0;break;case"$or":n=!0;for(var c=0;c<t[s].length;c++){if(this._match(e,t[s][c],"and"))return!0;u=!1}break;case"$and":n=!0;for(var p=0;p<t[s].length;p++)if(!this._match(e,t[s][p],"and"))return!1;break;case"$in":if(!(t[s]instanceof Array))throw"Cannot use a $nin operator on a non-array key: "+s;var d,f=t[s],y=f.length,m=!1;for(d=0;y>d;d++)if(f[d]===e){m=!0;break}if(m){if("or"===i)return!0}else u=!1;n=!0;break;case"$nin":if(!(t[s]instanceof Array))throw"Cannot use a $nin operator on a non-array key: "+s;var _,g=t[s],v=g.length,C=!0;for(_=0;v>_;_++)if(g[_]===e){C=!1;break}if(C){if("or"===i)return!0}else u=!1;n=!0;break;case"$ne":if(e!=t[s]){if("or"===i)return!0}else u=!1;n=!0}if(!n&&t[s]instanceof RegExp)if(n=!0,"object"==typeof e&&void 0!==e[s]&&t[s].test(e[s])){if("or"===i)return!0}else u=!1;if(!n)if("object"==typeof t[s])if(void 0!==e[s])if(e[s]instanceof Array&&!(t[s]instanceof Array)){for(o=!1,a=0;a<e[s].length&&!(o=this._match(e[s][a],t[s],r));a++);if(o){if("or"===i)return!0}else u=!1}else if(!(e[s]instanceof Array)&&t[s]instanceof Array){for(o=!1,a=0;a<t[s].length&&!(o=this._match(e[s],t[s][a],r));a++);if(o){if("or"===i)return!0}else u=!1}else if("object"==typeof e)if(o=this._match(e[s],t[s],r)){if("or"===i)return!0}else u=!1;else if(o=this._match(void 0,t[s],r)){if("or"===i)return!0}else u=!1;else if(t[s]&&void 0!==t[s].$exists)if(o=this._match(void 0,t[s],r)){if("or"===i)return!0}else u=!1;else u=!1;else if(e&&e[s]===t[s]){if("or"===i)return!0}else if(e&&e[s]&&e[s]instanceof Array&&t[s]&&"object"!=typeof t[s]){for(o=!1,a=0;a<e[s].length&&!(o=this._match(e[s][a],t[s],r));a++);if(o){if("or"===i)return!0}else u=!1}else u=!1;if("and"===i&&!u)return!1}}else e!==t&&(u=!1);return u},Collection.prototype.count=function(e,t){return e?this.find(e,t).length:this._data.length},Collection.prototype.findSub=function(e,t,i,n){var r,o,a,s=new Path(t),h=this.find(e),l=h.length,u=this._db.collection("__FDB_temp_"+this.objectId()),c={parents:l,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(r=0;l>r;r++)if(o=s.value(h[r])[0]){if(u.setData(o),a=u.find(i,n),n.returnFirst&&a.length)return a[0];c.subDocs.push(a),c.subDocTotal+=a.length,c.pathFound=!0}return u.drop(),n.noStats?c.subDocs:(c.pathFound||(c.err="No objects found in the parent documents with a matching path of: "+t),c)},Collection.prototype.insertIndexViolation=function(e){var t,i,n,r=this._indexByName;if(this._primaryIndex.get(e[this._primaryKey]))t=this._primaryIndex;else for(i in r)if(r.hasOwnProperty(i)&&(n=r[i],n.unique()&&n.violation(e))){t=n;break}return t?t.name():!1},Collection.prototype.ensureIndex=function(e,t){this._indexByName=this._indexByName||{},this._indexById=this._indexById||{};var i=new Index(e,t,this),n={start:(new Date).getTime()};return this._indexByName[i.name()]?{err:"Index with that name already exists"}:this._indexById[i.id()]?{err:"Index with those keys already exists"}:(i.rebuild(),this._indexByName[i.name()]=i,this._indexById[i.id()]=i,n.end=(new Date).getTime(),n.total=n.end-n.start,this._lastOp={type:"ensureIndex",stats:{time:n}},{index:i,id:i.id(),name:i.name(),state:i.state()})},Collection.prototype.index=function(e){return this._indexByName?this._indexByName[e]:void 0},Collection.prototype.lastOp=function(){return this._metrics.list()},Collection.prototype.diff=function(e){var t,i,n,r,o={insert:[],update:[],remove:[]},a=this.primaryKey();if(a!==e.primaryKey())throw"Collection diffing requires that both collections have the same primary key!";for(t=e._data;t&&!(t instanceof Array);)e=t,t=e._data;for(r=t.length,i=0;r>i;i++)n=t[i],this._primaryIndex.get(n[a])?this._primaryCrc.get(n[a])===e._primaryCrc.get(n[a])||o.update.push(n):o.insert.push(n);for(t=this._data,r=t.length,i=0;r>i;i++)n=t[i],e._primaryIndex.get(n[a])||o.remove.push(n);return o},Core.prototype.collection=function(e,t){if(e)return this._collection[e]||this.debug()&&console.log("Creating collection "+e),this._collection[e]=this._collection[e]||new Collection(e).db(this),void 0!==t&&this._collection[e].primaryKey(t),this._collection[e];throw"Cannot get collection with undefined name!"},Core.prototype.collectionExists=function(e){return Boolean(this._collection[e])},Core.prototype.collections=function(){var e,t=[];for(e in this._collection)this._collection.hasOwnProperty(e)&&t.push({name:e,count:this._collection[e].count()});return t},Shared.finishModule("Collection"),module.exports=Collection;
},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,"./Path":14,"./Shared":15}],3:[function(_dereq_,module,exports){
var Shared,Collection,Metrics,Crc,Overload;Shared=_dereq_("./Shared"),Overload=_dereq_("./Overload");var Core=function(){this.init.apply(this,arguments)};Core.prototype.init=function(){this._collection={},this._debug={},this._version="1.2.10"},Core.prototype.moduleLoaded=Overload({string:function(e){if(void 0!==e){e=e.replace(/ /g,"");var r,t=e.split(",");for(r=0;r<t.length;r++)if(!Shared.modules[t[r]])return!1;return!0}return!1},"string, function":function(e,r){if(void 0!==e){e=e.replace(/ /g,"");var t,o=e.split(",");for(t=0;t<o.length;t++)if(!Shared.modules[o[t]])return!1;r()}},"string, function, function":function(e,r,t){if(void 0!==e){e=e.replace(/ /g,"");var o,i=e.split(",");for(o=0;o<i.length;o++)if(!Shared.modules[i[o]])return t(),!1;r()}}}),Core.moduleLoaded=Core.prototype.moduleLoaded,Core.shared=Shared,Core.prototype.shared=Shared,Shared.addModule("Core",Core),Shared.mixin(Core.prototype,"Mixin.Common"),Shared.mixin(Core.prototype,"Mixin.ChainReactor"),Collection=_dereq_("./Collection.js"),Metrics=_dereq_("./Metrics.js"),Crc=_dereq_("./Crc.js"),Core.prototype._isServer=!1,Core.prototype.isClient=function(){return!this._isServer},Core.prototype.isServer=function(){return this._isServer},Core.prototype.crc=Crc,Core.prototype.isClient=function(){return!this._isServer},Core.prototype.isServer=function(){return this._isServer},Core.prototype.arrayToCollection=function(e){return(new Collection).setData(e)},Core.prototype.on=function(e,r){return this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(r),this},Core.prototype.off=function(e,r){if(e in this._listeners){var t=this._listeners[e],o=t.indexOf(r);o>-1&&t.splice(o,1)}return this},Core.prototype.emit=function(e){if(this._listeners=this._listeners||{},e in this._listeners){var r,t=this._listeners[e],o=t.length;for(r=0;o>r;r++)t[r].apply(this,Array.prototype.slice.call(arguments,1))}return this},Core.prototype.peek=function(e){var r,t,o=[],i=typeof e;for(r in this._collection)this._collection.hasOwnProperty(r)&&(t=this._collection[r],o=o.concat("string"===i?t.peek(e):t.find(e)));return o},Core.prototype.peekCat=function(e){var r,t,o,i={},n=typeof e;for(r in this._collection)this._collection.hasOwnProperty(r)&&(t=this._collection[r],"string"===n?(o=t.peek(e),o&&o.length&&(i[t.name()]=o)):(o=t.find(e),o&&o.length&&(i[t.name()]=o)));return i},module.exports=Core;
},{"./Collection.js":2,"./Crc.js":4,"./Metrics.js":7,"./Overload":13,"./Shared":15}],4:[function(_dereq_,module,exports){
var crcTable=function(){var r,e,o,c=[];for(e=0;256>e;e++){for(r=e,o=0;8>o;o++)r=1&r?3988292384^r>>>1:r>>>1;c[e]=r}return c}();module.exports=function(r){var e,o=-1;for(e=0;e<r.length;e++)o=o>>>8^crcTable[255&(o^r.charCodeAt(e))];return(-1^o)>>>0};
},{}],5:[function(_dereq_,module,exports){
var Shared=_dereq_("./Shared"),Path=_dereq_("./Path"),Index=function(){this.init.apply(this,arguments)};Index.prototype.init=function(t,e,i){this._crossRef={},this._size=0,this._id=this._itemKeyHash(t,t),this.data({}),this.unique(e&&e.unique?e.unique:!1),void 0!==t&&this.keys(t),void 0!==i&&this.collection(i),this.name(e&&e.name?e.name:this._id)},Shared.addModule("Index",Index),Shared.mixin(Index.prototype,"Mixin.ChainReactor"),Index.prototype.id=function(){return this._id},Index.prototype.state=function(){return this._state},Index.prototype.size=function(){return this._size},Index.prototype.data=function(t){return void 0!==t?(this._data=t,this):this._data},Shared.synthesize(Index.prototype,"name"),Index.prototype.collection=function(t){return void 0!==t?(this._collection=t,this):this._collection},Index.prototype.keys=function(t){return void 0!==t?(this._keys=t,this._keyCount=(new Path).parse(this._keys).length,this):this._keys},Index.prototype.type=function(t){return void 0!==t?(this._type=t,this):this._type},Index.prototype.unique=function(t){return void 0!==t?(this._unique=t,this):this._unique},Index.prototype.rebuild=function(){if(this._collection){var t,e=this._collection.subset({},{$decouple:!1,$orderBy:this._keys}),i=e.find(),n=i.length;for(this._data={},this._unique&&(this._uniqueLookup={}),t=0;n>t;t++)this.insert(i[t])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}},Index.prototype.insert=function(t){var e,i,n,o=this._unique;for(o&&(e=this._itemHash(t,this._keys),this._uniqueLookup[e]=t),i=this._itemHashArr(t,this._keys),n=0;n<i.length;n++)this.pushToPathValue(i[n],t)},Index.prototype.remove=function(t){var e,i,n,o=this._unique;for(o&&(e=this._itemHash(t,this._keys),delete this._uniqueLookup[e]),i=this._itemHashArr(t,this._keys),n=0;n<i.length;n++)this.pullFromPathValue(i[n],t)},Index.prototype.violation=function(t){var e=this._itemHash(t,this._keys);return Boolean(this._uniqueLookup[e])},Index.prototype.hashViolation=function(t){return Boolean(this._uniqueLookup[t])},Index.prototype.pushToPathValue=function(t,e){var i=this._data[t]=this._data[t]||[];-1===i.indexOf(e)&&(i.push(e),this._size++,this.pushToCrossRef(e,i))},Index.prototype.pullFromPathValue=function(t,e){var i,n=this._data[t];i=n.indexOf(e),i>-1&&(n.splice(i,1),this._size--,this.pullFromCrossRef(e,n)),n.length||delete this._data[t]},Index.prototype.pull=function(t){var e,i,n=t[this._collection.primaryKey()],o=this._crossRef[n],s=o.length;for(e=0;s>e;e++)i=o[e],this._pullFromArray(i,t);this._size--,delete this._crossRef[n]},Index.prototype._pullFromArray=function(t,e){for(var i=t.length;i--;)t[i]===e&&t.splice(i,1)},Index.prototype.pushToCrossRef=function(t,e){var i,n=t[this._collection.primaryKey()];this._crossRef[n]=this._crossRef[n]||[],i=this._crossRef[n],-1===i.indexOf(e)&&i.push(e)},Index.prototype.pullFromCrossRef=function(t){var e=t[this._collection.primaryKey()];delete this._crossRef[e]},Index.prototype.lookup=function(t){return this._data[this._itemHash(t,this._keys)]||[]},Index.prototype.match=function(t){var e=new Path;return e.countObjectPaths(this._keys,t)},Index.prototype._itemHash=function(t,e){var i,n,o=new Path,s="";for(i=o.parse(e),n=0;n<i.length;n++)s&&(s+="_"),s+=o.value(t,i[n].path).join(":");return s},Index.prototype._itemKeyHash=function(t,e){var i,n,o=new Path,s="";for(i=o.parse(e),n=0;n<i.length;n++)s&&(s+="_"),s+=o.keyValue(t,i[n].path);return s},Index.prototype._itemHashArr=function(t,e){var i,n,o,s,h,r=new Path,u=[];for(i=r.parse(e),s=0;s<i.length;s++)for(n=r.value(t,i[s].path),o=0;o<n.length;o++)if(0===s)u.push(n[o]);else for(h=0;h<u.length;h++)u[h]=u[h]+"_"+n[o];return u},Shared.finishModule("Index"),module.exports=Index;
},{"./Path":14,"./Shared":15}],6:[function(_dereq_,module,exports){
var Shared=_dereq_("./Shared"),KeyValueStore=function(){this.init.apply(this,arguments)};KeyValueStore.prototype.init=function(t){this._name=t,this._data={},this._primaryKey="_id"},Shared.addModule("KeyValueStore",KeyValueStore),Shared.mixin(KeyValueStore.prototype,"Mixin.ChainReactor"),Shared.synthesize(KeyValueStore.prototype,"name"),KeyValueStore.prototype.primaryKey=function(t){return void 0!==t?(this._primaryKey=t,this):this._primaryKey},KeyValueStore.prototype.truncate=function(){return this._data={},this},KeyValueStore.prototype.set=function(t,e){return this._data[t]=e?e:!0,this},KeyValueStore.prototype.get=function(t){return this._data[t]},KeyValueStore.prototype.lookup=function(t){var e,r,a,i,n=t[this._primaryKey];if(n instanceof Array){for(r=n.length,i=[],e=0;r>e;e++)a=this._data[n[e]],a&&i.push(a);return i}if(n instanceof RegExp){i=[];for(e in this._data)this._data.hasOwnProperty(e)&&n.test(e)&&i.push(this._data[e]);return i}if("object"!=typeof n)return a=this._data[n],void 0!==a?[a]:[];if(n.$ne){i=[];for(e in this._data)this._data.hasOwnProperty(e)&&e!==n.$ne&&i.push(this._data[e]);return i}if(n.$in&&n.$in instanceof Array){i=[];for(e in this._data)this._data.hasOwnProperty(e)&&n.$in.indexOf(e)>-1&&i.push(this._data[e]);return i}if(n.$nin&&n.$nin instanceof Array){i=[];for(e in this._data)this._data.hasOwnProperty(e)&&-1===n.$nin.indexOf(e)&&i.push(this._data[e]);return i}if(n.$or&&n.$or instanceof Array){for(i=[],e=0;e<n.$or.length;e++)i=i.concat(this.lookup(n.$or[e]));return i}},KeyValueStore.prototype.unSet=function(t){return delete this._data[t],this},KeyValueStore.prototype.uniqueSet=function(t,e){return void 0===this._data[t]?(this._data[t]=e,!0):!1},Shared.finishModule("KeyValueStore"),module.exports=KeyValueStore;
},{"./Shared":15}],7:[function(_dereq_,module,exports){
var Shared=_dereq_("./Shared"),Operation=_dereq_("./Operation"),Metrics=function(){this.init.apply(this,arguments)};Metrics.prototype.init=function(){this._data=[]},Shared.addModule("Metrics",Metrics),Shared.mixin(Metrics.prototype,"Mixin.ChainReactor"),Metrics.prototype.create=function(t){var e=new Operation(t);return this._enabled&&this._data.push(e),e},Metrics.prototype.start=function(){return this._enabled=!0,this},Metrics.prototype.stop=function(){return this._enabled=!1,this},Metrics.prototype.clear=function(){return this._data=[],this},Metrics.prototype.list=function(){return this._data},Shared.finishModule("Metrics"),module.exports=Metrics;
},{"./Operation":12,"./Shared":15}],8:[function(_dereq_,module,exports){
var CRUD={preSetData:function(){},postSetData:function(){}};module.exports=CRUD;
},{}],9:[function(_dereq_,module,exports){
var ChainReactor={chain:function(i){this._chain=this._chain||[];var n=this._chain.indexOf(i);-1===n&&this._chain.push(i)},unChain:function(i){if(this._chain){var n=this._chain.indexOf(i);n>-1&&this._chain.splice(n,1)}},chainSend:function(i,n,h){if(this._chain){var a,t=this._chain,c=t.length;for(a=0;c>a;a++)t[a].chainReceive(this,i,n,h)}},chainReceive:function(i,n,h,a){var t={sender:i,type:n,data:h,options:a};(!this._chainHandler||this._chainHandler&&!this._chainHandler(t))&&this.chainSend(t.type,t.data,t.options)}};module.exports=ChainReactor;
},{}],10:[function(_dereq_,module,exports){
var idCounter=0,Overload=_dereq_("./Overload"),Common;Common={decouple:function(t){return void 0!==t?JSON.parse(JSON.stringify(t)):void 0},objectId:function(t){var d,e=Math.pow(10,17);if(t){var i,u=0,h=t.length;for(i=0;h>i;i++)u+=t.charCodeAt(i)*e;d=u.toString(16)}else idCounter++,d=(idCounter+(Math.random()*e+Math.random()*e+Math.random()*e+Math.random()*e)).toString(16);return d},debug:Overload([function(){return this._debug&&this._debug.all},function(t){return void 0!==t?"boolean"==typeof t?(this._debug=this._debug||{},this._debug.all=t,this.chainSend("debug",this._debug),this):this._debug&&this._debug[t]||this._db&&this._db._debug&&this._db._debug[t]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(t,d){return void 0!==t?void 0!==d?(this._debug=this._debug||{},this._debug[t]=d,this.chainSend("debug",this._debug),this):this._debug&&this._debug[d]||this._db&&this._db._debug&&this._db._debug[t]:this._debug&&this._debug.all}])},module.exports=Common;
},{"./Overload":13}],11:[function(_dereq_,module,exports){
var Events={on:new Overload({"string, function":function(s,i){return this._listeners=this._listeners||{},this._listeners[s]=this._listeners[s]||{},this._listeners[s]["*"]=this._listeners[s]["*"]||[],this._listeners[s]["*"].push(i),this},"string, *, function":function(s,i,t){return this._listeners=this._listeners||{},this._listeners[s]=this._listeners[s]||{},this._listeners[s][i]=this._listeners[s][i]||[],this._listeners[s][i].push(t),this}}),off:new Overload({string:function(s){return this._listeners&&this._listeners[s]&&s in this._listeners&&delete this._listeners[s],this},"string, function":function(s,i){var t,e;return"string"==typeof i?this._listeners&&this._listeners[s]&&this._listeners[s][i]&&delete this._listeners[s][i]:s in this._listeners&&(t=this._listeners[s]["*"],e=t.indexOf(i),e>-1&&t.splice(e,1)),this},"string, *, function":function(s,i,t){if(this._listeners&&s in this._listeners&&i in this.listeners[s]){var e=this._listeners[s][i],n=e.indexOf(t);n>-1&&e.splice(n,1)}},"string, *":function(s,i){this._listeners&&s in this._listeners&&i in this._listeners[s]&&delete this._listeners[s][i]}}),emit:function(s,i){if(this._listeners=this._listeners||{},s in this._listeners){if(this._listeners[s]["*"]){var t,e=this._listeners[s]["*"],n=e.length;for(t=0;n>t;t++)e[t].apply(this,Array.prototype.slice.call(arguments,1))}if(i instanceof Array&&i[0]&&i[0][this._primaryKey]){var r,l,h=this._listeners[s];for(n=i.length,t=0;n>t;t++)if(h[i[t][this._primaryKey]])for(r=h[i[t][this._primaryKey]].length,l=0;r>l;l++)h[i[t][this._primaryKey]][l].apply(this,Array.prototype.slice.call(arguments,1))}}return this}};module.exports=Events;
},{}],12:[function(_dereq_,module,exports){
var Shared=_dereq_("./Shared"),Path=_dereq_("./Path"),Operation=function(){this.pathSolver=new Path,this.counter=0,this.init.apply(this,arguments)};Operation.prototype.init=function(t){this._data={operation:t,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}},Shared.addModule("Operation",Operation),Shared.mixin(Operation.prototype,"Mixin.ChainReactor"),Operation.prototype.start=function(){this._data.time.startMs=(new Date).getTime()},Operation.prototype.log=function(t){if(t){var e=this._log.length>0?this._data.log[this._data.log.length-1].time:0,a={event:t,time:(new Date).getTime(),delta:0};return this._data.log.push(a),e&&(a.delta=a.time-e),this}return this._data.log},Operation.prototype.time=function(t){if(void 0!==t){var e=this._data.time.process,a=e[t]=e[t]||{};return a.startMs?(a.stopMs=(new Date).getTime(),a.totalMs=a.stopMs-a.startMs,a.stepObj.totalMs=a.totalMs,delete a.stepObj):(a.startMs=(new Date).getTime(),a.stepObj={name:t},this._data.steps.push(a.stepObj)),this}return this._data.time},Operation.prototype.flag=function(t,e){return void 0===t||void 0===e?void 0!==t?this._data.flag[t]:this._data.flag:void(this._data.flag[t]=e)},Operation.prototype.data=function(t,e){return void 0!==e?(this.pathSolver.set(this._data,t,e),this):this.pathSolver.get(this._data,t)},Operation.prototype.pushData=function(t,e){this.pathSolver.push(this._data,t,e)},Operation.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime(),this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs},Shared.finishModule("Operation"),module.exports=Operation;
},{"./Path":14,"./Shared":15}],13:[function(_dereq_,module,exports){
Overload=function(e){if(e){var n,r,t,a,i,o;if(!(e instanceof Array)){t={};for(n in e)if(e.hasOwnProperty(n))if(a=n.replace(/ /g,""),-1===a.indexOf("*"))t[a]=e[n];else for(o=generateSignaturePermutations(a),i=0;i<o.length;i++)t[o[i]]||(t[o[i]]=e[n]);e=t}return function(){if(e instanceof Array){for(r=e.length,n=0;r>n;n++)if(e[n].length===arguments.length)return e[n].apply(this,arguments)}else{var t,a,i=[];for(n=0;n<arguments.length;n++)a=typeof arguments[n],"object"===a&&arguments[n]instanceof Array&&(a="array"),i.push(a);if(t=i.join(","),e[t])return e[t].apply(this,arguments);for(n=i.length;n>=0;n--)if(t=i.slice(0,n).join(","),e[t+",..."])return e[t+",..."].apply(this,arguments)}throw"Overloaded method does not have a matching signature for the passed arguments: "+JSON.stringify(i)}}return function(){}},generateSignaturePermutations=function(e){var n,r,t=[],a=["string","object","number","function","undefined"];if(e.indexOf("*")>-1)for(r=0;r<a.length;r++)n=e.replace("*",a[r]),t=t.concat(generateSignaturePermutations(n));else t.push(e);return t},module.exports=Overload;
},{}],14:[function(_dereq_,module,exports){
var Shared=_dereq_("./Shared"),Path=function(){this.init.apply(this,arguments)};Path.prototype.init=function(t){t&&this.path(t)},Shared.addModule("Path",Path),Shared.mixin(Path.prototype,"Mixin.ChainReactor"),Path.prototype.path=function(t){return void 0!==t?(this._path=this.clean(t),this._pathParts=this._path.split("."),this):this._path},Path.prototype.hasObjectPaths=function(t,e){var r,o=!0;for(r in t)if(t.hasOwnProperty(r)){if(void 0===e[r])return!1;if("object"==typeof t[r]&&(o=this.hasObjectPaths(t[r],e[r]),!o))return!1}return o},Path.prototype.countKeys=function(t){var e,r=0;for(e in t)t.hasOwnProperty(e)&&void 0!==t[e]&&("object"!=typeof t[e]?r++:r+=this.countKeys(t[e]));return r},Path.prototype.countObjectPaths=function(t,e){var r,o,a={},h=0,n=0;for(o in e)e.hasOwnProperty(o)&&("object"==typeof e[o]?(r=this.countObjectPaths(t[o],e[o]),a[o]=r.matchedKeys,n+=r.totalKeyCount,h+=r.matchedKeyCount):(n++,t&&t[o]&&"object"!=typeof t[o]?(a[o]=!0,h++):a[o]=!1));return{matchedKeys:a,matchedKeyCount:h,totalKeyCount:n}},Path.prototype.parse=function(t,e){var r,o,a,h=[],n="";for(o in t)if(t.hasOwnProperty(o))if(n=o,"object"==typeof t[o])if(e)for(r=this.parse(t[o],e),a=0;a<r.length;a++)h.push({path:n+"."+r[a].path,value:r[a].value});else for(r=this.parse(t[o]),a=0;a<r.length;a++)h.push({path:n+"."+r[a].path});else h.push(e?{path:n,value:t[o]}:{path:n});return h},Path.prototype.parseArr=function(t,e){return e=e||{},this._parseArr(t,"",[],e)},Path.prototype._parseArr=function(t,e,r,o){var a,h="";e=e||"",r=r||[];for(a in t)t.hasOwnProperty(a)&&(!o.ignore||o.ignore&&!o.ignore.test(a))&&(h=e?e+"."+a:a,"object"==typeof t[a]?this._parseArr(t[a],h,r,o):r.push(h));return r},Path.prototype.value=function(t,e){if(void 0!==t&&"object"==typeof t){var r,o,a,h,n,i,s,p=[];for(void 0!==e&&(e=this.clean(e),r=e.split(".")),o=r||this._pathParts,a=o.length,h=t,i=0;a>i;i++){if(h=h[o[i]],n instanceof Array){for(s=0;s<n.length;s++)p=p.concat(this.value(n,s+"."+o[i]));return p}if(!h||"object"!=typeof h)break;n=h}return[h]}return[]},Path.prototype.set=function(t,e,r){if(void 0!==t&&void 0!==e){var o,a;e=this.clean(e),o=e.split("."),a=o.shift(),o.length?(t[a]=t[a]||{},this.set(t[a],o.join("."),r)):t[a]=r}return t},Path.prototype.get=function(t,e){return this.value(t,e)[0]},Path.prototype.push=function(t,e,r){if(void 0!==t&&void 0!==e){var o,a;if(e=this.clean(e),o=e.split("."),a=o.shift(),o.length)t[a]=t[a]||{},this.set(t[a],o.join("."),r);else{if(t[a]=t[a]||[],!(t[a]instanceof Array))throw"Cannot push to a path whose endpoint is not an array!";t[a].push(r)}}return t},Path.prototype.keyValue=function(t,e){var r,o,a,h,n,i,s;for(void 0!==e&&(e=this.clean(e),r=e.split(".")),o=r||this._pathParts,a=o.length,h=t,s=0;a>s;s++){if(h=h[o[s]],!h||"object"!=typeof h){i=o[s]+":"+h;break}n=h}return i},Path.prototype.clean=function(t){return"."===t.substr(0,1)&&(t=t.substr(1,t.length-1)),t},Shared.finishModule("Path"),module.exports=Path;
},{"./Shared":15}],15:[function(_dereq_,module,exports){
var Shared={modules:{},_synth:{},addModule:function(i,e){this.modules[i]=e,this.emit("moduleLoad",[i,e])},finishModule:function(i){if(!this.modules[i])throw"finishModule called on a module that has not been registered with addModule(): "+i;this.modules[i]._fdbFinished=!0,this.emit("moduleFinished",[i,this.modules[i]])},moduleFinished:function(i,e){this.modules[i]&&this.modules[i]._fdbFinished?e(i,this.modules[i]):this.on("moduleFinished",e)},moduleExists:function(i){return Boolean(this.modules[i])},mixin:function(i,e){var n=this.mixins[e];if(!n)throw"Cannot find mixin named: "+e;for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s])},synthesize:function(i,e,n){if(this._synth[e]=this._synth[e]||function(i){return void 0!==i?(this["_"+e]=i,this):this["_"+e]},n){var s=this;i[e]=function(){var i,t=this.$super;return this.$super=s._synth[e],i=n.apply(this,arguments),this.$super=t,i}}else i[e]=this._synth[e]},overload:_dereq_("./Overload"),mixins:{"Mixin.Common":_dereq_("./Mixin.Common"),"Mixin.Events":_dereq_("./Mixin.Events"),"Mixin.ChainReactor":_dereq_("./Mixin.ChainReactor"),"Mixin.CRUD":_dereq_("./Mixin.CRUD")}};Shared.mixin(Shared,"Mixin.Events"),module.exports=Shared;
},{"./Mixin.CRUD":8,"./Mixin.ChainReactor":9,"./Mixin.Common":10,"./Mixin.Events":11,"./Overload":13}]},{},[1])(1)
});
