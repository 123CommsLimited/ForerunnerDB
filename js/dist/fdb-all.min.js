!function(Oa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Oa();else if("function"==typeof define&&define.amd)define([],Oa);else{var g;"undefined"!=typeof window?g=window:"undefined"!=typeof global?g=global:"undefined"!=typeof self&&(g=self);g.ForerunnerDB=Oa()}}(function(){return function g(n,l,f){function c(a,e){if(!l[a]){if(!n[a]){var d="function"==typeof require&&require;if(!e&&d)return d(a,!0);if(b)return b(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",
d;}d=l[a]={exports:{}};n[a][0].call(d.exports,function(h){var S=n[a][1][h];return c(S?S:h)},d,d.exports,g,n,l,f)}return l[a].exports}for(var b="function"==typeof require&&require,e=0;e<f.length;e++)c(f[e]);return c}({1:[function(g,n,l){l=g("../lib/Core");g("../lib/CollectionGroup");g("../lib/View");g("../lib/OldView");g("../lib/OldView.Bind");g("../lib/Highcharts");g("../lib/Persist");g("../lib/vendor/jsviews");n.exports=l;window.ForerunnerDB=l},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Highcharts":6,
"../lib/OldView":11,"../lib/OldView.Bind":10,"../lib/Persist":15,"../lib/View":17,"../lib/vendor/jsviews":18}],2:[function(g,n,l){var f,c,b,e,a,k;f=g("./Shared");var d=function(h){this.init.apply(this,arguments)};d.prototype.init=function(h){this._primaryKey="_id";this._primaryIndex=new b("primary");this._primaryCrc=new b("primaryCrc");this._crcLookup=new b("crcLookup");this._name=h;this._data=[];this._groups=[];this._metrics=new c;this._linked=0;this._debug={};this._deferQueue={insert:[],update:[],
remove:[],upsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};f.modules.Collection=d;l=g("./Overload");c=g("./Metrics");b=g("./KeyValueStore");e=g("./Path");a=g("./Index");k=g("./Crc");g=f.modules.Core;d.prototype.debug=new l([function(){return this._debug.all},function(h){if(void 0!==h){if("boolean"===typeof h){this._debug.all=h;for(var S=0;S<this._views.length;S++)this._views[S].debug(h);return this}return this._debug[h]||
this._db&&this._db._debug&&this._db._debug[h]||this._debug.all}return this._debug.all},function(h,S){if(void 0!==h){if(void 0!==S){this._debug[h]=S;for(var a=0;a<this._views.length;a++)this._views[a].debug(h,S);return this}return this._debug[h]||this._db&&this._db._debug&&this._db._debug[h]}return this._debug.all}]);d.prototype.crc=k;d.prototype.name=function(h){return void 0!==h?(this._name=h,this):this._name};d.prototype.on=new l([function(h,S){this._listeners=this._listeners||{};this._listeners[h]=
this._listeners[h]||{};this._listeners[h]["*"]=this._listeners[h]["*"]||[];this._listeners[h]["*"].push(S);return this},function(h,S,a){this._listeners=this._listeners||{};this._listeners[h]=this._listeners[h]||{};this._listeners[h][S]=this._listeners[h][S]||[];this._listeners[h][S].push(a);return this}]);d.prototype.off=new l([function(h){this._listeners&&this._listeners[h]&&h in this._listeners&&delete this._listeners[h];return this},function(h,S){var a,d;"string"===typeof S?this._listeners&&this._listeners[h]&&
this._listeners[h][S]&&delete this._listeners[h][S]:h in this._listeners&&(a=this._listeners[h]["*"],d=a.indexOf(S),-1<d&&a.splice(d,1));return this},function(h,a,d){this._listeners&&h in this._listeners&&(h=this._listeners[h][a],d=h.indexOf(d),-1<d&&h.splice(d,1))}]);d.prototype.emit=function(h,a){this._listeners=this._listeners||{};if(h in this._listeners){if(this._listeners[h]["*"]){var d=this._listeners[h]["*"],c=d.length,b;for(b=0;b<c;b++)d[b].apply(this,Array.prototype.slice.call(arguments,
1))}if(a instanceof Array&&a[0]&&a[0][this._primaryKey]){var d=this._listeners[h],e,k,c=a.length;for(b=0;b<c;b++)if(d[a[b][this._primaryKey]])for(e=d[a[b][this._primaryKey]].length,k=0;k<e;k++)d[a[b][this._primaryKey]][k].apply(this,Array.prototype.slice.call(arguments,1))}}return this};d.prototype.drop=function(){if(this._db&&this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var h=[],a;for(a=0;a<this._groups.length;a++)h.push(this._groups[a]);
for(a=0;a<h.length;a++)this._groups[a].removeCollection(this);return!0}return!1};d.prototype.primaryKey=function(h){return void 0!==h?(this._primaryKey=h,this._primaryIndex.primaryKey(h),this._rebuildPrimaryKeyIndex(),this):this._primaryKey};d.prototype._onInsert=function(h,a){this.emit("insert",h,a)};d.prototype._onUpdate=function(h){this.emit("update",h)};d.prototype._onRemove=function(h){this.emit("remove",h)};d.prototype.db=function(h){return void 0!==h?(this._db=h,this):this._db};d.prototype.setData=
function(h,a,d){if(h){var c=this._metrics.create("setData");c.start();a=a||{};a.decouple=void 0!==a.decouple?a.decouple:!0;a.decouple&&(h=this.decouple(h));h instanceof Array||(h=[h]);c.time("transformIn");h=this.transformIn(h);c.time("transformIn");var b=this._data;this._data=[];h.length&&(this._data=this._data.concat(h));c.time("_rebuildPrimaryKeyIndex");this._rebuildPrimaryKeyIndex(a);c.time("_rebuildPrimaryKeyIndex");c.stop();this.emit("setData",this._data,b)}d&&d(!1);return this};d.prototype._rebuildPrimaryKeyIndex=
function(h){var a=h&&void 0!==h.ensureKeys?h.ensureKeys:!0;h=h&&void 0!==h.violationCheck?h.violationCheck:!0;var d,c,b,e=this._primaryIndex,k=this._primaryCrc,f=this._crcLookup,g=this._primaryKey,l;e.truncate();k.truncate();f.truncate();d=this._data;for(c=d.length;c--;)if(b=d[c],a&&this._ensurePrimaryKey(b),h){if(!e.uniqueSet(b[g],b))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+b[this._primaryKey];
}else l=JSON.stringify(b),e.set(b[g],b),k.set(b[g],l),f.set(l,b)};d.prototype._ensurePrimaryKey=function(h){void 0===h[this._primaryKey]&&(h[this._primaryKey]=this.objectId())};d.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};d.prototype.upsert=function(h,a){if(h){var d=this._deferQueue.upsert,c=this._deferThreshold.upsert,b={},e;if(h instanceof Array){if(h.length>c){this._deferQueue.upsert=d.concat(h);this.processQueue("upsert",
a);return}b=[];for(d=0;d<h.length;d++)b.push(this.upsert(h[d]));a&&a();return b}h[this._primaryKey]?(e={},e[this._primaryKey]=h[this._primaryKey],this.count(e)?b.op="update":b.op="insert"):b.op="insert";switch(b.op){case "insert":b.result=this.insert(h);break;case "update":b.result=this.update(e,h)}return b}a&&a()};d.prototype.update=function(h,a,d){a=this.decouple(a);a=this.transformIn(a);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var c=this,b=this._metrics.create("update"),
e=this._primaryKey,k,f,g=function(b){if(a&&void 0!==a[e]&&a[e]!=b[e]){c._primaryIndex.unSet(b[e]);var k=c._updateObject(b,a,h,d,"");if(c._primaryIndex.uniqueSet(b[e],b))return k;throw"Primary key violation in update! Key violated: "+b[e];}return c._updateObject(b,a,h,d,"")},l=this._views;b.start();b.time("Retrieve documents to update");k=this.find(h,{decouple:!1});b.time("Retrieve documents to update");if(k.length&&(b.time("Update documents"),f=k.filter(g),b.time("Update documents"),f.length)){if(l&&
l.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());b.time("Inform views of update");for(k=0;k<l.length;k++)l[k].update(h,a);b.time("Inform views of update")}this._onUpdate(f);this.deferEmit("change",{type:"update",data:f})}b.stop();return f||[]};d.prototype.updateById=function(h,a){var d={};d[this._primaryKey]=h;return this.update(d,a)};d.prototype._updateObject=function(h,a,d,b,c,k){a=this.decouple(a);c=c||"";"."===c.substr(0,1)&&(c=c.substr(1,c.length-1));
var f=!1,g=!1,l,q,p,m;for(m in a)if(a.hasOwnProperty(m)){l=!1;if("$"===m.substr(0,1))switch(m){case "$index":break;default:l=!0,(g=this._updateObject(h,a[m],d,b,c,m))&&(f=!0)}if(this._isPositionalKey(m)&&(l=!0,m=m.substr(0,m.length-2),g=new e(c+"."+m),h[m]&&h[m]instanceof Array&&h[m].length)){q=[];for(p=0;p<h[m].length;p++)this._match(h[m][p],g.value(d)[0])&&q.push(p);for(p=0;p<q.length;p++)(g=this._updateObject(h[m][q[p]],a[m+".$"],d,b,c+"."+m,k))&&(f=!0)}if(!l)if(k||"object"!==typeof a[m])switch(k){case "$inc":this._updateIncrement(h,
m,a[m]);f=!0;break;case "$push":void 0===h[m]&&(h[m]=[]);if(h[m]instanceof Array){if(void 0!==a[m].$position&&a[m].$each instanceof Array)for(g=a[m].$position,l=a[m].$each.length,p=0;p<l;p++)this._updateSplicePush(h[m],g+p,a[m].$each[p]);else if(a[m].$each instanceof Array)for(l=a[m].$each.length,p=0;p<l;p++)this._updatePush(h[m],a[m].$each[p]);else this._updatePush(h[m],a[m]);f=!0}else throw"Cannot push to a key that is not an array! ("+m+")";break;case "$pull":if(h[m]instanceof Array){q=[];for(p=
0;p<h[m].length;p++)this._match(h[m][p],a[m])&&q.push(p);for(l=q.length;l--;)this._updatePull(h[m],q[l]),f=!0}break;case "$pullAll":if(h[m]instanceof Array)if(a[m]instanceof Array){if(q=h[m],l=q.length,0<l)for(;l--;){for(g=0;g<a[m].length;g++)q[l]===a[m][g]&&(this._updatePull(h[m],l),l--,f=!0);if(0>l)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+m+")";break;case "$addToSet":void 0===h[m]&&(h[m]=[]);if(h[m]instanceof Array){p=h[m];var r;q=p.length;var n;l=!0;r=
b&&b.$addToSet;var X;r&&r.key?(g=!1,X=new e(r.key),n=X.value(a[m])[0]):(n=JSON.stringify(a[m]),g=!0);for(r=0;r<q;r++)if(g){if(JSON.stringify(p[r])===n){l=!1;break}}else if(n===X.value(p[r])[0]){l=!1;break}l&&(this._updatePush(h[m],a[m]),f=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===h[m]&&(h[m]=[]);if(h[m]instanceof Array)if(g=a.$index,void 0!==g)delete a.$index,this._updateSplicePush(h[m],g,a[m]),f=!0;else throw"Cannot splicePush without a $index integer value!";
else throw"Cannot splicePush with a key that is not an array! ("+m+")";break;case "$move":if(h[m]instanceof Array)for(p=0;p<h[m].length;p++){if(this._match(h[m][p],a[m])){f=a[m].$index;if(void 0!==f)this._updateSpliceMove(h[m],p,f),f=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+m+")";break;case "$mul":this._updateMultiply(h,m,a[m]);f=!0;break;case "$rename":this._updateRename(h,m,a[m]);f=!0;break;case "$unset":this._updateUnset(h,
m);f=!0;break;case "$pop":if(h[m]instanceof Array)this._updatePop(h[m],a[m])&&(f=!0);else throw"Cannot pop from a key that is not an array! ("+m+")";break;default:h[m]!==a[m]&&(this._updateProperty(h,m,a[m]),f=!0)}else if(null!==h[m]&&"object"===typeof h[m])if(p=h[m]instanceof Array,q=a[m]instanceof Array,p||q)if(!q&&p)for(p=0;p<h[m].length;p++)(g=this._updateObject(h[m][p],a[m],d,b,c+"."+m,k))&&(f=!0);else h[m]!==a[m]&&(this._updateProperty(h,m,a[m]),f=!0);else(g=this._updateObject(h[m],a[m],d,b,
c+"."+m,k))&&(f=!0);else h[m]!==a[m]&&(this._updateProperty(h,m,a[m]),f=!0)}return f};d.prototype._isPositionalKey=function(h){return".$"===h.substr(h.length-2,2)};d.prototype._updateProperty=function(h,a,d){this._linked?(jQuery.observable(h).setProperty(a,d),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+a+'" for collection "'+this.name()+'"')):(h[a]=d,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+a+'" for collection "'+
this.name()+'"'))};d.prototype._updateIncrement=function(h,a,d){this._linked?jQuery.observable(h).setProperty(a,h[a]+d):h[a]+=d};d.prototype._updateSpliceMove=function(h,a,d){this._linked?(jQuery.observable(h).move(a,d),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+a+'" to "'+d+'" for collection "'+this.name()+'"')):(h.splice(d,0,h.splice(a,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+
a+'" to "'+d+'" for collection "'+this.name()+'"'))};d.prototype._updateSplicePush=function(h,a,d){h.length>a?this._linked?jQuery.observable(h).insert(a,d):h.splice(a,0,d):this._linked?jQuery.observable(h).insert(d):h.push(d)};d.prototype._updatePush=function(h,a){this._linked?jQuery.observable(h).insert(a):h.push(a)};d.prototype._updatePull=function(h,a){this._linked?jQuery.observable(h).remove(a):h.splice(a,1)};d.prototype._updateMultiply=function(h,a,d){this._linked?jQuery.observable(h).setProperty(a,
h[a]*d):h[a]*=d};d.prototype._updateRename=function(h,a,d){var b=h[a];this._linked?(jQuery.observable(h).setProperty(d,b),jQuery.observable(h).removeProperty(a)):(h[d]=b,delete h[a])};d.prototype._updateUnset=function(h,a){this._linked?jQuery.observable(h).removeProperty(a):delete h[a]};d.prototype._updatePop=function(h,a){var d,b=!1;0<h.length&&(this._linked?(1===a?d=h.length-1:-1===a&&(d=0),-1<d&&(jQuery.observable(arr).remove(d),b=!0)):1===a?(h.pop(),b=!0):-1===a&&(h.shift(),b=!0));return b};d.prototype.remove=
function(h){var a,d,b=this._views,c;if(h instanceof Array){b=[];for(a=0;a<h.length;a++)b.push(this.remove(h[a]));return b}a=this.find(h,{decouple:!1});if(a.length){for(c=0;c<a.length;c++)d=a[c],this._removeIndex(d),d=this._data.indexOf(d),this._linked?jQuery.observable(this._data).remove(d):this._data.splice(d,1);if(b&&b.length)for(c=0;c<b.length;c++)b[c].remove(h);this._onRemove(a);this.deferEmit("change",{type:"remove",data:a})}return a};d.prototype.removeById=function(h){var a={};a[this._primaryKey]=
h;return this.remove(a)};d.prototype.deferEmit=function(){var a=this,d;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(d=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){a.debug()&&console.log("ForerunnerDB.Collection: Emitting "+d[0]);a.emit.apply(a,d)},100))};d.prototype.processQueue=function(a,d){var b=this._deferQueue[a],c=this._deferThreshold[a],e=this._deferTime[a];if(b.length){var k=this;
b.length&&(b=b.length>c?b.splice(0,c):b.splice(0,b.length),this[a](b));setTimeout(function(){k.processQueue(a,d)},e)}else d&&d()};d.prototype.insert=function(a,d,b){"function"===typeof d?(b=d,d=this._data.length):void 0===d&&(d=this._data.length);a=this.transformIn(a);return this._insertHandle(a,d,b)};d.prototype._insertHandle=function(a,d,b){var c=this._deferQueue.insert,e=this._deferThreshold.insert,k=[],f=[],g=this._views;if(a instanceof Array){if(a.length>e){this._deferQueue.insert=c.concat(a);
this.processQueue("insert",b);return}for(e=0;e<a.length;e++)c=this._insert(a[e],d+e),!0===c?k.push(a[e]):f.push({doc:a[e],reason:c})}else c=this._insert(a,d),!0===c?k.push(a):f.push({doc:a,reason:c});if(g&&g.length)for(c=0;c<g.length;c++)g[c].insert(a,d);this._onInsert(k,f);b&&b();this.deferEmit("change",{type:"insert",data:k});return{inserted:k,failed:f}};d.prototype._insert=function(a,d){if(a){var b;this._ensurePrimaryKey(a);if(b=this.insertIndexViolation(a))return"Index violation in index: "+b;
this._insertIndex(a);this._linked?jQuery.observable(this._data).insert(d,a):this._data.splice(d,0,a);return!0}return"No document passed to insert"};d.prototype._insertIndex=function(a){var d=this._indexByName,b,c=JSON.stringify(a);this._primaryIndex.uniqueSet(a[this._primaryKey],a);this._primaryCrc.uniqueSet(a[this._primaryKey],c);this._crcLookup.uniqueSet(c,a);for(b in d)d.hasOwnProperty(b)&&d[b].insert(a)};d.prototype._removeIndex=function(a){var d=this._indexByName,b,c=JSON.stringify(a);this._primaryIndex.unSet(a[this._primaryKey]);
this._primaryCrc.unSet(a[this._primaryKey]);this._crcLookup.unSet(c);for(b in d)d.hasOwnProperty(b)&&d[b].remove(a)};d.prototype.subset=function(a,b){var c=this.find(a,b);return(new d)._subsetOf(this).primaryKey(this._primaryKey).setData(c)};d.prototype.subsetOf=function(){return this.__subsetOf};d.prototype._subsetOf=function(a){this.__subsetOf=a;return this};d.prototype.distinct=function(a,d,b){d=this.find(d,b);a=new e(a);b={};var c=[],k,f;for(f=0;f<d.length;f++)(k=a.value(d[f])[0])&&!b[k]&&(b[k]=
!0,c.push(k));return c};d.prototype.decouple=function(a){return JSON.parse(JSON.stringify(a))};d.prototype.findById=function(a,d){var b={};b[this._primaryKey]=a;return this.find(b,d)[0]};d.prototype.peek=function(a,b){var c=this._data,e=c.length,k,f,g=new d;if("string"===typeof a){for(k=0;k<e;k++)f=JSON.stringify(c[k]),-1<f.indexOf(a)&&g.insert(c[k]);return g.find({},b)}return this.find(a,b)};d.prototype.explain=function(a,d){return this.find(a,d).__fdbOp._data};d.prototype.find=function(a,d){a=a||
{};d=d||{};d.decouple=void 0!==d.decouple?d.decouple:!0;var b=this._metrics.create("find"),c=this,k,f=!0,g,l,H,q,p,m,r,n,X,ba=[];l=function(d){return c._match(d,a,"and")};b.start();if(a){b.time("analyseQuery");k=this._analyseQuery(a,d,b);b.time("analyseQuery");b.data("analysis",k);if(k.hasJoin&&k.queriesJoin){b.time("joinReferences");for(H=0;H<k.joinsOn.length;H++)p=k.joinsOn[H],q=new e(k.joinQueries[p]),q=q.value(a)[0],this._db.collection(k.joinsOn[H]).subset(q);b.time("joinReferences")}k.indexMatch.length&&
(!d||d&&!d.skipIndex)?(b.data("index.potential",k.indexMatch),b.data("index.used",k.indexMatch[0].index),b.time("indexLookup"),g=k.indexMatch[0].lookup,b.time("indexLookup"),k.indexMatch[0].keyData.totalKeyCount===k.indexMatch[0].keyData.matchedKeyCount&&(f=!1)):b.flag("usedIndex",!1);f&&(g&&g.length?(k=g.length,b.time("tableScan: "+k),g=g.filter(l)):(k=this._data.length,b.time("tableScan: "+k),g=this._data.filter(l)),d.sort&&(b.time("sort"),g=this.sort(d.sort,g),b.time("sort")),b.time("tableScan: "+
k));d.limit&&g&&g.length>d.limit&&(g.length=d.limit,b.data("limit",d.limit));d.decouple&&(b.time("decouple"),g=this.decouple(g),b.time("decouple"),b.data("flag.decouple",!0));if(d.join){for(l=0;l<d.join.length;l++)for(p in d.join[l])if(d.join[l].hasOwnProperty(p))for(n=p,k=this._db.collection(p),f=d.join[l][p],X=0;X<g.length;X++){r={};q=H=!1;for(m in f)if(f.hasOwnProperty(m))if("$"===m.substr(0,1))switch(m){case "$as":n=f[m];break;case "$multi":H=f[m];break;case "$require":q=f[m];break;default:m.substr(0,
3)}else r[m]=(new e(f[m])).value(g[X])[0];r=k.find(r);!q||q&&r[0]?g[X][n]=!1===H?r[0]:r:ba.push(g[X])}b.data("flag.join",!0)}if(ba.length){b.time("removalQueue");for(m=0;m<ba.length;m++)p=g.indexOf(ba[m]),-1<p&&g.splice(p,1);b.time("removalQueue")}if(d.transform){b.time("transform");for(m=0;m<g.length;m++)g.splice(m,1,d.transform(g[m]));b.time("transform");b.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(b.time("transformOut"),g=this.transformOut(g),b.time("transformOut"));
b.data("results",g.length);b.stop()}else b.stop(),g=[];g.__fdbOp=b;return g};d.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};d.prototype.transformIn=function(a){if(this._transformEnabled&&this._transformIn){if(a instanceof
Array){var d=[],b;for(b=0;b<a.length;b++)d[b]=this._transformIn(a[b]);return d}return this._transformIn(a)}return a};d.prototype.transformOut=function(a){if(this._transformEnabled&&this._transformOut){if(a instanceof Array){var d=[],b;for(b=0;b<a.length;b++)d[b]=this._transformOut(a[b]);return d}return this._transformOut(a)}return a};d.prototype.sort=function(a,d){d=d||[];var b=[],c,e;for(c in a)a.hasOwnProperty(c)&&(e={},e[c]=a[c],e.___fdbKey=c,b.push(e));return 2>b.length?this._sort(a,d):this._bucketSort(b,
d)};d.prototype._bucketSort=function(a,d){var b=a.shift(),c,e,k=[];if(0<a.length){d=this._sort(b,d);c=this.bucket(b.___fdbKey,d);for(e in c)c.hasOwnProperty(e)&&(b=[].concat(a),k=k.concat(this._bucketSort(b,c[e])));return k}return this._sort(b,d)};d.prototype._sort=function(a,d){var b=new e,c=b.parse(a,!0)[0];b.path(c.path);return d.sort(1===c.value?function(a,d){var h=b.value(a)[0],c=b.value(d)[0];return"string"===typeof h&&"string"===typeof c?h.localeCompare(c):h>c?1:h<c?-1:0}:function(a,d){var h=
b.value(a)[0],c=b.value(d)[0];return"string"===typeof h&&"string"===typeof c?1===h.localeCompare(c)?-1:1:h>c?-1:h<c?1:0})};d.prototype.bucket=function(a,d){var b,c={};for(b=0;b<d.length;b++)c[d[b][a]]=c[d[b][a]]||[],c[d[b][a]].push(d[b]);return c};d.prototype._analyseQuery=function(a,d,b){var c={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:a,options:d},k,f=[],g=[],l,n,q,p,m;b.time("checkIndexes");void 0!==a[this._primaryKey]&&(b.time("checkIndexMatch: Primary Key"),
l=new e,c.indexMatch.push({lookup:this._primaryIndex.lookup(a,d),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:l.countKeys(a)},index:this._primaryIndex}),b.time("checkIndexMatch: Primary Key"));for(m in this._indexById)if(this._indexById.hasOwnProperty(m)&&(n=this._indexById[m],q=n.name(),b.time("checkIndexMatch: "+q),l=n.match(a,d),p=n.lookup(a,d),0<l.matchedKeyCount&&c.indexMatch.push({lookup:p,keyData:l,index:n}),b.time("checkIndexMatch: "+q),l.totalKeyCount===l.matchedKeyCount))break;
b.time("checkIndexes");1<c.indexMatch.length&&(b.time("findOptimalIndex"),c.indexMatch.sort(function(a,d){return a.keyData.totalKeyCount===a.keyData.matchedKeyCount?-1:d.keyData.totalKeyCount===d.keyData.matchedKeyCount?1:a.keyData.matchedKeyCount===d.keyData.matchedKeyCount?a.lookup.length-d.lookup.length:d.keyData.matchedKeyCount-a.keyData.matchedKeyCount}),b.time("findOptimalIndex"));if(d.join){c.hasJoin=!0;for(b=0;b<d.join.length;b++)for(k in d.join[b])d.join[b].hasOwnProperty(k)&&(f.push(k),
"$as"in d.join[b][k]?g.push(d.join[b][k].$as):g.push(k));for(k=0;k<g.length;k++)if(d=this._queryReferencesCollection(a,g[k],""))c.joinQueries[f[k]]=d,c.queriesJoin=!0;c.joinsOn=f;c.queriesOn=c.queriesOn.concat(f)}return c};d.prototype._queryReferencesCollection=function(a,d,b){for(var c in a)if(a.hasOwnProperty(c)){if(c===d)return b&&(b+="."),b+c;if("object"===typeof a[c])return b&&(b+="."),b+=c,this._queryReferencesCollection(a[c],d,b)}return!1};d.prototype._match=function(a,d,b){var c,e;c=typeof a;
e=typeof d;var k=!0,f;if(!("string"!==c&&"number"!==c||"string"!==e&&"number"!==e))a!==d&&(k=!1);else for(f in d)if(d.hasOwnProperty(f)){c=!1;if("$"===f.substr(0,1))switch(f){case "$gt":if(a>d[f]){if("or"===b)return!0}else k=!1;c=!0;break;case "$gte":if(a>=d[f]){if("or"===b)return!0}else k=!1;c=!0;break;case "$lt":if(a<d[f]){if("or"===b)return!0}else k=!1;c=!0;break;case "$lte":if(a<=d[f]){if("or"===b)return!0}else k=!1;c=!0;break;case "$exists":if(void 0===a!==d[f]){if("or"===b)return!0}else k=!1;
c=!0;break;case "$or":c=!0;for(e=0;e<d[f].length;e++){if(this._match(a,d[f][e],"and"))return!0;k=!1}break;case "$and":c=!0;for(e=0;e<d[f].length;e++)if(!this._match(a,d[f][e],"and"))return!1;break;case "$in":if(d[f]instanceof Array){c=d[f];e=c.length;var g,l=!1;for(g=0;g<e;g++)if(c[g]===a){l=!0;break}if(l){if("or"===b)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+f;c=!0;break;case "$nin":if(d[f]instanceof Array){c=d[f];e=c.length;l=!0;for(g=0;g<e;g++)if(c[g]===a){l=
!1;break}if(l){if("or"===b)return!0}else k=!1}else throw"Cannot use a $nin operator on a non-array key: "+f;c=!0;break;case "$ne":if(a!=d[f]){if("or"===b)return!0}else k=!1;c=!0}if(!c&&d[f]instanceof RegExp)if(c=!0,"object"===typeof a&&void 0!==a[f]&&d[f].test(a[f])){if("or"===b)return!0}else k=!1;if(!c)if("object"===typeof d[f])if(void 0!==a[f]){if(a[f]instanceof Array&&!(d[f]instanceof Array))for(c=!1,e=0;e<a[f].length&&!(c=this._match(a[f][e],d[f],void 0));e++);else if(!(a[f]instanceof Array)&&
d[f]instanceof Array)for(c=!1,e=0;e<d[f].length&&!(c=this._match(a[f],d[f][e],void 0));e++);else c="object"===typeof a?this._match(a[f],d[f],void 0):this._match(void 0,d[f],void 0);if(c){if("or"===b)return!0}else k=!1}else if(d[f]&&void 0!==d[f].$exists)if(c=this._match(void 0,d[f],void 0)){if("or"===b)return!0}else k=!1;else k=!1;else if(a&&a[f]===d[f]){if("or"===b)return!0}else if(a&&a[f]&&a[f]instanceof Array&&d[f]&&"object"!==typeof d[f]){c=!1;for(e=0;e<a[f].length&&!(c=this._match(a[f][e],d[f],
void 0));e++);if(c){if("or"===b)return!0}else k=!1}else k=!1;if("and"===b&&!k)return!1}return k};d.prototype.count=function(a,d){return a?this.find(a,d).length:this._data.length};d.prototype.link=function(a,d){if(window.jQuery){this._links=this._links||{};if(!this._links[d]){if(jQuery(a).length){if(!jQuery.templates[d]){var b=jQuery(d);if(b.length)jQuery.views.templates(d,jQuery(b[0]).html());else throw"Unable to bind collection to target because template does not exist: "+d;}jQuery.templates[d].link(a,
this._data);this._links[d]=a;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+d;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.unlink=function(a,d){if(window.jQuery){this._links=this._links||
{};if(this._links[d])return jQuery.templates[d].unlink(a),delete this._links[d],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+d)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.findSub=function(a,d,b,c){var k=new e(d);a=this.find(a);var f=a.length,g,l,n=this._db.collection("__FDB_temp_"+
this.objectId()),q={parents:f,subDocTotal:0,subDocs:[],pathFound:!1,err:""};for(g=0;g<f;g++)if(l=k.value(a[g])[0]){n.setData(l);l=n.find(b,c);if(c.returnFirst&&l.length)return l[0];q.subDocs.push(l);q.subDocTotal+=l.length;q.pathFound=!0}n.drop();if(c.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+d);return q};d.prototype.insertIndexViolation=function(a){var d,b=this._indexByName,c,e;if(this._primaryIndex.get(a[this._primaryKey]))d=
this._primaryIndex;else for(c in b)if(b.hasOwnProperty(c)&&(e=b[c],e.unique()&&e.violation(a))){d=e;break}return d?d.name():!1};d.prototype.ensureIndex=function(d,b){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var c=new a(d,b,this),e={start:(new Date).getTime()};if(this._indexByName[c.name()])return{err:"Index with that name already exists"};if(this._indexById[c.id()])return{err:"Index with those keys already exists"};c.rebuild();this._indexByName[c.name()]=c;this._indexById[c.id()]=
c;e.end=(new Date).getTime();e.total=e.end-e.start;this._lastOp={type:"ensureIndex",stats:{time:e}};return{index:c,id:c.id(),name:c.name(),state:c.state()}};d.prototype.index=function(a){if(this._indexByName)return this._indexByName[a]};d.prototype.lastOp=function(){return this._metrics.list()};d.prototype.objectId=function(a){var d=Math.pow(10,17);if(a){var b=0,c=a.length,e;for(e=0;e<c;e++)b+=a.charCodeAt(e)*d;a=b.toString(16)}else f.idCounter++,a=(f.idCounter+(Math.random()*d+Math.random()*d+Math.random()*
d+Math.random()*d)).toString(16);return a};d.prototype.diff=function(a){var d={insert:[],update:[],remove:[]},b=this.primaryKey(),c,e,k,f;if(b===a.primaryKey()){c=a._data;f=c.length;for(e=0;e<f;e++)k=c[e],this._primaryIndex.get(k[b])?this._primaryCrc.get(k[b])!==a._primaryCrc.get(k[b])&&d.update.push(k):d.insert.push(k);c=this._data;f=c.length;for(e=0;e<f;e++)k=c[e],a._primaryIndex.get(k[b])||d.remove.push(k)}return d};g.prototype.collection=function(a,b){if(a)return this._collection[a]||this.debug()&&
console.log("Creating collection "+a),this._collection[a]=this._collection[a]||(new d(a)).db(this),void 0!==b&&this._collection[a].primaryKey(b),this._collection[a];throw"Cannot get collection with undefined name!";};g.prototype.collectionExists=function(a){return Boolean(this._collection[a])};g.prototype.collections=function(){var a=[],d;for(d in this._collection)this._collection.hasOwnProperty(d)&&a.push({name:d,count:this._collection[d].count()});return a};n.exports=d},{"./Crc":5,"./Index":7,"./KeyValueStore":8,
"./Metrics":9,"./Overload":13,"./Path":14,"./Shared":16}],3:[function(g,n,l){var f,c,b;l=g("./Shared");var e=function(){this.init.apply(this,arguments)};e.prototype.init=function(a){var b=this;this._name=a;this._collectionArr=[];this._views=[];this._onCollectionInsert=function(){b._onInsert.apply(b,arguments)};this._onCollectionUpdate=function(){b._onUpdate.apply(b,arguments)};this._onCollectionRemove=function(){b._onRemove.apply(b,arguments)};this._onCollectionChange=function(){b._onChange.apply(b,
arguments)}};l.modules.CollectionGroup=e;c=g("./Collection");b=g("./Overload");g=l.modules.Core;f=l.modules.Core.prototype.init;e.prototype.on=new b([function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(b);return this},function(a,b,d){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][b]=this._listeners[a][b]||[];this._listeners[a][b].push(d);
return this}]);e.prototype.off=new b([function(a){this._listeners&&this._listeners[a]&&a in this._listeners&&delete this._listeners[a];return this},function(a,b){var d,c;"string"===typeof b?this._listeners&&this._listeners[a]&&this._listeners[a][b]&&delete this._listeners[a][b]:a in this._listeners&&(d=this._listeners[a]["*"],c=d.indexOf(b),-1<c&&d.splice(c,1));return this},function(a,b,d){this._listeners&&a in this._listeners&&(a=this._listeners[a][b],d=a.indexOf(d),-1<d&&a.splice(d,1))}]);e.prototype.emit=
function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var d=this._listeners[a]["*"],c=d.length,e;for(e=0;e<c;e++)d[e].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var d=this._listeners[a],f,g,c=b.length;for(e=0;e<c;e++)if(d[b[e][this._primaryKey]])for(f=d[b[e][this._primaryKey]].length,g=0;g<f;g++)d[b[e][this._primaryKey]][g].apply(this,Array.prototype.slice.call(arguments,1))}}return this};
e.prototype.db=function(a){return void 0!==a?(this._db=a,this):this._db};e.prototype.addCollection=function(a){if(a&&-1===this._collectionArr.indexOf(a)){if(this._collectionArr.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this._primaryKey=a.primaryKey();this._collectionArr.push(a);a._groups.push(this);a.on("insert",this._onCollectionInsert);a.on("update",this._onCollectionUpdate);a.on("remove",this._onCollectionRemove);
a.on("change",this._onCollectionChange)}return this};e.prototype.removeCollection=function(a){if(a){var b=this._collectionArr.indexOf(a);-1!==b&&(a.off("insert",this._onCollectionInsert),a.off("update",this._onCollectionUpdate),a.off("remove",this._onCollectionRemove),a.off("change",this._onCollectionChange),this._collectionArr.splice(b,1),b=a._groups.indexOf(this),-1!==b&&a._groups.splice(b,1));0===this._collectionArr.length&&delete this._primaryKey}return this};e.prototype.find=function(a,b){var d=
(new c).primaryKey(this._collectionArr[0].primaryKey()),e;for(e=0;e<this._collectionArr.length;e++)d.insert(this._collectionArr[e].find(a));return d.find(a,b)};e.prototype.insert=function(a,b){for(var d=0;d<this._collectionArr.length;d++)this._collectionArr[d].insert(a,b)};e.prototype.update=function(a,b){for(var d=0;d<this._collectionArr.length;d++)this._collectionArr[d].update(a,b)};e.prototype.updateById=function(a,b){for(var d=0;d<this._collectionArr.length;d++)this._collectionArr[d].updateById(a,
b)};e.prototype.remove=function(a){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].remove(a)};e.prototype.removeById=function(a){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].removeById(a)};e.prototype._onInsert=function(a,b){this.emit("insert",a,b)};e.prototype._onUpdate=function(a,b){this.emit("update",a,b)};e.prototype._onRemove=function(a,b){this.emit("remove",a,b)};e.prototype._onChange=function(){this.emit("change")};e.prototype.subset=function(a,b){var d=
this.find(a,b);return(new c)._subsetOf(this).primaryKey(this._primaryKey).setData(d)};e.prototype.drop=function(){var a,b=[].concat(this._collectionArr),d=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<b.length;a++)this.removeCollection(b[a]);for(a=0;a<d.length;a++)this._removeView(d[a]);this.emit("drop");return!0};g.prototype.init=function(){this._collectionGroup={};f.apply(this,arguments)};g.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=
this._collectionGroup[a]||(new e(a)).db(this),this._collectionGroup[a]):this._collectionGroup};n.exports=e},{"./Collection":2,"./Overload":13,"./Shared":16}],4:[function(g,n,l){var f,c;f=g("./Shared.js");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(){this._collection={};this._debug={}};f.modules.Core=b;l=g("./Overload.js");c=g("./Collection.js");g("./Metrics.js");g=g("./Crc.js");b.prototype._isServer=!1;b.prototype.isClient=function(){return!this._isServer};b.prototype.isServer=
function(){return this._isServer};b.prototype.crc=g;b.prototype.isClient=function(){return!this._isServer};b.prototype.isServer=function(){return this._isServer};b.prototype.decouple=function(b){return JSON.parse(JSON.stringify(b))};b.prototype.debug=new l([function(){return this._debug.all},function(b){return void 0!==b&&"boolean"===typeof b?(this._debug.all=b,this):this._debug.all},function(b,a){return void 0!==b?void 0!==a?(this._debug[b]=a,this):this._debug[b]:this._debug.all}]);b.prototype.arrayToCollection=
function(b){return(new c).setData(b)};b.prototype.on=function(b,a){this._listeners=this._listeners||{};this._listeners[b]=this._listeners[b]||[];this._listeners[b].push(a);return this};b.prototype.off=function(b,a){if(b in this._listeners){var c=this._listeners[b],d=c.indexOf(a);-1<d&&c.splice(d,1)}return this};b.prototype.emit=function(b,a){this._listeners=this._listeners||{};if(b in this._listeners){var c=this._listeners[b],d=c.length,h;for(h=0;h<d;h++)c[h].apply(this,Array.prototype.slice.call(arguments,
1))}return this};b.prototype.objectId=function(b){var a,c,d=Math.pow(10,17),h;if(b){a=0;c=b.length;for(h=0;h<c;h++)a+=b.charCodeAt(h)*d;b=a.toString(16)}else f.idCounter++,b=(f.idCounter+(Math.random()*d+Math.random()*d+Math.random()*d+Math.random()*d)).toString(16);return b};b.prototype.peek=function(b){var a,c,d=[],h=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(c=this._collection[a],d="string"===h?d.concat(c.peek(b)):d.concat(c.find(b)));return d};b.prototype.peekCat=
function(b){var a,c,d={},h,f=typeof b;for(a in this._collection)this._collection.hasOwnProperty(a)&&(c=this._collection[a],(h="string"===f?c.peek(b):c.find(b))&&h.length&&(d[c.name()]=h));return d};n.exports=b},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":9,"./Overload.js":13,"./Shared.js":16}],5:[function(g,n,l){var f=function(){var c=[],b,e,a;for(e=0;256>e;e++){b=e;for(a=0;8>a;a++)b=b&1?3988292384^b>>>1:b>>>1;c[e]=b}return c}();n.exports=function(c){var b=-1,e;for(e=0;e<c.length;e++)b=b>>>8^
f[(b^c.charCodeAt(e))&255];return(b^-1)>>>0}},{}],6:[function(g,n,l){var f;g=g("./Shared");var c=function(b,c){this.init.apply(this,arguments)};c.prototype.init=function(b,c){this._options=c;this._selector=$(this._options.selector);this._listeners={};this._collection=b;this._options.series=[];var a,f;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();a=this._collection.find();f={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,
format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};a=this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField);$.extend(f,this._options.seriesOptions);$.extend(f,{type:"pie",name:this._options.seriesName,data:a});this._chart.addSeries(f);break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=
a.xAxis,this._options.chartOptions.series=a.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};g=g.modules.Collection;f=g.prototype.init;c.prototype.pieDataFromCollectionData=function(b,c,a){var f=[],d;for(d=0;d<b.length;d++)f.push([b[d][c],b[d][a]]);return f};c.prototype.lineDataFromCollectionData=function(b,c,a,f){var d=this._collection.distinct(b),h=[],g={categories:[]},l,n,Q,ga,ha;for(ga=0;ga<d.length;ga++){l=d[ga];n={};n[b]=
l;Q=[];n=this._collection.find(n,{orderBy:f});for(ha=0;ha<n.length;ha++)g.categories.push(n[ha][c]),Q.push(n[ha][a]);h.push({name:l,data:Q})}return{xAxis:g,series:h}};c.prototype._hookEvents=function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};c.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var b=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(b,
this._options.keyField,this._options.valField));break;case "line":b=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy);this._chart.xAxis[0].setCategories(b.xAxis.categories);for(var c=0;c<b.series.length;c++)this._chart.series[c].setData(b.series[c].data)}}};c.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};c.prototype.drop=function(){this._chart.destroy();
this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];delete this._chart;delete this._options;delete this._collection;return this};g.prototype.init=function(){this._highcharts={};f.apply(this,arguments)};g.prototype.chart=function(b){this._highcharts[b.selector]||(this._highcharts[b.selector]=new c(this,b));return this._highcharts[b.selector]};g.prototype.dropChart=function(b){this._highcharts[b]&&
this._highcharts[b].drop()};n.exports=c},{"./Shared":16}],7:[function(g,n,l){l=g("./Shared");var f=g("./Path");g=function(){this.init.apply(this,arguments)};g.prototype.init=function(c,b,e){this._crossRef={};this._size=0;this._id=this._itemKeyHash(c,c);this.data({});this.unique(b&&b.unique?b.unique:!1);void 0!==c&&this.keys(c);void 0!==e&&this.collection(e);this.name(b&&b.name?b.name:this._id)};l.modules.Index=g;g.prototype.id=function(){return this._id};g.prototype.state=function(){return this._state};
g.prototype.size=function(){return this._size};g.prototype.data=function(c){return void 0!==c?(this._data=c,this):this._data};g.prototype.name=function(c){return void 0!==c?(this._name=c,this):this._name};g.prototype.collection=function(c){return void 0!==c?(this._collection=c,this):this._collection};g.prototype.keys=function(c){return void 0!==c?(this._keys=c,this._keyCount=(new f).parse(this._keys).length,this):this._keys};g.prototype.type=function(c){return void 0!==c?(this._type=c,this):this._type};
g.prototype.unique=function(c){return void 0!==c?(this._unique=c,this):this._unique};g.prototype.rebuild=function(){if(this._collection){var c=this._collection.subset({},{decouple:!1,sort:this._keys}).find(),b,e=c.length;this._data={};this._unique&&(this._uniqueLookup={});for(b=0;b<e;b++)this.insert(c[b])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};g.prototype.insert=function(c,b){var e,a;this._unique&&(e=this._itemHash(c,this._keys),this._uniqueLookup[e]=
c);e=this._itemHashArr(c,this._keys);for(a=0;a<e.length;a++)this.pushToPathValue(e[a],c)};g.prototype.remove=function(c,b){var e,a;this._unique&&(e=this._itemHash(c,this._keys),delete this._uniqueLookup[e]);e=this._itemHashArr(c,this._keys);for(a=0;a<e.length;a++)this.pullFromPathValue(e[a],c)};g.prototype.violation=function(c){c=this._itemHash(c,this._keys);return Boolean(this._uniqueLookup[c])};g.prototype.hashViolation=function(c){return Boolean(this._uniqueLookup[c])};g.prototype.pushToPathValue=
function(c,b){var e=this._data[c]=this._data[c]||[];-1===e.indexOf(b)&&(e.push(b),this._size++,this.pushToCrossRef(b,e))};g.prototype.pullFromPathValue=function(c,b){var e=this._data[c],a;a=e.indexOf(b);-1<a&&(e.splice(a,1),this._size--,this.pullFromCrossRef(b,e));e.length||delete this._data[c]};g.prototype.pull=function(c){var b=c[this._collection.primaryKey()],e=this._crossRef[b],a,f=e.length,d;for(a=0;a<f;a++)d=e[a],this._pullFromArray(d,c);this._size--;delete this._crossRef[b]};g.prototype._pullFromArray=
function(c,b){for(var e=c.length;e--;)c[e]===b&&c.splice(e,1)};g.prototype.pushToCrossRef=function(c,b){var e=c[this._collection.primaryKey()];this._crossRef[e]=this._crossRef[e]||[];e=this._crossRef[e];-1===e.indexOf(b)&&e.push(b)};g.prototype.pullFromCrossRef=function(c,b){var e=c[this._collection.primaryKey()];delete this._crossRef[e]};g.prototype.lookup=function(c){return this._data[this._itemHash(c,this._keys)]||[]};g.prototype.match=function(c,b){return(new f).countObjectPaths(this._keys,c)};
g.prototype._itemHash=function(c,b){var e=new f,a,k="",d;a=e.parse(b);for(d=0;d<a.length;d++)k&&(k+="_"),k+=e.value(c,a[d].path).join(":");return k};g.prototype._itemKeyHash=function(c,b){var e=new f,a,k="",d;a=e.parse(b);for(d=0;d<a.length;d++)k&&(k+="_"),k+=e.keyValue(c,a[d].path);return k};g.prototype._itemHashArr=function(c,b){var e=new f,a,k=[],d,h,g,l;a=e.parse(b);for(g=0;g<a.length;g++)for(d=e.value(c,a[g].path),h=0;h<d.length;h++)if(0===g)k.push(d[h]);else for(l=0;l<k.length;l++)k[l]=k[l]+
"_"+d[h];return k};n.exports=g},{"./Path":14,"./Shared":16}],8:[function(g,n,l){g=g("./Shared");l=function(f){this.init.apply(this,arguments)};l.prototype.init=function(f){this._name=f;this._data={};this._primaryKey="_id"};g.modules.KeyValueStore=l;l.prototype.name=function(f){return void 0!==f?(this._name=f,this):this._name};l.prototype.primaryKey=function(f){return void 0!==f?(this._primaryKey=f,this):this._primaryKey};l.prototype.truncate=function(){this._data={};return this};l.prototype.set=function(f,
c){this._data[f]=c?c:!0;return this};l.prototype.get=function(f){return this._data[f]};l.prototype.lookup=function(f){f=f[this._primaryKey];var c,b,e,a;if(f instanceof Array){b=f.length;a=[];for(c=0;c<b;c++)(e=this._data[f[c]])&&a.push(e);return a}if(f instanceof RegExp){a=[];for(c in this._data)this._data.hasOwnProperty(c)&&f.test(c)&&a.push(this._data[c]);return a}if("object"===typeof f){if(f.$ne){a=[];for(c in this._data)this._data.hasOwnProperty(c)&&c!==f.$ne&&a.push(this._data[c]);return a}if(f.$in&&
f.$in instanceof Array){a=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1<f.$in.indexOf(c)&&a.push(this._data[c]);return a}if(f.$nin&&f.$nin instanceof Array){a=[];for(c in this._data)this._data.hasOwnProperty(c)&&-1===f.$nin.indexOf(c)&&a.push(this._data[c]);return a}if(f.$or&&f.$or instanceof Array){a=[];for(c=0;c<f.$or.length;c++)a=a.concat(this.lookup(f.$or[c]));return a}}else return e=this._data[f],void 0!==e?[e]:[]};l.prototype.unSet=function(f){delete this._data[f];return this};l.prototype.uniqueSet=
function(f,c){return void 0===this._data[f]?(this._data[f]=c,!0):!1};n.exports=l},{"./Shared":16}],9:[function(g,n,l){l=g("./Shared");var f=g("./Operation");g=function(){this.init.apply(this,arguments)};g.prototype.init=function(){this._data=[]};l.modules.Metrics=g;g.prototype.create=function(c){c=new f(c);this._enabled&&this._data.push(c);return c};g.prototype.start=function(){this._enabled=!0;return this};g.prototype.stop=function(){this._enabled=!1;return this};g.prototype.clear=function(){this._data=
[];return this};g.prototype.list=function(){return this._data};n.exports=g},{"./Operation":12,"./Shared":16}],10:[function(g,n,l){var f;g=g("./Shared").modules.OldView;f=g.prototype.init;g.prototype.init=function(){var c=this;this._binds=[];this._renderEnd=this._renderStart=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[],_bindInsert:[],_bindUpdate:[],_bindRemove:[],_bindUpsert:[]};this._deferThreshold={insert:100,update:100,remove:100,upsert:100,_bindInsert:100,_bindUpdate:100,_bindRemove:100,
_bindUpsert:100};this._deferTime={insert:100,update:1,remove:1,upsert:1,_bindInsert:100,_bindUpdate:1,_bindRemove:1,_bindUpsert:1};f.apply(this,arguments);this.on("insert",function(b,e){c._bindEvent("insert",b,e)});this.on("update",function(b,e){c._bindEvent("update",b,e)});this.on("remove",function(b,e){c._bindEvent("remove",b,e)});this.on("change",c._bindChange)};g.prototype.bind=function(c,b){if(b&&b.template)this._binds[c]=b;else throw"Cannot bind data to element, missing options information!";
return this};g.prototype.unBind=function(c){delete this._binds[c];return this};g.prototype.isBound=function(c){return Boolean(this._binds[c])};g.prototype.bindSortDom=function(c,b){var e=$(c),a,f,d;this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",b);for(a=0;a<b.length;a++)f=b[a],d=e.find("#"+f[this._primaryKey]),d.length?0===a?(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",d),e.prepend(d)):(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+
a+"...",d),d.insertAfter(e.children(":eq("+(a-1)+")"))):this.debug()&&console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",f)};g.prototype.bindRefresh=function(c){var b=this._binds,e,a;c||(c={data:this.find()});for(e in b)b.hasOwnProperty(e)&&(a=b[e],this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting DOM..."),this.bindSortDom(e,c.data),a.afterOperation&&a.afterOperation(),a.refresh&&a.refresh())};g.prototype.bindRender=function(c,b){var e=this._binds[c],a=
$(c),f,d,h=$("<ul></ul>"),g;if(e){f=this._data.find();for(g=0;g<f.length;g++)d=f[g],e.template(d,function(a){h.append(a)});b?b(c,h.html()):a.append(h.html())}};g.prototype.processQueue=function(c,b){var e=this._deferQueue[c],a=this._deferThreshold[c],f=this._deferTime[c];if(e.length){var d=this;e.length&&(e=e.length>a?e.splice(0,a):e.splice(0,e.length),this._bindEvent(c,e,[]));setTimeout(function(){d.processQueue(c,b)},f)}else b&&b(),this.emit("bindQueueComplete")};g.prototype._bindEvent=function(c,
b,e){var a=this._binds,f=this.find({}),d,h;for(h in a)if(a.hasOwnProperty(h))switch(d=a[h].reduce?this.find(a[h].reduce.query,a[h].reduce.options):f,c){case "insert":this._bindInsert(h,a[h],b,e,d);break;case "update":this._bindUpdate(h,a[h],b,e,d);break;case "remove":this._bindRemove(h,a[h],b,e,d)}};g.prototype._bindChange=function(c){this.debug()&&console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",c);this.bindRefresh(c)};g.prototype._bindInsert=function(c,b,e,a,f){var d=
$(c),h;for(h=0;h<e.length;h++)c=d.find("#"+e[h][this._primaryKey]),c.length||b.template(e[h],function(a,c,h,e){return function(a){b.insert?b.insert(a,c,h,e):b.prependInsert?d.prepend(a):d.append(a);b.afterInsert&&b.afterInsert(a,c,h,e)}}(c,e[h],a,f))};g.prototype._bindUpdate=function(c,b,e,a,f){var d=$(c);for(a=0;a<e.length;a++)c=d.find("#"+e[a][this._primaryKey]),b.template(e[a],function(a,c){return function(e){b.update?b.update(e,c,f,a.length?"update":"append"):a.length?a.replaceWith(e):b.prependUpdate?
d.prepend(e):d.append(e);b.afterUpdate&&b.afterUpdate(e,c,f)}}(c,e[a]))};g.prototype._bindRemove=function(c,b,e,a,f){c=$(c);var d;for(d=0;d<e.length;d++)a=c.find("#"+e[d][this._primaryKey]),a.length&&(b.beforeRemove?b.beforeRemove(a,e[d],f,function(a,d,c){return function(){b.remove?b.remove(a,d,c):(a.remove(),b.afterRemove&&b.afterRemove(a,d,c))}}(a,e[d],f)):b.remove?b.remove(a,e[d],f):(a.remove(),b.afterRemove&&b.afterRemove(a,e[d],f)))}},{"./Shared":16}],11:[function(g,n,l){var f,c,b,e,a;f=g("./Shared");
var k=function(){this.init.apply(this,arguments)};k.prototype.init=function(a){var b=this;this._name=a;this._groups=[];this._listeners={};this._query={query:{},options:{}};this._onFromSetData=function(){b._onSetData.apply(b,arguments)};this._onFromInsert=function(){b._onInsert.apply(b,arguments)};this._onFromUpdate=function(){b._onUpdate.apply(b,arguments)};this._onFromRemove=function(){b._onRemove.apply(b,arguments)};this._onFromChange=function(){b.debug()&&console.log("ForerunnerDB.OldView: Received change");
b._onChange.apply(b,arguments)}};f.modules.OldView=k;l=g("./CollectionGroup");c=g("./Collection");b=c.prototype.init;e=l.prototype.init;g=g("./Overload");f=f.modules.Core;a=f.prototype.init;k.prototype.on=new g([function(a,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(b);return this},function(a,b,c){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][b]=
this._listeners[a][b]||[];this._listeners[a][b].push(c);return this}]);k.prototype.off=new g([function(a){this._listeners&&this._listeners[a]&&a in this._listeners&&delete this._listeners[a];return this},function(a,b){var c,e;"string"===typeof b?this._listeners&&this._listeners[a]&&this._listeners[a][b]&&delete this._listeners[a][b]:a in this._listeners&&(c=this._listeners[a]["*"],e=c.indexOf(b),-1<e&&c.splice(e,1));return this},function(a,b,c){this._listeners&&a in this._listeners&&(a=this._listeners[a][b],
c=a.indexOf(c),-1<c&&a.splice(c,1))}]);k.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var c=this._listeners[a]["*"],e=c.length,f;for(f=0;f<e;f++)c[f].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this._primaryKey]){var c=this._listeners[a],k,g,e=b.length;for(f=0;f<e;f++)if(c[b[f][this._primaryKey]])for(k=c[b[f][this._primaryKey]].length,g=0;g<k;g++)c[b[f][this._primaryKey]][g].apply(this,
Array.prototype.slice.call(arguments,1))}}return this};k.prototype.drop=function(){return(this._db||this._from)&&this._name?(this.debug()&&console.log("ForerunnerDB.OldView: Dropping view "+this._name),this.emit("drop"),this._db&&delete this._db._oldViews[this._name],this._from&&delete this._from._oldViews[this._name],!0):!1};k.prototype.debug=function(){return!1};k.prototype.db=function(a){return void 0!==a?(this._db=a,this):this._db};k.prototype.from=function(a){if(void 0!==a){if("string"===typeof a)if(this._db.collectionExists(a))a=
this._db.collection(a);else throw"Invalid collection in view.from() call.";this._from!==a&&(this._from&&this.removeFrom(),this.addFrom(a));return this}return this._from};k.prototype.addFrom=function(a){if(this._from=a)return this._from.on("setData",this._onFromSetData),this._from.on("change",this._onFromChange),this._from._addOldView(this),this._primaryKey=this._from._primaryKey,this.refresh(),this;throw"Cannot determine collection type in view.from()";};k.prototype.removeFrom=function(){this._from.off("setData",
this._onFromSetData);this._from.off("change",this._onFromChange);this._from._removeOldView(this)};k.prototype.primaryKey=function(){if(this._from)return this._from.primaryKey()};k.prototype.queryData=function(a,b,c){void 0!==a&&(this._query.query=a);void 0!==b&&(this._query.options=b);return void 0!==a||void 0!==b?(void 0!==c&&!0!==c||this.refresh(),this):this._query};k.prototype.queryAdd=function(a,b,c){var e=this._query.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&(void 0===e[f]||void 0!==
e[f]&&b)&&(e[f]=a[f]);void 0!==c&&!0!==c||this.refresh()};k.prototype.queryRemove=function(a,b){var c=this._query.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&delete c[e];void 0!==b&&!0!==b||this.refresh()};k.prototype.query=function(a,b){return void 0!==a?(this._query.query=a,void 0!==b&&!0!==b||this.refresh(),this):this._query.query};k.prototype.queryOptions=function(a,b){return void 0!==a?(this._query.options=a,void 0!==b&&!0!==b||this.refresh(),this):this._query.options};k.prototype.refresh=
function(a){if(this._from){var b=this._data,c,e,f,k,g,l=[],n=[],H=[],q;this.debug()&&(console.log("ForerunnerDB.OldView: Refreshing view "+this._name),console.log("ForerunnerDB.OldView: Existing data: "+("undefined"!==typeof this._data)),"undefined"!==typeof this._data&&console.log("ForerunnerDB.OldView: Current data rows: "+this._data.find().length));this._query?(this.debug()&&console.log("ForerunnerDB.OldView: View has query and options, getting subset..."),this._data=this._from.subset(this._query.query,
this._query.options)):this._query.options?(this.debug()&&console.log("ForerunnerDB.OldView: View has options, getting subset..."),this._data=this._from.subset({},this._query.options)):(this.debug()&&console.log("ForerunnerDB.OldView: View has no query or options, getting subset..."),this._data=this._from.subset({}));if(!a&&b)if(this.debug()&&console.log("ForerunnerDB.OldView: Refresh not forced, old data detected..."),e=this._data,b.subsetOf()===e.subsetOf()){this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from same collection...");
f=e.find();a=b.find();k=e._primaryKey;for(q=0;q<f.length;q++)g=f[q],c={},c[k]=g[k],(c=b.find(c)[0])?JSON.stringify(c)!==JSON.stringify(g)&&n.push(g):l.push(g);for(q=0;q<a.length;q++)g=a[q],c={},c[k]=g[k],e.find(c)[0]||H.push(g);this.debug()&&(console.log("ForerunnerDB.OldView: Removed "+H.length+" rows"),console.log("ForerunnerDB.OldView: Inserted "+l.length+" rows"),console.log("ForerunnerDB.OldView: Updated "+n.length+" rows"));l.length&&this._onInsert(l,[]);n.length&&this._onUpdate(n,[]);H.length&&
this._onRemove(H,[])}else this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from different collections..."),H=b.find(),H.length&&this._onRemove(H),l=e.find(),l.length&&this._onInsert(l);else this.debug()&&console.log("ForerunnerDB.OldView: Forcing data update",f),this._data=this._from.subset(this._query.query,this._query.options),f=this._data.find(),this.debug()&&console.log("ForerunnerDB.OldView: Emitting change event with data",f),this._onInsert(f,[]);this.debug()&&console.log("ForerunnerDB.OldView: Emitting change");
this.emit("change")}return this};k.prototype.count=function(){return this._data&&this._data._data?this._data._data.length:0};k.prototype.find=function(){return this._data?(this.debug()&&console.log("ForerunnerDB.OldView: Finding data in view collection...",this._data),this._data.find.apply(this._data,arguments)):[]};k.prototype.insert=function(){return this._from?this._from.insert.apply(this._from,arguments):[]};k.prototype.update=function(){return this._from?this._from.update.apply(this._from,arguments):
[]};k.prototype.remove=function(){return this._from?this._from.remove.apply(this._from,arguments):[]};k.prototype._onSetData=function(a,b){this.emit("remove",b,[]);this.emit("insert",a,[])};k.prototype._onInsert=function(a,b){this.emit("insert",a,b)};k.prototype._onUpdate=function(a,b){this.emit("update",a,b)};k.prototype._onRemove=function(a,b){this.emit("remove",a,b)};k.prototype._onChange=function(){this.debug()&&console.log("ForerunnerDB.OldView: Refreshing data");this.refresh()};c.prototype.init=
function(){this._oldViews=[];b.apply(this,arguments)};c.prototype._addOldView=function(a){void 0!==a&&(this._oldViews[a._name]=a);return this};c.prototype._removeOldView=function(a){void 0!==a&&delete this._oldViews[a._name];return this};l.prototype.init=function(){this._oldViews=[];e.apply(this,arguments)};l.prototype._addOldView=function(a){void 0!==a&&(this._oldViews[a._name]=a);return this};l.prototype._removeOldView=function(a){void 0!==a&&delete this._oldViews[a._name];return this};f.prototype.init=
function(){this._oldViews={};a.apply(this,arguments)};f.prototype.oldView=function(a){this._oldViews[a]||this.debug()&&console.log("ForerunnerDB.OldView: Creating view "+a);this._oldViews[a]=this._oldViews[a]||(new k(a)).db(this);return this._oldViews[a]};f.prototype.oldViewExists=function(a){return Boolean(this._oldViews[a])};f.prototype.oldViews=function(){var a=[],b;for(b in this._oldViews)this._oldViews.hasOwnProperty(b)&&a.push({name:b,count:this._oldViews[b].count()});return a};n.exports=k},
{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],12:[function(g,n,l){l=g("./Shared");var f=g("./Path");g=function(c){this.pathSolver=new f;this.counter=0;this.init.apply(this,arguments)};g.prototype.init=function(c){this._data={operation:c,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};l.modules.Operation=g;g.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};g.prototype.log=function(c){if(c){var b=
0<this._log.length?this._data.log[this._data.log.length-1].time:0;c={event:c,time:(new Date).getTime(),delta:0};this._data.log.push(c);b&&(c.delta=c.time-b);return this}return this._data.log};g.prototype.time=function(c){if(void 0!==c){var b=this._data.time.process,b=b[c]=b[c]||{};b.startMs?(b.stopMs=(new Date).getTime(),b.totalMs=b.stopMs-b.startMs,b.stepObj.totalMs=b.totalMs,delete b.stepObj):(b.startMs=(new Date).getTime(),b.stepObj={name:c},this._data.steps.push(b.stepObj));return this}return this._data.time};
g.prototype.flag=function(c,b){if(void 0!==c&&void 0!==b)this._data.flag[c]=b;else return void 0!==c?this._data.flag[c]:this._data.flag};g.prototype.data=function(c,b,e){return void 0!==b?(this.pathSolver.set(this._data,c,b),this):this.pathSolver.get(this._data,c)};g.prototype.pushData=function(c,b,e){this.pathSolver.push(this._data,c,b)};g.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};n.exports=g},{"./Path":14,
"./Shared":16}],13:[function(g,n,l){l=function(f){if(f){var c,b=f.length;return function(){for(c=0;c<b;c++)if(f[c].length===arguments.length)return f[c].apply(this,arguments);return null}}return function(){}};g("./Shared").modules.Overload=l;n.exports=l},{"./Shared":16}],14:[function(g,n,l){g=g("./Shared");l=function(f){this.init.apply(this,arguments)};l.prototype.init=function(f){f&&this.path(f)};g.modules.Path=l;l.prototype.path=function(f){return void 0!==f?(this._path=this.clean(f),this._pathParts=
this._path.split("."),this):this._path};l.prototype.hasObjectPaths=function(f,c){var b=!0,e;for(e in f)if(f.hasOwnProperty(e)&&(void 0===c[e]||"object"===typeof f[e]&&(b=this.hasObjectPaths(f[e],c[e]),!b)))return!1;return b};l.prototype.countKeys=function(f){var c=0,b;for(b in f)f.hasOwnProperty(b)&&void 0!==f[b]&&("object"!==typeof f[b]?c++:c+=this.countKeys(f[b]));return c};l.prototype.countObjectPaths=function(f,c){var b,e={},a=0,k=0,d;for(d in c)c.hasOwnProperty(d)&&("object"===typeof c[d]?(b=
this.countObjectPaths(f[d],c[d]),e[d]=b.matchedKeys,k+=b.totalKeyCount,a+=b.matchedKeyCount):(k++,f&&f[d]&&"object"!==typeof f[d]?(e[d]=!0,a++):e[d]=!1));return{matchedKeys:e,matchedKeyCount:a,totalKeyCount:k}};l.prototype.parse=function(f,c){var b=[],e="",a,k,d;for(k in f)if(f.hasOwnProperty(k))if(e=k,"object"===typeof f[k])if(c)for(a=this.parse(f[k],c),d=0;d<a.length;d++)b.push({path:e+"."+a[d].path,value:a[d].value});else for(a=this.parse(f[k]),d=0;d<a.length;d++)b.push({path:e+"."+a[d].path});
else c?b.push({path:e,value:f[k]}):b.push({path:e});return b};l.prototype.parseArr=function(f,c){c=c||{};return this._parseArr(f,"",[],c)};l.prototype._parseArr=function(f,c,b,e){var a,k="";c=c||"";b=b||[];for(a in f)f.hasOwnProperty(a)&&(!e.ignore||e.ignore&&!e.ignore.test(a))&&(k=c?c+"."+a:a,"object"===typeof f[a]?this._parseArr(f[a],k,b,e):b.push(k));return b};l.prototype.value=function(f,c){if(void 0!==f&&"object"===typeof f){var b,e,a,k,d=[],h;void 0!==c&&(c=this.clean(c),b=c.split("."));b=b||
this._pathParts;e=b.length;a=f;for(h=0;h<e;h++){a=a[b[h]];if(k instanceof Array){for(e=0;e<k.length;e++)d=d.concat(this.value(k,e+"."+b[h]));return d}if(!a||"object"!==typeof a)break;k=a}return[a]}return[]};l.prototype.set=function(f,c,b){if(void 0!==f&&void 0!==c){var e;c=this.clean(c);c=c.split(".");e=c.shift();c.length?(f[e]=f[e]||{},this.set(f[e],c.join("."),b)):f[e]=b}return f};l.prototype.get=function(f,c){return this.value(f,c)[0]};l.prototype.push=function(f,c,b){if(void 0!==f&&void 0!==c){var e;
c=this.clean(c);c=c.split(".");e=c.shift();if(c.length)f[e]=f[e]||{},this.set(f[e],c.join("."),b);else if(f[e]=f[e]||[],f[e]instanceof Array)f[e].push(b);else throw"Cannot push to a path whose endpoint is not an array!";}return f};l.prototype.keyValue=function(f,c){var b,e,a,k,d;void 0!==c&&(c=this.clean(c),b=c.split("."));b=b||this._pathParts;e=b.length;a=f;for(d=0;d<e;d++)if(a=a[b[d]],!a||"object"!==typeof a){k=b[d]+":"+a;break}return k};l.prototype.clean=function(f){"."===f.substr(0,1)&&(f=f.substr(1,
f.length-1));return f};n.exports=l},{"./Shared":16}],15:[function(g,n,l){l=g("./Shared");var f,c,b,e;e=function(){this.init.apply(this,arguments)};e.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};l.modules.Persist=e;l=l.modules.Core;f=g("./Collection");c=f.prototype.drop;g("./CollectionGroup");g("./Overload");b=l.prototype.init;e.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};e.prototype.save=function(a,b,c){switch(this.mode()){case "localStorage":b=
"object"===typeof b?"json::fdb::"+JSON.stringify(b):"raw::fdb::"+b;try{localStorage.setItem(a,b)}catch(e){c&&c(e)}c&&c(!1)}c&&c("No data handler.")};e.prototype.load=function(a,b){var c,e;switch(this.mode()){case "localStorage":try{c=localStorage.getItem(a)}catch(f){b(f,null)}if(c){c=c.split("::fdb::");switch(c[0]){case "json":e=JSON.parse(c[1]);break;case "raw":e=c[1]}b&&b(!1,e)}}b&&b("No data handler or unrecognised data type.")};e.prototype.drop=function(a,b){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(c){b&&
b(c)}b&&b(!1)}b&&b("No data handler or unrecognised data type.")};f.prototype.drop=function(a){if(a)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),
"Cannot drop a collection's persistent storage when no name assigned to collection!";c.apply(this)};f.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";else return a&&a("Cannot save a collection with no assigned name!"),"Cannot save a collection with no assigned name!"};f.prototype.load=function(a){var b=this;
if(this._name)if(this._db)this._db.persist.load(this._name,function(c,e){if(c)return a&&a(c),c;e&&b.setData(e);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};l.prototype.init=function(){this.persist=new e(this);b.apply(this,arguments)};n.exports=e},{"./Collection":2,"./CollectionGroup":3,
"./Overload":13,"./Shared":16}],16:[function(g,n,l){n.exports={idCounter:0,modules:{},prototypes:{}}},{}],17:[function(g,n,l){var f,c,b;l=g("./Shared");var e=function(a,b,c){this.init.apply(this,arguments)};e.prototype.init=function(a,b,c){this._name=a;this._collections=[];this._groups=[];this._listeners={};this._querySettings={query:b,options:c};this._debug={};this._privateData=new f("__FDB__view_privateData_"+this._name)};l.modules.View=e;f=g("./Collection");g=g("./Overload");c=f.prototype.init;
l=l.modules.Core;b=l.prototype.init;e.prototype.debug=new g([function(){return this._debug.all},function(a){return void 0!==a&&"boolean"===typeof a?(this._debug.all=a,this.privateData().debug(a),this.publicData().debug(a),this):this._debug.all},function(a,b){return void 0!==a?void 0!==b?(this._debug[a]=b,this.privateData().debug(a,b),this.publicData().debug(a,b),this):this._debug[a]:this._debug.all}]);e.prototype.name=function(a){return void 0!==a?(this._name=a,this):this._name};e.prototype.find=
function(a,b){return this.publicData().find(a,b)};e.prototype.insert=function(a,b,c){a=this._privateData.decouple(a);"function"===typeof b?(c=b,b=this._privateData.length):void 0===b&&(b=this._privateData.length);this._transformInsert(a,b);this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');return this._privateData._insertHandle(a,b,c)};e.prototype.update=function(a,b){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+
this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');var c=this._privateData.update(a,b),e,f,g;if(this._transformEnabled&&this._transformIn){e=this._publicData.primaryKey();for(var l=0;l<c.length;l++)f={},g=c[l],f[e]=g[e],this._transformUpdate(f,g)}return c};e.prototype.remove=function(a){this._transformRemove(a);this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+
'"');return this._privateData.remove(a)};e.prototype.link=function(a,b){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+a);return c.link(a,b)};e.prototype.unlink=function(a,b){var c=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+c.name()+'" for output target: '+
a);return c.unlink(a,b)};e.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};e.prototype._addCollection=function(a){if(-1===this._collections.indexOf(a)){this._collections.push(a);a._addView(this);var b=a.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(a.primaryKey());this._transformInsert(b);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(b)}return this};e.prototype._removeCollection=
function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a._removeView(this),this._privateData.remove(a.find(this._querySettings.query,this._querySettings.options)));return this};e.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};e.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};e.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};e.prototype.drop=function(){if(this._collections&&
this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+this._name);this.emit("drop");for(var a=this._collections.length;a--;)this._removeCollection(this._collections[a]);this._privateData.drop();return!0}return!1};e.prototype.db=function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};e.prototype.primaryKey=function(){return this._privateData.primaryKey()};e.prototype.queryData=function(a,
b,c){void 0!==a&&(this._querySettings.query=a);void 0!==b&&(this._querySettings.options=b);return void 0!==a||void 0!==b?(void 0!==c&&!0!==c||this.refresh(),this):this._querySettings};e.prototype.queryAdd=function(a,b,c){var e=this._querySettings.query,f;if(void 0!==a)for(f in a)a.hasOwnProperty(f)&&(void 0===e[f]||void 0!==e[f]&&b)&&(e[f]=a[f]);void 0!==c&&!0!==c||this.refresh()};e.prototype.queryRemove=function(a,b){var c=this._querySettings.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&
delete c[e];void 0!==b&&!0!==b||this.refresh()};e.prototype.query=function(a,b){return void 0!==a?(this._querySettings.query=a,void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.query};e.prototype.queryOptions=function(a,b){return void 0!==a?(this._querySettings.options=a,void 0===a.decouple&&(a.decouple=!0),void 0!==b&&!0!==b||this.refresh(),this):this._querySettings.options};e.prototype.refresh=function(a){var b;a=this.publicData();var c;this._privateData.remove();a.remove();for(c=0;c<
this._collections.length;c++)b=this._collections[c],this._privateData.insert(b.find(this._querySettings.query,this._querySettings.options));b=this._privateData.find({},this._querySettings.options);a._linked?jQuery.observable(a._data).refresh(b):(this._privateData._data.length=0,this._privateData._data=this._privateData._data.concat(b));return this};e.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};e.prototype.transform=function(a){return void 0!==
a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};e.prototype.privateData=function(){return this._privateData};e.prototype.publicData=function(){return this._transformEnabled?
this._publicData:this._privateData};e.prototype._transformSetData=function(a){this._transformEnabled&&(this._publicData=new f("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(a))};e.prototype._transformInsert=function(a,b){this._transformEnabled&&this._publicData&&this._publicData.insert(a,b)};e.prototype._transformUpdate=function(a,b){this._transformEnabled&&
this._publicData&&this._publicData.update(a,b)};e.prototype._transformRemove=function(a){this._transformEnabled&&this._publicData&&this._publicData.remove(a)};e.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};f.prototype.init=function(){this._views=[];c.apply(this,arguments)};f.prototype.view=function(a,b,c){a=(new e(a,b,c)).db(this._db)._addCollection(this);this._views=this._views||[];this._views.push(a);return a};f.prototype._addView=
function(a){void 0!==a&&this._views.push(a);return this};f.prototype._removeView=function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};l.prototype.init=function(){this._views={};b.apply(this,arguments)};l.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+a);this._views[a]=this._views[a]||(new e(a)).db(this);return this._views[a]};l.prototype.viewExists=function(a){return Boolean(this._views[a])};
l.prototype.views=function(){var a=[],b;for(b in this._views)this._views.hasOwnProperty(b)&&a.push({name:b,count:this._views[b].count()});return a};n.exports=e},{"./Collection":2,"./Overload":13,"./Shared":16}],18:[function(g,n,l){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(f,c,b){function e(a){return a}function a(a){debugger;return a}function g(b){ca=(va._dbgMode=b)?"Unavailable (nested view): use #getIndex()":"";wa("dbg",Ga.dbg=V.dbg=b?a:e)}function d(a){this.name=(y.link?"JsViews":
"JsRender")+" Error";this.message=a||this.name}function h(a,b){for(var c in b)a[c]=b[c];return a}function l(a){return"function"===typeof a}function n(a,b,c){if(!da.rTag||a)w=a?a.charAt(0):w,ka=a?a.charAt(1):ka,N=b?b.charAt(0):N,I=b?b.charAt(1):I,R=c||R,a="\\"+w+"(\\"+R+")?\\"+ka,b="\\"+N+"\\"+I,E="(?:(?:(\\w+(?=[\\/\\s\\"+N+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+N+"]|\\"+N+"(?!\\"+I+"))*?)",da.rTag=E+")",E=RegExp(a+E+"(\\/)?|(?:\\/(\\w+)))"+b,"g"),xa=RegExp("<.*>|([^\\\\]|^)[{}]|"+
a+".*"+b);return[w,ka,N,I,R]}function Ia(a,c){c||(c=a,a=b);var d,e,f,h;f=this;d=!c||"root"===c;if(a){if(h=f.type===c?f:b,!h)if(d=f.views,f._.useKey)for(e in d){if(h=d[e].get(a,c))break}else for(e=0,f=d.length;!h&&e<f;e++)h=d[e].get(a,c)}else if(d)for(;f.parent.parent;)h=f=f.parent;else for(;f&&!h;)h=f.type===c?f:b,f=f.parent;return h}function Q(){var a=this.get("item");return a?a.index:b}function ga(){return this.index}function ha(a){var c,d=this,e=d.linkCtx,g=(d.ctx||{})[a];g===b&&e&&e.ctx&&(g=e.ctx[a]);
g===b&&(g=Ga[a]);g&&l(g)&&!g._wrp&&(c=function(){return g.apply(this&&this!==f?this:d,arguments)},c._wrp=1,h(c,g));return c||g}function oa(a,c,d){var e,f,h=+d===d&&d,g=c.linkCtx;h&&(d=(h=c.tmpl.bnds[h-1])(c.data,c,D));e=d.args[0];if(a||h){e=g&&g.tag;e||(e={_:{inline:!g,bnd:h},tagName:":",cvt:a,flow:!0,tagCtx:d,_is:"tag"},g&&(g.tag=e,e.linkCtx=g,d.ctx=T(d.ctx,g.view.ctx)),da._lnk(e));for(f in d.props)Ma.test(f)&&(e[f]=d.props[f]);d.view=c;e.ctx=d.ctx||{};delete d.ctx;c._.tag=e;e=H(e,e.convert||"true"!==
a&&a)[0];e=h&&c._.onRender?c._.onRender(e,c,h):e;c._.tag=b}return e!=b?e:""}function H(a,b){var c=a.tagCtx,d=c.view,e=c.args;b=b&&(""+b===b?d.getRsc("converters",b)||ma("Unknown converter: '"+b+"'"):b);e=e.length||c.index?b?e.slice():e:[d.data];b&&(b.depends&&(a.depends=da.getDeps(a.depends,a,b.depends,b)),e[0]=b.apply(a,e));return e}function q(a,c){for(var d,e=this;d===b&&e;)d=(d=e.tmpl[a])&&d[c],e=e.parent;return d||D[a][c]}function p(a,c,d,e,f){var g,k,l,A,m,J,t,n,s,y,p,B="",q=+e===e&&e,F=c.linkCtx||
0,r=c.ctx,E=d||c.tmpl;"tag"===a._is&&(g=a,a=g.tagName,e=g.tagCtxs);g=g||F.tag;q&&(e=(n=E.bnds[q-1])(c.data,c,D));J=e.length;for(m=0;m<J;m++){m||d&&g||(s=c.getRsc("tags",a)||ma("Unknown tag: {{"+a+"}}"));k=e[m];F.tag||(t=k.tmpl,t=k.content=t&&E.tmpls[t-1],h(k,{tmpl:(g?g:s).template||t,render:Y,index:m,view:c,ctx:T(k.ctx,r)}));if(d=k.props.tmpl)d=""+d===d?c.getRsc("templates",d)||Ca(d):d,k.tmpl=d;g||(s._ctr?(g=new s._ctr,y=!!g.init,g.attr=g.attr||s.attr||b):da._lnk(g={render:s.render}),g._={inline:!F},
F&&(F.attr=g.attr=F.attr||g.attr,F.tag=g,g.linkCtx=F),(g._.bnd=n||F.fn)?g._.arrVws={}:g.dataBoundOnly&&ma("{^{"+a+"}} tag must be data-bound"),g.tagName=a,g.parent=A=r&&r.tag,g._is="tag",g._def=s,g.tagCtxs=e);if(!m)for(p in t=k.props)Ma.test(p)&&(g[p]=t[p]);k.tag=g;g.dataMap&&g.tagCtxs&&(k.map=g.tagCtxs[m].map);g.flow||(t=k.ctx=k.ctx||{},k=g.parents=t.parentTags=r&&T(t.parentTags,r.parentTags)||{},A&&(k[A.tagName]=A),t.tag=g)}c._.tag=g;g.rendering={};for(m=0;m<J;m++){k=g.tagCtx=g.tagCtxs[m];t=k.props;
a=H(g,g.convert);if(e=t.dataMap||g.dataMap)if(a.length||t.dataMap){A=k.map;if(!A||A.src!==a[0]||f)A&&A.src&&A.unmap(),A=k.map=e.map(a[0],t);a=[A.tgt]}g.ctx=k.ctx;!m&&y&&(e=g.template,g.init(k,F,g.ctx),y=b,g.template!==e&&(g._.tmpl=g.template));A=b;if(e=g.render)A=e.apply(g,a);a=a.length?a:[c];A=A!==b?A:k.render(a[0],!0)||(f?b:"");B=B?B+(A||""):A}delete g.rendering;g.tagCtx=g.tagCtxs[0];g.ctx=g.tagCtx.ctx;g._.inline&&(l=g.attr)&&l!==O&&(B="text"===l?V.html(B):"");return q&&c._.onRender?c._.onRender(B,
c,q):B}function m(a,b,c,d,e,f,g,h){var k="array"===b,l={key:0,useKey:k?0:1,id:""+La++,onRender:h,bnds:{}};this.data=d;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=c;this.type=b;this._=l;this.linked=!!h;c?(b=c.views,d=c._,d.useKey?(b[l.key="_"+d.useKey++]=this,this.index=ca,this.getIndex=Q,f=d.tag,l.bnd=k&&(!f||!!f._.bnd&&f)):b.splice(l.key=this.index=f,0,this),this.ctx=a||c.ctx):this.ctx=a}function r(a){var b,c,d,e,f,g;for(b in K)if(e=K[b],(f=e.compile)&&(c=a[b+"s"]))for(d in c)(e=c[d]=
f(d,c[d],a))&&(g=da.onStore[b])&&g(d,e,f)}function Ja(a,c,d){l(c)?c={depends:c.depends,render:c}:(c.baseTag&&(c.flow=!!c.flow,c=h(h({},c.baseTag),c)),(a=c.template)!==b&&(c.template=""+a===a?Ca[a]||Ca(a):a),!1!==c.init&&(a=c._ctr=function(){},(a.prototype=c).constructor=a));d&&(c._parentTmpl=d);return c}function X(a,d,e,g){function h(d){if(""+d===d||0<d.nodeType){try{l=0<d.nodeType?d:!xa.test(d)&&c&&c(f.document).find(d)[0]}catch(k){}l&&(d=Ca[a=a||l.getAttribute(ea)],d||(a=a||"_"+fa++,l.setAttribute(ea,
a),d=Ca[a]=X(a,l.innerHTML,e,g)),l=b);return d}}var k,l;d=d||"";k=h(d);g=g||(d.markup?d:{});g.tmplName=a;e&&(g._parentTmpl=e);!k&&d.markup&&(k=h(d.markup))&&k.fn&&(k.debug!==d.debug||k.allowCode!==d.allowCode)&&(k=k.markup);if(k!==b)return a&&!e&&(v[a]=function(){return d.render.apply(d,arguments)}),k.fn||d.fn?k.fn&&(d=a&&a!==k.tmplName?T(g,k):k):(d=Ha(k,g),qa(k.replace(z,"\\$&"),d)),r(g),d}function ba(a){function b(c,d){this.tgt=a.getTgt(c,d)}l(a)&&(a={getTgt:a});a.baseMap&&(a=h(h({},a.baseMap),
a));a.map=function(a,c){return new b(a,c)};return a}function Ha(a,b){var c,d=va.wrapMap||{},e=h({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:Da},b);b.htmlTag||(c=Z.exec(a),e.htmlTag=c?c[1].toLowerCase():"");(c=d[e.htmlTag])&&c!==d.div&&(e.markup=y.trim(e.markup));return e}function W(a,c){function d(f,g,h){var k,l,A;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&!f.getTgt){for(l in f)d(l,f[l],g);return D}g===b&&(g=f,f=b);f&&""+f!==f&&(h=g,g=f,f=b);A=h?h[e]=h[e]||{}:d;l=c.compile;
null===g?f&&delete A[f]:(g=l?g=l(f,g,h):g,f&&(A[f]=g));l&&g&&(g._is=a);g&&(k=da.onStore[a])&&k(f,g,l);return g}var e=a+"s";D[e]=d;K[a]=c}function za(a,b){var c=this.jquery&&(this[0]||ma('Unknown template: "'+this.selector+'"')),d=c.getAttribute(ea);return Da.call(d?Ca[d]:Ca(c),a,b)}function sa(a,b,c){if(va._dbgMode)try{return a.fn(b,c,D)}catch(d){return ma(d,c)}return a.fn(b,c,D)}function Da(a,b,c,d,e,f){return d||!this.fn._nvw||y.isArray(a)?Y.call(this,a,b,c,d,e,f):sa(this,a,{tmpl:this})}function Y(a,
c,d,e,f,g){var h,k,l,A,J,t,s,n,B;l=this;var p="";!!c===c&&(d=c,c=b);!0===f&&(h=!0,f=0);l.tag?(t=l,l=l.tag,k=l._,J=l.tagName,n=k.tmpl||t.tmpl,B=l.attr&&l.attr!==O,c=T(c,l.ctx),s=t.content,!1===t.props.link&&(c=c||{},c.link=!1),e=e||t.view,a=arguments.length?a:e):n=l;if(n&&(!e&&a&&"view"===a._is&&(e=a),e&&(s=s||e.content,g=g||e._.onRender,a===e&&(a=e.data),c=T(c,e.ctx)),e&&e.data!==b||((c=c||{}).root=a),n.fn||(n=Ca[n]||Ca(n)),n)){t=g=!1!==(c&&c.link)&&!B&&g;!0===g&&(t=b,g=e._.onRender);c=n.helpers?
T(n.helpers,c):c;if(y.isArray(a)&&!d)for(A=h?e:f!==b&&e||new m(c,"array",e,a,n,f,s,g),h=0,k=a.length;h<k;h++)l=a[h],J=new m(c,"item",A,l,n,(f||0)+h,s,g),l=sa(n,l,J),p+=A._.onRender?A._.onRender(l,J):l;else{if(e||!n.fn._nvw)A=h?e:new m(c,J||"data",e,a,n,f,s,g),k&&!l.flow&&(A.tag=l);p+=sa(n,a,A)}return t?t(p,A):p}return""}function ma(a,b,c){c=va.onError(a,b,c);if(""+a===a)throw new da.Err(c);return!b.linkCtx&&b.linked?V.html(c):c}function P(a){ma("Syntax error\n"+a)}function qa(a,b,c,d){function e(b){(b-=
t)&&n.push(a.substr(t,b).replace(la,"\\n"))}function f(b){b&&P('Unmatched or missing tag: "{{/'+b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,m=[],t=0,T=[],n=m,s=[,,m];c&&(a=w+a+I);f(T[0]&&T[0][2].pop()[0]);a.replace(E,function(g,m,J,p,B,y,F,q,r,E,v,w){y&&(B=":",p=O);E=E||c;m=(m||c)&&[];var D="",C="",ta="",Aa="",na="",Ka="",Na="",Wa="";F=!E&&!B&&!F;J=J||(r=r||"#data",B);e(w);t=w+g.length;q?l&&n.push(["*","\n"+r.replace(ja,"$1")+"\n"]):J?("else"===J&&(U.test(r)&&P('for "{{else if expr}}" use "{{else expr}}"'),
m=s[7],s[8]=a.substring(s[8],w),s=T.pop(),n=s[2],F=!0),r&&A(r.replace(la," "),m,b).replace(G,function(a,b,c,d,e,f,g,h){g?(C+=f+",",Aa+="'"+h+"',"):c?(ta+=d+f+",",Ka+=d+"'"+h+"',"):b?Na+=f:("trigger"===e&&(Wa+=f),D+=d+f+",",na+=d+"'"+h+"',",k=k||Ma.test(e));return""}).slice(0,-1),h=[J,p||!!d||k||"",F&&[],[Aa.slice(0,-1),na.slice(0,-1),Ka.slice(0,-1)],[C.slice(0,-1),D.slice(0,-1),ta.slice(0,-1)],Na,Wa,m||0],n.push(h),F&&(T.push(s),s=h,s[8]=t)):v&&(f(v!==s[0]&&"else"!==s[0]&&v),s[8]=a.substring(s[8],
w),s=T.pop());f(!s&&v);n=s[2]});e(a.length);(t=m[m.length-1])&&f(""+t!==t&&+t[8]===t[8]&&t[0]);c?(g=J(m,a,c),g.paths=m[0][7]):g=J(m,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Fa(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function A(a,b,c){var d,e,f,g,h,k=0,l=c?c.links:b&&(b.links=b.links||{}),A={},m={0:-1},t=0;return(a+(c?" ":"")).replace(/\)\^/g,").").replace(Ea,function(J,T,s,n,p,B,y,F,q,r,E,v,w,D,z,C,ta,Aa,
na,Ka){function Na(a,c,C,g,h,ta,Aa,k){return C&&(b&&("linkTo"===d&&(e=b._jsvto=b._jsvto||[],e.push(p)),d&&!f||b.push(p.slice(c.length))),"."!==C)?(a=(g?'view.hlp("'+g+'")':h?"view":"data")+(k?(ta?"."+ta:g?"":h?"":"."+C)+(Aa||""):(k=g?"":h?ta||"":C,"")),a+=k?"."+k:"",c+("view.data"===a.slice(0,9)?a.slice(5):a)):a}B=B||"";s=s||T||v;p=p||q;r=r||ta||"";if(!y||h||g)return!b||!C||h||g||d&&!f&&!e||(C=m[t],Ka.length-1>na-C&&(C=Ka.slice(C,na+1),C=ka+":"+C+N,y=l[C],y||(l[C]=1,l[C]=y=qa(C,c||b,!0),y.paths.push({_jsvOb:y})),
1!==y&&(e||b).push({_jsvOb:y}))),h?(h=!w,h?J:'"'):g?(g=!D,g?J:'"'):(s?(t++,m[t]=na++,s):"")+(Aa?t?"":(k=Ka.slice(k,na),d?(d=f=e=!1,"\b"):"\b,")+k+(k=na+J.length,"\b"):F?(t&&P(a),d=p,f=n,k=na+J.length,p+":"):p?p.split("^").join(".").replace(aa,Na)+(r?(A[++t]=!0,"."!==p.charAt(0)&&(m[t]=na),r):B):B?B:z?(A[t--]=!1,z)+(r?(A[++t]=!0,r):""):E?(A[t]||P(a),","):T?"":(h=w,g=D,'"'));P(a)})}function J(a,b,d){var e,f,g,h,k,l,A,m,t,T,s,n,p,y,B,F,q,r,E,v,w,D,z,N,I=0,C="",ta={},Aa=a.length;""+b===b?(B=d?'data-link="'+
b.replace(la," ").slice(1,-1)+'"':b,b=0):(B=b.tmplName||"unnamed",b.allowCode&&(ta.allowCode=!0),b.debug&&(ta.debug=!0),s=b.bnds,y=b.tmpls);for(e=0;e<Aa;e++)if(f=a[e],""+f===f)C+='\n+"'+f+'"';else if(g=f[0],"*"===g)C+=";\n"+f[1]+"\nret=ret";else{h=f[1];r=f[2];k=Fa(f[3],"params")+"},"+Fa(p=f[4]);z=f[5];N=f[6];E=f[8];(w="else"===g)||(I=0,s&&(n=f[7])&&(I=s.push(n)));(f=":"===g)?h&&(g=h===O?">":h+g):(r&&(F=Ha(E,ta),F.tmplName=B+"/"+g,J(r,F),y.push(F)),w||(q=g,v=C,C=""),F=(F=a[e+1])&&"else"===F[0]);w=
z?";\ntry{\nret+=":"\n+";if(f&&(n||N||h&&h!==O)){D="return {"+k+"};";z&&(D="try {\n"+D+"\n}catch(e){return {error: j._err(e,view,"+z+")}}\n");D=new Function("data,view,j,u"," // "+B+" "+I+" "+g+"\n"+D);D.paths=n;D._tag=g;if(d)return D;T=1}C+=f?(d?(z?"\ntry{\n":"")+"return ":w)+(T?(T=0,t=m=!0,'c("'+h+'",view,'+(n?(s[I-1]=D,I):"{"+k+"}")+")"):">"===g?(A=!0,"h("+p[0]+")"):"((v="+p[0]+')!=null?v:"")'):(t=l=!0,"\n{view:view,tmpl:"+(r?y.length:"0")+","+k+"},");if(q&&!F){C="["+C.slice(0,-1)+"]";if(d||n)if(C=
new Function("data,view,j,u"," // "+B+" "+I+" "+q+"\nreturn "+C+";"),n&&((s[I-1]=C).paths=n),C._tag=g,d)return C;C=v+w+'t("'+q+'",view,this,'+(I||C)+")";q=n=0}z&&(t=!0,C+=";\n}catch(e){ret"+(d?"urn ":"+=")+"j._err(e,view,"+z+");}\n"+(d?"":"ret=ret"))}C="// "+B+"\nj=j||"+(c?"jQuery.":"jsviews.")+"views;var v"+(l?",t=j._tag":"")+(m?",c=j._cnvt":"")+(A?",h=j.converters.html":"")+(d?";\n":',ret=""\n')+(ta.debug?"debugger;":"")+C+(d?"\n":";\nreturn ret;");try{C=new Function("data,view,j,u",C)}catch(na){P("Compiled template code:\n\n"+
C+'\n: "'+na.message+'"')}b&&(b.fn=C);t||(C._nvw=!0);return C}function T(a,b){return a&&a!==b?b?h(h({},b),a):a:b&&h({},b)}function t(a){return ia[a]||(ia[a]="&#"+a.charCodeAt(0)+";")}function B(a){var b,c,d=[];if("object"===typeof a)for(b in a)(c=a[b])&&c.toJSON&&!c.toJSON()||l(c)||d.push({key:b,prop:c});return d}function F(a){return null!=a?M.test(a)&&(""+a).replace(ra,t)||a:""}if(!(c&&c.render||f.jsviews)){var y,s,E,xa,ca,w="{",ka="{",N="}",I="}",R="^",aa=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,
Ea=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,la=/[ \t]*(\r\n|\n|\r)/g,ja=/\\(['"])/g,z=/['"\\]/g,G=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,U=/^if\s/,Z=/<(\w+)[>\s]/,M=/[\x00`><\"'&]/,Ma=/^on[A-Z]|^convert(Back)?$/,ra=/[\x00`><"'&]/g,fa=0,La=0,ia={"&":"&amp;","<":"&lt;",">":"&gt;",
"\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},O="html",ea="data-jsv-tmpl",v={},K={template:{compile:X},tag:{compile:Ja},helper:{},converter:{}},D={jsviews:"v1.0.0-beta",settings:function(a){h(va,a);g(va._dbgMode);va.jsv&&va.jsv()},sub:{View:m,Err:d,tmplFn:qa,cvt:H,parse:A,extend:h,syntaxErr:P,onStore:{},_lnk:e},map:ba,_cnvt:oa,_tag:p,_err:ma};(d.prototype=Error()).constructor=d;Q.depends=function(){return[this.get("item"),"index"]};ga.depends=function(){return["index"]};m.prototype={get:Ia,getIndex:ga,
getRsc:q,hlp:ha,_is:"view"};for(s in K)W(s,K[s]);var Ca=D.templates,V=D.converters,Ga=D.helpers,wa=D.tags,da=D.sub,va=D.settings;c?(y=c,y.fn.render=za,y.observable&&(h(da,y.views.sub),D.map=y.views.map)):(y=f.jsviews={},y.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});y.render=v;y.views=D;y.templates=Ca=D.templates;va({debugMode:g,delimiters:n,onError:function(a,c,d){c&&(a=d===b?"{Error: "+a+"}":l(d)?d(a,c):d);return a==b?"":a},_dbgMode:!0});
wa({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,b,c){var d;for(a=0;(d=this.tagCtxs[a])&&d.args.length;a++)if(d=d.args[0],b=!d!==!c[a].args[0],!this.convert&&d||b)return b;return!1},flow:!0},"for":{render:function(a){var c,d=this.tagCtx,e="",f=0;if(!this.rendering.done){if(c=!arguments.length)a=d.view.data;a!==
b&&(e+=d.render(a,c),f+=y.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=d.index}return e},flow:!0},include:{flow:!0},"*":{render:e,flow:!0}});wa("props",{baseTag:wa["for"],dataMap:ba(B)});V({html:F,attr:F,url:function(a){return a!=b?encodeURI(""+a):null===a?a:""}});n()}})(this,this.jQuery);(function(f,c,b){function e(b){return r(b)?new g(b):new a(b)}function a(a){this._data=a;return this}function g(a){this._data=a;return this}function d(a,b){a=r(a)?a:[a];var c,e,f=b,g=f,h=a.length,
k=[];for(c=0;c<h;c++)e=a[c],Y(e)?k=k.concat(d(e.call(b,b),b)):""+e!==e?(b=g=e,g!==f&&k.push(f=g)):(g!==f&&k.push(f=g),k.push(e));return k}function h(a,b){var c,d;for(c in a){d=!0;break}d||delete sa[b]}function l(a,c){if(!a.data||!a.data.off){var d,e,f,g=c.oldValue,h=c.value,k=a.data,m=k.observeAll,n=!k.cb.noArray,p=k.paths;if(a.type===za)(k.cb.array||k.cb).call(k,a,c);else if(k.prop===c.path||"*"===k.prop)g=typeof g===X&&(p[0]||n&&r(g))&&g,h=typeof(h=c.value)===X&&(p[0]||n&&r(h))&&h,m?(d=m._path+
"."+c.path,e=m.filter,f=[m.parents().slice()],g&&Q(n,m.ns,[g],p,k.cb,!0,e,f,d),h&&Q(n,m.ns,[h],p,k.cb,b,e,f,d)):(g&&Q(n,[g],p,k.cb,!0),h&&Q(n,[h],p,k.cb)),k.cb(a,c)}}function n(){function a(b,d,e,f){var g,h=qa(v),k=r(v)?[v]:v;b=M?b+"."+M:b;if(ca||f)h&&c(k).off(b,l);else{if(R=h&&c._data(v))for(N=(R=(R=R&&R.events)&&R[e?za:W])&&R.length;N--;)if((I=R[N].data)&&I.cb._cId===w._cId&&I.ns===M){if(e)return;("*"===d&&I.prop!==d||I.prop===s)&&c(v).off(b,l)}d=e?{}:{fullPath:E,paths:d?[d]:[],prop:s};d.ns=M;d.cb=
w;U&&(d.observeAll={_path:U,path:function(){g=G.length;return U.replace(/[[.]/g,function(a){g--;return"["===a?"["+c.inArray(G[g-1],G[g]):"."})},parents:function(){return G},filter:Z,ns:M});c(k).on(b,null,d,l);la&&(la[c.data(v,"obId")||c.data(v,"obId",ma++)]=v)}}function f(a,b){a._ob=aa(a,ea);var c=ea;return function(d,e){var f=a._ob,h=b.length;typeof f===X&&(g(f,!0),(h||fa&&r(f))&&Q(fa,[f],b,w,aa,!0));f=a._ob=aa(a,c);typeof f===X&&(g(f),(h||fa&&r(f))&&Q(fa,[f],b,w,aa,[c]));w(d,e)}}function g(c,d,
f,h){if(fa){var k=v,l=U;v=c;h&&(v=c[h],U+="."+h,Z&&(v=e._fltr(h,c,U,Z)));v&&(f||r(v))&&a(za+".observe"+(w?".obs"+(ka=w._cId=w._cId||P++):""),b,!0,d);v=k;U=l}}var k,p,q,y,s,E,H,ca,w,ka,N,I,R,aa,ba,la,ja,z,G,U,Z,M,ga,ha,fa=!1!=this,oa=1,ia=Da,O=Array.apply(0,arguments);k=O.pop();var ea=O.shift(),v=z=ea,K=O.length;ea+""===ea&&fa&&(M=ea,ea=v=z=O.shift(),K--);if(Y(k))w=k;else if(k+""===k&&(U=k,G=O.pop(),Z=O.pop(),k=O.pop(),K-=3),!0===k?ca=k:k&&(ea=k,oa=0),k=O[K-1],K&&k===b||Y(k))w=O.pop(),K--;K&&Y(O[K-
1])&&(aa=w,w=O.pop(),K--);ia+=ca?w?".obs"+w._cId:"":".obs"+(ka=w._cId=w._cId||P++);ca||(la=sa[ka]=sa[ka]||{});ga=M&&M.match(Ha)||[""];for(ha=ga.length;ha--;)for(M=ga[ha],r(z)?g(z,ca,!0):ca&&0===K&&z&&a(ia,""),k=ja=0;k<K;k++)if(E=O[k],""!==E){v=z;if(""+E===E){y=E.split("^");y[1]&&(ja=y[0].split(".").length,E=y.join("."),ja=E.split(".").length-ja);if(aa&&(ba=aa(E,z))){K+=ba.length-1;m.apply(O,[k--,1].concat(ba));continue}y=E.split(".")}else oa&&!Y(E)&&(E._jsvOb&&(z=f(E,O.slice(k+1)),z.noArray=!fa,z._cId=
w._cId,Q(fa,[ea],O.slice(0,k),z,aa),z=b,E=E._ob),v=E),z=E,y=[z];for(;v&&(s=y.shift())!==b;)if(typeof v===X){if(""+s===s){if(""===s)continue;if(y.length<ja+1&&!v.nodeType){if(!ca&&(R=qa(v)&&c._data(v))){N=(R=(R=R.events)&&R[W])&&R.length;for(q=0;N--;)!(I=R[N].data)||I.cb!==w||I.ns!==M||I.prop!==s&&"*"!==I.prop||((p=y.join("."))&&I.paths.push(p),q++);if(q){v=v[s];continue}}if("*"===s){!ca&&R&&R.length&&a(ia,"",!1,!0);Y(v)?(H=v.depends)&&Q(fa,[H],w,ca||ea):a(ia,"");for(p in v)g(v,ca,b,p);break}else s&&
a(ia+"."+s,y.join("."))}U&&(U+="."+s);s=v[s]}if(Y(s)){(H=s.depends)&&Q(fa,[v],d(H,v),w,aa,ca||[ea]);break}v=s}g(v,ca)}ka&&h(la,ka);return{cbId:ka,bnd:la}}function Ia(){[].push.call(arguments,!0);return n.apply(this,arguments)}function Q(){var a=[].concat.apply([],arguments);return n.apply(a.shift(),a)}function ga(a,b,c,d){a+""!==a&&(c=b,b=a,a="");oa(a,this._data,b,c,[],"root",d)}function ha(a,b,c){ga.call(this,a,b,c,!0)}function oa(a,c,d,f,g,h,k){function l(b,c){p=b.length;for(w=h+"[]";p--;)(H=e._fltr(p,
b,w,f))&&oa(a,H,d,f||"",g.slice(),w,c)}function m(b,c){h=b.data.observeAll._path;var e=g;g[0]!==b.target&&(g=g.slice(),g.unshift(b.target));switch(c.change){case "insert":l(c.items);break;case "remove":l(c.items,!0);break;case "refresh":l(c.oldItems,!0);l(b.target);break;case "set":w=h+"."+c.path,oa(a,c.oldValue,d,0,g.slice(),w,!0),oa(a,c.value,d,0,g.slice(),w)}d.apply(this,arguments);g=e}var p,q,w,H;if(typeof c===X){q=r(c)?"":"*";g.unshift(c);if(d){if(q||0!==f)m._cId=d._cId=d._cId||P++,n(a,c,q,m,
k,f,g.slice(),h)}else n(a,c,q,b,k,f,g.slice(),h);if(q)for(p in c)"_"!==p.charAt(0)&&p!==Ja&&(w=h+"."+p,(H=e._fltr(p,c,w,f))&&oa(a,H,d,f||0,g.slice(),w,k));else l(c,k)}}function H(a,b,c){return 0>c.indexOf(".")&&0>c.indexOf("[")&&b[a]}if(!c)throw"jsViews/jsObservable require jQuery";if(!c.observable){f=c.views=c.views||{jsviews:"v1.0.0-alpha",sub:{}};var q=f.sub,p=c.event.special,m=[].splice,r=c.isArray,Ja=c.expando,X="object",ba=parseInt,Ha=/\S+/g,W=q.propChng=q.propChng||"propertyChange",za=q.arrChng=
q.arrChng||"arrayChange",sa=q._cbBnds=q._cbBnds||{},Da=W+".observe",Y=c.isFunction,ma=1,P=1,qa=c.hasData,Fa={};q.getDeps=function(){var a=arguments;return function(){for(var b,c,d=[],e=a.length;e--;)b=a[e--],(c=a[e])&&(d=d.concat(Y(c)?c(b,b):c));return d}};c.observable=e;e._fltr=function(a,b,c,d){(a=d&&Y(d)?d(a,b,c):b[a])&&(a=Y(a)?a.set&&a.call(b):a);return typeof a===X&&a};e.Object=a;e.Array=g;c.observe=e.observe=n;c.unobserve=e.unobserve=Ia;e._apply=Q;a.prototype={_data:null,observeAll:ga,unobserveAll:ha,
data:function(){return this._data},setProperty:function(a,c,d){var e,f=this._data;a=a||"";if(f)if(r(a))for(e=a.length;e--;)c=a[e],this.setProperty(c.name,c.value,d===b||d);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],c);else if(a!==Ja){for(a=a.split(".");f&&1<a.length;)f=f[a.shift()];f&&this._setProperty(f,a[0],c,d)}return this},removeProperty:function(a){this.setProperty(a,Fa);return this},_setProperty:function(a,c,d,e){var f,g,h,k=c?a[c]:a;Y(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));
if(k!==d||e&&k!=d)if(!(k instanceof Date)||k>d||k<d)f?(f.call(a,d),d=g.call(a)):(h=d===Fa)?(delete a[c],d=b):c&&(a[c]=d),this._trigger(a,{change:"set",path:c,value:d,oldValue:k,remove:h})},_trigger:function(a,b){c(a).triggerHandler(W,b)}};g.prototype={_data:null,observeAll:ga,unobserveAll:ha,data:function(){return this._data},insert:function(a,b){var c=this._data;1===arguments.length&&(b=a,a=c.length);a=ba(a);-1<a&&a<=c.length&&(b=r(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,
b){var c=this._data,d=c.length;m.apply(c,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},d)},remove:function(a,c){var d;d=this._data;a===b&&(a=d.length-1);a=ba(a);c=c?ba(c):0===c?0:1;-1<c&&-1<a&&(d=d.slice(a,a+c),(c=d.length)&&this._remove(a,c,d));return this},_remove:function(a,b,c){var d=this._data,e=d.length;d.splice(a,b);this._trigger({change:"remove",index:a,items:c},e)},move:function(a,b,c){c=c?ba(c):0===c?0:1;a=ba(a);b=ba(b);if(0<c&&-1<a&&-1<b&&a!==b){var d=this._data.slice(a,
a+c);(c=d.length)&&this._move(a,b,c,d)}return this},_move:function(a,b,c,d){var e=this._data,f=e.length;e.splice(a,c);e.splice.apply(e,[b,0].concat(d));this._trigger({change:"move",oldIndex:a,index:b,items:d},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,b){var c=this._data,d=c.length;m.apply(c,[0,c.length].concat(b));this._trigger({change:"refresh",oldItems:a},d)},_trigger:function(a,b){var d=this._data,e=d.length,d=c([d]);d.triggerHandler(za,
a);e!==b&&d.triggerHandler(W,{change:"set",path:"length",value:e,oldValue:b})}};p[W]=p[za]={remove:function(a){var b,d,e,f,g=a.data;if(g&&(g.off=1,g=g.cb)&&(b=sa[g._cId])){a=c._data(this).events[a.type];for(e=a.length;e--&&!d;)d=(f=a[e].data)&&f.cb===g;d||(delete b[c.data(this,"obId")],h(b,g._cId))}}};f.map=function(a){function d(b,c,f){var g,h=this;this.src&&this.unmap();"object"===typeof b&&(h.src=b,h.tgt=f||h.tgt||[],h.options=c||h.options,h.update(),a.obsSrc&&e(h.src).observeAll(h.obs=function(b,
c){g||(g=1,a.obsSrc(h,b,c),g=0)},h.srcFlt),a.obsTgt&&e(h.tgt).observeAll(h.obt=function(b,c){g||(g=1,a.obsTgt(h,b,c),g=0)},h.tgtFlt))}(d.prototype={srcFlt:a.srcFlt||H,tgtFlt:a.tgtFlt||H,update:function(b){c.observable(this.tgt).refresh(a.getTgt(this.src,this.options=b||this.options))},unmap:function(){this.src&&(this.obs&&c.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&c.observable(this.tgt).unobserveAll(this.obt,this.tgtFlt),this.src=b)},map:d,_def:a}).constructor=d;Y(a)&&(a=
{getTgt:a});a.baseMap&&(a=c.extend({},a.baseMap,a));a.map=function(a,b,c){return new d(a,b,c)};return a}}})(this,this.jQuery);(function(f,c,b){function e(a,d,e){var f,g,h,k,m,n,p,q,r,x=a.target,s=x._jsvBnd,u=/&(\d+)\+?/g;if(s)for(;h=u.exec(s);)if(h=Ba[h[1]])if(d=h.to){h=h.linkCtx;p=h.view;r=h.tag;n=c(x);m=p.hlp(K);q=p.hlp(D);g=l(x);f=Qa[g];e===b&&(e=M(g)?g(x):f?n[f]():n.attr(g));f=d[1];d=d[0];f&&(k=M(f)?f:p.getRsc("converters",f));k&&(e=k.call(r,e));f=p.linkCtx;p.linkCtx=h;g={change:"change",oldValue:h._val,
value:e};if(!(m&&!1===m.call(h,a,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(a,g)||e===b)&&(m=d[0],e!==b&&m)){m=m._jsvOb?m._ob:m;r&&(r._.chging=!0);fa(m).setProperty(d[2]||d[1],e);q&&q.call(h,a,g);if(r){if(r.onAfterChange)r.onAfterChange(a,g);delete r._.chging}h._val=e}p.linkCtx=f}}function a(a,d,e){var f,h,m,n=this.data,p=this.elem,q=this.convert;h=p.parentNode;var r=this.view,s=r.linkCtx,t=r.hlp(K);r.linkCtx=this;if(h&&!(t&&d&&!1===t.call(this,a,d)||d&&"*"!==a.data.prop&&a.data.prop!==d.path)){d&&
(this.eventArgs=d);if(d||this._initVal){delete this._initVal;h=e.call(r.tmpl,n,r,z);a:{var x=h,w=m=this.tag;f=this.attr||l(p,!0,q!==b);var u,y,v=w&&w.parentElem||this.elem;if(x!==b){y=c(v);f=w&&w.attr||f;M(x)&&ka(this.expr+": missing parens");"visible"===f&&(f="css-display");if(w=/^css-/.test(f)&&f.slice(4))u=c.style(v,w),+x===x&&(u=parseInt(u));else if("link"!==f){if("value"===f)v.type===Ga&&(u=y.prop(f=V));else if(f===wa)if(v.value===""+x)u=y.prop(V);else break a;u===b&&(u=(u=Qa[f])?y[u]():y.attr(f))}this._val=
u}}if(h&&h.error!==b)h=h.error;else if(m){h=h[0]?h:[h];e=d&&m.onUpdate&&!1===m.onUpdate(a,d,h);sa(m,h);if(e||f===da){f===pa&&m.onBeforeLink&&m.onBeforeLink();ba(m,m.tagCtx);Q(this,n,p);r.linkCtx=s;return}if(m._.chging)return;h=":"===m.tagName?z._cnvt(m.cvt,r,h[0]):z._tag(m,r,r.tmpl,h,!0)}else e._tag&&(h=(q=""===q?va:q)?z._cnvt(q,r,h):z._tag(e._tag,r,r.tmpl,h,!0),m=this.tag,f=this.attr||f);g(h,this,f,m)&&d&&(t=r.hlp(D))&&t.call(this,a,d);m&&ba(m,m.tagCtx)}Q(this,n,p);r.linkCtx=s}}function g(a,d,e,
h){var k,l,m,n,p,r,q=a!==b,s=d.data,x=h&&h.parentElem||d.elem,t=c(x),u=d.view;r=d._val;var w=u.ctx,y=u.linkCtx,v=h||e===pa;h&&(h.parentElem=h.parentElem||d.expr||h._elCnt?x:x.parentNode,l=h._prv,m=h._nxt);if(q){if(/^css-/.test(e))"visible"===d.attr&&(d=(x.currentStyle||db.call(f,x,"")).display,a?(a=x._jsvd||d,a!==da||(a=ab[k=x.nodeName])||(d=ja.createElement(k),ja.body.appendChild(d),a=ab[k]=(d.currentStyle||db.call(f,d,"")).display,ja.body.removeChild(d))):(x._jsvd=d,a=da)),(v=v||r!==a)&&c.style(x,
e.slice(4),a);else if("link"!==e){if(e===V)p=1,a=a&&"false"!==a;else if(e===wa)if(x.value===""+a)a=!0,p=1,e=V;else{Q(d,s,x);return}else if("selected"===e||"disabled"===e||"multiple"===e||"readonly"===e)a=a&&"false"!==a?e:null;if(k=Qa[e])if(e===pa){u.linkCtx=d;u.ctx=d.ctx;if(h&&h._.inline){e=h.nodes(!0);if(h._elCnt){if(l&&l!==m)A(l,m,x,h._tgId,"^",!0);else if(n=x._dfr)r=h._tgId+"^",k=n.indexOf("#"+r)+1,p=n.indexOf("/"+r),k&&0<p&&(k+=r.length,p>k&&(x._dfr=n.slice(0,k)+n.slice(p),J(n.slice(k,p))));l=
l?l.previousSibling:m?m.previousSibling:x.lastChild}c(e).remove();if(h&&h.onBeforeLink)h.onBeforeLink();n=u.link(u.data,x,l,m,a,h&&{tag:h._tgId,lazyLink:h.tagCtx.props.lazyLink})}else{q&&t.empty();if(h&&h.onBeforeLink)h.onBeforeLink();q&&(n=u.link(s,x,l,m,a,h&&{tag:h._tgId}))}u.linkCtx=y;u.ctx=w}else{if(v=v||r!==a)if("text"===e&&x.children&&!x.children[0])x.textContent!==b?x.textContent=a:x.innerText=null===a?"":a;else t[k](a)}else if(v=v||r!==a)t[p?"prop":"attr"](e,a!==b||p?a:null);d._val=a}return n||
v}if(e===pa&&h&&h.onBeforeLink)h.onBeforeLink()}function d(a,b){var c=this.hlp(K),d=this.hlp(D);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,e=b.items;switch(b.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,a,b)}}function h(a){var e,f=a.data,g=a._.bnd;if(!a._.useKey&&g){if(e=a._.bndArr)c([e[1]]).off(ea,e[0]),a._.bndArr=b;g!==!!g&&g._.inline?f?g._.arrVws[a._.id]=a:delete g._.arrVws[a._.id]:
f&&(e=function(b){b.data&&b.data.off||d.apply(a,arguments)},c([f]).on(ea,e),a._.bndArr=[e,f])}}function l(a,b,c){var d=a.nodeName.toLowerCase(),e=U.merge[d]||a.contentEditable===va&&{to:pa,from:pa};return e?b?"input"===d&&a.type===wa?wa:e.to:e.from:b?c?"text":pa:""}function n(a,d,e,f,g,h,k){var l,m,p,r=a.parentElem,q=a._prv,s=a._nxt,t=a._elCnt;q&&q.parentNode!==r&&ka("Missing parentNode");if(k)for(p in m=a.nodes(),t&&q&&q!==s&&A(q,s,r,a._.id,"_",!0),a.removeViews(b,b,!0),f=s,t&&(q=q?q.previousSibling:
s?s.previousSibling:r.lastChild),c(m).remove(),a._.bnds)Y(p);else{if(d){l=f[d-1];if(!l)return!1;q=l._nxt}t?q=(f=q)?f.previousSibling:r.lastChild:f=q.nextSibling}d=e.render(g,h,a._.useKey&&k,a,k||d,!0);a.link(g,r,q,f,d,l)}function Ia(a,c,d){var e;d?(e="^`",c=c._.tag||{_:{inline:!0,bnd:d},tagCtx:{view:c},flow:!0},d=c._tgId,d||(Ba[d=bb++]=c,c._tgId=""+d)):(e="_`",la[d=c._.id]=c);return"#"+d+e+(a!=b?a:"")+"/"+d+e}function Q(a,c,d){var e,f=a.tag,g=a.convertBack,h=[],k=a._bndId||""+bb++,l=a._hdlr;delete a._bndId;
f&&(h=f.depends||h,h=M(h)?f.depends(f):h,e=f.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&fa._apply(!1,[c],a._depends,l,!0),c=fa._apply(!1,[c],a.fn.paths,h,l,a._ctxCb),c.elem=d,c.linkCtx=a,c._tgId=k,d._jsvBnd=d._jsvBnd||"",d._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Ba[k]=c,e&&(c.to=[[],g]),(e||g!==b)&&za(c,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(c);f.flow||f._.inline||(d.setAttribute(ia,(d.getAttribute(ia)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&
(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||d._jsvBnd+"+",e[a]._jsvLnkdEl=f}function ga(a,b,c,d,e,f,g){return ha(this,a,b,c,d,e,f,g)}function ha(a,d,f,g,h,k,l,m){if(a&&d){d=d.jquery?d:c(d);F||(F=ja.body,c(F).on(v,e).on("blur","[contenteditable]",e));for(var n,p,q,s,x,t,u,w=Ia,z=g&&"replace"===g.target,A=d.length;A--;)if(u=d[A],""+a===a)x=y(u),n=x.ctx,x.ctx=g,H(a,u,x,f),x.ctx=n;else{k=k||y(u);if(a.markup!==b)!1===k.link&&(g=g||{},g.link=w=!1),z&&(t=u.parentNode),
q=a.render(f,g,h,k,b,w),t?(l=u.previousSibling,m=u.nextSibling,c.cleanData([u],!0),t.removeChild(u),u=t):(l=m=b,c(u).empty());else if(!0!==a)break;if(u._dfr&&!m){s=r(u._dfr,1,cb);n=0;for(p=s.length;n<p;n++)x=s[n],(x=la[x.id])&&x.data!==b&&x.parent.removeViews(x._.key,b,!0);u._dfr=""}k.link(f,u,l,m,q,b,g)}}return d}function oa(a,e,f,g,k,l,m,n){function q(a,c,d,e,f,g,h,C,l,m,ta,Aa,n){var na,p="";if(n)return x=0,a;u=C||l||"";e=e||m;d=d||Aa;ma&&!d&&(e||u||g)&&(ma=b,P=qa.shift());if(e=e||d)x=0,ma=b,ha&&
(d||Aa?Va[P]||/;svg;|;math;/.test(";"+qa.join(";")+";")||(na="'<"+P+".../"):Va[e]?na="'</"+e:qa.length&&e===P||(na="Mismatch: '</"+e),na&&Sa(na+">' in:\n"+k)),pa=ya,P=qa.shift(),ya=Ua[P],m=m?"</"+m+">":"",pa&&(ua+=W,W="",ya?ua+="-":(p=m+Ya+"@"+ua+Xa+(ta||""),ua=Fa.shift()));ya?(g?W+=g:c=m||Aa||"",u&&(c+=u,W&&(c+=" "+ia+'="'+W+'"',W=""))):c=g?c+p+f+Ya+g+Xa+h+u:p||a;x&&g&&Sa(" No {^{ tags within elem markup ("+x+' ). Use data-link="..."');u&&(x=u,qa.unshift(P),P=u.slice(1),qa[0]&&qa[0]===ib[P]&&ka("Parent of <tr> must be <tbody>"),
ma=Va[P],(ya=Ua[P])&&!pa&&(Fa.unshift(ua),ua=""),pa=ya,ua&&ya&&(ua+="+"));return c}function s(a,c){var f,g,k,C,l=[];if(a){"@"===a._tkns.charAt(0)&&(c=L.previousSibling,L.parentNode.removeChild(L),L=b);for(F=a.length;F--;){G=a[F];k=G.ch;if(f=G.path)for(D=f.length-1;g=f.charAt(D--);)"+"===g?"-"===f.charAt(D)?(D--,c=c.previousSibling):c=c.parentNode:c=c.lastChild;if("^"===k){if(u=Ba[f=G.id]){g=c&&(!L||L.parentNode!==c);if(!L||g)u.parentElem=c;G.elCnt&&g&&(c._dfr=(G.open?"#":"/")+f+k+(c._dfr||""));l.push([g?
null:L,G])}}else if(B=la[f=G.id])(B.parentElem||(B.parentElem=c||L&&L.parentNode||e,B._.onRender=Ia,B._.onArrayChange=d,h(B)),g=B.parentElem,G.open)?(B._elCnt=G.elCnt,c?c._dfr="#"+f+k+(c._dfr||""):(B._prv||(g._dfr=p(g._dfr,"#"+f+k)),B._prv=L)):(!c||L&&L.parentNode===c?L&&(B._nxt||(g._dfr=p(g._dfr,"/"+f+k)),B._nxt=L):(c._dfr="/"+f+k+(c._dfr||""),B._nxt=b),A=B.linkCtx,(C=B.ctx&&B.ctx.onAfterCreate||Ha)&&C.call(A,B))}for(F=l.length;F--;)xa.push(l[F])}return!a||a.elCnt}function t(a){var b,c;if(a)for(F=
a.length,D=0;D<F;D++)if(G=a[D],M.id)M.id=M.id!==G.id&&M.id;else if(c=u=Ba[G.id].linkCtx.tag,!u.flow){if(!ea){for(b=1;c=c.parent;)b++;ca=ca||b}!ea&&b!==ca||fa&&u.tagName!==fa||Y.push(u)}}function v(){I=Ta?e.querySelectorAll(R):c(R,e).get();E=I.length;f&&f.innerHTML&&(O=Ta?f.querySelectorAll(R):c(R,f).get(),f=O.length?O[O.length-1]:f);for(z=ca=0;z<E;z++)if(L=I[z],f&&!za)za=L===f;else if(g&&L===g)break;else L.parentNode&&Ga(r(L,b,Y&&nb))&&!M&&L.getAttribute(N)&&xa.push([L]);wa===Ea&&k===b&&e.getAttribute(N)&&
xa.push([e]);Ja(f,ya);Ja(g,ya);if(!M){if(ya&&ua+W&&(L=g,ua&&(g?s(r(ua+"+",1),g):s(r(ua,1),e)),s(r(W,1),e),g)){V=g.getAttribute(ia);if(E=V.indexOf(sa)+1)V=V.slice(E+sa.length-1);g.setAttribute(ia,W+V)}E=xa.length;for(z=0;z<E;z++)if(L=xa[z],J=L[1],L=L[0],J){if(u=Ba[J.id]){if(A=u.linkCtx)u=A.tag,u.linkCtx=A;J.open?(L&&(u.parentElem=L.parentNode,u._prv=L),u._elCnt=J.elCnt,!u||u.onBeforeLink&&!1===u.onBeforeLink()||u._.bound||(u._.bound=!0,B=u.tagCtx.view,H(b,u._prv,B,a,J.id)),u._.linking=!0):(u._nxt=
L,u._.linking&&(ga=u.tagCtx,B=ga.view,delete u._.linking,u._.bound||(u._.bound=!0,H(b,u._prv,B,a,J.id)),ba(u,ga)))}}else B=y(L),H(L.getAttribute(N),L,B,a,b,m)}ra&&ra.resolve()}var x,A,u,z,E,D,F,I,L,B,G,J,O,K,T,S,Q,Y,ea,fa,ga,ha,ca,M,Z,da,P,ma,oa,V,ya,pa,W,sa,za,ra,wa=this,Da=wa._.id+"_",ua="",xa=[],qa=[],Fa=[],Ha=wa.hlp(Ca),Ga=s;l&&(ra=l.lazyLink&&c.Deferred(),l.tmpl?T="/"+l._.id+"_":(M=l.get,l.tag&&(Da=l.tag+"^",l=!0)),l=!0===l);M&&(Ga=t,Y=M.tags,ea=M.deep,fa=M.name);e=e?""+e===e?c(e)[0]:e.jquery?
e[0]:e:wa.parentElem||ja.body;ha=!U.noValidate&&e.contentEditable!==va;P=e.tagName.toLowerCase();ya=!!Ua[P];f=f&&X(f,ya);g=g&&X(g,ya)||null;if(k!=b){oa=Z=ja.createElement("div");sa=W="";da="http://www.w3.org/2000/svg"===e.namespaceURI?"svg_ns":(K=gb.exec(k))&&K[1]||"";w&&K&&K[2]&&ka("Unsupported: "+K[2]);if(ya){for(Q=g;Q&&!(S=r(Q));)Q=Q.nextSibling;if(V=S?S._tkns:e._dfr){K=T||"";if(l||!T)K+="#"+Da;D=V.indexOf(K);D+1&&(D+=K.length,sa=W=V.slice(0,D),V=V.slice(D),S?Q.setAttribute(ia,V):e._dfr=V)}}ma=
b;k=(""+k).replace(kb,q);ha&&qa.length&&Sa("Mismatched '<"+P+"...>' in:\n"+k);if(n)return;$a.appendChild(Z);da=aa[da]||aa.div;l=da[0];for(oa.innerHTML=da[1]+k+da[2];l--;)oa=oa.lastChild;$a.removeChild(Z);for(Z=ja.createDocumentFragment();da=oa.firstChild;)Z.appendChild(da);e.insertBefore(Z,g)}ra?setTimeout(v,0):v();return ra&&ra.promise()}function H(a,d,e,f,g,h){var k,m,n,p,r,t,x,v;f=e.data===b?f||{}:e.data;if(g)h=Ba[g],h=h.linkCtx?h.linkCtx.tag:h,x=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:d,
view:e,ctx:e.ctx,attr:pa,fn:h._.bnd,tag:h,_bndId:g},q(x,x.fn);else if(a&&d)for(k=e.tmpl,n=l(d),a=c.trim(a).replace(hb,"\\$&"),a=a.slice(-1)!==xa?E+":"+a+(n?":":"")+xa:a,s.lastIndex=0;m=s.exec(a);)v=s.lastIndex,n=g?pa:m[1],t=m[3],r=m[10],p=b,x={data:f,elem:d,view:e,ctx:h||e.ctx,attr:n,_initVal:!m[2]},m[6]&&(!n&&(p=/:([\w$]*)$/.exec(r))&&(p=p[1],p!==b&&(r=-p.length-1,t=t.slice(0,r-1)+xa)),null===p&&(p=b),x.convert=m[5]||""),x.expr=n+t,(m=k.links[t])||(k.links[t]=m=G.tmplFn(t,k,!0,p)),x.fn=m,n||p===
b||(x.convertBack=p),q(x,m),s.lastIndex=v}function q(b,c){function d(e,f){a.call(b,e,f,c)}d.noArray=!0;b._ctxCb=qa(b.view);b._hdlr=d;d(!0)}function p(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function m(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ia)||"")}function r(a,b,c){function d(a,b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:m(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||
!a.type,f._tkns=b,b.replace(c||ob,d),f}function Ja(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(N)&&a.removeAttribute(N))}function X(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ja.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):m(c)||c.getAttribute(N)||c.setAttribute(N,""));return c}function ba(a,d){var e,f,g,h,k,l,m;e=d.view;var n=a.linkCtx=a.linkCtx||{tag:a,data:e.data,view:e,ctx:e.ctx};if(a.onAfterLink)a.onAfterLink(d,
n);if(f=(e=a.targetTag?a.targetTag.linkedElem:a.linkedElem)&&e[0]){if(g=a._.radio)e=e.children("input[type=radio]");if(g||!a._.chging){h=G.cvt(a,a.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(a._.inline&&(!k||k!==a&&k.targetTag!==a))for(f._jsvLnkdEl=a,k=n.elem?n.elem._jsvBnd:a._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),l=k.length;l--;)za(Ba[k[l]],a.convertBack);g&&(f[V]=h===f.value)}n._val=h}h!==b&&(g||f.value===b?f.contentEditable===va&&(f.innerHTML=h):f.type===
Ga?f[V]=h&&"false"!==h:e.val(h))}}if(f=f||":"===a.tagName&&n.elem)g=f._jsvTr,h=d.props.trigger,g!==h&&(f._jsvTr=h,e=e||c(f),W(e,g,"off"),W(e,h,"on"))}function Ha(a){setTimeout(function(){e(a)},0)}function W(a,b,c){b&&a[c](!0===b?"keydown":b,!0===b?Ha:e)}function za(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],
b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function sa(a,b){var d,e;d=a.tagCtx.view;var f=a.tagCtxs||[a.tagCtx],g=f.length,h=!b;for(b=b||a._.bnd.call(d.tmpl,(a.linkCtx||d).data,d,z);g--;)d=f[g],e=b[g],c.observable(d.props).setProperty(e.props),Z(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function Da(a){for(var b,c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd=
"",a=c.length;a--;)Y(c[a],b._jsvLnkdEl,b);J(m(b)+(b._dfr||""))}}function Y(a,d,e){var f,g,h,k=Ba[a];if(d)e===d.linkedElem[0]&&(delete e._jsvLnkdEl,delete d.linkedElem);else if(k){delete Ba[a];for(f in k.bnd)d=k.bnd[f],e=".obs"+k.cbId,c.isArray(d)?c([d]).off(ea+e).off(O+e):c(d).off(O+e),delete k.bnd[f];if(f=k.linkCtx){if(d=f.tag){if(e=d.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&h.unmap();if(g=(e=(h=d.linkedElem)&&h[0]||f.elem)&&e._jsvTr)W(h||c(e),g,"off"),e._jsvTr=b;if(d.onDispose)d.onDispose();d._elCnt||
(d._prv&&d._prv.parentNode.removeChild(d._prv),d._nxt&&d._nxt.parentNode.removeChild(d._nxt))}delete f.view._.bnds[a]}delete G._cbBnds[k.cbId]}}function ma(a,d){a===b?(F&&(c(F).off(v,e).off("blur","[contenteditable]",e),F=b),a=!0,Ea.removeViews(),Da(ja.body.getElementsByTagName("*"))):d&&!0===a&&(d=d.jquery?d:c(d),d.each(function(){for(var a;(a=y(this,!0))&&a.parent;)a.parent.removeViews(a._.key,b,!0);Da(this.getElementsByTagName("*"));Da([this])}));return d}function P(a,b){return ma(this,a,b)}function qa(a){a=
a||c.view();return function(b,c){var d,e,f=[c];if(a&&b){if(b._jsvOb)return b._jsvOb.call(a.tmpl,c,a,z);if("~"===b.charAt(0)){if("~tag"===b.slice(0,4)&&(e=a.ctx,"."===b.charAt(4)&&(d=b.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];b=b.slice(1).split(".");if(c=a.hlp(b.shift()))b.length&&f.unshift(b.join(".")),f.unshift(c);return c?f:[]}if("#"===b.charAt(0))return"#data"===b?[]:[a,b.replace(jb,""),c]}}}function Fa(a){return a.type===Ga?a[V]:a.value}function A(a,b,c,d,e,f){var g,h,k,l,
m,n,q=0,s=a===b;if(a){k=r(a)||[];g=0;for(h=k.length;g<h;g++){l=k[g];n=l.id;if(n===d&&l.ch===e)if(f)h=0;else break;s||(m="_"===l.ch?la[n]:Ba[n].linkCtx.tag,l.open?m._prv=b:l.close&&(m._nxt=b));q+=n.length+2}q&&a.setAttribute(ia,a.getAttribute(ia).slice(q));a=b?b.getAttribute(ia):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ia,a):c._dfr=a)}else c._dfr=p(c._dfr,"#"+d+e),f||b||(c._dfr=p(c._dfr,"/"+d+e))}function J(a){var c,d,e;if(e=r(a,1,lb))for(a=
0,c=e.length;a<c;a++)d=e[a],"_"===d.ch?(d=la[d.id])&&d.data!==b&&d.parent.removeViews(d._.key,b,!0):Y(d.id)}function T(a,b,d){switch(d.change){case "set":a=a.tgt;for(b=a.length;b--&&a[b].key!==d.path;);-1===b?d.path&&c.observable(a).insert({key:d.path,prop:d.value}):d.remove?c.observable(a).remove(b):c.observable(a[b]).setProperty("prop",d.value)}}function t(a,b,d){a=a.src;switch(d.change){case "set":"prop"===d.path?c.observable(a).setProperty(b.target.key,d.value):(c.observable(a).setProperty(d.oldValue,
null),delete a[d.oldValue],c.observable(a).setProperty(d.value,b.target.prop));break;case "remove":b=d.items[0];c.observable(a).removeProperty(b.key);delete a[b.key];break;case "insert":b=d.items[0],b.key&&c.observable(a).setProperty(b.key,b.prop)}}function B(a,b,c){return 0>c.indexOf(".")&&b[a]}var F,y,s,E,xa,ca,w,ka,N,I,R,aa,Ea,la,ja=f.document,z=c.views,G=z.sub,U=z.settings,Z=G.extend,M=c.isFunction,Ma=z.converters,ra=z.tags,fa=c.observable,La=fa.observe,ia="data-jsv",O=G.propChng=G.propChng||
"propertyChange",ea=G.arrChng=G.arrChng||"arrayChange",v="change.jsv",K="onBeforeChange",D="onAfterChange",Ca="onAfterCreate",V="checked",Ga="checkbox",wa="radio",da="none",va="true",Xa='">\x3c/script>',Ya='<script type="jsv',Pa="script,["+ia+"]",pa="html",Qa={value:"val",input:"val",html:pa,text:"text"},Za={from:"value",to:"value"},Ra=0,eb=c.cleanData,fb=U.delimiters,Sa=G.syntaxErr,gb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,hb=/['"\\]/g,$a=ja.createDocumentFragment(),Ta=ja.querySelector,Ua=
{ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},ib={tr:"table"},Va={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},ab={},Ba={},bb=1,jb=/^#(view\.?)?/,kb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,cb=/(#)()(\d+)(_)/g,lb=/(#)()(\d+)([_^])/g,mb=/(?:(#)|(\/))(\d+)(_)/g,nb=/(#)()(\d+)(\^)/g,ob=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,
db=f.getComputedStyle;if(!c)throw"JsViews requires jQuery";if(!c.views)throw"JsViews requires JsRender";if(!c.observable)throw"JsViews requires jquery.observable";c.link||(I={contents:function(a,d){a!==!!a&&(d=a,a=b);var e,f=c(this.nodes());f[0]&&(e=d?f.filter(d):f,f=a&&d?e.add(f.find(d)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&
(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,c){a!==!!a&&(c=a,a=b);var d=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&d.link(b,this.parentElem,f?e.previousSibling:e,this._nxt,b,{get:{tags:g,deep:a,name:c,id:f&&this._tgId}});return g},refresh:function(a){var c,d=this.linkCtx,e=this.tagCtx.view;this.disposed&&ka("Removed tag");a===b&&(a=z._tag(this,e,e.tmpl,sa(this),!0));a+""===a&&(c=this._.inline?pa:d.attr||l(this.parentElem,
!0),c=g(a,d,c,this));ba(this,this.tagCtx);return c||this},update:function(a){var c=this.linkedElem;c&&e({target:c[0]},b,a)}},G.onStore.template=function(a,b){b.link=ga;b.unlink=P;a&&(c.link[a]=function(){return ga.apply(b,arguments)},c.unlink[a]=function(){return P.apply(b,arguments)})},G.onStore.tag=function(a,b){G._lnk(b)},G._lnk=function(a){return Z(a,I)},G.viewInfos=r,(U.delimiters=function(){var a=fb.apply(z,arguments);E=a[1];xa=a[2];ca=a[4];s=RegExp("(?:^|\\s*)([\\w-]*)(\\"+ca+")?(\\"+E+G.rTag+
"\\"+xa+")","g");return this})(),Z(G._lnk(G.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==n(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)fa(f[a]).setProperty("index",a);return this},removeViews:function(a,d,e){function f(a){var d,g,k,l,n,p=m[a];if(p&&p.link){a=p._.id;e||(n=p.nodes());p.removeViews(b,b,!0);p.data=b;k=p._prv;l=p._nxt;g=p.parentElem;e||(p._elCnt&&A(k,l,g,a,"_"),c(n).remove());if(!p._elCnt)try{k.parentNode.removeChild(k),
l.parentNode.removeChild(l)}catch(q){}h(p);for(d in p._.bnds)Y(d);delete la[a]}}var g,k,l=!this._.useKey,m=this.views;l&&(k=m.length);if(a===b)if(l){for(g=k;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(d===b&&(l?d=1:(f(a),delete m[a])),l&&d){for(g=a+d;g-- >a;)f(g);m.splice(a,d);if(k=m.length)for(;a<k;)fa(m[a]).setProperty("index",a++)}return this},refresh:function(a){var b=this.parent;b&&(n(this,this.index,this.tmpl,b.views,this.data,a,!0),h(this));return this},link:oa}),la=
{0:Ea=new G.View(b,"top")},Ma.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},ra("on",{attr:da,onAfterLink:function(a,d){for(var e,f,g=0,h=a.args,k=a.props.data,l=a.view,m=a.props.context;!M(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(a.params.args.slice(-f.length-1)[0]))&&G.tmplFn("{:"+m[1]+"}",l.tmpl,
!0)(d.data,l));if(e){if(this._evs)this.onDispose();c(d.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==b?null:k,this._hlr=function(a){return e.apply(m||d.data,[].concat(f,a,{change:a.type,view:l,linkCtx:d}))})}},onDispose:function(){c(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),Z(ra["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===d&&!b.oldItems.length!==!a.target.length))this.refresh();
else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var a,b,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(a=0;a<=l;a++)b=h[a],e=b.map?b.map.tgt:b.args.length?b.args[0]:b.view.data,(d=g[a])&&e!==d[0]&&(La(d[0],d[1],!0),delete g[a]),!g[a]&&c.isArray(e)&&(La(e,b=function(a,b){f.onArrayChange(a,b)}),g[a]=[e,b]);for(a=l+1;a<k;a++)if(d=g[a])La(d[0],d[1],!0),delete g[a];f._ars=g},onDispose:function(){for(var a in this._ars)La(this._ars[a][0],
this._ars[a][1],!0)}}),Z(ra["for"],I),Z(ra["if"],I),Z(ra.include,I),ra("props",{baseTag:ra["for"],dataMap:z.map({getTgt:ra.props.dataMap.getTgt,obsSrc:T,obsTgt:t,tgtFlt:B})}),Z(c,{view:z.view=y=function(a,d,e){d!==!!d&&(e=d,d=b);var f,g,h,k,l,m;m=0;l=ja.body;if(a&&a!==l&&1<Ea._.useKey&&(a=""+a===a?c(a)[0]:a.jquery?a[0]:a))if(d)for(m=Ta?a.querySelectorAll(Pa):c(Pa,a).get(),l=m.length,a=0;a<l;a++)for(f=m[a],g=r(f,b,cb),h=0,k=g.length;h<k;h++){if(f=g[h],f=la[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;a;){if(g=
r(a,b,mb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=la[f.id])&&e?f.get(e):f||Ea;m--}else m++;a=a.previousSibling||a.parentNode}return d?b:Ea},link:z.link=ha,unlink:z.unlink=ma,cleanData:function(a){a.length&&Ra&&Da(a);eb.apply(c,arguments)}}),z.utility={validate:function(a){try{Ea.link(b,ja.createElement("div"),b,b,a,b,b,1)}catch(c){return c.message}}},Z(c.fn,{link:function(a,b,c,d,e,f,g){return ha(a,this,b,c,d,e,f,g)},unlink:function(a){return ma(a,this)},view:function(a){return y(this[0],
a)}}),c.each([pa,"replaceWith","empty","remove"],function(a,b){var d=c.fn[b];c.fn[b]=function(){var a;Ra=1;try{a=d.apply(this,arguments)}finally{Ra=0}return a}}),Z(Ea,{tmpl:{links:{},tags:{}}}),Ea._.onRender=Ia,U({wrapMap:aa={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],
col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:N="data-link",merge:{input:{from:Fa,to:"value"},textarea:Za,select:Za,optgroup:{to:"label"}},jsrDbgMode:U.debugMode,debugMode:function(a){U.jsrDbgMode(a);a?f._jsv={views:la,bindings:Ba}:delete f._jsv},jsv:function(){U.debugMode(U._dbgMode);N=U.linkAttr;ka=z._err;R=Pa+",["+N+"]";w=U.noDomLevel0;aa.optgroup=aa.option;aa.tbody=aa.tfoot=
aa.colgroup=aa.caption=aa.thead;aa.th=aa.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
