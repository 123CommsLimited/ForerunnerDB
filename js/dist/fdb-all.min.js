function z(){return function k(p,a,h){function f(g,e){if(!a[g]){if(!p[g]){var c="function"==typeof require&&require;if(!e&&c)return c(g,!0);if(b)return b(g,!0);c=Error("Cannot find module '"+g+"'");throw c.code="MODULE_NOT_FOUND",c;}c=a[g]={m:{}};p[g][0].call(c.m,function(c){var e=p[g][1][c];return f(e?e:c)},c,c.m,k,p,a,h)}return a[g].m}for(var b="function"==typeof require&&require,g=0;g<h.length;g++)f(h[g]);return f}({1:[function(k,p){var a=k("../lib/Core");k("../lib/CollectionGroup");k("../lib/View");
k("../lib/OldView");k("../lib/OldView.Bind");k("../lib/Highcharts");k("../lib/Persist");p.m=a},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Highcharts":6,"../lib/OldView":11,"../lib/OldView.Bind":10,"../lib/Persist":15,"../lib/View":17}],2:[function(k,p){function a(c){this.d.apply(this,arguments)}var h,f,b,g,l,e;h=k("./Shared");a.prototype.d=function(c){this.c="_id";this.F=new l("primary");this.Ga=new l("primaryCrc");this.Ca=new l("crcLookup");this.h=c;this.b=[];this.S=[];this.Fa=new g;this.D=
0;this.g={};this.R={i:[],update:[],remove:[],H:[]};this.ba={i:100,update:100,remove:100,H:100};this.Da={i:1,update:1,remove:1,H:1};this.Ia(this)};h.n.Jb=a;b=k("./Overload");g=k("./Metrics");l=k("./KeyValueStore");e=k("./Path");k("./Index");k("./Crc");f=h.n.W;a.prototype.debug=new b([function(){return this.g.all},function(c){if(void 0!==c){if("boolean"===typeof c){this.g.all=c;for(var d=0;d<this.v.length;d++)this.v[d].debug(c);return this}return this.g[c]||this.f&&this.f.g&&this.f.g[c]||this.g.all}return this.g.all},
function(c,d){if(void 0!==c){if(void 0!==d){this.g[c]=d;for(var e=0;e<this.v.length;e++)this.v[e].debug(c,d);return this}return this.g[c]||this.f&&this.f.g&&this.f.g[c]}return this.g.all}]);a.prototype.name=function(c){return void 0!==c?(this.h=c,this):this.h};a.prototype.C=new b([function(c,d){this.a=this.a||{};this.a[c]=this.a[c]||{};this.a[c]["*"]=this.a[c]["*"]||[];this.a[c]["*"].push(d);return this},function(c,d,e){this.a=this.a||{};this.a[c]=this.a[c]||{};this.a[c][d]=this.a[c][d]||[];this.a[c][d].push(e);
return this}]);a.prototype.s=new b([function(c){this.a&&this.a[c]&&c in this.a&&delete this.a[c];return this},function(c,d){var e,b;"string"===typeof d?this.a&&this.a[c]&&this.a[c][d]&&delete this.a[c][d]:c in this.a&&(e=this.a[c]["*"],b=e.indexOf(d),-1<b&&e.splice(b,1));return this},function(c,d,e){this.a&&c in this.a&&(c=this.a[c][d],e=c.indexOf(e),-1<e&&c.splice(e,1))}]);a.prototype.j=function(c,d){this.a=this.a||{};if(c in this.a){if(this.a[c]["*"]){var e=this.a[c]["*"],b=e.length,a;for(a=0;a<
b;a++)e[a].apply(this,Array.prototype.slice.call(arguments,1))}if(d instanceof Array&&d[0]&&d[0][this.c]){var e=this.a[c],f,g,b=d.length;for(a=0;a<b;a++)if(e[d[a][this.c]])for(f=e[d[a][this.c]].length,g=0;g<f;g++)e[d[a][this.c]][g].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.K=function(){if(this.f&&this.h){this.debug()&&console.log("Dropping collection "+this.h);this.j("drop");delete this.f.k[this.h];var c=[],d;for(d=0;d<this.S.length;d++)c.push(this.S[d]);for(d=
0;d<c.length;d++)this.S[d].Hb(this);return!0}return!1};a.prototype.primaryKey=function(c){return void 0!==c?(this.c=c,this.F.primaryKey(c),this.ob(),this):this.c};a.prototype.T=function(c,d){this.j("insert",c,d)};a.prototype.ca=function(c){this.j("update",c)};a.prototype.X=function(c){this.j("remove",c)};a.prototype.db=function(c){return void 0!==c?(this.f=c,this):this.f};a.prototype.setData=function(c,d,e){if(c){var b=this.Fa.create("setData");b.start();c instanceof Array||(c=[c]);b.time("transformIn");
c=this.Ta(c);b.time("transformIn");var a=this.b;this.b=[];c.length&&(this.b=this.b.concat(c));b.time("_rebuildPrimaryKeyIndex");this.ob(d);b.time("_rebuildPrimaryKeyIndex");b.stop();this.j("setData",this.b,a)}e&&e(!1);return this};a.prototype.ob=function(c){var d=c&&void 0!==c.uc?c.uc:!0;c=c&&void 0!==c.Kc?c.Kc:!0;var e,b,a,f=this.F,g=this.Ga,l=this.Ca,h=this.c,k;f.truncate();g.truncate();l.truncate();e=this.b;for(b=e.length;b--;)if(a=e[b],d&&this.eb(a),c){if(!f.ja(a[h],a))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+
a[this.c];}else k=JSON.stringify(a),f.set(a[h],a),g.set(a[h],k),l.set(k,a)};a.prototype.eb=function(c){void 0===c[this.c]&&(c[this.c]=this.Ab())};a.prototype.truncate=function(){this.j("truncate",this.b);this.b.length=0;this.ua("change");return this};a.prototype.H=function(c,d){if(c){var e=this.R.H,b=this.ba.H,a={},f;if(c instanceof Array){if(c.length>b){this.R.H=e.concat(c);this.ga("upsert",d);return}a=[];for(e=0;e<c.length;e++)a.push(this.H(c[e]));d&&d();return a}c[this.c]?(f={},f[this.c]=c[this.c],
this.count(f)?a.Ra="update":a.Ra="insert"):a.Ra="insert";switch(a.Ra){case "insert":a.result=this.i(c);break;case "update":a.result=this.update(f,c)}return a}d&&d()};a.prototype.update=function(c,d,e){function b(f){if(d&&void 0!==d[g]&&d[g]!=f[g]){a.F.ya(f[g]);var C=a.da(f,d,c,e,"");if(a.F.ja(f[g],f))return C;throw"Primary key violation in update! Key violated: "+f[g];}return a.da(f,d,c,e,"")}d=this.w(d);d=this.Ta(d);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+
'"');var a=this,f=this.Fa.create("update"),g=this.c,l,h,k=this.v;f.start();f.time("Retrieve documents to update");l=this.find(c,{w:!1});f.time("Retrieve documents to update");if(l.length&&(f.time("Update documents"),h=l.filter(b),f.time("Update documents"),h.length)){if(k&&k.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());f.time("Inform views of update");for(l=0;l<k.length;l++)k[l].update(c,d);f.time("Inform views of update")}this.ca(h);this.ua("change",{type:"update",
data:h})}f.stop();return h||[]};a.prototype.da=function(c,d,a,b,f){d=this.w(d);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));var g=!1,l=!1,h,k,q,m,n;for(m in d)if(d.hasOwnProperty(m)){h=!1;if("$"===m.substr(0,1))switch(m){case "$inc":h=!0;for(n in d[m])if(d[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if("number"===typeof c[n])this.gc(c,n,d[m][n]),g=!0;else throw"Cannot increment field that is not a number! ("+n+")!";break;case "$push":h=!0;for(n in d[m])if(d[m].hasOwnProperty(n)&&"$"!==n.substr(0,
1))if(c[n]instanceof Array)this.rb(c[n],d[m][n]),g=!0;else throw"Cannot push to a key that is not an array! ("+n+")!";break;case "$addToSet":h=!0;for(n in d[m])if(d[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(c[n]instanceof Array){k=c[n];var p;q=k.length;var s,l=!0;p=b&&b.Lc;var u,r;p&&p.key?(u=!1,r=new e(p.key),s=r.value(d[m][n])[0]):(s=JSON.stringify(d[m][n]),u=!0);for(p=0;p<q;p++)if(u){if(JSON.stringify(k[p])===s){l=!1;break}}else if(s===r.value(k[p])[0]){l=!1;break}l&&(this.rb(c[n],d[m][n]),
g=!0)}else throw"Cannot push to a key that is not an array! ("+n+")!";break;case "$splicePush":h=!0;for(n in d[m])if(d[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(c[n]instanceof Array)if(g=d[m].Wa,void 0!==g)delete d[m][n].Wa,this.jc(c[n],g,d[m][n]),g=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+n+")!";break;case "$move":h=!0;for(n in d[m])if(d[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(c[n]instanceof Array)for(q=
0;q<c[n].length;q++){if(this.u(c[n][q],d[m][n])){g=d[m].Wa;if(void 0!==g)this.ic(c[n],q,g),g=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot pull from a key that is not an array! ("+n+")!";break;case "$pull":for(n in h=!0,d[m])if(d[m].hasOwnProperty(n)&&"$"!==n.substr(0,1))if(c[n]instanceof Array){k=[];for(q=0;q<c[n].length;q++)this.u(c[n][q],d[m][n])&&k.push(q);for(q=k.length;q--;)this.hc(c[n],k[q]),g=!0}else throw"Cannot pull from a key that is not an array! ("+
n+")!";}if(".$"===m.substr(m.length-2,2)&&(h=!0,m=m.substr(0,m.length-2),l=new e(f+"."+m),c[m]&&c[m]instanceof Array&&c[m].length)){k=[];for(q=0;q<c[m].length;q++)this.u(c[m][q],l.value(a)[0])&&k.push(q);for(q=0;q<k.length;q++)(l=this.da(c[m][k[q]],d[m+".$"],a,b,f+"."+m))&&(g=!0)}if(!h)if("object"===typeof d[m])if(null!==c[m]&&"object"===typeof c[m])if(h=c[m]instanceof Array,k=d[m]instanceof Array,h||k)if(!k&&h)for(q=0;q<c[m].length;q++)(l=this.da(c[m][q],d[m],a,b,f+"."+m))&&(g=!0);else this.Ka(c,
m,d[m]),g=!0;else(l=this.da(c[m],d[m],a,b,f+"."+m))&&(g=!0);else this.Ka(c,m,d[m]),g=!0;else c[m]!==d[m]&&(this.Ka(c,m,d[m]),g=!0)}return g};a.prototype.Ka=function(c,d,e){this.D?($.M(c).setProperty(d,e),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+d+'" for collection "'+this.name()+'"')):(c[d]=e,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+d+'" for collection "'+this.name()+'"'))};a.prototype.ic=function(c,
d,e){this.D?($.M(c).move(d,e),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+d+'" to "'+e+'" for collection "'+this.name()+'"')):(c.splice(e,0,c.splice(d,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+d+'" to "'+e+'" for collection "'+this.name()+'"'))};a.prototype.jc=function(c,d,e){c.length>d?this.D?$.M(c).i(d,e):c.splice(d,0,e):this.D?$.M(c).i(e):c.push(e)};a.prototype.rb=function(c,
d){this.D?$.M(c).i(d):c.push(d)};a.prototype.hc=function(c,d){this.D?$.M(c).remove(d):c.splice(d,1)};a.prototype.gc=function(c,d,e){this.D?$.M(c).setProperty(d,c[d]+e):c[d]+=e};a.prototype.remove=function(c){var d,e,a=this.v,b;if(c instanceof Array){a=[];for(d=0;d<c.length;d++)a.push(this.remove(c[d]));return a}d=this.find(c,{w:!1});if(d.length){for(b=0;b<d.length;b++)e=d[b],this.$b(e),e=this.b.indexOf(e),this.D?$.M(this.b).remove(e):this.b.splice(e,1);if(a&&a.length)for(b=0;b<a.length;b++)a[b].remove(c);
this.X(d);this.ua("change",{type:"remove",data:d})}return d};a.prototype.ua=function(){var c=this,d;this.Ub||this.f&&(!this.f||this.f.Ub)?this.j.apply(this,arguments):(d=arguments,this.bb&&clearTimeout(this.bb),this.bb=setTimeout(function(){c.debug()&&console.log("ForerunnerDB.Collection: Emitting "+d[0]);c.j.apply(c,d)},100))};a.prototype.ga=function(c,d){var e=this.R[c],a=this.ba[c],b=this.Da[c];if(e.length){var f=this;e.length&&(e=e.length>a?e.splice(0,a):e.splice(0,e.length),this[c](e));setTimeout(function(){f.ga(c,
d)},b)}else d&&d()};a.prototype.i=function(c,d,e){"function"===typeof d?(e=d,d=this.b.length):void 0===d&&(d=this.b.length);c=this.Ta(c);return this.hb(c,d,e)};a.prototype.hb=function(c,d,e){var a=this.R.i,b=this.ba.i,f=[],g=[],l=this.v;if(c instanceof Array){if(c.length>b){this.R.i=a.concat(c);this.ga("insert",e);return}for(b=0;b<c.length;b++)a=this.gb(c[b],d+b),!0===a?f.push(c[b]):g.push({tc:c[b],reason:a})}else a=this.gb(c,d),!0===a?f.push(c):g.push({tc:c,reason:a});if(l&&l.length)for(a=0;a<l.length;a++)l[a].i(c,
d);this.T(f,g);e&&e();this.ua("change",{type:"insert",data:f});return{gd:f,dd:g}};a.prototype.gb=function(c,d){if(c){var e;this.eb(c);if(e=this.vc(c))return"Index violation in index: "+e;this.Rb(c);this.D?$.M(this.b).i(d,c):this.b.splice(d,0,c);return!0}return"No document passed to insert"};a.prototype.Rb=function(c){var d=this.pa,e,a=JSON.stringify(c);this.F.ja(c[this.c],c);this.Ga.ja(c[this.c],a);this.Ca.ja(a,c);for(e in d)d.hasOwnProperty(e)&&d[e].i(c)};a.prototype.$b=function(c){var d=this.pa,
e,a=JSON.stringify(c);this.F.ya(c[this.c]);this.Ga.ya(c[this.c]);this.Ca.ya(a);for(e in d)d.hasOwnProperty(e)&&d[e].remove(c)};a.prototype.$=function(c,d){var e=this.find(c,d);return(new a).Ia(this).primaryKey(this.c).setData(e)};a.prototype.Ia=function(c){this.Ya=c;return this};a.prototype.sc=function(c){var d=this.find(void 0,void 0);c=new e(c);var a={},b=[],f,g;for(g=0;g<d.length;g++)(f=c.value(d[g])[0])&&!a[f]&&(a[f]=!0,b.push(f));return b};a.prototype.w=function(c){return JSON.parse(JSON.stringify(c))};
a.prototype.find=function(c,d){function a(d){return f.u(d,c,"and")}c=c||{};d=d||{};d.w=void 0!==d.w?d.w:!0;var b=this.Fa.create("find"),f=this,g,l=!0,h,k,p,m,n,t,s,u,r,y=[];b.start();if(c){b.time("analyseQuery");g=this.Mb(c,d,b);b.time("analyseQuery");b.data("analysis",g);if(g.vb&&g.Fb){b.time("joinReferences");for(k=0;k<g.Oa.length;k++)m=g.Oa[k],p=new e(g.xb[m]),p=p.value(c)[0],this.f.ta(g.Oa[k]).$(p);b.time("joinReferences")}g.G.length&&(!d||d&&!d.rd)?(b.data("index.potential",g.G),b.data("index.used",
g.G[0].index),b.time("indexLookup"),h=g.G[0].L,b.time("indexLookup"),g.G[0].A.aa===g.G[0].A.B&&(l=!1)):b.fa("usedIndex",!1);l&&(h&&h.length?(g=h.length,b.time("tableScan: "+g),h=h.filter(a)):(g=this.b.length,b.time("tableScan: "+g),h=this.b.filter(a)),d.sort&&(b.time("sort"),h=this.sort(d.sort,h),b.time("sort")),b.time("tableScan: "+g));d.Qa&&h&&h.length>d.Qa&&(h.length=d.Qa,b.data("limit",d.Qa));d.w&&(b.time("decouple"),h=this.w(h),b.time("decouple"),b.data("flag.decouple",!0));if(d.join){for(g=
0;g<d.join.length;g++)for(m in d.join[g])if(d.join[g].hasOwnProperty(m))for(u=m,l=this.f.ta(m),k=d.join[g][m],r=0;r<h.length;r++){t={};s=p=!1;for(n in k)if(k.hasOwnProperty(n))if("$"===n.substr(0,1))switch(n){case "$as":u=k[n];break;case "$multi":p=k[n];break;case "$require":s=k[n]}else t[n]=(new e(k[n])).value(h[r])[0];t=l.find(t);!s||s&&t[0]?h[r][u]=!1===p?t[0]:t:y.push(h[r])}b.data("flag.join",!0)}if(y.length){b.time("removalQueue");for(n=0;n<y.length;n++)m=h.indexOf(y[n]),-1<m&&h.splice(m,1);
b.time("removalQueue")}if(d.transform){b.time("transform");for(n=0;n<h.length;n++)h.splice(n,1,d.transform(h[n]));b.time("transform");b.data("flag.transform",!0)}this.p&&this.Q&&(b.time("transformOut"),h=this.Ic(h),b.time("transformOut"));b.data("results",h.length);b.stop()}else b.stop(),h=[];h.Wc=b;return h};a.prototype.transform=function(c){return void 0!==c?("object"===typeof c?(void 0!==c.enabled&&(this.p=c.enabled),void 0!==c.Y&&(this.P=c.Y),void 0!==c.Z&&(this.Q=c.Z)):this.p=!1===c?!1:!0,this):
{enabled:this.p,Y:this.P,Z:this.Q}};a.prototype.Ta=function(c){if(this.p&&this.P){if(c instanceof Array){var d=[],e;for(e=0;e<c.length;e++)d[e]=this.P(c[e]);return d}return this.P(c)}return c};a.prototype.Ic=function(c){if(this.p&&this.Q){if(c instanceof Array){var d=[],e;for(e=0;e<c.length;e++)d[e]=this.Q(c[e]);return d}return this.Q(c)}return c};a.prototype.sort=function(c,d){d=d||[];var e=[],b,a;for(b in c)c.hasOwnProperty(b)&&(a={},a[b]=c[b],a.Lb=b,e.push(a));return 2>e.length?this.Ha(c,d):this.ab(e,
d)};a.prototype.ab=function(c,d){var e=c.shift(),b,a,f=[];if(0<c.length){d=this.Ha(e,d);b=this.qc(e.Lb,d);for(a in b)b.hasOwnProperty(a)&&(e=[].concat(c),f=f.concat(this.ab(e,b[a])));return f}return this.Ha(e,d)};a.prototype.Ha=function(c,d){var b=new e,a=b.parse(c,!0)[0];b.path(a.path);return d.sort(1===a.value?function(c,d){var e=b.value(c)[0],a=b.value(d)[0];return"string"===typeof e&&"string"===typeof a?e.localeCompare(a):e>a?1:e<a?-1:0}:function(c,d){var e=b.value(c)[0],a=b.value(d)[0];return"string"===
typeof e&&"string"===typeof a?1===e.localeCompare(a)?-1:1:e>a?-1:e<a?1:0})};a.prototype.qc=function(c,d){var e,b={};for(e=0;e<d.length;e++)b[d[e][c]]=b[d[e][c]]||[],b[d[e][c]].push(d[e]);return b};a.prototype.Mb=function(c,d,b){var a={Gb:[this.h],G:[],vb:!1,Fb:!1,xb:{},t:c,options:d},f,g=[],l=[],h,k,p,m,n;b.time("checkIndexes");void 0!==c[this.c]&&(b.time("checkIndexMatch: Primary Key"),h=new e,a.G.push({L:this.F.L(c,d),A:{zb:[this.c],B:1,aa:h.tb(c)},index:this.F}),b.time("checkIndexMatch: Primary Key"));
for(n in this.fb)if(this.fb.hasOwnProperty(n)&&(k=this.fb[n],p=k.name(),b.time("checkIndexMatch: "+p),h=k.match(c,d),m=k.L(c,d),0<h.B&&a.G.push({L:m,A:h,index:k}),b.time("checkIndexMatch: "+p),h.aa===h.B))break;b.time("checkIndexes");1<a.G.length&&(b.time("findOptimalIndex"),a.G.sort(function(c,d){return c.A.aa===c.A.B?-1:d.A.aa===d.A.B?1:c.A.B===d.A.B?c.L.length-d.L.length:d.A.B-c.A.B}),b.time("findOptimalIndex"));if(d.join){a.vb=!0;for(b=0;b<d.join.length;b++)for(f in d.join[b])d.join[b].hasOwnProperty(f)&&
(g.push(f),"$as"in d.join[b][f]?l.push(d.join[b][f].$as):l.push(f));for(f=0;f<l.length;f++)if(d=this.nb(c,l[f],""))a.xb[g[f]]=d,a.Fb=!0;a.Oa=g;a.Gb=a.Gb.concat(g)}return a};a.prototype.nb=function(c,d,e){for(var b in c)if(c.hasOwnProperty(b)){if(b===d)return e&&(e+="."),e+b;if("object"===typeof c[b])return e&&(e+="."),e+=b,this.nb(c[b],d,e)}return!1};a.prototype.u=function(c,d,e){var b,a;b=typeof c;a=typeof d;var f=!0,g;if(!("string"!==b&&"number"!==b||"string"!==a&&"number"!==a))c!==d&&(f=!1);else for(g in d)if(d.hasOwnProperty(g)){b=
!1;if("$"===g.substr(0,1))switch(g){case "$gt":if(c>d[g]){if("or"===e)return!0}else f=!1;b=!0;break;case "$gte":if(c>=d[g]){if("or"===e)return!0}else f=!1;b=!0;break;case "$lt":if(c<d[g]){if("or"===e)return!0}else f=!1;b=!0;break;case "$lte":if(c<=d[g]){if("or"===e)return!0}else f=!1;b=!0;break;case "$exists":if(void 0===c!==d[g]){if("or"===e)return!0}else f=!1;b=!0;break;case "$or":b=!0;for(a=0;a<d[g].length;a++){if(this.u(c,d[g][a],"and"))return!0;f=!1}break;case "$and":b=!0;for(a=0;a<d[g].length;a++)if(!this.u(c,
d[g][a],"and"))return!1;break;case "$in":if(d[g]instanceof Array){b=d[g];a=b.length;var l,h=!1;for(l=0;l<a;l++)if(b[l]===c){h=!0;break}if(h){if("or"===e)return!0}else f=!1}else throw"Cannot use a $nin operator on a non-array key: "+g;b=!0;break;case "$nin":if(d[g]instanceof Array){b=d[g];a=b.length;h=!0;for(l=0;l<a;l++)if(b[l]===c){h=!1;break}if(h){if("or"===e)return!0}else f=!1}else throw"Cannot use a $nin operator on a non-array key: "+g;b=!0;break;case "$ne":if(c!=d[g]){if("or"===e)return!0}else f=
!1;b=!0}if(!b&&d[g]instanceof RegExp)if(b=!0,"object"===typeof c&&void 0!==c[g]&&d[g].test(c[g])){if("or"===e)return!0}else f=!1;if(!b)if("object"===typeof d[g])if(void 0!==c[g]){if(c[g]instanceof Array&&!(d[g]instanceof Array))for(b=!1,a=0;a<c[g].length&&!(b=this.u(c[g][a],d[g],void 0));a++);else if(!(c[g]instanceof Array)&&d[g]instanceof Array)for(b=!1,a=0;a<d[g].length&&!(b=this.u(c[g],d[g][a],void 0));a++);else b="object"===typeof c?this.u(c[g],d[g],void 0):this.u(void 0,d[g],void 0);if(b){if("or"===
e)return!0}else f=!1}else if(d[g]&&void 0!==d[g].$exists)if(b=this.u(void 0,d[g],void 0)){if("or"===e)return!0}else f=!1;else f=!1;else if(c&&c[g]===d[g]){if("or"===e)return!0}else if(c&&c[g]&&c[g]instanceof Array&&d[g]&&"object"!==typeof d[g]){b=!1;for(a=0;a<c[g].length&&!(b=this.u(c[g][a],d[g],void 0));a++);if(b){if("or"===e)return!0}else f=!1}else f=!1;if("and"===e&&!f)return!1}return f};a.prototype.count=function(c,d){return c?this.find(c,d).length:this.b.length};a.prototype.vc=function(c){var d,
b=this.pa,e,a;if(this.F.get(c[this.c]))d=this.F;else for(e in b)if(b.hasOwnProperty(e)&&(a=b[e],a.unique()&&a.Jc(c))){d=a;break}return d?d.name():!1};a.prototype.index=function(c){if(this.pa)return this.pa[c]};a.prototype.Ab=function(c){var d=Math.pow(10,17);if(c){var b=0,e=c.length,a;for(a=0;a<e;a++)b+=c.charCodeAt(a)*d;c=b.toString(16)}else h.va++,c=(h.va+(Math.random()*d+Math.random()*d+Math.random()*d+Math.random()*d)).toString(16);return c};f.prototype.ta=function(c,d){if(c)return this.k[c]||
this.debug()&&console.log("Creating collection "+c),this.k[c]=this.k[c]||(new a(c)).db(this),void 0!==d&&this.k[c].primaryKey(d),this.k[c];throw"Cannot get collection with undefined name!";};p.m=a},{"./Crc":5,"./Index":7,"./KeyValueStore":8,"./Metrics":9,"./Overload":13,"./Path":14,"./Shared":16}],3:[function(k,p){function a(){this.d.apply(this,arguments)}var h,f,b,g,l;h=k("./Shared");a.prototype.d=function(b){var c=this;this.h=b;this.q=[];this.v=[];this.Wb=function(){c.T.apply(c,arguments)};this.Yb=
function(){c.ca.apply(c,arguments)};this.Xb=function(){c.X.apply(c,arguments)};this.Vb=function(){c.kb.apply(c,arguments)}};h.n.Mc=a;g=k("./Collection");l=k("./Overload");f=h.n.W;b=h.n.W.prototype.d;a.prototype.C=new l([function(b,c){this.a=this.a||{};this.a[b]=this.a[b]||{};this.a[b]["*"]=this.a[b]["*"]||[];this.a[b]["*"].push(c);return this},function(b,c,d){this.a=this.a||{};this.a[b]=this.a[b]||{};this.a[b][c]=this.a[b][c]||[];this.a[b][c].push(d);return this}]);a.prototype.s=new l([function(b){this.a&&
this.a[b]&&b in this.a&&delete this.a[b];return this},function(b,c){var d,a;"string"===typeof c?this.a&&this.a[b]&&this.a[b][c]&&delete this.a[b][c]:b in this.a&&(d=this.a[b]["*"],a=d.indexOf(c),-1<a&&d.splice(a,1));return this},function(b,c,d){this.a&&b in this.a&&(b=this.a[b][c],d=b.indexOf(d),-1<d&&b.splice(d,1))}]);a.prototype.j=function(b,c){this.a=this.a||{};if(b in this.a){if(this.a[b]["*"]){var d=this.a[b]["*"],a=d.length,g;for(g=0;g<a;g++)d[g].apply(this,Array.prototype.slice.call(arguments,
1))}if(c instanceof Array&&c[0]&&c[0][this.c]){var d=this.a[b],f,l,a=c.length;for(g=0;g<a;g++)if(d[c[g][this.c]])for(f=d[c[g][this.c]].length,l=0;l<f;l++)d[c[g][this.c]][l].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.db=function(b){return void 0!==b?(this.f=b,this):this.f};a.prototype.Hb=function(b){if(b){var c=this.q.indexOf(b);-1!==c&&(b.s("insert",this.Wb),b.s("update",this.Yb),b.s("remove",this.Xb),b.s("change",this.Vb),this.q.splice(c,1),c=b.S.indexOf(this),
-1!==c&&b.S.splice(c,1));0===this.q.length&&delete this.c}};a.prototype.find=function(b,c){var d=(new g).primaryKey(this.q[0].primaryKey()),a;for(a=0;a<this.q.length;a++)d.i(this.q[a].find(b));return d.find(b,c)};a.prototype.i=function(b,c){for(var d=0;d<this.q.length;d++)this.q[d].i(b,c)};a.prototype.update=function(b,c){for(var d=0;d<this.q.length;d++)this.q[d].update(b,c)};a.prototype.remove=function(b){for(var c=0;c<this.q.length;c++)this.q[c].remove(b)};a.prototype.T=function(b,c){this.j("insert",
b,c)};a.prototype.ca=function(b,c){this.j("update",b,c)};a.prototype.X=function(b,c){this.j("remove",b,c)};a.prototype.kb=function(){this.j("change")};a.prototype.$=function(b,c){var d=this.find(b,c);return(new g).Ia(this).primaryKey(this.c).setData(d)};a.prototype.K=function(){var b,c=[].concat(this.q),d=[].concat(this.v);this.g&&console.log("Dropping collection group "+this.h);for(b=0;b<c.length;b++)this.Hb(c[b]);for(b=0;b<d.length;b++)this.pb(d[b]);this.j("drop");return!0};f.prototype.d=function(){b.apply(this,
arguments)};p.m=a},{"./Collection":2,"./Overload":13,"./Shared":16}],4:[function(k,p){function a(){this.d.apply(this,arguments)}var h,f;h=k("./Shared.js");a.prototype.d=function(){this.k={};this.g={}};h.n.W=a;f=k("./Overload.js");k("./Collection.js");k("./Metrics.js");k("./Crc.js");a.prototype.ib=!1;a.prototype.wb=function(){return!this.ib};a.prototype.wb=function(){return!this.ib};a.prototype.w=function(b){return JSON.parse(JSON.stringify(b))};a.prototype.debug=new f([function(){return this.g.all},
function(b){return void 0!==b&&"boolean"===typeof b?(this.g.all=b,this):this.g.all},function(b,a){return void 0!==b?void 0!==a?(this.g[b]=a,this):this.g[b]:this.g.all}]);a.prototype.C=function(b,a){this.a=this.a||{};this.a[b]=this.a[b]||[];this.a[b].push(a);return this};a.prototype.s=function(b,a){if(b in this.a){var f=this.a[b],e=f.indexOf(a);-1<e&&f.splice(e,1)}return this};a.prototype.j=function(b,a){this.a=this.a||{};if(b in this.a){var f=this.a[b],e=f.length,c;for(c=0;c<e;c++)f[c].apply(this,
Array.prototype.slice.call(arguments,1))}return this};a.prototype.Ab=function(b){var a,f,e=Math.pow(10,17),c;if(b){a=0;f=b.length;for(c=0;c<f;c++)a+=b.charCodeAt(c)*e;b=a.toString(16)}else h.va++,b=(h.va+(Math.random()*e+Math.random()*e+Math.random()*e+Math.random()*e)).toString(16);return b};p.m=a},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":9,"./Overload.js":13,"./Shared.js":16}],5:[function(k,p){var a=function(){var a=[],f,b,g;for(b=0;256>b;b++){f=b;for(g=0;8>g;g++)f=f&1?3988292384^f>>>1:
f>>>1;a[b]=f}return a}();p.m=function(h){var f=-1,b;for(b=0;b<h.length;b++)f=f>>>8^a[(f^h.charCodeAt(b))&255];return(f^-1)>>>0}},{}],6:[function(k,p){function a(b,a){this.d.apply(this,arguments)}var h,f;h=k("./Shared");a.prototype.d=function(b,a){this.l=a;this.sa=$(this.l.Dc);this.a={};this.k=b;this.l.V=[];var f,e;switch(this.l.type){case "pie":this.sa.Na(this.l.Ma);this.N=this.sa.Na();f=this.k.find();e={Zc:!0,cursor:"pointer",bd:{enabled:!0,ed:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",
style:{color:Highcharts.Hc&&Highcharts.Hc.ad||"black"}}};f=this.Db(f,this.l.Pa,this.l.Ua);$.extend(e,this.l.pd);$.extend(e,{type:"pie",name:this.l.od,data:f});this.N.Yc(e);break;case "line":f=this.yb(this.l.Ec,this.l.Pa,this.l.Ua,this.l.Bb),this.l.Ma.za=f.za,this.l.Ma.V=f.V,this.sa.Na(this.l.Ma),this.N=this.sa.Na()}this.Pb()};h=h.n.Jb;f=h.prototype.d;a.prototype.Db=function(b,a,f){var e=[],c;for(c=0;c<b.length;c++)e.push([b[c][a],b[c][f]]);return e};a.prototype.yb=function(b,a,f,e){var c=this.k.sc(b),
d=[],h={sb:[]},k,p,B,x,w;for(x=0;x<c.length;x++){k=c[x];p={};p[b]=k;B=[];p=this.k.find(p,{Bb:e});for(w=0;w<p.length;w++)h.sb.push(p[w][a]),B.push(p[w][f]);d.push({name:k,data:B})}return{za:h,V:d}};a.prototype.Pb=function(){this.k.C("change",this.Ba);this.k.C("drop",this.Ea)};a.prototype.Ba=function(){if("undefined"!==typeof this.k&&this.N){var b=this.k.find();switch(this.l.type){case "pie":this.N.V[0].setData(this.Db(b,this.l.Pa,this.l.Ua));break;case "line":b=this.yb(this.l.Ec,this.l.Pa,this.l.Ua,
this.l.Bb);this.N.za[0].qd(b.za.sb);for(var a=0;a<b.V.length;a++)this.N.V[a].setData(b.V[a].data)}}};a.prototype.Ea=function(){this.k.s("change",this.Ba);this.k.s("drop",this.Ea)};a.prototype.K=function(){this.N.cd();this.k.s("change",this.Ba);this.k.s("drop",this.Ea);delete this.k.Ob[this.l.Dc];delete this.N;delete this.l;delete this.k;return this};h.prototype.d=function(){this.Ob={};f.apply(this,arguments)};p.m=a},{"./Shared":16}],7:[function(k,p){function a(){this.d.apply(this,arguments)}var h=
k("./Shared"),f=k("./Path");a.prototype.d=function(b,a,f){this.oa={};this.Qb=this.Sb(b,b);this.data({});this.unique(a&&a.unique?a.unique:!1);void 0!==b&&this.keys(b);void 0!==f&&this.ta(f);this.name(a&&a.name?a.name:this.Qb)};h.n.Oc=a;a.prototype.data=function(b){return void 0!==b?(this.b=b,this):this.b};a.prototype.name=function(b){return void 0!==b?(this.h=b,this):this.h};a.prototype.ta=function(b){return void 0!==b?(this.k=b,this):this.k};a.prototype.keys=function(b){return void 0!==b?(this.I=
b,(new f).parse(this.I),this):this.I};a.prototype.type=function(b){return void 0!==b?(this.fc=b,this):this.fc};a.prototype.unique=function(b){return void 0!==b?(this.Ja=b,this):this.Ja};a.prototype.i=function(b){var a,f;this.Ja&&(a=this.qa(b,this.I),this.qb[a]=b);a=this.jb(b,this.I);for(f=0;f<a.length;f++)this.Cc(a[f],b)};a.prototype.remove=function(b){var a,f;this.Ja&&(a=this.qa(b,this.I),delete this.qb[a]);a=this.jb(b,this.I);for(f=0;f<a.length;f++)this.Ac(a[f],b)};a.prototype.Jc=function(b){b=
this.qa(b,this.I);return Boolean(this.qb[b])};a.prototype.Cc=function(b,a){var f=this.b[b]=this.b[b]||[];-1===f.indexOf(a)&&(f.push(a),this.Bc(a,f))};a.prototype.Ac=function(b,a){var f=this.b[b],e;e=f.indexOf(a);-1<e&&(f.splice(e,1),this.zc(a));f.length||delete this.b[b]};a.prototype.Bc=function(b,a){var f=b[this.k.primaryKey()];this.oa[f]=this.oa[f]||[];f=this.oa[f];-1===f.indexOf(a)&&f.push(a)};a.prototype.zc=function(b){b=b[this.k.primaryKey()];delete this.oa[b]};a.prototype.L=function(b){return this.b[this.qa(b,
this.I)]||[]};a.prototype.match=function(b){return(new f).ub(this.I,b)};a.prototype.qa=function(b,a){var h=new f,e,c="",d;e=h.parse(a);for(d=0;d<e.length;d++)c&&(c+="_"),c+=h.value(b,e[d].path).join(":");return c};a.prototype.Sb=function(b,a){var h=new f,e,c="",d;e=h.parse(a);for(d=0;d<e.length;d++)c&&(c+="_"),c+=h.wc(b,e[d].path);return c};a.prototype.jb=function(b,a){var h=new f,e,c=[],d,k,p,v;e=h.parse(a);for(p=0;p<e.length;p++)for(d=h.value(b,e[p].path),k=0;k<d.length;k++)if(0===p)c.push(d[k]);
else for(v=0;v<c.length;v++)c[v]=c[v]+"_"+d[k];return c};p.m=a},{"./Path":14,"./Shared":16}],8:[function(k,p){function a(a){this.d.apply(this,arguments)}var h=k("./Shared");a.prototype.d=function(a){this.h=a;this.b={};this.c="_id"};h.n.Pc=a;a.prototype.name=function(a){return void 0!==a?(this.h=a,this):this.h};a.prototype.primaryKey=function(a){return void 0!==a?(this.c=a,this):this.c};a.prototype.truncate=function(){this.b={};return this};a.prototype.set=function(a,b){this.b[a]=b?b:!0;return this};
a.prototype.get=function(a){return this.b[a]};a.prototype.L=function(a){a=a[this.c];var b,g,h,e;if(a instanceof Array){g=a.length;e=[];for(b=0;b<g;b++)(h=this.b[a[b]])&&e.push(h);return e}if(a instanceof RegExp){e=[];for(b in this.b)this.b.hasOwnProperty(b)&&a.test(b)&&e.push(this.b[b]);return e}if("object"===typeof a){if(a.Ib){e=[];for(b in this.b)this.b.hasOwnProperty(b)&&b!==a.Ib&&e.push(this.b[b]);return e}if(a.Va&&a.Va instanceof Array){e=[];for(b in this.b)this.b.hasOwnProperty(b)&&-1<a.Va.indexOf(b)&&
e.push(this.b[b]);return e}if(a.Xa&&a.Xa instanceof Array){e=[];for(b in this.b)this.b.hasOwnProperty(b)&&-1===a.Xa.indexOf(b)&&e.push(this.b[b]);return e}if(a.Aa&&a.Aa instanceof Array){e=[];for(b=0;b<a.Aa.length;b++)e=e.concat(this.L(a.Aa[b]));return e}}else return h=this.b[a],void 0!==h?[h]:[]};a.prototype.ya=function(a){delete this.b[a]};a.prototype.ja=function(a,b){return void 0===this.b[a]?(this.b[a]=b,!0):!1};p.m=a},{"./Shared":16}],9:[function(k,p){function a(){this.d.apply(this,arguments)}
var h=k("./Shared"),f=k("./Operation");a.prototype.d=function(){this.b=[]};h.n.Qc=a;a.prototype.create=function(a){a=new f(a);this.cb&&this.b.push(a);return a};a.prototype.start=function(){this.cb=!0;return this};a.prototype.stop=function(){this.cb=!1;return this};p.m=a},{"./Operation":12,"./Shared":16}],10:[function(k){var p;k=k("./Shared").n.Kb;p=k.prototype.d;k.prototype.d=function(){var a=this;this.$a=[];this.R={i:[],update:[],remove:[],H:[],la:[],na:[],ma:[],Za:[]};this.ba={i:100,update:100,
remove:100,H:100,la:100,na:100,ma:100,Za:100};this.Da={i:100,update:1,remove:1,H:1,la:100,na:1,ma:1,Za:1};p.apply(this,arguments);this.C("insert",function(h,f){a.ka("insert",h,f)});this.C("update",function(h,f){a.ka("update",h,f)});this.C("remove",function(h,f){a.ka("remove",h,f)});this.C("change",a.Nb)};k.prototype.pc=function(a,h){var f=$(a),b,g,l;this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",h);for(b=0;b<h.length;b++)g=h[b],l=f.find("#"+g[this.c]),l.length?0===b?
(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",l),f.Eb(l)):(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+b+"...",l),l.fd(f.children(":eq("+(b-1)+")"))):this.debug()&&console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",g)};k.prototype.oc=function(a){var h=this.$a,f,b;a||(a={data:this.find()});for(f in h)h.hasOwnProperty(f)&&(b=h[f],this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting DOM..."),
this.pc(f,a.data),b.lc&&b.lc(),b.refresh&&b.refresh())};k.prototype.ga=function(a,h){var f=this.R[a],b=this.ba[a],g=this.Da[a];if(f.length){var l=this;f.length&&(f=f.length>b?f.splice(0,b):f.splice(0,f.length),this.ka(a,f,[]));setTimeout(function(){l.ga(a,h)},g)}else h&&h(),this.j("bindQueueComplete")};k.prototype.ka=function(a,h,f){var b=this.$a,g=this.find({}),l,e;for(e in b)if(b.hasOwnProperty(e))switch(l=b[e].reduce?this.find(b[e].reduce.t,b[e].reduce.options):g,a){case "insert":this.la(e,b[e],
h,f,l);break;case "update":this.na(e,b[e],h,f,l);break;case "remove":this.ma(e,b[e],h,f,l)}};k.prototype.Nb=function(a){this.debug()&&console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",a);this.oc(a)};k.prototype.la=function(a,h,f,b,g){var l=$(a),e;for(e=0;e<f.length;e++)a=l.find("#"+f[e][this.c]),a.length||h.Gc(f[e],function(a,b,e,f){return function(a){h.i?h.i(a,b,e,f):h.kd?l.Eb(a):l.append(a);h.kc&&h.kc(a,b,e,f)}}(a,f[e],b,g))};k.prototype.na=function(a,h,f,b,g){var l=
$(a);for(b=0;b<f.length;b++)a=l.find("#"+f[b][this.c]),h.Gc(f[b],function(a,b){return function(d){h.update?h.update(d,b,g,a.length?"update":"append"):a.length?a.nd(d):h.ld?l.Eb(d):l.append(d);h.mc&&h.mc(d,b,g)}}(a,f[b]))};k.prototype.ma=function(a,h,f,b,g){a=$(a);var l;for(l=0;l<f.length;l++)b=a.find("#"+f[l][this.c]),b.length&&(h.nc?h.nc(b,f[l],g,function(a,b,d){return function(){h.remove?h.remove(a,b,d):(a.remove(),h.La&&h.La(a,b,d))}}(b,f[l],g)):h.remove?h.remove(b,f[l],g):(b.remove(),h.La&&h.La(b,
f[l],g)))}},{"./Shared":16}],11:[function(k,p){function a(){this.d.apply(this,arguments)}var h,f,b,g,l,e,c;h=k("./Shared");a.prototype.d=function(a){this.h=a;this.S=[];this.a={};this.J={t:{},options:{}}};h.n.Kb=a;f=k("./CollectionGroup");b=k("./Collection");g=b.prototype.d;l=f.prototype.d;c=k("./Overload");h=h.n.W;e=h.prototype.d;a.prototype.C=new c([function(a,b){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a]["*"]=this.a[a]["*"]||[];this.a[a]["*"].push(b);return this},function(a,b,c){this.a=
this.a||{};this.a[a]=this.a[a]||{};this.a[a][b]=this.a[a][b]||[];this.a[a][b].push(c);return this}]);a.prototype.s=new c([function(a){this.a&&this.a[a]&&a in this.a&&delete this.a[a];return this},function(a,b){var c,e;"string"===typeof b?this.a&&this.a[a]&&this.a[a][b]&&delete this.a[a][b]:a in this.a&&(c=this.a[a]["*"],e=c.indexOf(b),-1<e&&c.splice(e,1));return this},function(a,b,c){this.a&&a in this.a&&(a=this.a[a][b],c=a.indexOf(c),-1<c&&a.splice(c,1))}]);a.prototype.j=function(a,b){this.a=this.a||
{};if(a in this.a){if(this.a[a]["*"]){var c=this.a[a]["*"],e=c.length,f;for(f=0;f<e;f++)c[f].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this.c]){var c=this.a[a],g,h,e=b.length;for(f=0;f<e;f++)if(c[b[f][this.c]])for(g=c[b[f][this.c]].length,h=0;h<g;h++)c[b[f][this.c]][h].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.K=function(){return(this.f||this.o)&&this.h?(this.debug()&&console.log("ForerunnerDB.OldView: Dropping view "+
this.h),this.j("drop"),this.f&&delete this.f.ra[this.h],this.o&&delete this.o.ra[this.h],!0):!1};a.prototype.debug=function(){return!1};a.prototype.db=function(a){return void 0!==a?(this.f=a,this):this.f};a.prototype.primaryKey=function(){if(this.o)return this.o.primaryKey()};a.prototype.t=function(a,b){return void 0!==a?(this.J.t=a,void 0!==b&&!0!==b||this.refresh(),this):this.J.t};a.prototype.refresh=function(a){if(this.o){var b=this.b,c,e,f,g,h,l=[],k=[],m=[],n;this.debug()&&(console.log("ForerunnerDB.OldView: Refreshing view "+
this.h),console.log("ForerunnerDB.OldView: Existing data: "+("undefined"!==typeof this.b)),"undefined"!==typeof this.b&&console.log("ForerunnerDB.OldView: Current data rows: "+this.b.find().length));this.J?(this.debug()&&console.log("ForerunnerDB.OldView: View has query and options, getting subset..."),this.b=this.o.$(this.J.t,this.J.options)):this.J.options?(this.debug()&&console.log("ForerunnerDB.OldView: View has options, getting subset..."),this.b=this.o.$({},this.J.options)):(this.debug()&&console.log("ForerunnerDB.OldView: View has no query or options, getting subset..."),
this.b=this.o.$({}));if(!a&&b)if(this.debug()&&console.log("ForerunnerDB.OldView: Refresh not forced, old data detected..."),e=this.b,b.Ya===e.Ya){this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from same collection...");f=e.find();a=b.find();g=e.c;for(n=0;n<f.length;n++)h=f[n],c={},c[g]=h[g],(c=b.find(c)[0])?JSON.stringify(c)!==JSON.stringify(h)&&k.push(h):l.push(h);for(n=0;n<a.length;n++)h=a[n],c={},c[g]=h[g],e.find(c)[0]||m.push(h);this.debug()&&(console.log("ForerunnerDB.OldView: Removed "+
m.length+" rows"),console.log("ForerunnerDB.OldView: Inserted "+l.length+" rows"),console.log("ForerunnerDB.OldView: Updated "+k.length+" rows"));l.length&&this.T(l,[]);k.length&&this.ca(k,[]);m.length&&this.X(m,[])}else this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from different collections..."),m=b.find(),m.length&&this.X(m),l=e.find(),l.length&&this.T(l);else this.debug()&&console.log("ForerunnerDB.OldView: Forcing data update",f),this.b=this.o.$(this.J.t,this.J.options),
f=this.b.find(),this.debug()&&console.log("ForerunnerDB.OldView: Emitting change event with data",f),this.T(f,[]);this.debug()&&console.log("ForerunnerDB.OldView: Emitting change");this.j("change")}return this};a.prototype.count=function(){return this.b&&this.b.b?this.b.b.length:0};a.prototype.find=function(){return this.b?(this.debug()&&console.log("ForerunnerDB.OldView: Finding data in view collection...",this.b),this.b.find.apply(this.b,arguments)):[]};a.prototype.i=function(){return this.o?this.o.i.apply(this.o,
arguments):[]};a.prototype.update=function(){return this.o?this.o.update.apply(this.o,arguments):[]};a.prototype.remove=function(){return this.o?this.o.remove.apply(this.o,arguments):[]};a.prototype.T=function(a,b){this.j("insert",a,b)};a.prototype.ca=function(a,b){this.j("update",a,b)};a.prototype.X=function(a,b){this.j("remove",a,b)};a.prototype.kb=function(){this.debug()&&console.log("ForerunnerDB.OldView: Refreshing data");this.refresh()};b.prototype.d=function(){this.ra=[];g.apply(this,arguments)};
f.prototype.d=function(){this.ra=[];l.apply(this,arguments)};h.prototype.d=function(){this.ra={};e.apply(this,arguments)};p.m=a},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],12:[function(k,p){function a(a){this.Cb=new f;this.d.apply(this,arguments)}var h=k("./Shared"),f=k("./Path");a.prototype.d=function(a){this.b={hd:a,index:{jd:[],sd:!1},Fc:[],time:{ia:0,wa:0,xa:0,yc:{}},fa:{},log:[]}};h.n.Rc=a;a.prototype.start=function(){this.b.time.ia=(new Date).getTime()};a.prototype.log=
function(a){if(a){var f=0<this.Xc.length?this.b.log[this.b.log.length-1].time:0;a={event:a,time:(new Date).getTime(),rc:0};this.b.log.push(a);f&&(a.rc=a.time-f);return this}return this.b.log};a.prototype.time=function(a){if(void 0!==a){var f=this.b.time.yc,f=f[a]=f[a]||{};f.ia?(f.wa=(new Date).getTime(),f.xa=f.wa-f.ia,f.Sa.xa=f.xa,delete f.Sa):(f.ia=(new Date).getTime(),f.Sa={name:a},this.b.Fc.push(f.Sa));return this}return this.b.time};a.prototype.fa=function(a,f){if(void 0!==a&&void 0!==f)this.b.fa[a]=
f;else return void 0!==a?this.b.fa[a]:this.b.fa};a.prototype.data=function(a,f){return void 0!==f?(this.Cb.set(this.b,a,f),this):this.Cb.get(this.b,a)};a.prototype.stop=function(){this.b.time.wa=(new Date).getTime();this.b.time.xa=this.b.time.wa-this.b.time.ia};p.m=a},{"./Path":14,"./Shared":16}],13:[function(k,p){function a(a){if(a){var f,b=a.length;return function(){for(f=0;f<b;f++)if(a[f].length===arguments.length)return a[f].apply(this,arguments);return null}}return function(){}}k("./Shared").n.Sc=
a;p.m=a},{"./Shared":16}],14:[function(k,p){function a(a){this.d.apply(this,arguments)}var h=k("./Shared");a.prototype.d=function(a){a&&this.path(a)};h.n.Tc=a;a.prototype.path=function(a){return void 0!==a?(this.lb=this.ea(a),this.mb=this.lb.split("."),this):this.lb};a.prototype.tb=function(a){var b=0,g;for(g in a)a.hasOwnProperty(g)&&void 0!==a[g]&&("object"!==typeof a[g]?b++:b+=this.tb(a[g]));return b};a.prototype.ub=function(a,b){var g,h={},e=0,c=0,d;for(d in b)b.hasOwnProperty(d)&&("object"===
typeof b[d]?(g=this.ub(a[d],b[d]),h[d]=g.zb,c+=g.aa,e+=g.B):(c++,a&&a[d]&&"object"!==typeof a[d]?(h[d]=!0,e++):h[d]=!1));return{zb:h,B:e,aa:c}};a.prototype.parse=function(a,b){var g=[],h="",e,c,d;for(c in a)if(a.hasOwnProperty(c))if(h=c,"object"===typeof a[c])if(b)for(e=this.parse(a[c],b),d=0;d<e.length;d++)g.push({path:h+"."+e[d].path,value:e[d].value});else for(e=this.parse(a[c]),d=0;d<e.length;d++)g.push({path:h+"."+e[d].path});else b?g.push({path:h,value:a[c]}):g.push({path:h});return g};a.prototype.value=
function(a,b){if(void 0!==a&&"object"===typeof a){var g,h,e,c,d=[],k;void 0!==b&&(b=this.ea(b),g=b.split("."));g=g||this.mb;h=g.length;e=a;for(k=0;k<h;k++){e=e[g[k]];if(c instanceof Array){for(h=0;h<c.length;h++)d=d.concat(this.value(c,h+"."+g[k]));return d}if(!e||"object"!==typeof e)break;c=e}return[e]}return[]};a.prototype.set=function(a,b,g){if(void 0!==a&&void 0!==b){var h;b=this.ea(b);b=b.split(".");h=b.shift();b.length?(a[h]=a[h]||{},this.set(a[h],b.join("."),g)):a[h]=g}return a};a.prototype.get=
function(a,b){return this.value(a,b)[0]};a.prototype.push=function(a,b,g){if(void 0!==a&&void 0!==b){var h;b=this.ea(b);b=b.split(".");h=b.shift();if(b.length)a[h]=a[h]||{},this.set(a[h],b.join("."),g);else if(a[h]=a[h]||[],a[h]instanceof Array)a[h].push(g);else throw"Cannot push to a path whose endpoint is not an array!";}return a};a.prototype.wc=function(a,b){var g,h,e,c,d;void 0!==b&&(b=this.ea(b),g=b.split("."));g=g||this.mb;h=g.length;e=a;for(d=0;d<h;d++)if(e=e[g[d]],!e||"object"!==typeof e){c=
g[d]+":"+e;break}return c};a.prototype.ea=function(a){"."===a.substr(0,1)&&(a=a.substr(1,a.length-1));return a};p.m=a},{"./Shared":16}],15:[function(k,p){var a=k("./Shared"),h,f,b,g;g=function(){this.d.apply(this,arguments)};g.prototype.d=function(a){a.wb()&&void 0!==Storage&&this.mode("localStorage")};a.n.Uc=g;a=a.n.W;h=k("./Collection");f=h.prototype.K;k("./CollectionGroup");k("./Overload");b=a.prototype.d;g.prototype.mode=function(a){return void 0!==a?(this.Tb=a,this):this.Tb};g.prototype.K=function(a,
b){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(c){b&&b(c)}b&&b(!1)}b&&b("No data handler or unrecognised data type.")};h.prototype.K=function(a){if(a)if(this.h)if(this.f)this.f.xc.K(this.h);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),
"Cannot drop a collection's persistent storage when no name assigned to collection!";f.apply(this)};a.prototype.d=function(){this.xc=new g(this);b.apply(this,arguments)};p.m=g},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],16:[function(k,p){p.m={va:0,n:{},md:{}}},{}],17:[function(k,p){function a(a,b,d){this.d.apply(this,arguments)}var h,f,b,g,l;h=k("./Shared");a.prototype.d=function(a,b,d){this.h=a;this.O=[];this.S=[];this.a={};this.U={t:b,options:d};this.g={};this.e=new f("__FDB__view_privateData_"+
this.h)};h.n.Vc=a;f=k("./Collection");l=k("./Overload");b=f.prototype.d;h=h.n.W;g=h.prototype.d;a.prototype.debug=new l([function(){return this.g.all},function(a){return void 0!==a&&"boolean"===typeof a?(this.g.all=a,this.e.debug(a),this.ha().debug(a),this):this.g.all},function(a,b){return void 0!==a?void 0!==b?(this.g[a]=b,this.e.debug(a,b),this.ha().debug(a,b),this):this.g[a]:this.g.all}]);a.prototype.name=function(a){return void 0!==a?(this.h=a,this):this.h};a.prototype.find=function(a,b){return this.ha().find(a,
b)};a.prototype.i=function(a,b,d){a=this.e.w(a);"function"===typeof b?(d=b,b=this.e.length):void 0===b&&(b=this.e.length);this.ac(a,b);this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');return this.e.hb(a,b,d)};a.prototype.update=function(a,b){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');
var d=this.e.update(a,b),f,g,h;if(this.p&&this.P){f=this.r.primaryKey();for(var k=0;k<d.length;k++)g={},h=d[k],g[f]=h[f],this.ec(g,h)}return d};a.prototype.remove=function(a){this.cc(a);this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');return this.e.remove(a)};a.prototype.Zb=function(a){-1<this.O.indexOf(a)&&(this.O.splice(a,1),a.pb(this),this.e.remove(a.find(this.U.t,this.U.options)))};a.prototype.C=
function(){this.e.C.apply(this.e,arguments)};a.prototype.s=function(){this.e.s.apply(this.e,arguments)};a.prototype.j=function(){this.e.j.apply(this.e,arguments)};a.prototype.K=function(){if(this.O&&this.O.length){(this.debug()||this.f&&this.f.debug())&&console.log("ForerunnerDB.View: Dropping view "+this.h);this.j("drop");for(var a=this.O.length;a--;)this.Zb(this.O[a]);this.e.K();return!0}return!1};a.prototype.db=function(a){return void 0!==a?(this.f=a,this.e.db(a),this.ha().db(a),this):this.f};
a.prototype.primaryKey=function(){return this.e.primaryKey()};a.prototype.t=function(a,b){return void 0!==a?(this.U.t=a,void 0!==b&&!0!==b||this.refresh(),this):this.U.t};a.prototype.refresh=function(){var a,b=this.ha(),d;this.e.remove();b.remove();for(d=0;d<this.O.length;d++)a=this.O[d],this.e.i(a.find(this.U.t,this.U.options));a=this.e.find({},this.U.options);b.D?$.M(b.b).refresh(a):(this.e.b.length=0,this.e.b=this.e.b.concat(a));return this};a.prototype.count=function(){return this.e&&this.e.b?
this.e.b.length:0};a.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this.p=a.enabled),void 0!==a.Y&&(this.P=a.Y),void 0!==a.Z&&(this.Q=a.Z)):this.p=!1===a?!1:!0,this.bc(this.e.primaryKey()),this.dc(this.e.find()),this):{enabled:this.p,Y:this.P,Z:this.Q}};a.prototype.ha=function(){return this.p?this.r:this.e};a.prototype.dc=function(a){this.p&&(this.r=new f("__FDB__view_publicData_"+this.h),this.r.db(this.e.f),this.r.transform({enabled:!0,Y:this.P,Z:this.Q}),
this.r.setData(a))};a.prototype.ac=function(a,b){this.p&&this.r&&this.r.i(a,b)};a.prototype.ec=function(a,b){this.p&&this.r&&this.r.update(a,b)};a.prototype.cc=function(a){this.p&&this.r&&this.r.remove(a)};a.prototype.bc=function(a){this.p&&this.r&&this.r.primaryKey(a)};f.prototype.d=function(){this.v=[];b.apply(this,arguments)};f.prototype.pb=function(a){void 0!==a&&(a=this.v.indexOf(a),-1<a&&this.v.splice(a,1))};h.prototype.d=function(){this.v={};g.apply(this,arguments)};p.m=a},{"./Collection":2,
"./Overload":13,"./Shared":16}]},{},[1])(1)}if("object"==typeof exports&&"undefined"!=typeof module)module.m=z();else if("function"==typeof define&&define.$c)define([],z);else{var A;"undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self);A.Nc=z()}!0;
