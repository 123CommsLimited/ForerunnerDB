(function(){var h=ForerunnerDB.classes.View,k=ForerunnerDB.classes.View.prototype.init;h.prototype.init=function(){var d=this;this._binds=[];k.apply(this,arguments);this.on("insert",function(b,c){d._bindEvent("insert",b,c)});this.on("update",function(b,c){d._bindEvent("update",b,c)});this.on("remove",function(b,c){d._bindEvent("remove",b,c)});this.on("change",d._bindChange)};h.prototype.bind=function(d,b){if(b&&b.template)this._binds[d]=b;else throw"Cannot bind data to element, missing options information!";
return this};h.prototype.unBind=function(d){delete this._binds[d];return this};h.prototype.bindSortDom=function(d,b){var c=$(d),a,g;for(a=0;a<b.length;a++)g=b[a],g=c.find("#"+g[this._primaryKey]),0===a?c.prepend(g):g.insertAfter(c.children(":eq("+(a-1)+")"))};h.prototype.bindRefresh=function(d){var b=this._binds,c,a;for(c in b)b.hasOwnProperty(c)&&(a=b[c],a.maintainSort&&this.bindSortDom(c,d.data),a.afterOperation&&a.afterOperation())};h.prototype.bindRender=function(d,b){var c=this._binds[d],a=$(d),
g,f,e=$("<ul></ul>"),h;if(c){g=this._data.find();for(h=0;h<g.length;h++)f=g[h],c.template(f,function(b){e.append(b)});b?b(d,e.html()):a.append(e.html())}};h.prototype._bindEvent=function(d,b,c){var a=this._binds,g=this.find({}),f,e;for(e in a)if(a.hasOwnProperty(e))switch(f=a[e].reduce?this.find(a[e].reduce.query,a[e].reduce.options):g,d){case "insert":this._bindInsert(e,a[e],b,c,f);break;case "update":this._bindUpdate(e,a[e],b,c,f);break;case "remove":this._bindRemove(e,a[e],b,c,f)}};h.prototype._bindChange=
function(d){this.bindRefresh(d)};h.prototype._bindInsert=function(d,b,c,a,g){var f=$(d),e;for(e=0;e<c.length;e++)d=f.find("#"+c[e][this._primaryKey]),d.length||b.template(c[e],function(a,c,d,e){return function(a){b.insert?b.insert(a,c,d,e):b.prependInsert?f.prepend(a):f.append(a);b.afterInsert&&b.afterInsert(a,c,d,e)}}(d,c[e],a,g))};h.prototype._bindUpdate=function(d,b,c,a,g){var f=$(d);for(a=0;a<c.length;a++)d=f.find("#"+c[a][this._primaryKey]),b.template(c[a],function(a,c){return function(d){b.update?
b.update(d,c,g,a.length?"update":"append"):a.length?a.replaceWith(d):b.prependUpdate?f.prepend(d):f.append(d);b.afterUpdate&&b.afterUpdate(d,c,g)}}(d,c[a]))};h.prototype._bindRemove=function(d,b,c,a,g){d=$(d);var f;for(f=0;f<c.length;f++)a=d.find("#"+c[f][this._primaryKey]),a.length&&(b.beforeRemove?b.beforeRemove(a,c[f],g,function(a,c,d){return function(){b.remove?b.remove(a,c,d):(a.remove(),b.afterRemove&&b.afterRemove(a,c,d))}}(a,c[f],g)):b.remove?b.remove(a,c[f],g):(a.remove(),b.afterRemove&&
b.afterRemove(a,c[f],g)))}})();
