(function(){var d=function(d,a){asyncTest("Events - Collection.on() :: Insert with Success",function(){a.dbUp();a.dataUp();expect(1);user.on("insert",function(a,b){ok(1===a.length,"Insert single document");start()});user.insert({_id:"2342",name:"hello"});a.dbDown()});asyncTest("Events - Collection.on() :: Insert with Failed",function(){a.dbUp();a.dataUp();expect(1);user.insert({_id:"2342",name:"hello"});user.on("insert",function(a,b){ok(1===b.length,"Insert single document with index violation");
start()});user.insert({_id:"2342",name:"hello"});a.dbDown()});asyncTest("Events - Collection.on() :: Update with Success",function(){a.dbUp();a.dataUp();expect(1);user.insert({_id:"2342",name:"hello"});user.on("update",function(a,b){console.log("Updated");ok(1===a.length,"Update single document");start()});console.log("Calling update");user.update({_id:"2342"},{name:"hello2"});a.dbDown()});asyncTest("Events - Collection.on() :: Update Key Array Data with Success",function(){a.dbUp();a.dataUp();expect(1);
user.insert({_id:"2342",name:[{said:"hello"}]});user.on("update",function(a,b){console.log("Updated",a);ok(1===a.length,"Update single document");start()});console.log("Calling update");user.update({_id:"2342",name:{said:"hello"}},{"name.$":{said:"hello2"}});a.dbDown()});asyncTest("Events - Collection.on() :: Remove with Success",function(){a.dbUp();a.dataUp();expect(1);user.insert({_id:"2342",name:"hello"});user.on("remove",function(a,b){ok(1===a.length,"Remove single document");start()});user.remove({_id:"2342"});
a.dbDown()});asyncTest("Events - View.on() :: Insert",function(){a.dbUp();a.dataUp();a.viewUp();expect(1);db.oldView("userView").on("insert",function(a,b){console.log("insert");ok(1===a.length,"Insert single document");start()});user.insert({_id:"2342",name:"hello"});a.viewDown();a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Insert :: Event fired from collection",function(){a.dbUp();a.dataUp();expect(1);db.collectionGroup("testGroup").addCollection(user).on("insert",function(a,b){ok(1===
a.length,"Insert single document");start()});user.insert({_id:"2342",name:"hello"});a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Update :: Event fired from collection",function(){a.dbUp();a.dataUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(user).on("update",function(a,b){ok(1===a.length,"Update single document");start()});user.update({_id:"2342"},{name:"hello2"});a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Update With Specific ID Selector :: Event fired from collection",
function(){a.dbUp();a.dataUp();expect(2);user.insert({_id:"2342",name:"hello"});user.insert({_id:"2343",name:"hello"});var c=db.collectionGroup("testGroup").addCollection(user);c.on("update","2342",function(a,c){ok(1===a.length&&"2342"===a[0]._id,"Update single document")});c.on("update","2343",function(a,c){ok(1===a.length&&"2343"===a[0]._id,"Update single document");start()});user.update({_id:"2342"},{name:"hello2"});user.update({_id:"2343"},{name:"hello2"});a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Remove :: Event fired from collection",
function(){a.dbUp();a.dataUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(user).on("remove",function(a,b){ok(1===a.length,"Remove single document");start()});user.remove({_id:"2342"});a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Insert :: Event fired from view",function(){a.dbUp();a.dataUp();a.viewUp();expect(1);db.collectionGroup("testGroup").addCollection(userView).on("insert",function(a,b){ok(1===a.length,"Insert single document");
start()});user.insert({_id:"2342",name:"hello"});a.viewDown();a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Update :: Event fired from view",function(){a.dbUp();a.dataUp();a.viewUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(userView).on("update",function(a,b){ok(1===a.length,"Update single document");start()});user.update({_id:"2342"},{name:"hello2"});a.viewDown();a.dbDown()});asyncTest("Events - CollectionGroup.on() :: Remove :: Event fired from view",
function(){a.dbUp();a.dataUp();a.viewUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(userView).on("remove",function(a,b){ok(1===a.length,"Remove single document");start()});user.remove({_id:"2342"});a.viewDown();a.dbDown()})};"function"===typeof define&&define.amd?require(["../ForerunnerDB","./base"],function(e,a){d(e,a)}):d(ForerunnerDB,base)})();
