fdb-all.js:1: WARNING - Suspicious code. The result of the 'not' operator is not being used.
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.ForerunnerDB=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
^

0 error(s), 1 warning(s)
function n(F){throw F;}var q=void 0,s=!0,u=!1;
function C(){return function k(r,a,h){function f(g,d){if(!a[g]){if(!r[g]){var b="function"==typeof require&&require;if(!d&&b)return b(g,s);if(e)return e(g,s);b=Error("Cannot find module '"+g+"'");n((b.code="MODULE_NOT_FOUND",b))}b=a[g]={m:{}};r[g][0].call(b.m,function(b){var d=r[g][1][b];return f(d?d:b)},b,b.m,k,r,a,h)}return a[g].m}for(var e="function"==typeof require&&require,g=0;g<h.length;g++)f(h[g]);return f}({1:[function(k,r){var a=k("../lib/Core");k("../lib/CollectionGroup");k("../lib/View");
k("../lib/OldView");k("../lib/OldView.Bind");k("../lib/Highcharts");k("../lib/Persist");r.m=a},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Highcharts":6,"../lib/OldView":11,"../lib/OldView.Bind":10,"../lib/Persist":15,"../lib/View":17}],2:[function(k,r){function a(b){this.d.apply(this,arguments)}var h,f,e,g,l,d;h=k("./Shared");a.prototype.d=function(b){this.c="_id";this.D=new l("primary");this.Ga=new l("primaryCrc");this.Ba=new l("crcLookup");this.h=b;this.b=[];this.S=[];this.Ea=new g;this.C=
0;this.f={};this.R={j:[],update:[],remove:[],G:[]};this.ba={j:100,update:100,remove:100,G:100};this.Ca={j:1,update:1,remove:1,G:1};this.Ia(this)};h.n.Jb=a;e=k("./Overload");g=k("./Metrics");l=k("./KeyValueStore");d=k("./Path");k("./Index");k("./Crc");f=h.n.W;a.prototype.debug=new e([function(){return this.f.all},function(b){if(b!==q){if("boolean"===typeof b){this.f.all=b;for(var c=0;c<this.v.length;c++)this.v[c].debug(b);return this}return this.f[b]||this.g&&this.g.f&&this.g.f[b]||this.f.all}return this.f.all},
function(b,c){if(b!==q){if(c!==q){this.f[b]=c;for(var d=0;d<this.v.length;d++)this.v[d].debug(b,c);return this}return this.f[b]||this.g&&this.g.f&&this.g.f[b]}return this.f.all}]);a.prototype.name=function(b){return b!==q?(this.h=b,this):this.h};a.prototype.B=new e([function(b,c){this.a=this.a||{};this.a[b]=this.a[b]||{};this.a[b]["*"]=this.a[b]["*"]||[];this.a[b]["*"].push(c);return this},function(b,c,d){this.a=this.a||{};this.a[b]=this.a[b]||{};this.a[b][c]=this.a[b][c]||[];this.a[b][c].push(d);
return this}]);a.prototype.s=new e([function(b){this.a&&(this.a[b]&&b in this.a)&&delete this.a[b];return this},function(b,c){var d,e;"string"===typeof c?this.a&&(this.a[b]&&this.a[b][c])&&delete this.a[b][c]:b in this.a&&(d=this.a[b]["*"],e=d.indexOf(c),-1<e&&d.splice(e,1));return this},function(b,c,d){this.a&&b in this.a&&(b=this.a[b][c],d=b.indexOf(d),-1<d&&b.splice(d,1))}]);a.prototype.i=function(b,c){this.a=this.a||{};if(b in this.a){if(this.a[b]["*"]){var d=this.a[b]["*"],e=d.length,a;for(a=
0;a<e;a++)d[a].apply(this,Array.prototype.slice.call(arguments,1))}if(c instanceof Array&&c[0]&&c[0][this.c]){var d=this.a[b],f,g,e=c.length;for(a=0;a<e;a++)if(d[c[a][this.c]]){f=d[c[a][this.c]].length;for(g=0;g<f;g++)d[c[a][this.c]][g].apply(this,Array.prototype.slice.call(arguments,1))}}}return this};a.prototype.J=function(){if(this.g&&this.h){this.debug()&&console.log("Dropping collection "+this.h);this.i("drop");delete this.g.k[this.h];var b=[],c;for(c=0;c<this.S.length;c++)b.push(this.S[c]);
for(c=0;c<b.length;c++)this.S[c].Hb(this);return s}return u};a.prototype.primaryKey=function(b){return b!==q?(this.c=b,this.D.primaryKey(b),this.nb(),this):this.c};a.prototype.O=function(b,c){this.i("insert",b,c)};a.prototype.X=function(b){this.i("update",b)};a.prototype.T=function(b){this.i("remove",b)};a.prototype.db=function(b){return b!==q?(this.g=b,this):this.g};a.prototype.setData=function(b,c,d){if(b){var e=this.Ea.create("setData");e.start();b instanceof Array||(b=[b]);e.time("transformIn");
b=this.Ta(b);e.time("transformIn");var a=this.b;this.b=[];b.length&&(this.b=this.b.concat(b));e.time("_rebuildPrimaryKeyIndex");this.nb(c);e.time("_rebuildPrimaryKeyIndex");e.stop();this.i("setData",this.b,a)}d&&d(u);return this};a.prototype.nb=function(b){var c=b&&b.vc!==q?b.vc:s;b=b&&b.Lc!==q?b.Lc:s;var d,e,a,f=this.D,g=this.Ga,l=this.Ba,h=this.c,k;f.truncate();g.truncate();l.truncate();d=this.b;for(e=d.length;e--;)a=d[e],c&&this.eb(a),b?f.ia(a[h],a)||n("Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+
a[this.c]):(k=JSON.stringify(a),f.set(a[h],a),g.set(a[h],k),l.set(k,a))};a.prototype.eb=function(b){b[this.c]===q&&(b[this.c]=this.Ab())};a.prototype.truncate=function(){this.i("truncate",this.b);this.b.length=0;this.ta("change");return this};a.prototype.G=function(b,c){if(b){var d=this.R.G,e=this.ba.G,a={},f;if(b instanceof Array){if(b.length>e){this.R.G=d.concat(b);this.fa("upsert",c);return}a=[];for(d=0;d<b.length;d++)a.push(this.G(b[d]));c&&c();return a}b[this.c]?(f={},f[this.c]=b[this.c],this.count(f)?
a.Ra="update":a.Ra="insert"):a.Ra="insert";switch(a.Ra){case "insert":a.result=this.j(b);break;case "update":a.result=this.update(f,b)}return a}c&&c()};a.prototype.update=function(b,c,d){function a(f){if(c&&c[g]!==q&&c[g]!=f[g]){e.D.xa(f[g]);var G=e.ca(f,c,b,d,"");if(e.D.ia(f[g],f))return G;n("Primary key violation in update! Key violated: "+f[g])}return e.ca(f,c,b,d,"")}c=this.w(c);c=this.Ta(c);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var e=this,
f=this.Ea.create("update"),g=this.c,l,h,k=this.v;f.start();f.time("Retrieve documents to update");l=this.find(b,{w:u});f.time("Retrieve documents to update");if(l.length&&(f.time("Update documents"),h=l.filter(a),f.time("Update documents"),h.length)){if(k&&k.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());f.time("Inform views of update");for(l=0;l<k.length;l++)k[l].update(b,c);f.time("Inform views of update")}this.X(h);this.ta("change",{type:"update",data:h})}f.stop();
return h||[]};a.prototype.ca=function(b,c,e,a,f){c=this.w(c);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));var g=u,l=u,h,k,t,m,p;for(m in c)if(c.hasOwnProperty(m)){h=u;if("$"===m.substr(0,1))switch(m){case "$inc":h=s;for(p in c[m])c[m].hasOwnProperty(p)&&"$"!==p.substr(0,1)&&("number"===typeof b[p]?(this.hc(b,p,c[m][p]),g=s):n("Cannot increment field that is not a number! ("+p+")!"));break;case "$push":h=s;for(p in c[m])c[m].hasOwnProperty(p)&&"$"!==p.substr(0,1)&&(b[p]instanceof Array?
(this.rb(b[p],c[m][p]),g=s):n("Cannot push to a key that is not an array! ("+p+")!"));break;case "$addToSet":h=s;for(p in c[m])if(c[m].hasOwnProperty(p)&&"$"!==p.substr(0,1))if(b[p]instanceof Array){k=b[p];var r;t=k.length;var w,l=s;r=a&&a.Mc;var y,v;r&&r.key?(y=u,v=new d(r.key),w=v.value(c[m][p])[0]):(w=JSON.stringify(c[m][p]),y=s);for(r=0;r<t;r++)if(y){if(JSON.stringify(k[r])===w){l=u;break}}else if(w===v.value(k[r])[0]){l=u;break}l&&(this.rb(b[p],c[m][p]),g=s)}else n("Cannot push to a key that is not an array! ("+
p+")!");break;case "$splicePush":h=s;for(p in c[m])c[m].hasOwnProperty(p)&&"$"!==p.substr(0,1)&&(b[p]instanceof Array?(k=c[m].Wa,k!==q?(delete c[m][p].Wa,this.kc(b[p],k,c[m][p]),g=s):n("Cannot splicePush without a $index integer value!")):n("Cannot splicePush with a key that is not an array! ("+p+")!"));break;case "$move":h=s;for(p in c[m])if(c[m].hasOwnProperty(p)&&"$"!==p.substr(0,1))if(b[p]instanceof Array)for(t=0;t<b[p].length;t++){if(this.u(b[p][t],c[m][p])){k=c[m].Wa;k!==q?(this.jc(b[p],t,k),
g=s):n("Cannot move without a $index integer value!");break}}else n("Cannot pull from a key that is not an array! ("+p+")!");break;case "$pull":for(p in h=s,c[m])if(c[m].hasOwnProperty(p)&&"$"!==p.substr(0,1))if(b[p]instanceof Array){k=[];for(t=0;t<b[p].length;t++)this.u(b[p][t],c[m][p])&&k.push(t);for(t=k.length;t--;)this.ic(b[p],k[t]),g=s}else n("Cannot pull from a key that is not an array! ("+p+")!")}if(".$"===m.substr(m.length-2,2)&&(h=s,m=m.substr(0,m.length-2),l=new d(f+"."+m),b[m]&&b[m]instanceof
Array&&b[m].length)){k=[];for(t=0;t<b[m].length;t++)this.u(b[m][t],l.value(e)[0])&&k.push(t);for(t=0;t<k.length;t++)(l=this.ca(b[m][k[t]],c[m+".$"],e,a,f+"."+m))&&(g=s)}if(!h)if("object"===typeof c[m])if(null!==b[m]&&"object"===typeof b[m])if(h=b[m]instanceof Array,k=c[m]instanceof Array,h||k)if(!k&&h)for(t=0;t<b[m].length;t++)(l=this.ca(b[m][t],c[m],e,a,f+"."+m))&&(g=s);else this.Ka(b,m,c[m]),g=s;else(l=this.ca(b[m],c[m],e,a,f+"."+m))&&(g=s);else this.Ka(b,m,c[m]),g=s;else b[m]!==c[m]&&(this.Ka(b,
m,c[m]),g=s)}return g};a.prototype.Ka=function(b,c,d){this.C?($.L(b).setProperty(c,d),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+c+'" for collection "'+this.name()+'"')):(b[c]=d,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+c+'" for collection "'+this.name()+'"'))};a.prototype.jc=function(b,c,d){this.C?($.L(b).move(c,d),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+
c+'" to "'+d+'" for collection "'+this.name()+'"')):(b.splice(d,0,b.splice(c,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+c+'" to "'+d+'" for collection "'+this.name()+'"'))};a.prototype.kc=function(b,c,d){b.length>c?this.C?$.L(b).j(c,d):b.splice(c,0,d):this.C?$.L(b).j(d):b.push(d)};a.prototype.rb=function(b,c){this.C?$.L(b).j(c):b.push(c)};a.prototype.ic=function(b,c){this.C?$.L(b).remove(c):b.splice(c,1)};a.prototype.hc=function(b,
c,d){this.C?$.L(b).setProperty(c,b[c]+d):b[c]+=d};a.prototype.remove=function(b){var c,d,e=this.v,a;if(b instanceof Array){e=[];for(c=0;c<b.length;c++)e.push(this.remove(b[c]));return e}c=this.find(b,{w:u});if(c.length){for(a=0;a<c.length;a++)d=c[a],this.ac(d),d=this.b.indexOf(d),this.C?$.L(this.b).remove(d):this.b.splice(d,1);if(e&&e.length)for(a=0;a<e.length;a++)e[a].remove(b);this.T(c);this.ta("change",{type:"remove",data:c})}return c};a.prototype.ta=function(){var b=this,c;!this.Ub&&(!this.g||
this.g&&!this.g.Ub)?(c=arguments,this.bb&&clearTimeout(this.bb),this.bb=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+c[0]);b.i.apply(b,c)},100)):this.i.apply(this,arguments)};a.prototype.fa=function(b,c){var d=this.R[b],e=this.ba[b],a=this.Ca[b];if(d.length){var f=this;d.length&&(d=d.length>e?d.splice(0,e):d.splice(0,d.length),this[b](d));setTimeout(function(){f.fa(b,c)},a)}else c&&c()};a.prototype.j=function(b,c,d){"function"===typeof c?(d=c,c=this.b.length):
c===q&&(c=this.b.length);b=this.Ta(b);return this.hb(b,c,d)};a.prototype.hb=function(b,c,d){var e=this.R.j,a=this.ba.j,f=[],g=[],l=this.v;if(b instanceof Array){if(b.length>a){this.R.j=e.concat(b);this.fa("insert",d);return}for(a=0;a<b.length;a++)e=this.gb(b[a],c+a),e===s?f.push(b[a]):g.push({uc:b[a],reason:e})}else e=this.gb(b,c),e===s?f.push(b):g.push({uc:b,reason:e});if(l&&l.length)for(e=0;e<l.length;e++)l[e].j(b,c);this.O(f,g);d&&d();this.ta("change",{type:"insert",data:f});return{sd:f,pd:g}};
a.prototype.gb=function(b,c){if(b){var d;this.eb(b);if(d=this.wc(b))return"Index violation in index: "+d;this.Rb(b);this.C?$.L(this.b).j(c,b):this.b.splice(c,0,b);return s}return"No document passed to insert"};a.prototype.Rb=function(b){var c=this.oa,d,e=JSON.stringify(b);this.D.ia(b[this.c],b);this.Ga.ia(b[this.c],e);this.Ba.ia(e,b);for(d in c)c.hasOwnProperty(d)&&c[d].j(b)};a.prototype.ac=function(b){var c=this.oa,d,e=JSON.stringify(b);this.D.xa(b[this.c]);this.Ga.xa(b[this.c]);this.Ba.xa(e);for(d in c)c.hasOwnProperty(d)&&
c[d].remove(b)};a.prototype.$=function(b,c){var d=this.find(b,c);return(new a).Ia(this).primaryKey(this.c).setData(d)};a.prototype.Ia=function(b){this.Ya=b;return this};a.prototype.tc=function(b){var c=this.find(q,q);b=new d(b);var e={},a=[],f,g;for(g=0;g<c.length;g++)if((f=b.value(c[g])[0])&&!e[f])e[f]=s,a.push(f);return a};a.prototype.w=function(b){return JSON.parse(JSON.stringify(b))};a.prototype.find=function(b,c){function e(c){return f.u(c,b,"and")}b=b||{};c=c||{};c.w=c.w!==q?c.w:s;var a=this.Ea.create("find"),
f=this,g,l=s,h,k,r,m,p,x,w,y,v,B=[];a.start();if(b){a.time("analyseQuery");g=this.Mb(b,c,a);a.time("analyseQuery");a.data("analysis",g);if(g.vb&&g.Fb){a.time("joinReferences");for(k=0;k<g.Oa.length;k++)m=g.Oa[k],r=new d(g.xb[m]),r=r.value(b)[0],this.g.sa(g.Oa[k]).$(r);a.time("joinReferences")}g.F.length&&(!c||c&&!c.Cd)?(a.data("index.potential",g.F),a.data("index.used",g.F[0].index),a.time("indexLookup"),h=g.F[0].K,a.time("indexLookup"),g.F[0].z.aa===g.F[0].z.A&&(l=u)):a.ea("usedIndex",u);l&&(h&&
h.length?(g=h.length,a.time("tableScan: "+g),h=h.filter(e)):(g=this.b.length,a.time("tableScan: "+g),h=this.b.filter(e)),c.sort&&(a.time("sort"),h=this.sort(c.sort,h),a.time("sort")),a.time("tableScan: "+g));c.Qa&&(h&&h.length>c.Qa)&&(h.length=c.Qa,a.data("limit",c.Qa));c.w&&(a.time("decouple"),h=this.w(h),a.time("decouple"),a.data("flag.decouple",s));if(c.join){for(g=0;g<c.join.length;g++)for(m in c.join[g])if(c.join[g].hasOwnProperty(m)){y=m;l=this.g.sa(m);k=c.join[g][m];for(v=0;v<h.length;v++){x=
{};w=r=u;for(p in k)if(k.hasOwnProperty(p))if("$"===p.substr(0,1))switch(p){case "$as":y=k[p];break;case "$multi":r=k[p];break;case "$require":w=k[p]}else x[p]=(new d(k[p])).value(h[v])[0];x=l.find(x);!w||w&&x[0]?h[v][y]=r===u?x[0]:x:B.push(h[v])}}a.data("flag.join",s)}if(B.length){a.time("removalQueue");for(p=0;p<B.length;p++)m=h.indexOf(B[p]),-1<m&&h.splice(m,1);a.time("removalQueue")}if(c.transform){a.time("transform");for(p=0;p<h.length;p++)h.splice(p,1,c.transform(h[p]));a.time("transform");
a.data("flag.transform",s)}this.p&&this.Q&&(a.time("transformOut"),h=this.Jc(h),a.time("transformOut"));a.data("results",h.length);a.stop()}else a.stop(),h=[];h.Xc=a;return h};a.prototype.transform=function(b){return b!==q?("object"===typeof b?(b.enabled!==q&&(this.p=b.enabled),b.Y!==q&&(this.P=b.Y),b.Z!==q&&(this.Q=b.Z)):this.p=b===u?u:s,this):{enabled:this.p,Y:this.P,Z:this.Q}};a.prototype.Ta=function(b){if(this.p&&this.P){if(b instanceof Array){var c=[],d;for(d=0;d<b.length;d++)c[d]=this.P(b[d]);
return c}return this.P(b)}return b};a.prototype.Jc=function(b){if(this.p&&this.Q){if(b instanceof Array){var c=[],d;for(d=0;d<b.length;d++)c[d]=this.Q(b[d]);return c}return this.Q(b)}return b};a.prototype.sort=function(b,c){c=c||[];var d=[],a,e;for(a in b)b.hasOwnProperty(a)&&(e={},e[a]=b[a],e.Lb=a,d.push(e));return 2>d.length?this.Ha(b,c):this.ab(d,c)};a.prototype.ab=function(b,c){var d=b.shift(),a,e,f=[];if(0<b.length){c=this.Ha(d,c);a=this.rc(d.Lb,c);for(e in a)a.hasOwnProperty(e)&&(d=[].concat(b),
f=f.concat(this.ab(d,a[e])));return f}return this.Ha(d,c)};a.prototype.Ha=function(b,c){var a=new d,e=a.parse(b,s)[0];a.path(e.path);return c.sort(1===e.value?function(b,c){var d=a.value(b)[0],e=a.value(c)[0];return"string"===typeof d&&"string"===typeof e?d.localeCompare(e):d>e?1:d<e?-1:0}:function(b,c){var d=a.value(b)[0],e=a.value(c)[0];return"string"===typeof d&&"string"===typeof e?1===d.localeCompare(e)?-1:1:d>e?-1:d<e?1:0})};a.prototype.rc=function(b,c){var d,a={};for(d=0;d<c.length;d++)a[c[d][b]]=
a[c[d][b]]||[],a[c[d][b]].push(c[d]);return a};a.prototype.Mb=function(b,c,a){var e={Gb:[this.h],F:[],vb:u,Fb:u,xb:{},t:b,options:c},f,g=[],l=[],h,k,r,m,p;a.time("checkIndexes");b[this.c]!==q&&(a.time("checkIndexMatch: Primary Key"),h=new d,e.F.push({K:this.D.K(b,c),z:{zb:[this.c],A:1,aa:h.tb(b)},index:this.D}),a.time("checkIndexMatch: Primary Key"));for(p in this.fb)if(this.fb.hasOwnProperty(p)&&(k=this.fb[p],r=k.name(),a.time("checkIndexMatch: "+r),h=k.match(b,c),m=k.K(b,c),0<h.A&&e.F.push({K:m,
z:h,index:k}),a.time("checkIndexMatch: "+r),h.aa===h.A))break;a.time("checkIndexes");1<e.F.length&&(a.time("findOptimalIndex"),e.F.sort(function(b,c){return b.z.aa===b.z.A?-1:c.z.aa===c.z.A?1:b.z.A===c.z.A?b.K.length-c.K.length:c.z.A-b.z.A}),a.time("findOptimalIndex"));if(c.join){e.vb=s;for(a=0;a<c.join.length;a++)for(f in c.join[a])c.join[a].hasOwnProperty(f)&&(g.push(f),"$as"in c.join[a][f]?l.push(c.join[a][f].$as):l.push(f));for(f=0;f<l.length;f++)if(c=this.mb(b,l[f],""))e.xb[g[f]]=c,e.Fb=s;e.Oa=
g;e.Gb=e.Gb.concat(g)}return e};a.prototype.mb=function(b,c,d){for(var a in b)if(b.hasOwnProperty(a)){if(a===c)return d&&(d+="."),d+a;if("object"===typeof b[a])return d&&(d+="."),d+=a,this.mb(b[a],c,d)}return u};a.prototype.u=function(b,c,d){var a,e;a=typeof b;e=typeof c;var f=s,g;if(("string"===a||"number"===a)&&("string"===e||"number"===e))b!==c&&(f=u);else for(g in c)if(c.hasOwnProperty(g)){a=u;if("$"===g.substr(0,1))switch(g){case "$gt":if(b>c[g]){if("or"===d)return s}else f=u;a=s;break;case "$gte":if(b>=
c[g]){if("or"===d)return s}else f=u;a=s;break;case "$lt":if(b<c[g]){if("or"===d)return s}else f=u;a=s;break;case "$lte":if(b<=c[g]){if("or"===d)return s}else f=u;a=s;break;case "$exists":if(b===q!==c[g]){if("or"===d)return s}else f=u;a=s;break;case "$or":a=s;for(e=0;e<c[g].length;e++){if(this.u(b,c[g][e],"and"))return s;f=u}break;case "$and":a=s;for(e=0;e<c[g].length;e++)if(!this.u(b,c[g][e],"and"))return u;break;case "$in":if(c[g]instanceof Array){a=c[g];e=a.length;var l,h=u;for(l=0;l<e;l++)if(a[l]===
b){h=s;break}if(h){if("or"===d)return s}else f=u}else n("Cannot use a $nin operator on a non-array key: "+g);a=s;break;case "$nin":if(c[g]instanceof Array){a=c[g];e=a.length;h=s;for(l=0;l<e;l++)if(a[l]===b){h=u;break}if(h){if("or"===d)return s}else f=u}else n("Cannot use a $nin operator on a non-array key: "+g);a=s;break;case "$ne":if(b!=c[g]){if("or"===d)return s}else f=u;a=s}if(!a&&c[g]instanceof RegExp)if(a=s,"object"===typeof b&&b[g]!==q&&c[g].test(b[g])){if("or"===d)return s}else f=u;if(!a)if("object"===
typeof c[g])if(b[g]!==q){if(b[g]instanceof Array&&!(c[g]instanceof Array)){a=u;for(e=0;e<b[g].length&&!(a=this.u(b[g][e],c[g],q));e++);}else if(!(b[g]instanceof Array)&&c[g]instanceof Array){a=u;for(e=0;e<c[g].length&&!(a=this.u(b[g],c[g][e],q));e++);}else a="object"===typeof b?this.u(b[g],c[g],q):this.u(q,c[g],q);if(a){if("or"===d)return s}else f=u}else if(c[g]&&c[g].$exists!==q)if(a=this.u(q,c[g],q)){if("or"===d)return s}else f=u;else f=u;else if(b&&b[g]===c[g]){if("or"===d)return s}else if(b&&
b[g]&&b[g]instanceof Array&&c[g]&&"object"!==typeof c[g]){a=u;for(e=0;e<b[g].length&&!(a=this.u(b[g][e],c[g],q));e++);if(a){if("or"===d)return s}else f=u}else f=u;if("and"===d&&!f)return u}return f};a.prototype.count=function(b,c){return b?this.find(b,c).length:this.b.length};a.prototype.wc=function(b){var c,a=this.oa,d,e;if(this.D.get(b[this.c]))c=this.D;else for(d in a)if(a.hasOwnProperty(d)&&(e=a[d],e.unique()&&e.Kc(b))){c=e;break}return c?c.name():u};a.prototype.index=function(b){if(this.oa)return this.oa[b]};
a.prototype.Ab=function(b){if(b){var c=0,a=b.length,d;for(d=0;d<a;d++)c+=b.charCodeAt(d)*Math.pow(10,17);b=c.toString(16)}else h.ua++,b=(h.ua+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16);return b};f.prototype.sa=function(b,c){if(b)return this.k[b]||this.debug()&&console.log("Creating collection "+b),this.k[b]=this.k[b]||(new a(b)).db(this),c!==q&&this.k[b].primaryKey(c),this.k[b];n("Cannot get collection with undefined name!")};
r.m=a},{"./Crc":5,"./Index":7,"./KeyValueStore":8,"./Metrics":9,"./Overload":13,"./Path":14,"./Shared":16}],3:[function(k,r){function a(){this.d.apply(this,arguments)}var h,f,e,g,l;h=k("./Shared");a.prototype.d=function(a){var b=this;this.h=a;this.q=[];this.v=[];this.Wb=function(){b.O.apply(b,arguments)};this.Yb=function(){b.X.apply(b,arguments)};this.Xb=function(){b.T.apply(b,arguments)};this.Vb=function(){b.Fa.apply(b,arguments)}};h.n.Nc=a;g=k("./Collection");l=k("./Overload");f=h.n.W;e=h.n.W.prototype.d;
a.prototype.B=new l([function(a,b){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a]["*"]=this.a[a]["*"]||[];this.a[a]["*"].push(b);return this},function(a,b,c){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a][b]=this.a[a][b]||[];this.a[a][b].push(c);return this}]);a.prototype.s=new l([function(a){this.a&&(this.a[a]&&a in this.a)&&delete this.a[a];return this},function(a,b){var c,e;"string"===typeof b?this.a&&(this.a[a]&&this.a[a][b])&&delete this.a[a][b]:a in this.a&&(c=this.a[a]["*"],e=c.indexOf(b),
-1<e&&c.splice(e,1));return this},function(a,b,c){this.a&&a in this.a&&(a=this.a[a][b],c=a.indexOf(c),-1<c&&a.splice(c,1))}]);a.prototype.i=function(a,b){this.a=this.a||{};if(a in this.a){if(this.a[a]["*"]){var c=this.a[a]["*"],e=c.length,g;for(g=0;g<e;g++)c[g].apply(this,Array.prototype.slice.call(arguments,1))}if(b instanceof Array&&b[0]&&b[0][this.c]){var c=this.a[a],f,l,e=b.length;for(g=0;g<e;g++)if(c[b[g][this.c]]){f=c[b[g][this.c]].length;for(l=0;l<f;l++)c[b[g][this.c]][l].apply(this,Array.prototype.slice.call(arguments,
1))}}}return this};a.prototype.db=function(a){return a!==q?(this.g=a,this):this.g};a.prototype.Hb=function(a){if(a){var b=this.q.indexOf(a);-1!==b&&(a.s("insert",this.Wb),a.s("update",this.Yb),a.s("remove",this.Xb),a.s("change",this.Vb),this.q.splice(b,1),b=a.S.indexOf(this),-1!==b&&a.S.splice(b,1));0===this.q.length&&delete this.c}};a.prototype.find=function(a,b){var c=(new g).primaryKey(this.q[0].primaryKey()),e;for(e=0;e<this.q.length;e++)c.j(this.q[e].find(a));return c.find(a,b)};a.prototype.j=
function(a,b){for(var c=0;c<this.q.length;c++)this.q[c].j(a,b)};a.prototype.update=function(a,b){for(var c=0;c<this.q.length;c++)this.q[c].update(a,b)};a.prototype.remove=function(a){for(var b=0;b<this.q.length;b++)this.q[b].remove(a)};a.prototype.O=function(a,b){this.i("insert",a,b)};a.prototype.X=function(a,b){this.i("update",a,b)};a.prototype.T=function(a,b){this.i("remove",a,b)};a.prototype.Fa=function(){this.i("change")};a.prototype.$=function(a,b){var c=this.find(a,b);return(new g).Ia(this).primaryKey(this.c).setData(c)};
a.prototype.J=function(){var a,b=[].concat(this.q),c=[].concat(this.v);this.f&&console.log("Dropping collection group "+this.h);for(a=0;a<b.length;a++)this.Hb(b[a]);for(a=0;a<c.length;a++)this.ob(c[a]);this.i("drop");return s};f.prototype.d=function(){this.Yc={};e.apply(this,arguments)};r.m=a},{"./Collection":2,"./Overload":13,"./Shared":16}],4:[function(k,r){function a(){this.d.apply(this,arguments)}var h,f;h=k("./Shared.js");a.prototype.d=function(){this.k={};this.f={}};h.n.W=a;f=k("./Overload.js");
k("./Collection.js");k("./Metrics.js");k("./Crc.js");a.prototype.ib=u;a.prototype.wb=function(){return!this.ib};a.prototype.wb=function(){return!this.ib};a.prototype.w=function(a){return JSON.parse(JSON.stringify(a))};a.prototype.debug=new f([function(){return this.f.all},function(a){return a!==q&&"boolean"===typeof a?(this.f.all=a,this):this.f.all},function(a,g){return a!==q?g!==q?(this.f[a]=g,this):this.f[a]:this.f.all}]);a.prototype.B=function(a,g){this.a=this.a||{};this.a[a]=this.a[a]||[];this.a[a].push(g);
return this};a.prototype.s=function(a,g){if(a in this.a){var f=this.a[a],d=f.indexOf(g);-1<d&&f.splice(d,1)}return this};a.prototype.i=function(a,g){this.a=this.a||{};if(a in this.a){var f=this.a[a],d=f.length,b;for(b=0;b<d;b++)f[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};a.prototype.Ab=function(a){var g,f,d=Math.pow(10,17),b;if(a){g=0;f=a.length;for(b=0;b<f;b++)g+=a.charCodeAt(b)*d;a=g.toString(16)}else h.ua++,a=(h.ua+(Math.random()*d+Math.random()*d+Math.random()*d+Math.random()*
d)).toString(16);return a};r.m=a},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":9,"./Overload.js":13,"./Shared.js":16}],5:[function(k,r){var a=function(){var a=[],f,e,g;for(e=0;256>e;e++){f=e;for(g=0;8>g;g++)f=f&1?3988292384^f>>>1:f>>>1;a[e]=f}return a}();r.m=function(h){var f=-1,e;for(e=0;e<h.length;e++)f=f>>>8^a[(f^h.charCodeAt(e))&255];return(f^-1)>>>0}},{}],6:[function(k,r){function a(a,g){this.d.apply(this,arguments)}var h,f;h=k("./Shared");a.prototype.d=function(a,g){this.l=g;this.ra=$(this.l.Ec);
this.a={};this.k=a;this.l.V=[];var f,d;switch(this.l.type){case "pie":this.ra.Na(this.l.Ma);this.M=this.ra.Na();f=this.k.find();d={jd:s,cursor:"pointer",nd:{enabled:s,qd:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.Ic&&Highcharts.Ic.ld||"black"}}};f=this.Db(f,this.l.Pa,this.l.Ua);$.extend(d,this.l.Ad);$.extend(d,{type:"pie",name:this.l.zd,data:f});this.M.hd(d);break;case "line":f=this.yb(this.l.Fc,this.l.Pa,this.l.Ua,this.l.Bb),this.l.Ma.ya=f.ya,this.l.Ma.V=f.V,this.ra.Na(this.l.Ma),
this.M=this.ra.Na()}this.Pb()};h=h.n.Jb;f=h.prototype.d;a.prototype.Db=function(a,g,f){var d=[],b;for(b=0;b<a.length;b++)d.push([a[b][g],a[b][f]]);return d};a.prototype.yb=function(a,g,f,d){var b=this.k.tc(a),c=[],h={sb:[]},k,r,E,A,z;for(A=0;A<b.length;A++){k=b[A];r={};r[a]=k;E=[];r=this.k.find(r,{Bb:d});for(z=0;z<r.length;z++)h.sb.push(r[z][g]),E.push(r[z][f]);c.push({name:k,data:E})}return{ya:h,V:c}};a.prototype.Pb=function(){this.k.B("change",this.Aa);this.k.B("drop",this.Da)};a.prototype.Aa=function(){if("undefined"!==
typeof this.k&&this.M){var a=this.k.find();switch(this.l.type){case "pie":this.M.V[0].setData(this.Db(a,this.l.Pa,this.l.Ua));break;case "line":a=this.yb(this.l.Fc,this.l.Pa,this.l.Ua,this.l.Bb);this.M.ya[0].Bd(a.ya.sb);for(var g=0;g<a.V.length;g++)this.M.V[g].setData(a.V[g].data)}}};a.prototype.Da=function(){this.k.s("change",this.Aa);this.k.s("drop",this.Da)};a.prototype.J=function(){this.M.od();this.k.s("change",this.Aa);this.k.s("drop",this.Da);delete this.k.Ob[this.l.Ec];delete this.M;delete this.l;
delete this.k;return this};h.prototype.d=function(){this.Ob={};f.apply(this,arguments)};r.m=a},{"./Shared":16}],7:[function(k,r){function a(){this.d.apply(this,arguments)}var h=k("./Shared"),f=k("./Path");a.prototype.d=function(a,g,f){this.na={};this.pb=0;this.Qb=this.Sb(a,a);this.data({});this.unique(g&&g.unique?g.unique:u);a!==q&&this.keys(a);f!==q&&this.sa(f);this.name(g&&g.name?g.name:this.Qb)};h.n.Pc=a;a.prototype.data=function(a){return a!==q?(this.b=a,this):this.b};a.prototype.name=function(a){return a!==
q?(this.h=a,this):this.h};a.prototype.sa=function(a){return a!==q?(this.k=a,this):this.k};a.prototype.keys=function(a){return a!==q?(this.H=a,this.Zc=(new f).parse(this.H).length,this):this.H};a.prototype.type=function(a){return a!==q?(this.gc=a,this):this.gc};a.prototype.unique=function(a){return a!==q?(this.Ja=a,this):this.Ja};a.prototype.j=function(a){var f,l;this.Ja&&(f=this.pa(a,this.H),this.qb[f]=a);f=this.jb(a,this.H);for(l=0;l<f.length;l++)this.Dc(f[l],a)};a.prototype.remove=function(a){var f,
l;this.Ja&&(f=this.pa(a,this.H),delete this.qb[f]);f=this.jb(a,this.H);for(l=0;l<f.length;l++)this.Bc(f[l],a)};a.prototype.Kc=function(a){a=this.pa(a,this.H);return Boolean(this.qb[a])};a.prototype.Dc=function(a,f){var l=this.b[a]=this.b[a]||[];-1===l.indexOf(f)&&(l.push(f),this.pb++,this.Cc(f,l))};a.prototype.Bc=function(a,f){var l=this.b[a],d;d=l.indexOf(f);-1<d&&(l.splice(d,1),this.pb--,this.Ac(f));l.length||delete this.b[a]};a.prototype.Cc=function(a,f){var l=a[this.k.primaryKey()];this.na[l]=
this.na[l]||[];l=this.na[l];-1===l.indexOf(f)&&l.push(f)};a.prototype.Ac=function(a){a=a[this.k.primaryKey()];delete this.na[a]};a.prototype.K=function(a){return this.b[this.pa(a,this.H)]||[]};a.prototype.match=function(a){return(new f).ub(this.H,a)};a.prototype.pa=function(a,g){var l=new f,d,b="",c;d=l.parse(g);for(c=0;c<d.length;c++)b&&(b+="_"),b+=l.value(a,d[c].path).join(":");return b};a.prototype.Sb=function(a,g){var l=new f,d,b="",c;d=l.parse(g);for(c=0;c<d.length;c++)b&&(b+="_"),b+=l.xc(a,
d[c].path);return b};a.prototype.jb=function(a,g){var l=new f,d,b=[],c,h,k,r;d=l.parse(g);for(k=0;k<d.length;k++){c=l.value(a,d[k].path);for(h=0;h<c.length;h++)if(0===k)b.push(c[h]);else for(r=0;r<b.length;r++)b[r]=b[r]+"_"+c[h]}return b};r.m=a},{"./Path":14,"./Shared":16}],8:[function(k,r){function a(a){this.d.apply(this,arguments)}var h=k("./Shared");a.prototype.d=function(a){this.h=a;this.b={};this.c="_id"};h.n.Qc=a;a.prototype.name=function(a){return a!==q?(this.h=a,this):this.h};a.prototype.primaryKey=
function(a){return a!==q?(this.c=a,this):this.c};a.prototype.truncate=function(){this.b={};return this};a.prototype.set=function(a,e){this.b[a]=e?e:s;return this};a.prototype.get=function(a){return this.b[a]};a.prototype.K=function(a){a=a[this.c];var e,g,h,d;if(a instanceof Array){g=a.length;d=[];for(e=0;e<g;e++)(h=this.b[a[e]])&&d.push(h);return d}if(a instanceof RegExp){d=[];for(e in this.b)this.b.hasOwnProperty(e)&&a.test(e)&&d.push(this.b[e]);return d}if("object"===typeof a){if(a.Ib){d=[];for(e in this.b)this.b.hasOwnProperty(e)&&
e!==a.Ib&&d.push(this.b[e]);return d}if(a.Va&&a.Va instanceof Array){d=[];for(e in this.b)this.b.hasOwnProperty(e)&&-1<a.Va.indexOf(e)&&d.push(this.b[e]);return d}if(a.Xa&&a.Xa instanceof Array){d=[];for(e in this.b)this.b.hasOwnProperty(e)&&-1===a.Xa.indexOf(e)&&d.push(this.b[e]);return d}if(a.za&&a.za instanceof Array){d=[];for(e=0;e<a.za.length;e++)d=d.concat(this.K(a.za[e]));return d}}else return h=this.b[a],h!==q?[h]:[]};a.prototype.xa=function(a){delete this.b[a]};a.prototype.ia=function(a,
e){return this.b[a]===q?(this.b[a]=e,s):u};r.m=a},{"./Shared":16}],9:[function(k,r){function a(){this.d.apply(this,arguments)}var h=k("./Shared"),f=k("./Operation");a.prototype.d=function(){this.b=[]};h.n.Rc=a;a.prototype.create=function(a){a=new f(a);this.cb&&this.b.push(a);return a};a.prototype.start=function(){this.cb=s;return this};a.prototype.stop=function(){this.cb=u;return this};r.m=a},{"./Operation":12,"./Shared":16}],10:[function(k){var r;k=k("./Shared").n.Kb;r=k.prototype.d;k.prototype.d=
function(){var a=this;this.$a=[];this.fd=this.gd=0;this.R={j:[],update:[],remove:[],G:[],ka:[],ma:[],la:[],Za:[]};this.ba={j:100,update:100,remove:100,G:100,ka:100,ma:100,la:100,Za:100};this.Ca={j:100,update:1,remove:1,G:1,ka:100,ma:1,la:1,Za:1};r.apply(this,arguments);this.B("insert",function(h,f){a.ja("insert",h,f)});this.B("update",function(h,f){a.ja("update",h,f)});this.B("remove",function(h,f){a.ja("remove",h,f)});this.B("change",a.Nb)};k.prototype.qc=function(a,h){var f=$(a),e,g,l;this.debug()&&
console.log("ForerunnerDB.OldView.Bind: Sorting data in DOM...",h);for(e=0;e<h.length;e++)g=h[e],l=f.find("#"+g[this.c]),l.length?0===e?(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index 0...",l),f.Eb(l)):(this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sort, moving to index "+e+"...",l),l.rd(f.children(":eq("+(e-1)+")"))):this.debug()&&console.log("ForerunnerDB.OldView.Bind: Warning, element for array item not found!",g)};k.prototype.pc=function(a){var h=this.$a,f,
e;a||(a={data:this.find()});for(f in h)h.hasOwnProperty(f)&&(e=h[f],this.debug()&&console.log("ForerunnerDB.OldView.Bind: Sorting DOM..."),this.qc(f,a.data),e.mc&&e.mc(),e.refresh&&e.refresh())};k.prototype.fa=function(a,h){var f=this.R[a],e=this.ba[a],g=this.Ca[a];if(f.length){var l=this;f.length&&(f=f.length>e?f.splice(0,e):f.splice(0,f.length),this.ja(a,f,[]));setTimeout(function(){l.fa(a,h)},g)}else h&&h(),this.i("bindQueueComplete")};k.prototype.ja=function(a,h,f){var e=this.$a,g=this.find({}),
l,d;for(d in e)if(e.hasOwnProperty(d))switch(l=e[d].reduce?this.find(e[d].reduce.t,e[d].reduce.options):g,a){case "insert":this.ka(d,e[d],h,f,l);break;case "update":this.ma(d,e[d],h,f,l);break;case "remove":this.la(d,e[d],h,f,l)}};k.prototype.Nb=function(a){this.debug()&&console.log("ForerunnerDB.OldView.Bind: Bind data change, refreshing bind...",a);this.pc(a)};k.prototype.ka=function(a,h,f,e,g){var l=$(a),d;for(d=0;d<f.length;d++)a=l.find("#"+f[d][this.c]),a.length||h.Hc(f[d],function(a,c,d,e){return function(a){h.j?
h.j(a,c,d,e):h.vd?l.Eb(a):l.append(a);h.lc&&h.lc(a,c,d,e)}}(a,f[d],e,g))};k.prototype.ma=function(a,h,f,e,g){var l=$(a);for(e=0;e<f.length;e++)a=l.find("#"+f[e][this.c]),h.Hc(f[e],function(a,b){return function(c){h.update?h.update(c,b,g,a.length?"update":"append"):a.length?a.yd(c):h.wd?l.Eb(c):l.append(c);h.nc&&h.nc(c,b,g)}}(a,f[e]))};k.prototype.la=function(a,h,f,e,g){a=$(a);var l;for(l=0;l<f.length;l++)e=a.find("#"+f[l][this.c]),e.length&&(h.oc?h.oc(e,f[l],g,function(a,b,c){return function(){h.remove?
h.remove(a,b,c):(a.remove(),h.La&&h.La(a,b,c))}}(e,f[l],g)):h.remove?h.remove(e,f[l],g):(e.remove(),h.La&&h.La(e,f[l],g)))}},{"./Shared":16}],11:[function(k,r){function a(){this.d.apply(this,arguments)}var h,f,e,g,l,d,b;h=k("./Shared");a.prototype.d=function(a){var b=this;this.h=a;this.S=[];this.a={};this.I={t:{},options:{}};this.dd=function(){b.Zb.apply(b,arguments)};this.bd=function(){b.O.apply(b,arguments)};this.ed=function(){b.X.apply(b,arguments)};this.cd=function(){b.T.apply(b,arguments)};this.ad=
function(){b.debug()&&console.log("ForerunnerDB.OldView: Received change");b.Fa.apply(b,arguments)}};h.n.Kb=a;f=k("./CollectionGroup");e=k("./Collection");g=e.prototype.d;l=f.prototype.d;b=k("./Overload");h=h.n.W;d=h.prototype.d;a.prototype.B=new b([function(a,b){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a]["*"]=this.a[a]["*"]||[];this.a[a]["*"].push(b);return this},function(a,b,d){this.a=this.a||{};this.a[a]=this.a[a]||{};this.a[a][b]=this.a[a][b]||[];this.a[a][b].push(d);return this}]);a.prototype.s=
new b([function(a){this.a&&(this.a[a]&&a in this.a)&&delete this.a[a];return this},function(a,b){var d,e;"string"===typeof b?this.a&&(this.a[a]&&this.a[a][b])&&delete this.a[a][b]:a in this.a&&(d=this.a[a]["*"],e=d.indexOf(b),-1<e&&d.splice(e,1));return this},function(a,b,d){this.a&&a in this.a&&(a=this.a[a][b],d=a.indexOf(d),-1<d&&a.splice(d,1))}]);a.prototype.i=function(a,b){this.a=this.a||{};if(a in this.a){if(this.a[a]["*"]){var d=this.a[a]["*"],e=d.length,f;for(f=0;f<e;f++)d[f].apply(this,Array.prototype.slice.call(arguments,
1))}if(b instanceof Array&&b[0]&&b[0][this.c]){var d=this.a[a],g,h,e=b.length;for(f=0;f<e;f++)if(d[b[f][this.c]]){g=d[b[f][this.c]].length;for(h=0;h<g;h++)d[b[f][this.c]][h].apply(this,Array.prototype.slice.call(arguments,1))}}}return this};a.prototype.J=function(){return(this.g||this.o)&&this.h?(this.debug()&&console.log("ForerunnerDB.OldView: Dropping view "+this.h),this.i("drop"),this.g&&delete this.g.qa[this.h],this.o&&delete this.o.qa[this.h],s):u};a.prototype.debug=function(){return u};a.prototype.db=
function(a){return a!==q?(this.g=a,this):this.g};a.prototype.primaryKey=function(){if(this.o)return this.o.primaryKey()};a.prototype.t=function(a,b){return a!==q?(this.I.t=a,(b===q||b===s)&&this.refresh(),this):this.I.t};a.prototype.refresh=function(a){if(this.o){var b=this.b,d,e,f,g,h,l=[],k=[],m=[],p;this.debug()&&(console.log("ForerunnerDB.OldView: Refreshing view "+this.h),console.log("ForerunnerDB.OldView: Existing data: "+("undefined"!==typeof this.b)),"undefined"!==typeof this.b&&console.log("ForerunnerDB.OldView: Current data rows: "+
this.b.find().length));this.I?(this.debug()&&console.log("ForerunnerDB.OldView: View has query and options, getting subset..."),this.b=this.o.$(this.I.t,this.I.options)):this.I.options?(this.debug()&&console.log("ForerunnerDB.OldView: View has options, getting subset..."),this.b=this.o.$({},this.I.options)):(this.debug()&&console.log("ForerunnerDB.OldView: View has no query or options, getting subset..."),this.b=this.o.$({}));if(!a&&b)if(this.debug()&&console.log("ForerunnerDB.OldView: Refresh not forced, old data detected..."),
e=this.b,b.Ya===e.Ya){this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from same collection...");f=e.find();a=b.find();g=e.c;for(p=0;p<f.length;p++)h=f[p],d={},d[g]=h[g],(d=b.find(d)[0])?JSON.stringify(d)!==JSON.stringify(h)&&k.push(h):l.push(h);for(p=0;p<a.length;p++)h=a[p],d={},d[g]=h[g],e.find(d)[0]||m.push(h);this.debug()&&(console.log("ForerunnerDB.OldView: Removed "+m.length+" rows"),console.log("ForerunnerDB.OldView: Inserted "+l.length+" rows"),console.log("ForerunnerDB.OldView: Updated "+
k.length+" rows"));l.length&&this.O(l,[]);k.length&&this.X(k,[]);m.length&&this.T(m,[])}else this.debug()&&console.log("ForerunnerDB.OldView: Old and new data are from different collections..."),m=b.find(),m.length&&this.T(m),l=e.find(),l.length&&this.O(l);else this.debug()&&console.log("ForerunnerDB.OldView: Forcing data update",f),this.b=this.o.$(this.I.t,this.I.options),f=this.b.find(),this.debug()&&console.log("ForerunnerDB.OldView: Emitting change event with data",f),this.O(f,[]);this.debug()&&
console.log("ForerunnerDB.OldView: Emitting change");this.i("change")}return this};a.prototype.count=function(){return this.b&&this.b.b?this.b.b.length:0};a.prototype.find=function(){return this.b?(this.debug()&&console.log("ForerunnerDB.OldView: Finding data in view collection...",this.b),this.b.find.apply(this.b,arguments)):[]};a.prototype.j=function(){return this.o?this.o.j.apply(this.o,arguments):[]};a.prototype.update=function(){return this.o?this.o.update.apply(this.o,arguments):[]};a.prototype.remove=
function(){return this.o?this.o.remove.apply(this.o,arguments):[]};a.prototype.Zb=function(a,b){this.i("remove",b,[]);this.i("insert",a,[])};a.prototype.O=function(a,b){this.i("insert",a,b)};a.prototype.X=function(a,b){this.i("update",a,b)};a.prototype.T=function(a,b){this.i("remove",a,b)};a.prototype.Fa=function(){this.debug()&&console.log("ForerunnerDB.OldView: Refreshing data");this.refresh()};e.prototype.d=function(){this.qa=[];g.apply(this,arguments)};f.prototype.d=function(){this.qa=[];l.apply(this,
arguments)};h.prototype.d=function(){this.qa={};d.apply(this,arguments)};r.m=a},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],12:[function(k,r){function a(a){this.Cb=new f;this.md=0;this.d.apply(this,arguments)}var h=k("./Shared"),f=k("./Path");a.prototype.d=function(a){this.b={td:a,index:{ud:[],Dd:u},Gc:[],time:{ha:0,va:0,wa:0,zc:{}},ea:{},log:[]}};h.n.Sc=a;a.prototype.start=function(){this.b.time.ha=(new Date).getTime()};a.prototype.log=function(a){if(a){var f=0<this.$c.length?
this.b.log[this.b.log.length-1].time:0;a={event:a,time:(new Date).getTime(),sc:0};this.b.log.push(a);f&&(a.sc=a.time-f);return this}return this.b.log};a.prototype.time=function(a){if(a!==q){var f=this.b.time.zc,f=f[a]=f[a]||{};f.ha?(f.va=(new Date).getTime(),f.wa=f.va-f.ha,f.Sa.wa=f.wa,delete f.Sa):(f.ha=(new Date).getTime(),f.Sa={name:a},this.b.Gc.push(f.Sa));return this}return this.b.time};a.prototype.ea=function(a,f){if(a!==q&&f!==q)this.b.ea[a]=f;else return a!==q?this.b.ea[a]:this.b.ea};a.prototype.data=
function(a,f){return f!==q?(this.Cb.set(this.b,a,f),this):this.Cb.get(this.b,a)};a.prototype.stop=function(){this.b.time.va=(new Date).getTime();this.b.time.wa=this.b.time.va-this.b.time.ha};r.m=a},{"./Path":14,"./Shared":16}],13:[function(k,r){function a(a){if(a){var f,e=a.length;return function(){for(f=0;f<e;f++)if(a[f].length===arguments.length)return a[f].apply(this,arguments);return null}}return function(){}}k("./Shared").n.Tc=a;r.m=a},{"./Shared":16}],14:[function(k,r){function a(a){this.d.apply(this,
arguments)}var h=k("./Shared");a.prototype.d=function(a){a&&this.path(a)};h.n.Uc=a;a.prototype.path=function(a){return a!==q?(this.kb=this.da(a),this.lb=this.kb.split("."),this):this.kb};a.prototype.tb=function(a){var e=0,g;for(g in a)a.hasOwnProperty(g)&&a[g]!==q&&("object"!==typeof a[g]?e++:e+=this.tb(a[g]));return e};a.prototype.ub=function(a,e){var g,h={},d=0,b=0,c;for(c in e)e.hasOwnProperty(c)&&("object"===typeof e[c]?(g=this.ub(a[c],e[c]),h[c]=g.zb,b+=g.aa,d+=g.A):(b++,a&&a[c]&&"object"!==
typeof a[c]?(h[c]=s,d++):h[c]=u));return{zb:h,A:d,aa:b}};a.prototype.parse=function(a,e){var g=[],h="",d,b,c;for(b in a)if(a.hasOwnProperty(b))if(h=b,"object"===typeof a[b])if(e){d=this.parse(a[b],e);for(c=0;c<d.length;c++)g.push({path:h+"."+d[c].path,value:d[c].value})}else{d=this.parse(a[b]);for(c=0;c<d.length;c++)g.push({path:h+"."+d[c].path})}else e?g.push({path:h,value:a[b]}):g.push({path:h});return g};a.prototype.value=function(a,e){if(a!==q&&"object"===typeof a){var g,h,d,b,c=[],k;e!==q&&(e=
this.da(e),g=e.split("."));g=g||this.lb;h=g.length;d=a;for(k=0;k<h;k++){d=d[g[k]];if(b instanceof Array){for(h=0;h<b.length;h++)c=c.concat(this.value(b,h+"."+g[k]));return c}if(!d||"object"!==typeof d)break;b=d}return[d]}return[]};a.prototype.set=function(a,e,g){if(a!==q&&e!==q){var h;e=this.da(e);e=e.split(".");h=e.shift();e.length?(a[h]=a[h]||{},this.set(a[h],e.join("."),g)):a[h]=g}return a};a.prototype.get=function(a,e){return this.value(a,e)[0]};a.prototype.push=function(a,e,g){if(a!==q&&e!==
q){var h;e=this.da(e);e=e.split(".");h=e.shift();e.length?(a[h]=a[h]||{},this.set(a[h],e.join("."),g)):(a[h]=a[h]||[],a[h]instanceof Array?a[h].push(g):n("Cannot push to a path whose endpoint is not an array!"))}return a};a.prototype.xc=function(a,e){var g,h,d,b,c;e!==q&&(e=this.da(e),g=e.split("."));g=g||this.lb;h=g.length;d=a;for(c=0;c<h;c++)if(d=d[g[c]],!d||"object"!==typeof d){b=g[c]+":"+d;break}return b};a.prototype.da=function(a){"."===a.substr(0,1)&&(a=a.substr(1,a.length-1));return a};r.m=
a},{"./Shared":16}],15:[function(k,r){var a=k("./Shared"),h,f,e,g;g=function(){this.d.apply(this,arguments)};g.prototype.d=function(a){a.wb()&&Storage!==q&&this.mode("localStorage")};a.n.Vc=g;a=a.n.W;h=k("./Collection");f=h.prototype.J;k("./CollectionGroup");k("./Overload");e=a.prototype.d;g.prototype.mode=function(a){return a!==q?(this.Tb=a,this):this.Tb};g.prototype.J=function(a,d){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(b){d&&d(b)}d&&d(u)}d&&d("No data handler or unrecognised data type.")};
h.prototype.J=function(a){if(a)if(this.h)if(this.g)this.g.yc.J(this.h);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";
f.apply(this)};a.prototype.d=function(){this.yc=new g(this);e.apply(this,arguments)};r.m=g},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}],16:[function(k,r){r.m={ua:0,n:{},xd:{}}},{}],17:[function(k,r){function a(a,b,c){this.d.apply(this,arguments)}var h,f,e,g,l;h=k("./Shared");a.prototype.d=function(a,b,c){this.h=a;this.N=[];this.S=[];this.a={};this.U={t:b,options:c};this.f={};this.e=new f("__FDB__view_privateData_"+this.h)};h.n.Wc=a;f=k("./Collection");k("./CollectionGroup");
l=k("./Overload");e=f.prototype.d;h=h.n.W;g=h.prototype.d;a.prototype.debug=new l([function(){return this.f.all},function(a){return a!==q&&"boolean"===typeof a?(this.f.all=a,this.e.debug(a),this.ga().debug(a),this):this.f.all},function(a,b){return a!==q?b!==q?(this.f[a]=b,this.e.debug(a,b),this.ga().debug(a,b),this):this.f[a]:this.f.all}]);a.prototype.name=function(a){return a!==q?(this.h=a,this):this.h};a.prototype.find=function(a,b){return this.ga().find(a,b)};a.prototype.j=function(a,b,c){a=this.e.w(a);
"function"===typeof b?(c=b,b=this.e.length):b===q&&(b=this.e.length);this.bc(a,b);this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');return this.e.hb(a,b,c)};a.prototype.update=function(a,b){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');var c=this.e.update(a,b),e,f,g;if(this.p&&this.P){e=
this.r.primaryKey();for(var h=0;h<c.length;h++)f={},g=c[h],f[e]=g[e],this.fc(f,g)}return c};a.prototype.remove=function(a){this.dc(a);this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.e.name()+'"');return this.e.remove(a)};a.prototype.$b=function(a){-1<this.N.indexOf(a)&&(this.N.splice(a,1),a.ob(this),this.e.remove(a.find(this.U.t,this.U.options)))};a.prototype.B=function(){this.e.B.apply(this.e,arguments)};
a.prototype.s=function(){this.e.s.apply(this.e,arguments)};a.prototype.i=function(){this.e.i.apply(this.e,arguments)};a.prototype.J=function(){if(this.N&&this.N.length){(this.f||this.g&&this.g.f)&&console.log("ForerunnerDB.View: Dropping view "+this.h);this.i("drop");for(var a=this.N.length;a--;)this.$b(this.N[a]);this.e.J();return s}return u};a.prototype.db=function(a){return a!==q?(this.g=a,this.e.db(a),this.ga().db(a),this):this.g};a.prototype.primaryKey=function(){return this.e.primaryKey()};
a.prototype.t=function(a,b){return a!==q?(this.U.t=a,(b===q||b===s)&&this.refresh(),this):this.U.t};a.prototype.refresh=function(){var a,b=this.ga(),c;this.e.remove();b.remove();for(c=0;c<this.N.length;c++)a=this.N[c],this.e.j(a.find(this.U.t,this.U.options));a=this.e.find({},this.U.options);b.C?$.L(b.b).refresh(a):(this.e.b.length=0,this.e.b=this.e.b.concat(a));return this};a.prototype.count=function(){return this.e&&this.e.b?this.e.b.length:0};a.prototype.transform=function(a){return a!==q?("object"===
typeof a?(a.enabled!==q&&(this.p=a.enabled),a.Y!==q&&(this.P=a.Y),a.Z!==q&&(this.Q=a.Z)):this.p=a===u?u:s,this.cc(this.e.primaryKey()),this.ec(this.e.find()),this):{enabled:this.p,Y:this.P,Z:this.Q}};a.prototype.ga=function(){return this.p?this.r:this.e};a.prototype.ec=function(a){this.p&&(this.r=new f("__FDB__view_publicData_"+this.h),this.r.db(this.e.g),this.r.transform({enabled:s,Y:this.P,Z:this.Q}),this.r.setData(a))};a.prototype.bc=function(a,b){this.p&&this.r&&this.r.j(a,b)};a.prototype.fc=
function(a,b){this.p&&this.r&&this.r.update(a,b)};a.prototype.dc=function(a){this.p&&this.r&&this.r.remove(a)};a.prototype.cc=function(a){this.p&&this.r&&this.r.primaryKey(a)};f.prototype.d=function(){this.v=[];e.apply(this,arguments)};f.prototype.ob=function(a){a!==q&&(a=this.v.indexOf(a),-1<a&&this.v.splice(a,1))};h.prototype.d=function(){this.v={};g.apply(this,arguments)};r.m=a},{"./Collection":2,"./CollectionGroup":3,"./Overload":13,"./Shared":16}]},{},[1])(1)}
if("object"==typeof exports&&"undefined"!=typeof module)module.m=C();else if("function"==typeof define&&define.kd)define([],C);else{var D;"undefined"!=typeof window?D=window:"undefined"!=typeof global?D=global:"undefined"!=typeof self&&(D=self);D.Oc=C()}s;
