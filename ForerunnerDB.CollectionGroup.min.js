(function(){var g=ForerunnerDB.classes.Collection,h=ForerunnerDB,k=ForerunnerDB.prototype.init,b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){var c=this;this._name=a;this._collectionArr=[];this._views=[];this._onCollectionInsert=function(){c._onInsert.apply(c,arguments)};this._onCollectionUpdate=function(){c._onUpdate.apply(c,arguments)};this._onCollectionRemove=function(){c._onRemove.apply(c,arguments)}};b.prototype.on=function(a,c){this._listeners=this._listeners||{};
this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(c);return this};b.prototype.off=function(a,c){if(a in this._listeners){var e=this._listeners[a],b=e.indexOf(c);-1<b&&e.splice(b,1)}return this};b.prototype.emit=function(a,c){this._listeners=this._listeners||{};if(a in this._listeners){var b=this._listeners[a],d=b.length,f;for(f=0;f<d;f++)b[f].apply(this,Array.prototype.slice.call(arguments,1))}return this};b.prototype.db=function(a){return void 0!==a?(this._db=a,this):this._db};b.prototype.addCollection=
function(a){if(a&&-1===this._collectionArr.indexOf(a)){if(this._collectionArr.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this._primaryKey=a.primaryKey();this._collectionArr.push(a);a._groups.push(this);a.on("insert",this._onCollectionInsert);a.on("update",this._onCollectionUpdate);a.on("remove",this._onCollectionRemove)}return this};b.prototype.removeCollection=function(a){if(a){var c=this._collectionArr.indexOf(a);
-1!==c&&(a.off("insert",this._onCollectionInsert),a.off("update",this._onCollectionUpdate),a.off("remove",this._onCollectionRemove),this._collectionArr.splice(c,1),c=a._groups.indexOf(this),-1!==c&&a._groups.splice(c,1));0===this._collectionArr.length&&delete this._primaryKey}return this};b.prototype.find=function(a,c){var b=(new g).primaryKey(this._collectionArr[0].primaryKey()),d;for(d=0;d<this._collectionArr.length;d++)b.insert(this._collectionArr[d].find(a));return b.find(a,c)};b.prototype.insert=
function(a,c){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].insert(a,c)};b.prototype.update=function(a,c){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].update(a,c)};b.prototype.updateById=function(a,c){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].updateById(a,c)};b.prototype.remove=function(a){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].remove(a)};b.prototype.removeById=function(a){for(var b=0;b<this._collectionArr.length;b++)this._collectionArr[b].removeById(a)};
b.prototype._addView=function(a){void 0!==a&&(this._views[a._name]=a);return this};b.prototype._removeView=function(a){void 0!==a&&delete this._views[a._name];return this};b.prototype._onInsert=function(a,b){this.emit("insert",a,b)};b.prototype._onUpdate=function(a,b){this.emit("update",a,b)};b.prototype._onRemove=function(a,b){this.emit("remove",a,b)};b.prototype.subset=function(a,b){var e=this.find(a,b);return(new g)._subsetOf(this).primaryKey(this._primaryKey).setData(e)};h.prototype.init=function(){this._collectionGroup=
{};k.apply(this,arguments)};h.prototype.collectionGroup=function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new b(a)).db(this),this._collectionGroup[a]):this._collectionGroup};ForerunnerDB.classes.CollectionGroup=b})();
