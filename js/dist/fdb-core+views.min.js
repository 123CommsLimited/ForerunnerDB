function w(){return function n(r,a,k){function e(f,h){if(!a[f]){if(!r[f]){var b="function"==typeof require&&require;if(!h&&b)return b(f,!0);if(c)return c(f,!0);b=Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",b;}b=a[f]={g:{}};r[f][0].call(b.g,function(b){var c=r[f][1][b];return e(c?c:b)},b,b.g,n,r,a,k)}return a[f].g}for(var c="function"==typeof require&&require,f=0;f<k.length;f++)e(k[f]);return e}({1:[function(n,r){var a=n("../lib/Core");n("../lib/View");r.g=a},{"../lib/Core":3,
"../lib/View":12}],2:[function(n,r){function a(b){this.e.apply(this,arguments)}var k,e,c,f,g,h;k=n("./Shared");a.prototype.e=function(b){this.d="_id";this.s=new g("primary");this.fa=new g("primaryCrc");this.ca=new g("crcLookup");this.j=b;this.a=[];this.ea=new f;this.q=0;this.c={};this.K={f:[],update:[],remove:[],G:[]};this.da={f:100,update:100,remove:100,G:100};this.Va={f:1,update:1,remove:1,G:1};this.Ga()};k.p.Fb=a;c=n("./Overload");f=n("./Metrics");g=n("./KeyValueStore");h=n("./Path");n("./Index");
n("./Crc");e=k.p.sa;a.prototype.debug=new c([function(){return this.c.all},function(b){if(void 0!==b){if("boolean"===typeof b){this.c.all=b;for(var d=0;d<this.F.length;d++)this.F[d].debug(b);return this}return this.c[b]||this.h&&this.h.c&&this.h.c[b]||this.c.all}return this.c.all},function(b,d){if(void 0!==b){if(void 0!==d){this.c[b]=d;for(var c=0;c<this.F.length;c++)this.F[c].debug(b,d);return this}return this.c[b]||this.h&&this.h.c&&this.h.c[b]}return this.c.all}]);a.prototype.name=function(b){return void 0!==
b?(this.j=b,this):this.j};a.prototype.t=function(b,d){this.r=this.r||{};if(b in this.r){if(this.r[b]["*"]){var c=this.r[b]["*"],s=c.length,a;for(a=0;a<s;a++)c[a].apply(this,Array.prototype.slice.call(arguments,1))}if(d instanceof Array&&d[0]&&d[0][this.d]){var c=this.r[b],h,e,s=d.length;for(a=0;a<s;a++)if(c[d[a][this.d]])for(h=c[d[a][this.d]].length,e=0;e<h;e++)c[d[a][this.d]][e].apply(this,Array.prototype.slice.call(arguments,1))}}return this};a.prototype.primaryKey=function(b){return void 0!==b?
(this.d=b,this.s.primaryKey(b),this.Fa(),this):this.d};a.prototype.$a=function(b,d){this.t("insert",b,d)};a.prototype.bb=function(b){this.t("update",b)};a.prototype.ab=function(b){this.t("remove",b)};a.prototype.db=function(b){return void 0!==b?(this.h=b,this):this.h};a.prototype.setData=function(b,d,c){if(b){var s=this.ea.create("setData");s.start();b instanceof Array||(b=[b]);s.time("transformIn");b=this.oa(b);s.time("transformIn");var a=this.a;this.a=[];b.length&&(this.a=this.a.concat(b));s.time("_rebuildPrimaryKeyIndex");
this.Fa(d);s.time("_rebuildPrimaryKeyIndex");s.stop();this.t("setData",this.a,a)}c&&c(!1);return this};a.prototype.Fa=function(b){var d=b&&void 0!==b.rb?b.rb:!0;b=b&&void 0!==b.Db?b.Db:!0;var c,s,a,h=this.s,e=this.fa,f=this.ca,g=this.d,q;h.truncate();e.truncate();f.truncate();c=this.a;for(s=c.length;s--;)if(a=c[s],d&&this.xa(a),b){if(!h.S(a[g],a))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+a[this.d];
}else q=JSON.stringify(a),h.set(a[g],a),e.set(a[g],q),f.set(q,a)};a.prototype.xa=function(b){void 0===b[this.d]&&(b[this.d]=this.Oa())};a.prototype.truncate=function(){this.t("truncate",this.a);this.a.length=0;this.X("change");return this};a.prototype.G=function(b,d){if(b){var c=this.K.G,a=this.da.G,h={},e;if(b instanceof Array){if(b.length>a){this.K.G=c.concat(b);this.ma("upsert",d);return}h=[];for(c=0;c<b.length;c++)h.push(this.G(b[c]));d&&d();return h}b[this.d]?(e={},e[this.d]=b[this.d],this.count(e)?
h.la="update":h.la="insert"):h.la="insert";switch(h.la){case "insert":h.result=this.f(b);break;case "update":h.result=this.update(e,b)}return h}d&&d()};a.prototype.update=function(b,d,c){function a(s){if(d&&void 0!==d[f]&&d[f]!=s[f]){h.s.aa(s[f]);var e=h.M(s,d,b,c,"");if(h.s.S(s[f],s))return e;throw"Primary key violation in update! Key violated: "+s[f];}return h.M(s,d,b,c,"")}d=this.m(d);d=this.oa(d);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var h=
this,e=this.ea.create("update"),f=this.d,g,t,q=this.F;e.start();e.time("Retrieve documents to update");g=this.find(b,{m:!1});e.time("Retrieve documents to update");if(g.length&&(e.time("Update documents"),t=g.filter(a),e.time("Update documents"),t.length)){if(q&&q.length){this.debug("views")&&console.log("Updating views from collection: "+this.name());e.time("Inform views of update");for(g=0;g<q.length;g++)q[g].update(b,d);e.time("Inform views of update")}this.bb(t);this.X("change",{type:"update",
data:t})}e.stop();return t||[]};a.prototype.M=function(b,d,c,a,e){d=this.m(d);e=e||"";"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));var f=!1,g=!1,p,t,q,l,m;for(l in d)if(d.hasOwnProperty(l)){p=!1;if("$"===l.substr(0,1))switch(l){case "$inc":p=!0;for(m in d[l])if(d[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if("number"===typeof b[m])this.kb(b,m,d[l][m]),f=!0;else throw"Cannot increment field that is not a number! ("+m+")!";break;case "$push":p=!0;for(m in d[l])if(d[l].hasOwnProperty(m)&&"$"!==m.substr(0,
1))if(b[m]instanceof Array)this.Ia(b[m],d[l][m]),f=!0;else throw"Cannot push to a key that is not an array! ("+m+")!";break;case "$addToSet":p=!0;for(m in d[l])if(d[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array){t=b[m];var k;q=t.length;var n,g=!0;k=a&&a.Eb;var r,u;k&&k.key?(r=!1,u=new h(k.key),n=u.value(d[l][m])[0]):(n=JSON.stringify(d[l][m]),r=!0);for(k=0;k<q;k++)if(r){if(JSON.stringify(t[k])===n){g=!1;break}}else if(n===u.value(t[k])[0]){g=!1;break}g&&(this.Ia(b[m],d[l][m]),
f=!0)}else throw"Cannot push to a key that is not an array! ("+m+")!";break;case "$splicePush":p=!0;for(m in d[l])if(d[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array)if(f=d[l].qa,void 0!==f)delete d[l][m].qa,this.nb(b[m],f,d[l][m]),f=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+m+")!";break;case "$move":p=!0;for(m in d[l])if(d[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array)for(q=
0;q<b[m].length;q++){if(this.l(b[m][q],d[l][m])){f=d[l].qa;if(void 0!==f)this.mb(b[m],q,f),f=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot pull from a key that is not an array! ("+m+")!";break;case "$pull":for(m in p=!0,d[l])if(d[l].hasOwnProperty(m)&&"$"!==m.substr(0,1))if(b[m]instanceof Array){t=[];for(q=0;q<b[m].length;q++)this.l(b[m][q],d[l][m])&&t.push(q);for(q=t.length;q--;)this.lb(b[m],t[q]),f=!0}else throw"Cannot pull from a key that is not an array! ("+
m+")!";}if(".$"===l.substr(l.length-2,2)&&(p=!0,l=l.substr(0,l.length-2),g=new h(e+"."+l),b[l]&&b[l]instanceof Array&&b[l].length)){t=[];for(q=0;q<b[l].length;q++)this.l(b[l][q],g.value(c)[0])&&t.push(q);for(q=0;q<t.length;q++)(g=this.M(b[l][t[q]],d[l+".$"],c,a,e+"."+l))&&(f=!0)}if(!p)if("object"===typeof d[l])if(null!==b[l]&&"object"===typeof b[l])if(p=b[l]instanceof Array,t=d[l]instanceof Array,p||t)if(!t&&p)for(q=0;q<b[l].length;q++)(g=this.M(b[l][q],d[l],c,a,e+"."+l))&&(f=!0);else this.ia(b,l,
d[l]),f=!0;else(g=this.M(b[l],d[l],c,a,e+"."+l))&&(f=!0);else this.ia(b,l,d[l]),f=!0;else b[l]!==d[l]&&(this.ia(b,l,d[l]),f=!0)}return f};a.prototype.ia=function(b,d,c){this.q?($.B(b).setProperty(d,c),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+d+'" for collection "'+this.name()+'"')):(b[d]=c,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+d+'" for collection "'+this.name()+'"'))};a.prototype.mb=function(b,
d,c){this.q?($.B(b).move(d,c),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+d+'" to "'+c+'" for collection "'+this.name()+'"')):(b.splice(c,0,b.splice(d,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+d+'" to "'+c+'" for collection "'+this.name()+'"'))};a.prototype.nb=function(b,d,c){b.length>d?this.q?$.B(b).f(d,c):b.splice(d,0,c):this.q?$.B(b).f(c):b.push(c)};a.prototype.Ia=function(b,
d){this.q?$.B(b).f(d):b.push(d)};a.prototype.lb=function(b,d){this.q?$.B(b).remove(d):b.splice(d,1)};a.prototype.kb=function(b,d,c){this.q?$.B(b).setProperty(d,b[d]+c):b[d]+=c};a.prototype.remove=function(b){var d,c,a=this.F,e;if(b instanceof Array){a=[];for(d=0;d<b.length;d++)a.push(this.remove(b[d]));return a}d=this.find(b,{m:!1});if(d.length){for(e=0;e<d.length;e++)c=d[e],this.cb(c),c=this.a.indexOf(c),this.q?$.B(this.a).remove(c):this.a.splice(c,1);if(a&&a.length)for(e=0;e<a.length;e++)a[e].remove(b);
this.ab(d);this.X("change",{type:"remove",data:d})}return d};a.prototype.X=function(){var b=this,d;this.Za||this.h&&(!this.h||this.h.Za)?this.t.apply(this,arguments):(d=arguments,this.ua&&clearTimeout(this.ua),this.ua=setTimeout(function(){b.debug()&&console.log("ForerunnerDB.Collection: Emitting "+d[0]);b.t.apply(b,d)},100))};a.prototype.ma=function(b,d){var c=this.K[b],a=this.da[b],e=this.Va[b];if(c.length){var h=this;c.length&&(c=c.length>a?c.splice(0,a):c.splice(0,c.length),this[b](c));setTimeout(function(){h.ma(b,
d)},e)}else d&&d()};a.prototype.f=function(b,d,c){"function"===typeof d?(c=d,d=this.a.length):void 0===d&&(d=this.a.length);b=this.oa(b);return this.Aa(b,d,c)};a.prototype.Aa=function(b,d,c){var a=this.K.f,e=this.da.f,h=[],f=[],g=this.F;if(b instanceof Array){if(b.length>e){this.K.f=a.concat(b);this.ma("insert",c);return}for(e=0;e<b.length;e++)a=this.za(b[e],d+e),!0===a?h.push(b[e]):f.push({qb:b[e],reason:a})}else a=this.za(b,d),!0===a?h.push(b):f.push({qb:b,reason:a});if(g&&g.length)for(a=0;a<g.length;a++)g[a].f(b,
d);this.$a(h,f);c&&c();this.X("change",{type:"insert",data:h});return{Sb:h,Rb:f}};a.prototype.za=function(b,d){if(b){var c;this.xa(b);if(c=this.sb(b))return"Index violation in index: "+c;this.Xa(b);this.q?$.B(this.a).f(d,b):this.a.splice(d,0,b);return!0}return"No document passed to insert"};a.prototype.Xa=function(b){var d=this.U,c,a=JSON.stringify(b);this.s.S(b[this.d],b);this.fa.S(b[this.d],a);this.ca.S(a,b);for(c in d)d.hasOwnProperty(c)&&d[c].f(b)};a.prototype.cb=function(b){var d=this.U,c,a=
JSON.stringify(b);this.s.aa(b[this.d]);this.fa.aa(b[this.d]);this.ca.aa(a);for(c in d)d.hasOwnProperty(c)&&d[c].remove(b)};a.prototype.Ab=function(b){b=this.find(b,void 0);(new a).Ga().primaryKey(this.d).setData(b)};a.prototype.Ga=function(){return this};a.prototype.m=function(b){return JSON.parse(JSON.stringify(b))};a.prototype.find=function(b,d){function c(d){return e.l(d,b,"and")}b=b||{};d=d||{};d.m=void 0!==d.m?d.m:!0;var a=this.ea.create("find"),e=this,f,g=!0,p,k,q,l,m,n,r,y,u,v=[];a.start();
if(b){a.time("analyseQuery");f=this.Ua(b,d,a);a.time("analyseQuery");a.data("analysis",f);if(f.La&&f.Qa){a.time("joinReferences");for(k=0;k<f.ja.length;k++)l=f.ja[k],q=new h(f.Ma[l]),q=q.value(b)[0],this.h.W(f.ja[k]).Ab(q);a.time("joinReferences")}f.u.length&&(!d||d&&!d.Wb)?(a.data("index.potential",f.u),a.data("index.used",f.u[0].index),a.time("indexLookup"),p=f.u[0].A,a.time("indexLookup"),f.u[0].n.J===f.u[0].n.o&&(g=!1)):a.O("usedIndex",!1);g&&(p&&p.length?(f=p.length,a.time("tableScan: "+f),p=
p.filter(c)):(f=this.a.length,a.time("tableScan: "+f),p=this.a.filter(c)),d.sort&&(a.time("sort"),p=this.sort(d.sort,p),a.time("sort")),a.time("tableScan: "+f));d.ka&&p&&p.length>d.ka&&(p.length=d.ka,a.data("limit",d.ka));d.m&&(a.time("decouple"),p=this.m(p),a.time("decouple"),a.data("flag.decouple",!0));if(d.join){for(f=0;f<d.join.length;f++)for(l in d.join[f])if(d.join[f].hasOwnProperty(l))for(y=l,g=this.h.W(l),k=d.join[f][l],u=0;u<p.length;u++){n={};r=q=!1;for(m in k)if(k.hasOwnProperty(m))if("$"===
m.substr(0,1))switch(m){case "$as":y=k[m];break;case "$multi":q=k[m];break;case "$require":r=k[m]}else n[m]=(new h(k[m])).value(p[u])[0];n=g.find(n);!r||r&&n[0]?p[u][y]=!1===q?n[0]:n:v.push(p[u])}a.data("flag.join",!0)}if(v.length){a.time("removalQueue");for(m=0;m<v.length;m++)l=p.indexOf(v[m]),-1<l&&p.splice(l,1);a.time("removalQueue")}if(d.transform){a.time("transform");for(m=0;m<p.length;m++)p.splice(m,1,d.transform(p[m]));a.time("transform");a.data("flag.transform",!0)}this.i&&this.D&&(a.time("transformOut"),
p=this.Bb(p),a.time("transformOut"));a.data("results",p.length);a.stop()}else a.stop(),p=[];p.Ob=a;return p};a.prototype.transform=function(b){return void 0!==b?("object"===typeof b?(void 0!==b.enabled&&(this.i=b.enabled),void 0!==b.H&&(this.C=b.H),void 0!==b.I&&(this.D=b.I)):this.i=!1===b?!1:!0,this):{enabled:this.i,H:this.C,I:this.D}};a.prototype.oa=function(b){if(this.i&&this.C){if(b instanceof Array){var d=[],c;for(c=0;c<b.length;c++)d[c]=this.C(b[c]);return d}return this.C(b)}return b};a.prototype.Bb=
function(b){if(this.i&&this.D){if(b instanceof Array){var d=[],c;for(c=0;c<b.length;c++)d[c]=this.D(b[c]);return d}return this.D(b)}return b};a.prototype.sort=function(b,d){d=d||[];var c=[],a,e;for(a in b)b.hasOwnProperty(a)&&(e={},e[a]=b[a],e.Ta=a,c.push(e));return 2>c.length?this.ga(b,d):this.ta(c,d)};a.prototype.ta=function(b,d){var c=b.shift(),a,e,f=[];if(0<b.length){d=this.ga(c,d);a=this.ob(c.Ta,d);for(e in a)a.hasOwnProperty(e)&&(c=[].concat(b),f=f.concat(this.ta(c,a[e])));return f}return this.ga(c,
d)};a.prototype.ga=function(b,d){var c=new h,a=c.parse(b,!0)[0];c.path(a.path);return d.sort(1===a.value?function(b,d){var a=c.value(b)[0],e=c.value(d)[0];return"string"===typeof a&&"string"===typeof e?a.localeCompare(e):a>e?1:a<e?-1:0}:function(b,d){var a=c.value(b)[0],e=c.value(d)[0];return"string"===typeof a&&"string"===typeof e?1===a.localeCompare(e)?-1:1:a>e?-1:a<e?1:0})};a.prototype.ob=function(b,d){var c,a={};for(c=0;c<d.length;c++)a[d[c][b]]=a[d[c][b]]||[],a[d[c][b]].push(d[c]);return a};
a.prototype.Ua=function(b,c,a){var e={Ra:[this.j],u:[],La:!1,Qa:!1,Ma:{},Q:b,options:c},f,g=[],k=[],p,n,q,l,m;a.time("checkIndexes");void 0!==b[this.d]&&(a.time("checkIndexMatch: Primary Key"),p=new h,e.u.push({A:this.s.A(b,c),n:{Na:[this.d],o:1,J:p.Ja(b)},index:this.s}),a.time("checkIndexMatch: Primary Key"));for(m in this.ya)if(this.ya.hasOwnProperty(m)&&(n=this.ya[m],q=n.name(),a.time("checkIndexMatch: "+q),p=n.match(b,c),l=n.A(b,c),0<p.o&&e.u.push({A:l,n:p,index:n}),a.time("checkIndexMatch: "+
q),p.J===p.o))break;a.time("checkIndexes");1<e.u.length&&(a.time("findOptimalIndex"),e.u.sort(function(b,c){return b.n.J===b.n.o?-1:c.n.J===c.n.o?1:b.n.o===c.n.o?b.A.length-c.A.length:c.n.o-b.n.o}),a.time("findOptimalIndex"));if(c.join){e.La=!0;for(a=0;a<c.join.length;a++)for(f in c.join[a])c.join[a].hasOwnProperty(f)&&(g.push(f),"$as"in c.join[a][f]?k.push(c.join[a][f].$as):k.push(f));for(f=0;f<k.length;f++)if(c=this.Ea(b,k[f],""))e.Ma[g[f]]=c,e.Qa=!0;e.ja=g;e.Ra=e.Ra.concat(g)}return e};a.prototype.Ea=
function(b,c,a){for(var e in b)if(b.hasOwnProperty(e)){if(e===c)return a&&(a+="."),a+e;if("object"===typeof b[e])return a&&(a+="."),a+=e,this.Ea(b[e],c,a)}return!1};a.prototype.l=function(b,c,a){var e,f;e=typeof b;f=typeof c;var h=!0,g;if(!("string"!==e&&"number"!==e||"string"!==f&&"number"!==f))b!==c&&(h=!1);else for(g in c)if(c.hasOwnProperty(g)){e=!1;if("$"===g.substr(0,1))switch(g){case "$gt":if(b>c[g]){if("or"===a)return!0}else h=!1;e=!0;break;case "$gte":if(b>=c[g]){if("or"===a)return!0}else h=
!1;e=!0;break;case "$lt":if(b<c[g]){if("or"===a)return!0}else h=!1;e=!0;break;case "$lte":if(b<=c[g]){if("or"===a)return!0}else h=!1;e=!0;break;case "$exists":if(void 0===b!==c[g]){if("or"===a)return!0}else h=!1;e=!0;break;case "$or":e=!0;for(f=0;f<c[g].length;f++){if(this.l(b,c[g][f],"and"))return!0;h=!1}break;case "$and":e=!0;for(f=0;f<c[g].length;f++)if(!this.l(b,c[g][f],"and"))return!1;break;case "$in":if(c[g]instanceof Array){e=c[g];f=e.length;var k,n=!1;for(k=0;k<f;k++)if(e[k]===b){n=!0;break}if(n){if("or"===
a)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+g;e=!0;break;case "$nin":if(c[g]instanceof Array){e=c[g];f=e.length;n=!0;for(k=0;k<f;k++)if(e[k]===b){n=!1;break}if(n){if("or"===a)return!0}else h=!1}else throw"Cannot use a $nin operator on a non-array key: "+g;e=!0;break;case "$ne":if(b!=c[g]){if("or"===a)return!0}else h=!1;e=!0}if(!e&&c[g]instanceof RegExp)if(e=!0,"object"===typeof b&&void 0!==b[g]&&c[g].test(b[g])){if("or"===a)return!0}else h=!1;if(!e)if("object"===
typeof c[g])if(void 0!==b[g]){if(b[g]instanceof Array&&!(c[g]instanceof Array))for(e=!1,f=0;f<b[g].length&&!(e=this.l(b[g][f],c[g],void 0));f++);else if(!(b[g]instanceof Array)&&c[g]instanceof Array)for(e=!1,f=0;f<c[g].length&&!(e=this.l(b[g],c[g][f],void 0));f++);else e="object"===typeof b?this.l(b[g],c[g],void 0):this.l(void 0,c[g],void 0);if(e){if("or"===a)return!0}else h=!1}else if(c[g]&&void 0!==c[g].$exists)if(e=this.l(void 0,c[g],void 0)){if("or"===a)return!0}else h=!1;else h=!1;else if(b&&
b[g]===c[g]){if("or"===a)return!0}else if(b&&b[g]&&b[g]instanceof Array&&c[g]&&"object"!==typeof c[g]){e=!1;for(f=0;f<b[g].length&&!(e=this.l(b[g][f],c[g],void 0));f++);if(e){if("or"===a)return!0}else h=!1}else h=!1;if("and"===a&&!h)return!1}return h};a.prototype.count=function(b,c){return b?this.find(b,c).length:this.a.length};a.prototype.sb=function(b){var c,a=this.U,e,f;if(this.s.get(b[this.d]))c=this.s;else for(e in a)if(a.hasOwnProperty(e)&&(f=a[e],f.unique()&&f.Cb(b))){c=f;break}return c?c.name():
!1};a.prototype.index=function(b){if(this.U)return this.U[b]};a.prototype.Oa=function(b){var c=Math.pow(10,17);if(b){var a=0,e=b.length,f;for(f=0;f<e;f++)a+=b.charCodeAt(f)*c;b=a.toString(16)}else k.Y++,b=(k.Y+(Math.random()*c+Math.random()*c+Math.random()*c+Math.random()*c)).toString(16);return b};e.prototype.W=function(b,c){if(b)return this.v[b]||this.debug()&&console.log("Creating collection "+b),this.v[b]=this.v[b]||(new a(b)).db(this),void 0!==c&&this.v[b].primaryKey(c),this.v[b];throw"Cannot get collection with undefined name!";
};r.g=a},{"./Crc":4,"./Index":5,"./KeyValueStore":6,"./Metrics":7,"./Overload":9,"./Path":10,"./Shared":11}],3:[function(n,r){function a(){this.e.apply(this,arguments)}var k,e;k=n("./Shared.js");a.prototype.e=function(){this.v={};this.c={}};k.p.sa=a;e=n("./Overload.js");n("./Collection.js");n("./Metrics.js");n("./Crc.js");a.prototype.m=function(c){return JSON.parse(JSON.stringify(c))};a.prototype.debug=new e([function(){return this.c.all},function(c){return void 0!==c&&"boolean"===typeof c?(this.c.all=
c,this):this.c.all},function(c,a){return void 0!==c?void 0!==a?(this.c[c]=a,this):this.c[c]:this.c.all}]);a.prototype.t=function(c,a){this.r=this.r||{};if(c in this.r){var e=this.r[c],h=e.length,b;for(b=0;b<h;b++)e[b].apply(this,Array.prototype.slice.call(arguments,1))}return this};a.prototype.Oa=function(c){var a,e,h=Math.pow(10,17),b;if(c){a=0;e=c.length;for(b=0;b<e;b++)a+=c.charCodeAt(b)*h;c=a.toString(16)}else k.Y++,c=(k.Y+(Math.random()*h+Math.random()*h+Math.random()*h+Math.random()*h)).toString(16);
return c};r.g=a},{"./Collection.js":2,"./Crc.js":4,"./Metrics.js":7,"./Overload.js":9,"./Shared.js":11}],4:[function(n,r){var a=function(){var a=[],e,c,f;for(c=0;256>c;c++){e=c;for(f=0;8>f;f++)e=e&1?3988292384^e>>>1:e>>>1;a[c]=e}return a}();r.g=function(k){var e=-1,c;for(c=0;c<k.length;c++)e=e>>>8^a[(e^k.charCodeAt(c))&255];return(e^-1)>>>0}},{}],5:[function(n,r){function a(){this.e.apply(this,arguments)}var k=n("./Shared"),e=n("./Path");a.prototype.e=function(c,a,e){this.T={};this.Wa=this.Ya(c,c);
this.data({});this.unique(a&&a.unique?a.unique:!1);void 0!==c&&this.keys(c);void 0!==e&&this.W(e);this.name(a&&a.name?a.name:this.Wa)};k.p.Hb=a;a.prototype.data=function(c){return void 0!==c?(this.a=c,this):this.a};a.prototype.name=function(c){return void 0!==c?(this.j=c,this):this.j};a.prototype.W=function(c){return void 0!==c?(this.v=c,this):this.v};a.prototype.keys=function(c){return void 0!==c?(this.w=c,(new e).parse(this.w),this):this.w};a.prototype.type=function(c){return void 0!==c?(this.jb=
c,this):this.jb};a.prototype.unique=function(c){return void 0!==c?(this.ha=c,this):this.ha};a.prototype.f=function(c){var a,e;this.ha&&(a=this.V(c,this.w),this.Ha[a]=c);a=this.Ba(c,this.w);for(e=0;e<a.length;e++)this.yb(a[e],c)};a.prototype.remove=function(c){var a,e;this.ha&&(a=this.V(c,this.w),delete this.Ha[a]);a=this.Ba(c,this.w);for(e=0;e<a.length;e++)this.wb(a[e],c)};a.prototype.Cb=function(c){c=this.V(c,this.w);return Boolean(this.Ha[c])};a.prototype.yb=function(c,a){var e=this.a[c]=this.a[c]||
[];-1===e.indexOf(a)&&(e.push(a),this.xb(a,e))};a.prototype.wb=function(c,a){var e=this.a[c],h;h=e.indexOf(a);-1<h&&(e.splice(h,1),this.vb(a));e.length||delete this.a[c]};a.prototype.xb=function(c,a){var e=c[this.v.primaryKey()];this.T[e]=this.T[e]||[];e=this.T[e];-1===e.indexOf(a)&&e.push(a)};a.prototype.vb=function(c){c=c[this.v.primaryKey()];delete this.T[c]};a.prototype.A=function(c){return this.a[this.V(c,this.w)]||[]};a.prototype.match=function(c){return(new e).Ka(this.w,c)};a.prototype.V=function(c,
a){var g=new e,h,b="",d;h=g.parse(a);for(d=0;d<h.length;d++)b&&(b+="_"),b+=g.value(c,h[d].path).join(":");return b};a.prototype.Ya=function(c,a){var g=new e,h,b="",d;h=g.parse(a);for(d=0;d<h.length;d++)b&&(b+="_"),b+=g.tb(c,h[d].path);return b};a.prototype.Ba=function(c,a){var g=new e,h,b=[],d,k,n,r;h=g.parse(a);for(n=0;n<h.length;n++)for(d=g.value(c,h[n].path),k=0;k<d.length;k++)if(0===n)b.push(d[k]);else for(r=0;r<b.length;r++)b[r]=b[r]+"_"+d[k];return b};r.g=a},{"./Path":10,"./Shared":11}],6:[function(n,
r){function a(a){this.e.apply(this,arguments)}var k=n("./Shared");a.prototype.e=function(a){this.j=a;this.a={};this.d="_id"};k.p.Ib=a;a.prototype.name=function(a){return void 0!==a?(this.j=a,this):this.j};a.prototype.primaryKey=function(a){return void 0!==a?(this.d=a,this):this.d};a.prototype.truncate=function(){this.a={};return this};a.prototype.set=function(a,c){this.a[a]=c?c:!0;return this};a.prototype.get=function(a){return this.a[a]};a.prototype.A=function(a){a=a[this.d];var c,f,g,h;if(a instanceof
Array){f=a.length;h=[];for(c=0;c<f;c++)(g=this.a[a[c]])&&h.push(g);return h}if(a instanceof RegExp){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&a.test(c)&&h.push(this.a[c]);return h}if("object"===typeof a){if(a.Sa){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&c!==a.Sa&&h.push(this.a[c]);return h}if(a.pa&&a.pa instanceof Array){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&-1<a.pa.indexOf(c)&&h.push(this.a[c]);return h}if(a.ra&&a.ra instanceof Array){h=[];for(c in this.a)this.a.hasOwnProperty(c)&&
-1===a.ra.indexOf(c)&&h.push(this.a[c]);return h}if(a.ba&&a.ba instanceof Array){h=[];for(c=0;c<a.ba.length;c++)h=h.concat(this.A(a.ba[c]));return h}}else return g=this.a[a],void 0!==g?[g]:[]};a.prototype.aa=function(a){delete this.a[a]};a.prototype.S=function(a,c){return void 0===this.a[a]?(this.a[a]=c,!0):!1};r.g=a},{"./Shared":11}],7:[function(n,r){function a(){this.e.apply(this,arguments)}var k=n("./Shared"),e=n("./Operation");a.prototype.e=function(){this.a=[]};k.p.Jb=a;a.prototype.create=function(a){a=
new e(a);this.wa&&this.a.push(a);return a};a.prototype.start=function(){this.wa=!0;return this};a.prototype.stop=function(){this.wa=!1;return this};r.g=a},{"./Operation":8,"./Shared":11}],8:[function(n,r){function a(a){this.Pa=new e;this.e.apply(this,arguments)}var k=n("./Shared"),e=n("./Path");a.prototype.e=function(a){this.a={Tb:a,index:{Ub:[],Xb:!1},zb:[],time:{R:0,Z:0,$:0,ub:{}},O:{},log:[]}};k.p.Kb=a;a.prototype.start=function(){this.a.time.R=(new Date).getTime()};a.prototype.log=function(a){if(a){var e=
0<this.Pb.length?this.a.log[this.a.log.length-1].time:0;a={event:a,time:(new Date).getTime(),pb:0};this.a.log.push(a);e&&(a.pb=a.time-e);return this}return this.a.log};a.prototype.time=function(a){if(void 0!==a){var e=this.a.time.ub,e=e[a]=e[a]||{};e.R?(e.Z=(new Date).getTime(),e.$=e.Z-e.R,e.na.$=e.$,delete e.na):(e.R=(new Date).getTime(),e.na={name:a},this.a.zb.push(e.na));return this}return this.a.time};a.prototype.O=function(a,e){if(void 0!==a&&void 0!==e)this.a.O[a]=e;else return void 0!==a?this.a.O[a]:
this.a.O};a.prototype.data=function(a,e){return void 0!==e?(this.Pa.set(this.a,a,e),this):this.Pa.get(this.a,a)};a.prototype.stop=function(){this.a.time.Z=(new Date).getTime();this.a.time.$=this.a.time.Z-this.a.time.R};r.g=a},{"./Path":10,"./Shared":11}],9:[function(n,r){function a(a){if(a){var e,c=a.length;return function(){for(e=0;e<c;e++)if(a[e].length===arguments.length)return a[e].apply(this,arguments);return null}}return function(){}}n("./Shared").p.Lb=a;r.g=a},{"./Shared":11}],10:[function(n,
r){function a(a){this.e.apply(this,arguments)}var k=n("./Shared");a.prototype.e=function(a){a&&this.path(a)};k.p.Mb=a;a.prototype.path=function(a){return void 0!==a?(this.Ca=this.N(a),this.Da=this.Ca.split("."),this):this.Ca};a.prototype.Ja=function(a){var c=0,f;for(f in a)a.hasOwnProperty(f)&&void 0!==a[f]&&("object"!==typeof a[f]?c++:c+=this.Ja(a[f]));return c};a.prototype.Ka=function(a,c){var f,g={},h=0,b=0,d;for(d in c)c.hasOwnProperty(d)&&("object"===typeof c[d]?(f=this.Ka(a[d],c[d]),g[d]=f.Na,
b+=f.J,h+=f.o):(b++,a&&a[d]&&"object"!==typeof a[d]?(g[d]=!0,h++):g[d]=!1));return{Na:g,o:h,J:b}};a.prototype.parse=function(a,c){var f=[],g="",h,b,d;for(b in a)if(a.hasOwnProperty(b))if(g=b,"object"===typeof a[b])if(c)for(h=this.parse(a[b],c),d=0;d<h.length;d++)f.push({path:g+"."+h[d].path,value:h[d].value});else for(h=this.parse(a[b]),d=0;d<h.length;d++)f.push({path:g+"."+h[d].path});else c?f.push({path:g,value:a[b]}):f.push({path:g});return f};a.prototype.value=function(a,c){if(void 0!==a&&"object"===
typeof a){var f,g,h,b,d=[],k;void 0!==c&&(c=this.N(c),f=c.split("."));f=f||this.Da;g=f.length;h=a;for(k=0;k<g;k++){h=h[f[k]];if(b instanceof Array){for(g=0;g<b.length;g++)d=d.concat(this.value(b,g+"."+f[k]));return d}if(!h||"object"!==typeof h)break;b=h}return[h]}return[]};a.prototype.set=function(a,c,f){if(void 0!==a&&void 0!==c){var g;c=this.N(c);c=c.split(".");g=c.shift();c.length?(a[g]=a[g]||{},this.set(a[g],c.join("."),f)):a[g]=f}return a};a.prototype.get=function(a,c){return this.value(a,c)[0]};
a.prototype.push=function(a,c,f){if(void 0!==a&&void 0!==c){var g;c=this.N(c);c=c.split(".");g=c.shift();if(c.length)a[g]=a[g]||{},this.set(a[g],c.join("."),f);else if(a[g]=a[g]||[],a[g]instanceof Array)a[g].push(f);else throw"Cannot push to a path whose endpoint is not an array!";}return a};a.prototype.tb=function(a,c){var f,g,h,b,d;void 0!==c&&(c=this.N(c),f=c.split("."));f=f||this.Da;g=f.length;h=a;for(d=0;d<g;d++)if(h=h[f[d]],!h||"object"!==typeof h){b=f[d]+":"+h;break}return b};a.prototype.N=
function(a){"."===a.substr(0,1)&&(a=a.substr(1,a.length-1));return a};r.g=a},{"./Shared":11}],11:[function(n,r){r.g={Y:0,p:{},Vb:{}}},{}],12:[function(n,r){function a(a,b,c){this.e.apply(this,arguments)}var k,e,c,f,g;k=n("./Shared");a.prototype.e=function(a,b,c){this.j=a;this.va=[];this.r={};this.L={Q:b,options:c};this.c={};this.b=new e("__FDB__view_privateData_"+this.j)};k.p.Nb=a;e=n("./Collection");g=n("./Overload");c=e.prototype.e;k=k.p.sa;f=k.prototype.e;a.prototype.debug=new g([function(){return this.c.all},
function(a){return void 0!==a&&"boolean"===typeof a?(this.c.all=a,this.b.debug(a),this.P().debug(a),this):this.c.all},function(a,b){return void 0!==a?void 0!==b?(this.c[a]=b,this.b.debug(a,b),this.P().debug(a,b),this):this.c[a]:this.c.all}]);a.prototype.name=function(a){return void 0!==a?(this.j=a,this):this.j};a.prototype.find=function(a,b){return this.P().find(a,b)};a.prototype.f=function(a,b,c){a=this.b.m(a);"function"===typeof b?(c=b,b=this.b.length):void 0===b&&(b=this.b.length);this.eb(a,b);
this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.b.name()+'"');return this.b.Aa(a,b,c)};a.prototype.update=function(a,b){this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.b.name()+'"');var c=this.b.update(a,b),e,f,g;if(this.i&&this.C){e=this.k.primaryKey();for(var k=0;k<c.length;k++)f={},g=c[k],f[e]=g[e],this.ib(f,g)}return c};
a.prototype.remove=function(a){this.gb(a);this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+this.b.name()+'"');return this.b.remove(a)};a.prototype.t=function(){this.b.t.apply(this.b,arguments)};a.prototype.db=function(a){return void 0!==a?(this.h=a,this.b.db(a),this.P().db(a),this):this.h};a.prototype.primaryKey=function(){return this.b.primaryKey()};a.prototype.Q=function(a,b){return void 0!==a?(this.L.Q=a,void 0!==
b&&!0!==b||this.refresh(),this):this.L.Q};a.prototype.refresh=function(){var a,b=this.P(),c;this.b.remove();b.remove();for(c=0;c<this.va.length;c++)a=this.va[c],this.b.f(a.find(this.L.Q,this.L.options));a=this.b.find({},this.L.options);b.q?$.B(b.a).refresh(a):(this.b.a.length=0,this.b.a=this.b.a.concat(a));return this};a.prototype.count=function(){return this.b&&this.b.a?this.b.a.length:0};a.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this.i=a.enabled),
void 0!==a.H&&(this.C=a.H),void 0!==a.I&&(this.D=a.I)):this.i=!1===a?!1:!0,this.fb(this.b.primaryKey()),this.hb(this.b.find()),this):{enabled:this.i,H:this.C,I:this.D}};a.prototype.P=function(){return this.i?this.k:this.b};a.prototype.hb=function(a){this.i&&(this.k=new e("__FDB__view_publicData_"+this.j),this.k.db(this.b.h),this.k.transform({enabled:!0,H:this.C,I:this.D}),this.k.setData(a))};a.prototype.eb=function(a,b){this.i&&this.k&&this.k.f(a,b)};a.prototype.ib=function(a,b){this.i&&this.k&&this.k.update(a,
b)};a.prototype.gb=function(a){this.i&&this.k&&this.k.remove(a)};a.prototype.fb=function(a){this.i&&this.k&&this.k.primaryKey(a)};e.prototype.e=function(){this.F=[];c.apply(this,arguments)};k.prototype.e=function(){this.F={};f.apply(this,arguments)};r.g=a},{"./Collection":2,"./Overload":9,"./Shared":11}]},{},[1])(1)}
if("object"==typeof exports&&"undefined"!=typeof module)module.g=w();else if("function"==typeof define&&define.Qb)define([],w);else{var x;"undefined"!=typeof window?x=window:"undefined"!=typeof global?x=global:"undefined"!=typeof self&&(x=self);x.Gb=w()}!0;
