$(function(){asyncTest("Events - Collection.on() :: Insert with Success",function(){dbUp();dataUp();expect(1);user.on("insert",function(a,b){ok(1===a.length,"Insert single document");start()});user.insert({_id:"2342",name:"hello"});dbDown()});asyncTest("Events - Collection.on() :: Insert with Failed",function(){dbUp();dataUp();expect(1);user.insert({_id:"2342",name:"hello"});user.on("insert",function(a,b){ok(1===b.length,"Insert single document with index violation");start()});user.insert({_id:"2342",
name:"hello"});dbDown()});asyncTest("Events - Collection.on() :: Update with Success",function(){dbUp();dataUp();expect(1);user.insert({_id:"2342",name:"hello"});user.on("update",function(a,b){ok(1===a.length,"Update single document");start()});user.update({_id:"2342"},{name:"hello2"});dbDown()});asyncTest("Events - Collection.on() :: Remove with Success",function(){dbUp();dataUp();expect(1);user.insert({_id:"2342",name:"hello"});user.on("remove",function(a,b){ok(1===a.length,"Remove single document");
start()});user.remove({_id:"2342"});dbDown()});asyncTest("Events - View.on() :: Insert",function(){dbUp();dataUp();viewUp();expect(1);db.view("userView").on("insert",function(a,b){ok(1===a.length,"Insert single document");start()});user.insert({_id:"2342",name:"hello"});viewDown();dbDown()});asyncTest("Events - CollectionGroup.on() :: Insert :: Event fired from collection",function(){dbUp();dataUp();viewUp();expect(1);db.collectionGroup("testGroup").addCollection(user).on("insert",function(a,b){ok(1===
a.length,"Insert single document");start()});user.insert({_id:"2342",name:"hello"});viewDown();dbDown()});asyncTest("Events - CollectionGroup.on() :: Update :: Event fired from collection",function(){dbUp();dataUp();viewUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(user).on("update",function(a,b){ok(1===a.length,"Update single document");start()});user.update({_id:"2342"},{name:"hello2"});viewDown();dbDown()});asyncTest("Events - CollectionGroup.on() :: Remove :: Event fired from collection",
function(){dbUp();dataUp();viewUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(user).on("remove",function(a,b){ok(1===a.length,"Remove single document");start()});user.remove({_id:"2342"});viewDown();dbDown()});asyncTest("Events - CollectionGroup.on() :: Insert :: Event fired from view",function(){dbUp();dataUp();viewUp();expect(1);db.collectionGroup("testGroup").addCollection(userView).on("insert",function(a,b){ok(1===a.length,"Insert single document");
start()});user.insert({_id:"2342",name:"hello"});viewDown();dbDown()});asyncTest("Events - CollectionGroup.on() :: Update :: Event fired from view",function(){dbUp();dataUp();viewUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(userView).on("update",function(a,b){ok(1===a.length,"Update single document");start()});user.update({_id:"2342"},{name:"hello2"});viewDown();dbDown()});asyncTest("Events - CollectionGroup.on() :: Remove :: Event fired from view",
function(){dbUp();dataUp();viewUp();expect(1);user.insert({_id:"2342",name:"hello"});db.collectionGroup("testGroup").addCollection(userView).on("remove",function(a,b){ok(1===a.length,"Remove single document");start()});user.remove({_id:"2342"});viewDown();dbDown()})});
