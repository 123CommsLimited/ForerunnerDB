!function(Pa){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=Pa();else if("function"==typeof define&&define.amd)define([],Pa);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.ForerunnerDB=Pa()}}(function(){return function e(m,k,h){function a(c,b){if(!k[c]){if(!m[c]){var g="function"==typeof require&&require;if(!b&&g)return g(c,!0);if(d)return d(c,!0);g=Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",
g;}g=k[c]={exports:{}};m[c][0].call(g.exports,function(g){var d=m[c][1][g];return a(d?d:g)},g,g.exports,e,m,k,h)}return k[c].exports}for(var d="function"==typeof require&&require,b=0;b<h.length;b++)a(h[b]);return a}({1:[function(e,m,k){k=e("../lib/Core");e("../lib/CollectionGroup");e("../lib/View");e("../lib/Highcharts");e("../lib/Persist");e("../lib/Document");e("../lib/Overview");e("../lib/vendor/jsviews");m.exports=k},{"../lib/CollectionGroup":3,"../lib/Core":4,"../lib/Document":6,"../lib/Highcharts":7,
"../lib/Overview":12,"../lib/Persist":14,"../lib/View":16,"../lib/vendor/jsviews":17}],2:[function(e,m,k){var h,a,d,b,c;k=e("./Shared");var f=function(g){this.init.apply(this,arguments)};f.prototype.init=function(g){this._primaryKey="_id";this._primaryIndex=new a("primary");this._primaryCrc=new a("primaryCrc");this._crcLookup=new a("crcLookup");this._name=g;this._data=[];this._groups=[];this._metrics=new h;this._linked=0;this._deferQueue={insert:[],update:[],remove:[],upsert:[]};this._deferThreshold=
{insert:100,update:100,remove:100,upsert:100};this._deferTime={insert:1,update:1,remove:1,upsert:1};this._subsetOf(this)};k.addModule("Collection",f);k.inherit(f.prototype,k.chainSystem);h=e("./Metrics");a=e("./KeyValueStore");d=e("./Path");b=e("./Index");c=e("./Crc");e=k.modules.Core;f.prototype.debug=k.common.debug;f.prototype.crc=c;k.synthesize(f.prototype,"name");f.prototype.on=k.common.on;f.prototype.off=k.common.off;f.prototype.emit=k.common.emit;f.prototype.drop=function(){if(this._db&&this._db._collection&&
this._name){this.debug()&&console.log("Dropping collection "+this._name);this.emit("drop");delete this._db._collection[this._name];var g=[],c;for(c=0;c<this._groups.length;c++)g.push(this._groups[c]);for(c=0;c<g.length;c++)this._groups[c].removeCollection(this);return!0}return!1};f.prototype.primaryKey=function(g){return void 0!==g?(this._primaryKey!==g&&(this._primaryKey=g,this._primaryIndex.primaryKey(g),this._rebuildPrimaryKeyIndex()),this):this._primaryKey};f.prototype._onInsert=function(g,c){this.emit("insert",
g,c)};f.prototype._onUpdate=function(g){this.emit("update",g)};f.prototype._onRemove=function(g){this.emit("remove",g)};k.synthesize(f.prototype,"db");f.prototype.setData=function(g,c,a){if(g){var d=this._metrics.create("setData");d.start();c=c||{};c.$decouple=void 0!==c.$decouple?c.$decouple:!0;c.$decouple&&(g=this.decouple(g));g instanceof Array||(g=[g]);d.time("transformIn");g=this.transformIn(g);d.time("transformIn");var b=this._data;this._linked?this.remove():this._data=[];g.length&&(this._linked?
this.insert(g):this._data=this._data.concat(g));d.time("Rebuild Primary Key Index");this._rebuildPrimaryKeyIndex(c);d.time("Rebuild Primary Key Index");d.time("Resolve chains");this.chainSend("setData",g,{oldData:b});d.time("Resolve chains");d.stop();this.emit("setData",this._data,b)}a&&a(!1);return this};f.prototype._rebuildPrimaryKeyIndex=function(g){var c=g&&void 0!==g.ensureKeys?g.ensureKeys:!0;g=g&&void 0!==g.violationCheck?g.violationCheck:!0;var d,a,b,f=this._primaryIndex,h=this._primaryCrc,
e=this._crcLookup,k=this._primaryKey,q;f.truncate();h.truncate();e.truncate();d=this._data;for(a=d.length;a--;)if(b=d[a],c&&this._ensurePrimaryKey(b),g){if(!f.uniqueSet(b[k],b))throw"Call to setData failed because your data violates the primary key unique constraint. One or more documents are using the same primary key: "+b[this._primaryKey];}else q=JSON.stringify(b),f.set(b[k],b),h.set(b[k],q),e.set(q,b)};f.prototype._ensurePrimaryKey=function(g){void 0===g[this._primaryKey]&&(g[this._primaryKey]=
this.objectId())};f.prototype.truncate=function(){this.emit("truncate",this._data);this._data.length=0;this.deferEmit("change");return this};f.prototype.upsert=function(g,c){if(g){var d=this._deferQueue.upsert,a=this._deferThreshold.upsert,b={},f;if(g instanceof Array){if(g.length>a){this._deferQueue.upsert=d.concat(g);this.processQueue("upsert",c);return}b=[];for(d=0;d<g.length;d++)b.push(this.upsert(g[d]));c&&c();return b}g[this._primaryKey]?(f={},f[this._primaryKey]=g[this._primaryKey],this.count(f)?
b.op="update":b.op="insert"):b.op="insert";switch(b.op){case "insert":b.result=this.insert(g);break;case "update":b.result=this.update(f,g)}return b}c&&c()};f.prototype.update=function(g,c,d){c=this.decouple(c);c=this.transformIn(c);this.debug()&&console.log('Updating some collection data for collection "'+this.name()+'"');var b=this,a=this._metrics.create("update"),f=this._primaryKey,h,e,k=function(a){if(c&&void 0!==c[f]&&c[f]!=a[f]){b._primaryIndex.unSet(a[f]);var h=b._updateObject(a,c,g,d,"");
if(b._primaryIndex.uniqueSet(a[f],a))return h;throw"Primary key violation in update! Key violated: "+a[f];}return b._updateObject(a,c,g,d,"")};a.start();a.time("Retrieve documents to update");h=this.find(g,{$decouple:!1});a.time("Retrieve documents to update");h.length&&(a.time("Update documents"),e=h.filter(k),a.time("Update documents"),e.length&&(a.time("Resolve chains"),this.chainSend("update",{query:g,update:c},d),a.time("Resolve chains"),this._onUpdate(e),this.deferEmit("change",{type:"update",
data:e})));a.stop();return e||[]};f.prototype.updateById=function(g,c){var a={};a[this._primaryKey]=g;return this.update(a,c)};f.prototype._updateObject=function(g,c,a,b,f,h){c=this.decouple(c);f=f||"";"."===f.substr(0,1)&&(f=f.substr(1,f.length-1));var e=!1,k=!1,n,q,p,l;for(l in c)if(c.hasOwnProperty(l)){n=!1;if("$"===l.substr(0,1))switch(l){case "$index":break;default:n=!0,(k=this._updateObject(g,c[l],a,b,f,l))&&(e=!0)}if(this._isPositionalKey(l)&&(n=!0,l=l.substr(0,l.length-2),k=new d(f+"."+l),
g[l]&&g[l]instanceof Array&&g[l].length)){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],k.value(a)[0])&&q.push(p);for(p=0;p<q.length;p++)(k=this._updateObject(g[l][q[p]],c[l+".$"],a,b,f+"."+l,h))&&(e=!0)}if(!n)if(h||"object"!==typeof c[l])switch(h){case "$inc":this._updateIncrement(g,l,c[l]);e=!0;break;case "$push":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){if(void 0!==c[l].$position&&c[l].$each instanceof Array)for(k=c[l].$position,n=c[l].$each.length,p=0;p<n;p++)this._updateSplicePush(g[l],
k+p,c[l].$each[p]);else if(c[l].$each instanceof Array)for(n=c[l].$each.length,p=0;p<n;p++)this._updatePush(g[l],c[l].$each[p]);else this._updatePush(g[l],c[l]);e=!0}else throw"Cannot push to a key that is not an array! ("+l+")";break;case "$pull":if(g[l]instanceof Array){q=[];for(p=0;p<g[l].length;p++)this._match(g[l][p],c[l])&&q.push(p);for(n=q.length;n--;)this._updatePull(g[l],q[n]),e=!0}break;case "$pullAll":if(g[l]instanceof Array)if(c[l]instanceof Array){if(q=g[l],n=q.length,0<n)for(;n--;){for(k=
0;k<c[l].length;k++)q[n]===c[l][k]&&(this._updatePull(g[l],n),n--,e=!0);if(0>n)break}}else throw"Cannot pullAll without being given an array of values to pull! ("+l+")";break;case "$addToSet":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array){p=g[l];var m;q=p.length;var F;n=!0;m=b&&b.$addToSet;var aa;m&&m.key?(k=!1,aa=new d(m.key),F=aa.value(c[l])[0]):(F=JSON.stringify(c[l]),k=!0);for(m=0;m<q;m++)if(k){if(JSON.stringify(p[m])===F){n=!1;break}}else if(F===aa.value(p[m])[0]){n=!1;break}n&&(this._updatePush(g[l],
c[l]),e=!0)}else throw"Cannot addToSet on a key that is not an array! (undefined)!";break;case "$splicePush":void 0===g[l]&&(g[l]=[]);if(g[l]instanceof Array)if(k=c.$index,void 0!==k)delete c.$index,this._updateSplicePush(g[l],k,c[l]),e=!0;else throw"Cannot splicePush without a $index integer value!";else throw"Cannot splicePush with a key that is not an array! ("+l+")";break;case "$move":if(g[l]instanceof Array)for(p=0;p<g[l].length;p++){if(this._match(g[l][p],c[l])){e=c[l].$index;if(void 0!==e)this._updateSpliceMove(g[l],
p,e),e=!0;else throw"Cannot move without a $index integer value!";break}}else throw"Cannot move on a key that is not an array! ("+l+")";break;case "$mul":this._updateMultiply(g,l,c[l]);e=!0;break;case "$rename":this._updateRename(g,l,c[l]);e=!0;break;case "$unset":this._updateUnset(g,l);e=!0;break;case "$pop":if(g[l]instanceof Array)this._updatePop(g[l],c[l])&&(e=!0);else throw"Cannot pop from a key that is not an array! ("+l+")";break;default:g[l]!==c[l]&&(this._updateProperty(g,l,c[l]),e=!0)}else if(null!==
g[l]&&"object"===typeof g[l])if(p=g[l]instanceof Array,q=c[l]instanceof Array,p||q)if(!q&&p)for(p=0;p<g[l].length;p++)(k=this._updateObject(g[l][p],c[l],a,b,f+"."+l,h))&&(e=!0);else g[l]!==c[l]&&(this._updateProperty(g,l,c[l]),e=!0);else(k=this._updateObject(g[l],c[l],a,b,f+"."+l,h))&&(e=!0);else g[l]!==c[l]&&(this._updateProperty(g,l,c[l]),e=!0)}return e};f.prototype._isPositionalKey=function(g){return".$"===g.substr(g.length-2,2)};f.prototype._updateProperty=function(g,c,a){this._linked?(jQuery.observable(g).setProperty(c,
a),this.debug()&&console.log('ForerunnerDB.Collection: Setting data-bound document property "'+c+'" for collection "'+this.name()+'"')):(g[c]=a,this.debug()&&console.log('ForerunnerDB.Collection: Setting non-data-bound document property "'+c+'" for collection "'+this.name()+'"'))};f.prototype._updateIncrement=function(g,c,a){this._linked?jQuery.observable(g).setProperty(c,g[c]+a):g[c]+=a};f.prototype._updateSpliceMove=function(g,c,a){this._linked?(jQuery.observable(g).move(c,a),this.debug()&&console.log('ForerunnerDB.Collection: Moving data-bound document array index from "'+
c+'" to "'+a+'" for collection "'+this.name()+'"')):(g.splice(a,0,g.splice(c,1)[0]),this.debug()&&console.log('ForerunnerDB.Collection: Moving non-data-bound document array index from "'+c+'" to "'+a+'" for collection "'+this.name()+'"'))};f.prototype._updateSplicePush=function(g,c,a){g.length>c?this._linked?jQuery.observable(g).insert(c,a):g.splice(c,0,a):this._linked?jQuery.observable(g).insert(a):g.push(a)};f.prototype._updatePush=function(g,c){this._linked?jQuery.observable(g).insert(c):g.push(c)};
f.prototype._updatePull=function(g,c){this._linked?jQuery.observable(g).remove(c):g.splice(c,1)};f.prototype._updateMultiply=function(g,c,a){this._linked?jQuery.observable(g).setProperty(c,g[c]*a):g[c]*=a};f.prototype._updateRename=function(g,c,a){var b=g[c];this._linked?(jQuery.observable(g).setProperty(a,b),jQuery.observable(g).removeProperty(c)):(g[a]=b,delete g[c])};f.prototype._updateUnset=function(g,c){this._linked?jQuery.observable(g).removeProperty(c):delete g[c]};f.prototype._updatePop=function(g,
c){var a,b=!1;0<g.length&&(this._linked?(1===c?a=g.length-1:-1===c&&(a=0),-1<a&&(jQuery.observable(arr).remove(a),b=!0)):1===c?(g.pop(),b=!0):-1===c&&(g.shift(),b=!0));return b};f.prototype.remove=function(g,c,a){var b,d;if(g instanceof Array){d=[];for(a=0;a<g.length;a++)d.push(this.remove(g[a],{noEmit:!0}));(!c||c&&!c.noEmit)&&this._onRemove(d);return d}a=this.find(g,{$decouple:!1});if(a.length){for(d=0;d<a.length;d++)b=a[d],this._removeIndex(b),b=this._data.indexOf(b),this._linked?jQuery.observable(this._data).remove(b):
this._data.splice(b,1);this.chainSend("remove",{query:g},c);(!c||c&&!c.noEmit)&&this._onRemove(a);this.deferEmit("change",{type:"remove",data:a})}return a};f.prototype.removeById=function(c){var a={};a[this._primaryKey]=c;return this.remove(a)};f.prototype.deferEmit=function(){var c=this,a;this._noEmitDefer||this._db&&(!this._db||this._db._noEmitDefer)?this.emit.apply(this,arguments):(a=arguments,this._changeTimeout&&clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){c.debug()&&
console.log("ForerunnerDB.Collection: Emitting "+a[0]);c.emit.apply(c,a)},100))};f.prototype.processQueue=function(c,a){var b=this._deferQueue[c],d=this._deferThreshold[c],f=this._deferTime[c];if(b.length){var e=this;b.length&&(b=b.length>d?b.splice(0,d):b.splice(0,b.length),this[c](b));setTimeout(function(){e.processQueue(c,a)},f)}else a&&a()};f.prototype.insert=function(c,a,b){"function"===typeof a?(b=a,a=this._data.length):void 0===a&&(a=this._data.length);c=this.transformIn(c);return this._insertHandle(c,
a,b)};f.prototype._insertHandle=function(c,a,b){var d=this._deferQueue.insert,f=this._deferThreshold.insert,e=[],h=[];if(c instanceof Array){if(c.length>f){this._deferQueue.insert=d.concat(c);this.processQueue("insert",b);return}for(f=0;f<c.length;f++)d=this._insert(c[f],a+f),!0===d?e.push(c[f]):h.push({doc:c[f],reason:d})}else d=this._insert(c,a),!0===d?e.push(c):h.push({doc:c,reason:d});this.chainSend("insert",c,{index:a});this._onInsert(e,h);b&&b();this.deferEmit("change",{type:"insert",data:e});
return{inserted:e,failed:h}};f.prototype._insert=function(c,a){if(c){var b;this._ensurePrimaryKey(c);if(b=this.insertIndexViolation(c))return"Index violation in index: "+b;this._insertIndex(c);this._linked?jQuery.observable(this._data).insert(a,c):this._data.splice(a,0,c);return!0}return"No document passed to insert"};f.prototype._insertIndex=function(c){var a=this._indexByName,b,d=JSON.stringify(c);this._primaryIndex.uniqueSet(c[this._primaryKey],c);this._primaryCrc.uniqueSet(c[this._primaryKey],
d);this._crcLookup.uniqueSet(d,c);for(b in a)a.hasOwnProperty(b)&&a[b].insert(c)};f.prototype._removeIndex=function(c){var a=this._indexByName,b,d=JSON.stringify(c);this._primaryIndex.unSet(c[this._primaryKey]);this._primaryCrc.unSet(c[this._primaryKey]);this._crcLookup.unSet(d);for(b in a)a.hasOwnProperty(b)&&a[b].remove(c)};f.prototype.subset=function(c,a){var b=this.find(c,a);return(new f)._subsetOf(this).primaryKey(this._primaryKey).setData(b)};f.prototype.subsetOf=function(){return this.__subsetOf};
f.prototype._subsetOf=function(c){this.__subsetOf=c;return this};f.prototype.distinct=function(c,a,b){a=this.find(a,b);c=new d(c);b={};var f=[],e,h;for(h=0;h<a.length;h++)(e=c.value(a[h])[0])&&!b[e]&&(b[e]=!0,f.push(e));return f};f.prototype.decouple=k.common.decouple;f.prototype.findById=function(c,a){var b={};b[this._primaryKey]=c;return this.find(b,a)[0]};f.prototype.peek=function(c,a){var b=this._data,d=b.length,e,h,k=new f;if("string"===typeof c){for(e=0;e<d;e++)h=JSON.stringify(b[e]),-1<h.indexOf(c)&&
k.insert(b[e]);return k.find({},a)}return this.find(c,a)};f.prototype.explain=function(c,a){return this.find(c,a).__fdbOp._data};f.prototype.find=function(c,a){c=c||{};a=a||{};a.$decouple=void 0!==a.$decouple?a.$decouple:!0;var b=this._metrics.create("find"),f=this,e,h=!0,k,A,n,q,p,l,m,F,aa,la=[];A=function(a){return f._match(a,c,"and")};b.start();if(c){b.time("analyseQuery");e=this._analyseQuery(c,a,b);b.time("analyseQuery");b.data("analysis",e);if(e.hasJoin&&e.queriesJoin){b.time("joinReferences");
for(n=0;n<e.joinsOn.length;n++)p=e.joinsOn[n],q=new d(e.joinQueries[p]),q=q.value(c)[0],this._db.collection(e.joinsOn[n]).subset(q);b.time("joinReferences")}e.indexMatch.length&&(!a||a&&!a.$skipIndex)?(b.data("index.potential",e.indexMatch),b.data("index.used",e.indexMatch[0].index),b.time("indexLookup"),k=e.indexMatch[0].lookup,b.time("indexLookup"),e.indexMatch[0].keyData.totalKeyCount===e.indexMatch[0].keyData.matchedKeyCount&&(h=!1)):b.flag("usedIndex",!1);h&&(k&&k.length?(e=k.length,b.time("tableScan: "+
e),k=k.filter(A)):(e=this._data.length,b.time("tableScan: "+e),k=this._data.filter(A)),a.$orderBy&&(b.time("sort"),k=this.sort(a.$orderBy,k),b.time("sort")),b.time("tableScan: "+e));a.limit&&k&&k.length>a.limit&&(k.length=a.limit,b.data("limit",a.limit));a.$decouple&&(b.time("decouple"),k=this.decouple(k),b.time("decouple"),b.data("flag.decouple",!0));if(a.join){for(A=0;A<a.join.length;A++)for(p in a.join[A])if(a.join[A].hasOwnProperty(p))for(F=p,e=this._db.collection(p),h=a.join[A][p],aa=0;aa<k.length;aa++){m=
{};q=n=!1;for(l in h)if(h.hasOwnProperty(l))if("$"===l.substr(0,1))switch(l){case "$as":F=h[l];break;case "$multi":n=h[l];break;case "$require":q=h[l];break;default:l.substr(0,3)}else m[l]=(new d(h[l])).value(k[aa])[0];m=e.find(m);!q||q&&m[0]?k[aa][F]=!1===n?m[0]:m:la.push(k[aa])}b.data("flag.join",!0)}if(la.length){b.time("removalQueue");for(l=0;l<la.length;l++)p=k.indexOf(la[l]),-1<p&&k.splice(p,1);b.time("removalQueue")}if(a.transform){b.time("transform");for(l=0;l<k.length;l++)k.splice(l,1,a.transform(k[l]));
b.time("transform");b.data("flag.transform",!0)}this._transformEnabled&&this._transformOut&&(b.time("transformOut"),k=this.transformOut(k),b.time("transformOut"));b.data("results",k.length);b.stop()}else b.stop(),k=[];k.__fdbOp=b;return k};f.prototype.indexOf=function(c){if(c=this.find(c,{$decouple:!1})[0])return this._data.indexOf(c)};f.prototype.transform=function(c){return void 0!==c?("object"===typeof c?(void 0!==c.enabled&&(this._transformEnabled=c.enabled),void 0!==c.dataIn&&(this._transformIn=
c.dataIn),void 0!==c.dataOut&&(this._transformOut=c.dataOut)):this._transformEnabled=!1===c?!1:!0,this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};f.prototype.transformIn=function(c){if(this._transformEnabled&&this._transformIn){if(c instanceof Array){var a=[],b;for(b=0;b<c.length;b++)a[b]=this._transformIn(c[b]);return a}return this._transformIn(c)}return c};f.prototype.transformOut=function(c){if(this._transformEnabled&&this._transformOut){if(c instanceof
Array){var a=[],b;for(b=0;b<c.length;b++)a[b]=this._transformOut(c[b]);return a}return this._transformOut(c)}return c};f.prototype.sort=function(c,a){a=a||[];var b=[],d,f;for(d in c)c.hasOwnProperty(d)&&(f={},f[d]=c[d],f.___fdbKey=d,b.push(f));return 2>b.length?this._sort(c,a):this._bucketSort(b,a)};f.prototype._bucketSort=function(c,a){var b=c.shift(),d,f,e=[];if(0<c.length){a=this._sort(b,a);d=this.bucket(b.___fdbKey,a);for(f in d)d.hasOwnProperty(f)&&(b=[].concat(c),e=e.concat(this._bucketSort(b,
d[f])));return e}return this._sort(b,a)};f.prototype._sort=function(c,a){var b=new d,f=b.parse(c,!0)[0];b.path(f.path);return a.sort(1===f.value?function(c,a){var d=b.value(c)[0],g=b.value(a)[0];return"string"===typeof d&&"string"===typeof g?d.localeCompare(g):d>g?1:d<g?-1:0}:function(c,a){var d=b.value(c)[0],g=b.value(a)[0];return"string"===typeof d&&"string"===typeof g?1===d.localeCompare(g)?-1:1:d>g?-1:d<g?1:0})};f.prototype.bucket=function(c,a){var b,d={};for(b=0;b<a.length;b++)d[a[b][c]]=d[a[b][c]]||
[],d[a[b][c]].push(a[b]);return d};f.prototype._analyseQuery=function(c,a,b){var f={queriesOn:[this._name],indexMatch:[],hasJoin:!1,queriesJoin:!1,joinQueries:{},query:c,options:a},e,h=[],k=[],m,n,q,p,l;b.time("checkIndexes");void 0!==c[this._primaryKey]&&(b.time("checkIndexMatch: Primary Key"),m=new d,f.indexMatch.push({lookup:this._primaryIndex.lookup(c,a),keyData:{matchedKeys:[this._primaryKey],matchedKeyCount:1,totalKeyCount:m.countKeys(c)},index:this._primaryIndex}),b.time("checkIndexMatch: Primary Key"));
for(l in this._indexById)if(this._indexById.hasOwnProperty(l)&&(n=this._indexById[l],q=n.name(),b.time("checkIndexMatch: "+q),m=n.match(c,a),p=n.lookup(c,a),0<m.matchedKeyCount&&f.indexMatch.push({lookup:p,keyData:m,index:n}),b.time("checkIndexMatch: "+q),m.totalKeyCount===m.matchedKeyCount))break;b.time("checkIndexes");1<f.indexMatch.length&&(b.time("findOptimalIndex"),f.indexMatch.sort(function(c,a){return c.keyData.totalKeyCount===c.keyData.matchedKeyCount?-1:a.keyData.totalKeyCount===a.keyData.matchedKeyCount?
1:c.keyData.matchedKeyCount===a.keyData.matchedKeyCount?c.lookup.length-a.lookup.length:a.keyData.matchedKeyCount-c.keyData.matchedKeyCount}),b.time("findOptimalIndex"));if(a.join){f.hasJoin=!0;for(b=0;b<a.join.length;b++)for(e in a.join[b])a.join[b].hasOwnProperty(e)&&(h.push(e),"$as"in a.join[b][e]?k.push(a.join[b][e].$as):k.push(e));for(e=0;e<k.length;e++)if(a=this._queryReferencesCollection(c,k[e],""))f.joinQueries[h[e]]=a,f.queriesJoin=!0;f.joinsOn=h;f.queriesOn=f.queriesOn.concat(h)}return f};
f.prototype._queryReferencesCollection=function(c,a,b){for(var d in c)if(c.hasOwnProperty(d)){if(d===a)return b&&(b+="."),b+d;if("object"===typeof c[d])return b&&(b+="."),b+=d,this._queryReferencesCollection(c[d],a,b)}return!1};f.prototype._match=function(c,a,b){var d,f;d=typeof c;f=typeof a;var e=!0,h;if(!("string"!==d&&"number"!==d||"string"!==f&&"number"!==f))c!==a&&(e=!1);else for(h in a)if(a.hasOwnProperty(h)){d=!1;if("$"===h.substr(0,1))switch(h){case "$gt":if(c>a[h]){if("or"===b)return!0}else e=
!1;d=!0;break;case "$gte":if(c>=a[h]){if("or"===b)return!0}else e=!1;d=!0;break;case "$lt":if(c<a[h]){if("or"===b)return!0}else e=!1;d=!0;break;case "$lte":if(c<=a[h]){if("or"===b)return!0}else e=!1;d=!0;break;case "$exists":if(void 0===c!==a[h]){if("or"===b)return!0}else e=!1;d=!0;break;case "$or":d=!0;for(f=0;f<a[h].length;f++){if(this._match(c,a[h][f],"and"))return!0;e=!1}break;case "$and":d=!0;for(f=0;f<a[h].length;f++)if(!this._match(c,a[h][f],"and"))return!1;break;case "$in":if(a[h]instanceof
Array){d=a[h];f=d.length;var k,m=!1;for(k=0;k<f;k++)if(d[k]===c){m=!0;break}if(m){if("or"===b)return!0}else e=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;d=!0;break;case "$nin":if(a[h]instanceof Array){d=a[h];f=d.length;m=!0;for(k=0;k<f;k++)if(d[k]===c){m=!1;break}if(m){if("or"===b)return!0}else e=!1}else throw"Cannot use a $nin operator on a non-array key: "+h;d=!0;break;case "$ne":if(c!=a[h]){if("or"===b)return!0}else e=!1;d=!0}if(!d&&a[h]instanceof RegExp)if(d=!0,"object"===
typeof c&&void 0!==c[h]&&a[h].test(c[h])){if("or"===b)return!0}else e=!1;if(!d)if("object"===typeof a[h])if(void 0!==c[h]){if(c[h]instanceof Array&&!(a[h]instanceof Array))for(d=!1,f=0;f<c[h].length&&!(d=this._match(c[h][f],a[h],void 0));f++);else if(!(c[h]instanceof Array)&&a[h]instanceof Array)for(d=!1,f=0;f<a[h].length&&!(d=this._match(c[h],a[h][f],void 0));f++);else d="object"===typeof c?this._match(c[h],a[h],void 0):this._match(void 0,a[h],void 0);if(d){if("or"===b)return!0}else e=!1}else if(a[h]&&
void 0!==a[h].$exists)if(d=this._match(void 0,a[h],void 0)){if("or"===b)return!0}else e=!1;else e=!1;else if(c&&c[h]===a[h]){if("or"===b)return!0}else if(c&&c[h]&&c[h]instanceof Array&&a[h]&&"object"!==typeof a[h]){d=!1;for(f=0;f<c[h].length&&!(d=this._match(c[h][f],a[h],void 0));f++);if(d){if("or"===b)return!0}else e=!1}else e=!1;if("and"===b&&!e)return!1}return e};f.prototype.count=function(c,a){return c?this.find(c,a).length:this._data.length};f.prototype.link=function(c,a){if(window.jQuery){this._links=
this._links||{};var b,d;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(b=this.objectId(a.template),d=a.template):b=a;if(!this._links[b]){if(jQuery(c).length){if(!jQuery.templates[b]){if(!d)if(d=jQuery(a),d.length)d=jQuery(d[0]).html();else throw"Unable to bind collection to target because template does not exist: "+a;jQuery.views.templates(b,d)}jQuery.templates[b].link(c,this._data);this._links[b]=c;this._linked++;this.debug()&&console.log('ForerunnerDB.Collection: Added binding collection "'+
this.name()+'" to output target: '+c);return this}throw'Cannot bind view data to output target selector "'+c+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+c+" with the template: "+b;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};f.prototype.unlink=function(c,a){if(window.jQuery){this._links=this._links||{};var b;a&&"object"===typeof a?a.template&&"string"===typeof a.template&&(b=this.objectId(a.template)):b=a;if(this._links[b])return jQuery.templates[b].unlink(c),
delete this._links[b],this._linked--,this.debug()&&console.log('ForerunnerDB.Collection: Removed binding collection "'+this.name()+'" to output target: '+c),this;console.log("Cannot remove link, one does not exist to the target: "+c+" with the template: "+a)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};f.prototype.findSub=function(c,a,b,f){var h=new d(a);c=this.find(c);var e=c.length,k,m,n=this._db.collection("__FDB_temp_"+this.objectId()),q={parents:e,subDocTotal:0,
subDocs:[],pathFound:!1,err:""};for(k=0;k<e;k++)if(m=h.value(c[k])[0]){n.setData(m);m=n.find(b,f);if(f.returnFirst&&m.length)return m[0];q.subDocs.push(m);q.subDocTotal+=m.length;q.pathFound=!0}n.drop();if(f.noStats)return q.subDocs;q.pathFound||(q.err="No objects found in the parent documents with a matching path of: "+a);return q};f.prototype.insertIndexViolation=function(c){var a,b=this._indexByName,d,f;if(this._primaryIndex.get(c[this._primaryKey]))a=this._primaryIndex;else for(d in b)if(b.hasOwnProperty(d)&&
(f=b[d],f.unique()&&f.violation(c))){a=f;break}return a?a.name():!1};f.prototype.ensureIndex=function(c,a){this._indexByName=this._indexByName||{};this._indexById=this._indexById||{};var d=new b(c,a,this),f={start:(new Date).getTime()};if(this._indexByName[d.name()])return{err:"Index with that name already exists"};if(this._indexById[d.id()])return{err:"Index with those keys already exists"};d.rebuild();this._indexByName[d.name()]=d;this._indexById[d.id()]=d;f.end=(new Date).getTime();f.total=f.end-
f.start;this._lastOp={type:"ensureIndex",stats:{time:f}};return{index:d,id:d.id(),name:d.name(),state:d.state()}};f.prototype.index=function(c){if(this._indexByName)return this._indexByName[c]};f.prototype.lastOp=function(){return this._metrics.list()};f.prototype.objectId=k.common.objectId;f.prototype.diff=function(c){var a={insert:[],update:[],remove:[]},b=this.primaryKey(),d,f,h,e;if(b===c.primaryKey()){d=c._data;e=d.length;for(f=0;f<e;f++)h=d[f],this._primaryIndex.get(h[b])?this._primaryCrc.get(h[b])!==
c._primaryCrc.get(h[b])&&a.update.push(h):a.insert.push(h);d=this._data;e=d.length;for(f=0;f<e;f++)h=d[f],c._primaryIndex.get(h[b])||a.remove.push(h)}return a};e.prototype.collection=function(c,a){if(c)return this._collection[c]||this.debug()&&console.log("Creating collection "+c),this._collection[c]=this._collection[c]||(new f(c)).db(this),void 0!==a&&this._collection[c].primaryKey(a),this._collection[c];throw"Cannot get collection with undefined name!";};e.prototype.collectionExists=function(c){return Boolean(this._collection[c])};
e.prototype.collections=function(){var c=[],a;for(a in this._collection)this._collection.hasOwnProperty(a)&&c.push({name:a,count:this._collection[a].count()});return c};m.exports=f},{"./Crc":5,"./Index":8,"./KeyValueStore":9,"./Metrics":10,"./Path":13,"./Shared":15}],3:[function(e,m,k){var h,a;k=e("./Shared");var d=function(){this.init.apply(this,arguments)};d.prototype.init=function(b){this._name=b;this._data=new a("__FDB__cg_data_"+this._name);this._collections=[];this._views=[]};k.addModule("CollectionGroup",
d);k.inherit(d.prototype,k.chainSystem);a=e("./Collection");e=k.modules.Core;h=k.modules.Core.prototype.init;d.prototype.debug=k.common.debug;d.prototype.on=function(){this._data.on.apply(this._data,arguments)};d.prototype.off=function(){this._data.off.apply(this._data,arguments)};d.prototype.emit=function(){this._data.emit.apply(this._data,arguments)};d.prototype.primaryKey=function(a){return void 0!==a?(this._primaryKey=a,this):this._primaryKey};k.synthesize(d.prototype,"db");d.prototype.addCollection=
function(a){if(a&&-1===this._collections.indexOf(a)){if(this._collections.length){if(this._primaryKey!==a.primaryKey())throw"All collections in a collection group must have the same primary key!";}else this.primaryKey(a.primaryKey());this._collections.push(a);a._groups.push(this);a.chain(this);this._data.insert(a.find())}return this};d.prototype.removeCollection=function(a){if(a){var c=this._collections.indexOf(a);-1!==c&&(a.unChain(this),this._collections.splice(c,1),c=a._groups.indexOf(this),-1!==
c&&a._groups.splice(c,1));0===this._collections.length&&delete this._primaryKey}return this};d.prototype.decouple=k.common.decouple;d.prototype._chainHandler=function(a,c,d,g){switch(c){case "setData":d=this.decouple(d);this._data.remove(g.oldData);this._data.insert(d);break;case "insert":d=this.decouple(d);this._data.insert(d);break;case "update":this._data.update(d.query,d.update,g);break;case "remove":this._data.remove(d.query,g)}};d.prototype.insert=function(){this._collectionsRun("insert",arguments)};
d.prototype.update=function(){this._collectionsRun("update",arguments)};d.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};d.prototype.remove=function(){this._collectionsRun("remove",arguments)};d.prototype._collectionsRun=function(a,c){for(var d=0;d<this._collections.length;d++)this._collections[d][a].apply(this._collections[d],c)};d.prototype.find=function(a,c){return this._data.find(a,c)};d.prototype.removeById=function(a){for(var c=0;c<this._collections.length;c++)this._collections[c].removeById(a)};
d.prototype.subset=function(b,c){var d=this.find(b,c);return(new a)._subsetOf(this).primaryKey(this._primaryKey).setData(d)};d.prototype.drop=function(){var a,c=[].concat(this._collections),d=[].concat(this._views);this._debug&&console.log("Dropping collection group "+this._name);for(a=0;a<c.length;a++)this.removeCollection(c[a]);for(a=0;a<d.length;a++)this._removeView(d[a]);this.emit("drop");return!0};e.prototype.init=function(){this._collectionGroup={};h.apply(this,arguments)};e.prototype.collectionGroup=
function(a){return a?(this._collectionGroup[a]=this._collectionGroup[a]||(new d(a)).db(this),this._collectionGroup[a]):this._collectionGroup};m.exports=d},{"./Collection":2,"./Shared":15}],4:[function(e,m,k){var h;k=e("./Shared.js");var a=function(){this.init.apply(this,arguments)};a.prototype.init=function(){this._collection={};this._debug={};this._version="1.2.7"};a.shared=k;a.prototype.shared=k;k.addModule("Core",a);k.inherit(a.prototype,k.chainSystem);h=e("./Collection.js");e("./Metrics.js");
e=e("./Crc.js");a.prototype._isServer=!1;a.prototype.isClient=function(){return!this._isServer};a.prototype.isServer=function(){return this._isServer};a.prototype.crc=e;a.prototype.isClient=function(){return!this._isServer};a.prototype.isServer=function(){return this._isServer};a.prototype.decouple=k.common.decouple;a.prototype.debug=k.common.debug;a.prototype.arrayToCollection=function(a){return(new h).setData(a)};a.prototype.on=function(a,b){this._listeners=this._listeners||{};this._listeners[a]=
this._listeners[a]||[];this._listeners[a].push(b);return this};a.prototype.off=function(a,b){if(a in this._listeners){var c=this._listeners[a],f=c.indexOf(b);-1<f&&c.splice(f,1)}return this};a.prototype.emit=function(a,b){this._listeners=this._listeners||{};if(a in this._listeners){var c=this._listeners[a],f=c.length,g;for(g=0;g<f;g++)c[g].apply(this,Array.prototype.slice.call(arguments,1))}return this};a.prototype.objectId=k.common.objectId;a.prototype.peek=function(a){var b,c,f=[],g=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&
(c=this._collection[b],f="string"===g?f.concat(c.peek(a)):f.concat(c.find(a)));return f};a.prototype.peekCat=function(a){var b,c,f={},g,h=typeof a;for(b in this._collection)this._collection.hasOwnProperty(b)&&(c=this._collection[b],(g="string"===h?c.peek(a):c.find(a))&&g.length&&(f[c.name()]=g));return f};m.exports=a},{"./Collection.js":2,"./Crc.js":5,"./Metrics.js":10,"./Shared.js":15}],5:[function(e,m,k){var h=function(){var a=[],d,b,c;for(b=0;256>b;b++){d=b;for(c=0;8>c;c++)d=d&1?3988292384^d>>>
1:d>>>1;a[b]=d}return a}();m.exports=function(a){var d=-1,b;for(b=0;b<a.length;b++)d=d>>>8^h[(d^a.charCodeAt(b))&255];return(d^-1)>>>0}},{}],6:[function(e,m,k){var h,a;k=e("./Shared");var d=function(){this.init.apply(this,arguments)};d.prototype.init=function(a){this._name=a;this._data={}};k.addModule("Document",d);k.inherit(d.prototype,k.chainSystem);e=e("./Collection");h=k.modules.Core;a=k.modules.Core.prototype.init;k.synthesize(d.prototype,"db");k.synthesize(d.prototype,"name");d.prototype.setData=
function(a){var c,d;if(a)if(a=this.decouple(a),this._linked){d={};for(c in this._data)"jQuery"!==c.substr(0,6)&&this._data.hasOwnProperty(c)&&void 0===a[c]&&(d[c]=1);a.$unset=d;this._updateObject(this._data,a,{})}else this._data=a;return this};d.prototype.decouple=k.common.decouple;d.prototype.objectId=k.common.objectId;d.prototype.on=k.common.on;d.prototype.off=k.common.off;d.prototype.emit=k.common.emit;d.prototype.debug=k.common.debug;d.prototype.update=function(a,c,d){this._updateObject(this._data,
c,a,d)};d.prototype._updateObject=e.prototype._updateObject;d.prototype._isPositionalKey=function(a){return".$"===a.substr(a.length-2,2)};d.prototype._updateProperty=function(a,c,d){this._linked?(jQuery.observable(a).setProperty(c,d),this.debug()&&console.log('ForerunnerDB.Document: Setting data-bound document property "'+c+'" for collection "'+this.name()+'"')):(a[c]=d,this.debug()&&console.log('ForerunnerDB.Document: Setting non-data-bound document property "'+c+'" for collection "'+this.name()+
'"'))};d.prototype._updateIncrement=function(a,c,d){this._linked?jQuery.observable(a).setProperty(c,a[c]+d):a[c]+=d};d.prototype._updateSpliceMove=function(a,c,d){this._linked?(jQuery.observable(a).move(c,d),this.debug()&&console.log('ForerunnerDB.Document: Moving data-bound document array index from "'+c+'" to "'+d+'" for collection "'+this.name()+'"')):(a.splice(d,0,a.splice(c,1)[0]),this.debug()&&console.log('ForerunnerDB.Document: Moving non-data-bound document array index from "'+c+'" to "'+
d+'" for collection "'+this.name()+'"'))};d.prototype._updateSplicePush=function(a,c,d){a.length>c?this._linked?jQuery.observable(a).insert(c,d):a.splice(c,0,d):this._linked?jQuery.observable(a).insert(d):a.push(d)};d.prototype._updatePush=function(a,c){this._linked?jQuery.observable(a).insert(c):a.push(c)};d.prototype._updatePull=function(a,c){this._linked?jQuery.observable(a).remove(c):a.splice(c,1)};d.prototype._updateMultiply=function(a,c,d){this._linked?jQuery.observable(a).setProperty(c,a[c]*
d):a[c]*=d};d.prototype._updateRename=function(a,c,d){var g=a[c];this._linked?(jQuery.observable(a).setProperty(d,g),jQuery.observable(a).removeProperty(c)):(a[d]=g,delete a[c])};d.prototype._updateUnset=function(a,c){this._linked?jQuery.observable(a).removeProperty(c):delete a[c]};d.prototype._updatePop=function(a,c){var d,g=!1;0<a.length&&(this._linked?(1===c?d=a.length-1:-1===c&&(d=0),-1<d&&(jQuery.observable(arr).remove(d),g=!0)):1===c?(a.pop(),g=!0):-1===c&&(a.shift(),g=!0));return g};d.prototype.link=
function(a,c){if(window.jQuery){this._links=this._links||{};this._linked||(this._linked=0);var d,g;c&&"object"===typeof c?c.template&&"string"===typeof c.template&&(d=this.objectId(c.template),g=c.template):d=c;if(!this._links[d]){if(jQuery(a).length){if(!jQuery.templates[d]){if(!g)if(g=jQuery(c),g.length)g=jQuery(g[0]).html();else throw"Unable to bind document to target because template does not exist: "+c;jQuery.views.templates(d,g)}jQuery.templates[d].link(a,this._data);this._links[d]=a;this._linked++;
this.debug()&&console.log('ForerunnerDB.Document: Added binding document "'+this.name()+'" to output target: '+a);return this}throw'Cannot bind view data to output target selector "'+a+'" because it does not exist in the DOM!';}throw"Cannot create a duplicate link to the target: "+a+" with the template: "+d;}throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.unlink=function(a,c){if(window.jQuery){this._links=this._links||{};var d;c&&"object"===typeof c?c.template&&
"string"===typeof c.template&&(d=this.objectId(c.template)):d=c;if(this._links[d])return jQuery.templates[d].unlink(a),delete this._links[d],this._linked--,this.debug()&&console.log('ForerunnerDB.Document: Removed binding document "'+this.name()+'" to output target: '+a),this;console.log("Cannot remove link, one does not exist to the target: "+a+" with the template: "+c)}else throw"Cannot data-bind without jQuery, please add jQuery to your page!";};d.prototype.drop=function(){this._db&&this._name&&
this._db&&this._db._document&&this._db._document[this._name]&&(delete this._db._document[this._name],this._data={})};h.prototype.init=function(){a.apply(this,arguments)};h.prototype.document=function(a){return a?(this._document=this._document||{},this._document[a]=this._document[a]||(new d(a)).db(this),this._document[a]):this._document};m.exports=d},{"./Collection":2,"./Shared":15}],7:[function(e,m,k){var h;e=e("./Shared");var a=function(a,b){this.init.apply(this,arguments)};a.prototype.init=function(a,
b){this._options=b;this._selector=$(this._options.selector);this._listeners={};this._collection=a;this._options.series=[];var c,f;switch(this._options.type){case "pie":this._selector.highcharts(this._options.chartOptions);this._chart=this._selector.highcharts();c=this._collection.find();f={allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {y} ({point.percentage:.0f}%)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}};c=this.pieDataFromCollectionData(c,
this._options.keyField,this._options.valField);$.extend(f,this._options.seriesOptions);$.extend(f,{type:"pie",name:this._options.seriesName,data:c});this._chart.addSeries(f);break;case "line":c=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,this._options.orderBy),this._options.chartOptions.xAxis=c.xAxis,this._options.chartOptions.series=c.series,this._selector.highcharts(this._options.chartOptions),this._chart=this._selector.highcharts()}this._hookEvents()};
e=e.modules.Collection;h=e.prototype.init;a.prototype.pieDataFromCollectionData=function(a,b,c){var f=[],g;for(g=0;g<a.length;g++)f.push([a[g][b],a[g][c]]);return f};a.prototype.lineDataFromCollectionData=function(a,b,c,f){var g=this._collection.distinct(a),h=[],e={categories:[]},k,m,R,Y,A;for(Y=0;Y<g.length;Y++){k=g[Y];m={};m[a]=k;R=[];m=this._collection.find(m,{orderBy:f});for(A=0;A<m.length;A++)e.categories.push(m[A][b]),R.push(m[A][c]);h.push({name:k,data:R})}return{xAxis:e,series:h}};a.prototype._hookEvents=
function(){this._collection.on("change",this._changeListener);this._collection.on("drop",this._dropListener)};a.prototype._changeListener=function(){if("undefined"!==typeof this._collection&&this._chart){var a=this._collection.find();switch(this._options.type){case "pie":this._chart.series[0].setData(this.pieDataFromCollectionData(a,this._options.keyField,this._options.valField));break;case "line":a=this.lineDataFromCollectionData(this._options.seriesField,this._options.keyField,this._options.valField,
this._options.orderBy);this._chart.xAxis[0].setCategories(a.xAxis.categories);for(var b=0;b<a.series.length;b++)this._chart.series[b].setData(a.series[b].data)}}};a.prototype._dropListener=function(){this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener)};a.prototype.drop=function(){this._chart.destroy();this._collection.off("change",this._changeListener);this._collection.off("drop",this._dropListener);delete this._collection._highcharts[this._options.selector];
delete this._chart;delete this._options;delete this._collection;return this};e.prototype.init=function(){this._highcharts={};h.apply(this,arguments)};e.prototype.chart=function(d){this._highcharts[d.selector]||(this._highcharts[d.selector]=new a(this,d));return this._highcharts[d.selector]};e.prototype.dropChart=function(a){this._highcharts[a]&&this._highcharts[a].drop()};m.exports=a},{"./Shared":15}],8:[function(e,m,k){k=e("./Shared");var h=e("./Path");e=function(){this.init.apply(this,arguments)};
e.prototype.init=function(a,d,b){this._crossRef={};this._size=0;this._id=this._itemKeyHash(a,a);this.data({});this.unique(d&&d.unique?d.unique:!1);void 0!==a&&this.keys(a);void 0!==b&&this.collection(b);this.name(d&&d.name?d.name:this._id)};k.addModule("Index",e);k.inherit(e.prototype,k.chainSystem);e.prototype.id=function(){return this._id};e.prototype.state=function(){return this._state};e.prototype.size=function(){return this._size};e.prototype.data=function(a){return void 0!==a?(this._data=a,
this):this._data};k.synthesize(e.prototype,"name");e.prototype.collection=function(a){return void 0!==a?(this._collection=a,this):this._collection};e.prototype.keys=function(a){return void 0!==a?(this._keys=a,this._keyCount=(new h).parse(this._keys).length,this):this._keys};e.prototype.type=function(a){return void 0!==a?(this._type=a,this):this._type};e.prototype.unique=function(a){return void 0!==a?(this._unique=a,this):this._unique};e.prototype.rebuild=function(){if(this._collection){var a=this._collection.subset({},
{$decouple:!1,$orderBy:this._keys}).find(),d,b=a.length;this._data={};this._unique&&(this._uniqueLookup={});for(d=0;d<b;d++)this.insert(a[d])}this._state={name:this._name,keys:this._keys,indexSize:this._size,built:new Date,updated:new Date,ok:!0}};e.prototype.insert=function(a,d){var b,c;this._unique&&(b=this._itemHash(a,this._keys),this._uniqueLookup[b]=a);b=this._itemHashArr(a,this._keys);for(c=0;c<b.length;c++)this.pushToPathValue(b[c],a)};e.prototype.remove=function(a,d){var b,c;this._unique&&
(b=this._itemHash(a,this._keys),delete this._uniqueLookup[b]);b=this._itemHashArr(a,this._keys);for(c=0;c<b.length;c++)this.pullFromPathValue(b[c],a)};e.prototype.violation=function(a){a=this._itemHash(a,this._keys);return Boolean(this._uniqueLookup[a])};e.prototype.hashViolation=function(a){return Boolean(this._uniqueLookup[a])};e.prototype.pushToPathValue=function(a,d){var b=this._data[a]=this._data[a]||[];-1===b.indexOf(d)&&(b.push(d),this._size++,this.pushToCrossRef(d,b))};e.prototype.pullFromPathValue=
function(a,d){var b=this._data[a],c;c=b.indexOf(d);-1<c&&(b.splice(c,1),this._size--,this.pullFromCrossRef(d,b));b.length||delete this._data[a]};e.prototype.pull=function(a){var d=a[this._collection.primaryKey()],b=this._crossRef[d],c,f=b.length,g;for(c=0;c<f;c++)g=b[c],this._pullFromArray(g,a);this._size--;delete this._crossRef[d]};e.prototype._pullFromArray=function(a,d){for(var b=a.length;b--;)a[b]===d&&a.splice(b,1)};e.prototype.pushToCrossRef=function(a,d){var b=a[this._collection.primaryKey()];
this._crossRef[b]=this._crossRef[b]||[];b=this._crossRef[b];-1===b.indexOf(d)&&b.push(d)};e.prototype.pullFromCrossRef=function(a,d){var b=a[this._collection.primaryKey()];delete this._crossRef[b]};e.prototype.lookup=function(a){return this._data[this._itemHash(a,this._keys)]||[]};e.prototype.match=function(a,d){return(new h).countObjectPaths(this._keys,a)};e.prototype._itemHash=function(a,d){var b=new h,c,f="",g;c=b.parse(d);for(g=0;g<c.length;g++)f&&(f+="_"),f+=b.value(a,c[g].path).join(":");return f};
e.prototype._itemKeyHash=function(a,d){var b=new h,c,f="",g;c=b.parse(d);for(g=0;g<c.length;g++)f&&(f+="_"),f+=b.keyValue(a,c[g].path);return f};e.prototype._itemHashArr=function(a,d){var b=new h,c,f=[],g,e,k,m;c=b.parse(d);for(k=0;k<c.length;k++)for(g=b.value(a,c[k].path),e=0;e<g.length;e++)if(0===k)f.push(g[e]);else for(m=0;m<f.length;m++)f[m]=f[m]+"_"+g[e];return f};m.exports=e},{"./Path":13,"./Shared":15}],9:[function(e,m,k){e=e("./Shared");k=function(h){this.init.apply(this,arguments)};k.prototype.init=
function(h){this._name=h;this._data={};this._primaryKey="_id"};e.addModule("KeyValueStore",k);e.inherit(k.prototype,e.chainSystem);e.synthesize(k.prototype,"name");k.prototype.primaryKey=function(h){return void 0!==h?(this._primaryKey=h,this):this._primaryKey};k.prototype.truncate=function(){this._data={};return this};k.prototype.set=function(h,a){this._data[h]=a?a:!0;return this};k.prototype.get=function(h){return this._data[h]};k.prototype.lookup=function(h){h=h[this._primaryKey];var a,d,b,c;if(h instanceof
Array){d=h.length;c=[];for(a=0;a<d;a++)(b=this._data[h[a]])&&c.push(b);return c}if(h instanceof RegExp){c=[];for(a in this._data)this._data.hasOwnProperty(a)&&h.test(a)&&c.push(this._data[a]);return c}if("object"===typeof h){if(h.$ne){c=[];for(a in this._data)this._data.hasOwnProperty(a)&&a!==h.$ne&&c.push(this._data[a]);return c}if(h.$in&&h.$in instanceof Array){c=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1<h.$in.indexOf(a)&&c.push(this._data[a]);return c}if(h.$nin&&h.$nin instanceof
Array){c=[];for(a in this._data)this._data.hasOwnProperty(a)&&-1===h.$nin.indexOf(a)&&c.push(this._data[a]);return c}if(h.$or&&h.$or instanceof Array){c=[];for(a=0;a<h.$or.length;a++)c=c.concat(this.lookup(h.$or[a]));return c}}else return b=this._data[h],void 0!==b?[b]:[]};k.prototype.unSet=function(h){delete this._data[h];return this};k.prototype.uniqueSet=function(h,a){return void 0===this._data[h]?(this._data[h]=a,!0):!1};m.exports=k},{"./Shared":15}],10:[function(e,m,k){k=e("./Shared");var h=
e("./Operation");e=function(){this.init.apply(this,arguments)};e.prototype.init=function(){this._data=[]};k.addModule("Metrics",e);k.inherit(e.prototype,k.chainSystem);e.prototype.create=function(a){a=new h(a);this._enabled&&this._data.push(a);return a};e.prototype.start=function(){this._enabled=!0;return this};e.prototype.stop=function(){this._enabled=!1;return this};e.prototype.clear=function(){this._data=[];return this};e.prototype.list=function(){return this._data};m.exports=e},{"./Operation":11,
"./Shared":15}],11:[function(e,m,k){k=e("./Shared");var h=e("./Path");e=function(a){this.pathSolver=new h;this.counter=0;this.init.apply(this,arguments)};e.prototype.init=function(a){this._data={operation:a,index:{potential:[],used:!1},steps:[],time:{startMs:0,stopMs:0,totalMs:0,process:{}},flag:{},log:[]}};k.addModule("Operation",e);k.inherit(e.prototype,k.chainSystem);e.prototype.start=function(){this._data.time.startMs=(new Date).getTime()};e.prototype.log=function(a){if(a){var d=0<this._log.length?
this._data.log[this._data.log.length-1].time:0;a={event:a,time:(new Date).getTime(),delta:0};this._data.log.push(a);d&&(a.delta=a.time-d);return this}return this._data.log};e.prototype.time=function(a){if(void 0!==a){var d=this._data.time.process,d=d[a]=d[a]||{};d.startMs?(d.stopMs=(new Date).getTime(),d.totalMs=d.stopMs-d.startMs,d.stepObj.totalMs=d.totalMs,delete d.stepObj):(d.startMs=(new Date).getTime(),d.stepObj={name:a},this._data.steps.push(d.stepObj));return this}return this._data.time};e.prototype.flag=
function(a,d){if(void 0!==a&&void 0!==d)this._data.flag[a]=d;else return void 0!==a?this._data.flag[a]:this._data.flag};e.prototype.data=function(a,d,b){return void 0!==d?(this.pathSolver.set(this._data,a,d),this):this.pathSolver.get(this._data,a)};e.prototype.pushData=function(a,d,b){this.pathSolver.push(this._data,a,d)};e.prototype.stop=function(){this._data.time.stopMs=(new Date).getTime();this._data.time.totalMs=this._data.time.stopMs-this._data.time.startMs};m.exports=e},{"./Path":13,"./Shared":15}],
12:[function(e,m,k){var h,a,d;k=e("./Shared");var b=function(){this.init.apply(this,arguments)};b.prototype.init=function(c){this._name=c;this._data=new d("__FDB__dc_data_"+this._name);this._collData=new a;this._collections=[]};k.addModule("Overview",b);k.inherit(b.prototype,k.chainSystem);a=e("./Collection");d=e("./Document");e=k.modules.Core;h=k.modules.Core.prototype.init;k.synthesize(b.prototype,"db");k.synthesize(b.prototype,"name");k.synthesize(b.prototype,"query",function(a){var d=this.$super(a);
void 0!==a&&this._refresh();return d});k.synthesize(b.prototype,"queryOptions",function(a){var d=this.$super(a);void 0!==a&&this._refresh();return d});k.synthesize(b.prototype,"reduce",function(a){var d=this.$super(a);void 0!==a&&this._refresh();return d});b.prototype.debug=k.common.debug;b.prototype.objectId=k.common.objectId;b.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));return this};b.prototype.find=function(){return this._collData.find.apply(this._collData,
arguments)};b.prototype._addCollection=function(a){-1===this._collections.indexOf(a)&&(this._collections.push(a),a.chain(this),this._refresh());return this};b.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._refresh());return this};b.prototype._refresh=function(){if(this._collections&&this._collections[0]){this._collData.primaryKey(this._collections[0].primaryKey());var a=[],d;for(d=0;d<this._collections.length;d++)a=a.concat(this._collections[d].find(this._query,
this._queryOptions));this._collData.setData(a)}this._reduce&&(a=this._reduce(),this._data.setData(a))};b.prototype._chainHandler=function(a,d,b,h){switch(d){case "setData":case "insert":case "update":case "remove":this._refresh()}};b.prototype.link=function(a,d){this._data.link.apply(this._data,arguments);this._refresh()};b.prototype.unlink=function(a,d){this._data.unlink.apply(this._data,arguments);this._refresh()};e.prototype.init=function(){this._overview={};h.apply(this,arguments)};e.prototype.overview=
function(a){return a?(this._overview[a]=this._overview[a]||(new b(a)).db(this),this._overview[a]):this._overview};m.exports=b},{"./Collection":2,"./Document":6,"./Shared":15}],13:[function(e,m,k){e=e("./Shared");k=function(h){this.init.apply(this,arguments)};k.prototype.init=function(h){h&&this.path(h)};e.addModule("Path",k);e.inherit(k.prototype,e.chainSystem);k.prototype.path=function(h){return void 0!==h?(this._path=this.clean(h),this._pathParts=this._path.split("."),this):this._path};k.prototype.hasObjectPaths=
function(h,a){var d=!0,b;for(b in h)if(h.hasOwnProperty(b)&&(void 0===a[b]||"object"===typeof h[b]&&(d=this.hasObjectPaths(h[b],a[b]),!d)))return!1;return d};k.prototype.countKeys=function(h){var a=0,d;for(d in h)h.hasOwnProperty(d)&&void 0!==h[d]&&("object"!==typeof h[d]?a++:a+=this.countKeys(h[d]));return a};k.prototype.countObjectPaths=function(h,a){var d,b={},c=0,f=0,g;for(g in a)a.hasOwnProperty(g)&&("object"===typeof a[g]?(d=this.countObjectPaths(h[g],a[g]),b[g]=d.matchedKeys,f+=d.totalKeyCount,
c+=d.matchedKeyCount):(f++,h&&h[g]&&"object"!==typeof h[g]?(b[g]=!0,c++):b[g]=!1));return{matchedKeys:b,matchedKeyCount:c,totalKeyCount:f}};k.prototype.parse=function(h,a){var d=[],b="",c,f,g;for(f in h)if(h.hasOwnProperty(f))if(b=f,"object"===typeof h[f])if(a)for(c=this.parse(h[f],a),g=0;g<c.length;g++)d.push({path:b+"."+c[g].path,value:c[g].value});else for(c=this.parse(h[f]),g=0;g<c.length;g++)d.push({path:b+"."+c[g].path});else a?d.push({path:b,value:h[f]}):d.push({path:b});return d};k.prototype.parseArr=
function(h,a){a=a||{};return this._parseArr(h,"",[],a)};k.prototype._parseArr=function(h,a,d,b){var c,f="";a=a||"";d=d||[];for(c in h)h.hasOwnProperty(c)&&(!b.ignore||b.ignore&&!b.ignore.test(c))&&(f=a?a+"."+c:c,"object"===typeof h[c]?this._parseArr(h[c],f,d,b):d.push(f));return d};k.prototype.value=function(h,a){if(void 0!==h&&"object"===typeof h){var d,b,c,f,g=[],e;void 0!==a&&(a=this.clean(a),d=a.split("."));d=d||this._pathParts;b=d.length;c=h;for(e=0;e<b;e++){c=c[d[e]];if(f instanceof Array){for(b=
0;b<f.length;b++)g=g.concat(this.value(f,b+"."+d[e]));return g}if(!c||"object"!==typeof c)break;f=c}return[c]}return[]};k.prototype.set=function(e,a,d){if(void 0!==e&&void 0!==a){var b;a=this.clean(a);a=a.split(".");b=a.shift();a.length?(e[b]=e[b]||{},this.set(e[b],a.join("."),d)):e[b]=d}return e};k.prototype.get=function(e,a){return this.value(e,a)[0]};k.prototype.push=function(e,a,d){if(void 0!==e&&void 0!==a){var b;a=this.clean(a);a=a.split(".");b=a.shift();if(a.length)e[b]=e[b]||{},this.set(e[b],
a.join("."),d);else if(e[b]=e[b]||[],e[b]instanceof Array)e[b].push(d);else throw"Cannot push to a path whose endpoint is not an array!";}return e};k.prototype.keyValue=function(e,a){var d,b,c,f,g;void 0!==a&&(a=this.clean(a),d=a.split("."));d=d||this._pathParts;b=d.length;c=e;for(g=0;g<b;g++)if(c=c[d[g]],!c||"object"!==typeof c){f=d[g]+":"+c;break}return f};k.prototype.clean=function(e){"."===e.substr(0,1)&&(e=e.substr(1,e.length-1));return e};m.exports=k},{"./Shared":15}],14:[function(e,m,k){k=
e("./Shared");var h,a,d,b;b=function(){this.init.apply(this,arguments)};b.prototype.init=function(a){a.isClient()&&void 0!==Storage&&this.mode("localStorage")};k.addModule("Persist",b);k.inherit(b.prototype,k.chainSystem);k=k.modules.Core;h=e("./Collection");a=h.prototype.drop;e("./CollectionGroup");d=k.prototype.init;b.prototype.mode=function(a){return void 0!==a?(this._mode=a,this):this._mode};b.prototype.save=function(a,d,b){switch(this.mode()){case "localStorage":d="object"===typeof d?"json::fdb::"+
JSON.stringify(d):"raw::fdb::"+d;try{localStorage.setItem(a,d)}catch(e){if(b)b(e);else throw e;break}if(b)b(!1);else return!1;break;default:if(b)b("No data handler.");else throw"No data handler.";}};b.prototype.load=function(a,d){var b,e;switch(this.mode()){case "localStorage":try{b=localStorage.getItem(a)}catch(h){d(h,null)}if(b){b=b.split("::fdb::");switch(b[0]){case "json":e=JSON.parse(b[1]);break;case "raw":e=b[1]}if(d)d(!1,e);else return e}break;default:if(d)d("No data handler or unrecognised data type.");
else throw"No data handler or unrecognised data type.";}};b.prototype.drop=function(a,d){switch(this.mode()){case "localStorage":try{localStorage.removeItem(a)}catch(b){d&&d(b)}d&&d(!1);break;default:d&&d("No data handler or unrecognised data type.")}};h.prototype.drop=function(c){if(c)if(this._name)if(this._db)this._db.persist.drop(this._name);else return callback&&callback("Cannot drop a collection's persistent storage when the collection is not attached to a database!"),"Cannot drop a collection's persistent storage when the collection is not attached to a database!";
else return callback&&callback("Cannot drop a collection's persistent storage when no name assigned to collection!"),"Cannot drop a collection's persistent storage when no name assigned to collection!";a.apply(this)};h.prototype.save=function(a){if(this._name)if(this._db)this._db.persist.save(this._name,this._data,a);else return a&&a("Cannot save a collection that is not attached to a database!"),"Cannot save a collection that is not attached to a database!";else return a&&a("Cannot save a collection with no assigned name!"),
"Cannot save a collection with no assigned name!"};h.prototype.load=function(a){var d=this;if(this._name)if(this._db)this._db.persist.load(this._name,function(b,e){if(b)return a&&a(b),b;e&&d.setData(e);a&&a(!1)});else return a&&a("Cannot load a collection that is not attached to a database!"),"Cannot load a collection that is not attached to a database!";else return a&&a("Cannot load a collection with no assigned name!"),"Cannot load a collection with no assigned name!"};k.prototype.init=function(){this.persist=
new b(this);d.apply(this,arguments)};m.exports=b},{"./Collection":2,"./CollectionGroup":3,"./Shared":15}],15:[function(e,m,k){var h=0;e=function(a){if(a){var d,b=a.length;return function(){for(d=0;d<b;d++)if(a[d].length===arguments.length)return a[d].apply(this,arguments);return null}}return function(){}};e={modules:{},common:{decouple:function(a){return JSON.parse(JSON.stringify(a))},objectId:function(a){var d=Math.pow(10,17);if(a){var b=0,c=a.length,f;for(f=0;f<c;f++)b+=a.charCodeAt(f)*d;a=b.toString(16)}else h++,
a=(h+(Math.random()*d+Math.random()*d+Math.random()*d+Math.random()*d)).toString(16);return a},debug:new e([function(){return this._debug&&this._debug.all},function(a){return void 0!==a?"boolean"===typeof a?(this._debug=this._debug||{},this._debug.all=a,this.chainSend("debug",this._debug),this):this._debug&&this._debug[a]||this._db&&this._db._debug&&this._db._debug[a]||this._debug&&this._debug.all:this._debug&&this._debug.all},function(a,d){return void 0!==a?void 0!==d?(this._debug=this._debug||{},
this._debug[a]=d,this.chainSend("debug",this._debug),this):this._debug&&this._debug[d]||this._db&&this._db._debug&&this._db._debug[a]:this._debug&&this._debug.all}]),on:new e([function(a,d){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a]["*"]=this._listeners[a]["*"]||[];this._listeners[a]["*"].push(d);return this},function(a,d,b){this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||{};this._listeners[a][d]=this._listeners[a][d]||
[];this._listeners[a][d].push(b);return this}]),off:new e([function(a){this._listeners&&this._listeners[a]&&a in this._listeners&&delete this._listeners[a];return this},function(a,d){var b,c;"string"===typeof d?this._listeners&&this._listeners[a]&&this._listeners[a][d]&&delete this._listeners[a][d]:a in this._listeners&&(b=this._listeners[a]["*"],c=b.indexOf(d),-1<c&&b.splice(c,1));return this},function(a,d,b){this._listeners&&a in this._listeners&&(a=this._listeners[a][d],b=a.indexOf(b),-1<b&&a.splice(b,
1))}]),emit:function(a,d){this._listeners=this._listeners||{};if(a in this._listeners){if(this._listeners[a]["*"]){var b=this._listeners[a]["*"],c=b.length,f;for(f=0;f<c;f++)b[f].apply(this,Array.prototype.slice.call(arguments,1))}if(d instanceof Array&&d[0]&&d[0][this._primaryKey]){var b=this._listeners[a],g,e,c=d.length;for(f=0;f<c;f++)if(b[d[f][this._primaryKey]])for(g=b[d[f][this._primaryKey]].length,e=0;e<g;e++)b[d[f][this._primaryKey]][e].apply(this,Array.prototype.slice.call(arguments,1))}}return this}},
_synth:{},addModule:function(a,d){this.modules[a]=d},inherit:function(a,d){for(var b in d)d.hasOwnProperty(b)&&(a[b]=d[b])},synthesize:function(a,d,b){this._synth[d]=this._synth[d]||function(a){return void 0!==a?(this["_"+d]=a,this):this["_"+d]};if(b){var c=this;a[d]=function(){var a=this.$super,g;this.$super=c._synth[d];g=b.apply(this,arguments);this.$super=a;return g}}else a[d]=this._synth[d]},overload:e,chainSystem:{chain:function(a){this._chain=this._chain||[];-1===this._chain.indexOf(a)&&this._chain.push(a)},
unChain:function(a){this._chain&&(a=this._chain.indexOf(a),-1<a&&this._chain.splice(a,1))},chainSend:function(a,d,b){if(this._chain){var c=this._chain,f=c.length,g;for(g=0;g<f;g++)c[g].chainReceive(this,a,d,b)}},chainReceive:function(a,d,b,c){(!this._chainHandler||this._chainHandler&&!this._chainHandler(a,d,b,c))&&this.chainSend(d,b,c)}}};m.exports=e},{}],16:[function(e,m,k){var h,a,d;k=e("./Shared");var b=function(a,d,b){this.init.apply(this,arguments)};b.prototype.init=function(a,d,b){this._name=
a;this._collections=[];this._groups=[];this._listeners={};this._querySettings={query:d,options:b};this._debug={};this._privateData=new h("__FDB__view_privateData_"+this._name)};k.addModule("View",b);k.inherit(b.prototype,k.chainSystem);h=e("./Collection");CollectionGroup=e("./CollectionGroup");a=h.prototype.init;e=k.modules.Core;d=e.prototype.init;k.synthesize(b.prototype,"name");b.prototype.debug=k.common.debug;b.prototype.insert=function(){this._collectionsRun("insert",arguments)};b.prototype.update=
function(){this._collectionsRun("update",arguments)};b.prototype.updateById=function(){this._collectionsRun("updateById",arguments)};b.prototype.remove=function(){this._collectionsRun("remove",arguments)};b.prototype._collectionsRun=function(a,d){for(var b=0;b<this._collections.length;b++)this._collections[b][a].apply(this._collections[b],d)};b.prototype.find=function(a,d){return this.publicData().find(a,d)};b.prototype.link=function(a,d){var b=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Setting up data binding on view "'+
this.name()+'" in underlying (internal) view collection "'+b.name()+'" for output target: '+a);return b.link(a,d)};b.prototype.unlink=function(a,d){var b=this.publicData();this.debug()&&console.log('ForerunnerDB.View: Removing data binding on view "'+this.name()+'" in underlying (internal) view collection "'+b.name()+'" for output target: '+a);return b.unlink(a,d)};b.prototype.decouple=k.common.decouple;b.prototype.from=function(a){void 0!==a&&("string"===typeof a&&(a=this._db.collection(a)),this._addCollection(a));
return this};b.prototype._addCollection=function(a){if(-1===this._collections.indexOf(a)){this._collections.push(a);a.chain(this);var d=a.find(this._querySettings.query,this._querySettings.options);this._transformPrimaryKey(a.primaryKey());this._transformInsert(d);this._privateData.primaryKey(a.primaryKey());this._privateData.insert(d)}return this};b.prototype._removeCollection=function(a){-1<this._collections.indexOf(a)&&(this._collections.splice(a,1),a.unChain(this),this._privateData.remove(a.find(this._querySettings.query,
this._querySettings.options)));return this};b.prototype._chainHandler=function(a,d,b,e){var h,k;switch(d){case "setData":this.debug()&&console.log('ForerunnerDB.View: Setting data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b=this.decouple(b);this._transformSetData(b);this._privateData.setData(b);break;case "insert":this.debug()&&console.log('ForerunnerDB.View: Inserting some data on view "'+this.name()+'" in underlying (internal) view collection "'+
this._privateData.name()+'"');b=this.decouple(b);if(this._querySettings.options&&this._querySettings.options.$orderBy)if(h=[].concat(this._privateData._data),(a=b instanceof Array)?h=h.concat(b):h.push(b),h=this._privateData.sort(this._querySettings.options.$orderBy,h),a)for(b.sort(function(a,c){return h.indexOf(a)-h.indexOf(c)}),a=0;a<b.length;a++)d=h.indexOf(b[a]),this._transformInsert(b,d),this._privateData._insertHandle(b,d);else d=h.indexOf(b),this._transformInsert(b,d),this._privateData._insertHandle(b,
d);else d=e&&e.index?e.index:this._privateData._data.length,this._transformInsert(b,d),this._privateData._insertHandle(b,d);break;case "update":this.debug()&&console.log('ForerunnerDB.View: Updating some data on view "'+this.name()+'" in underlying (internal) view collection "'+this._privateData.name()+'"');b=this._privateData.update(b.query,b.update,b.options);if(this._querySettings.options&&this._querySettings.options.$orderBy)for(h=[].concat(this._privateData._data),h=this._privateData.sort(this._querySettings.options.$orderBy,
h),b.sort(function(a,c){return h.indexOf(a)-h.indexOf(c)}),a=0;a<b.length;a++)e=this._privateData._data.indexOf(b[a]),d=h.indexOf(b[a]),this._privateData._updateSpliceMove(this._privateData._data,e,d);if(this._transformEnabled&&this._transformIn)for(d=this._publicData.primaryKey(),a=0;a<b.length;a++)e={},k=b[a],e[d]=k[d],this._transformUpdate(e,k);break;case "remove":this.debug()&&console.log('ForerunnerDB.View: Removing some data on view "'+this.name()+'" in underlying (internal) view collection "'+
this._privateData.name()+'"'),this._transformRemove(b.query,e),this._privateData.remove(b.query,e)}};b.prototype.on=function(){this._privateData.on.apply(this._privateData,arguments)};b.prototype.off=function(){this._privateData.off.apply(this._privateData,arguments)};b.prototype.emit=function(){this._privateData.emit.apply(this._privateData,arguments)};b.prototype.drop=function(){if(this._collections&&this._collections.length){(this.debug()||this._db&&this._db.debug())&&console.log("ForerunnerDB.View: Dropping view "+
this._name);for(var a=this._collections.length;a--;)this._removeCollection(this._collections[a]);this._privateData.drop();return!0}return!1};b.prototype.db=function(a){return void 0!==a?(this._db=a,this.privateData().db(a),this.publicData().db(a),this):this._db};b.prototype.primaryKey=function(){return this._privateData.primaryKey()};b.prototype.queryData=function(a,d,b){void 0!==a&&(this._querySettings.query=a);void 0!==d&&(this._querySettings.options=d);return void 0!==a||void 0!==d?(void 0!==b&&
!0!==b||this.refresh(),this):this._querySettings};b.prototype.queryAdd=function(a,d,b){var e=this._querySettings.query,h;if(void 0!==a)for(h in a)a.hasOwnProperty(h)&&(void 0===e[h]||void 0!==e[h]&&d)&&(e[h]=a[h]);void 0!==b&&!0!==b||this.refresh()};b.prototype.queryRemove=function(a,d){var b=this._querySettings.query,e;if(void 0!==a)for(e in a)a.hasOwnProperty(e)&&delete b[e];void 0!==d&&!0!==d||this.refresh()};b.prototype.query=function(a,d){return void 0!==a?(this._querySettings.query=a,void 0!==
d&&!0!==d||this.refresh(),this):this._querySettings.query};b.prototype.queryOptions=function(a,d){return void 0!==a?(this._querySettings.options=a,void 0===a.$decouple&&(a.$decouple=!0),void 0!==d&&!0!==d||this.refresh(),this):this._querySettings.options};b.prototype.refresh=function(){var a,d=this.publicData(),b;this._privateData.remove();d.remove();for(b=0;b<this._collections.length;b++)a=this._collections[b],this._privateData.insert(a.find(this._querySettings.query,this._querySettings.options));
a=this._privateData.find({},this._querySettings.options);d._linked?jQuery.observable(d._data).refresh(a):(this._privateData._data.length=0,this._privateData._data=this._privateData._data.concat(a));return this};b.prototype.count=function(){return this._privateData&&this._privateData._data?this._privateData._data.length:0};b.prototype.transform=function(a){return void 0!==a?("object"===typeof a?(void 0!==a.enabled&&(this._transformEnabled=a.enabled),void 0!==a.dataIn&&(this._transformIn=a.dataIn),
void 0!==a.dataOut&&(this._transformOut=a.dataOut)):this._transformEnabled=!1===a?!1:!0,this._transformPrimaryKey(this.privateData().primaryKey()),this._transformSetData(this.privateData().find()),this):{enabled:this._transformEnabled,dataIn:this._transformIn,dataOut:this._transformOut}};b.prototype.privateData=function(){return this._privateData};b.prototype.publicData=function(){return this._transformEnabled?this._publicData:this._privateData};b.prototype._transformSetData=function(a){this._transformEnabled&&
(this._publicData=new h("__FDB__view_publicData_"+this._name),this._publicData.db(this._privateData._db),this._publicData.transform({enabled:!0,dataIn:this._transformIn,dataOut:this._transformOut}),this._publicData.setData(a))};b.prototype._transformInsert=function(a,d){this._transformEnabled&&this._publicData&&this._publicData.insert(a,d)};b.prototype._transformUpdate=function(a,d,b){this._transformEnabled&&this._publicData&&this._publicData.update(a,d,b)};b.prototype._transformRemove=function(a,
d){this._transformEnabled&&this._publicData&&this._publicData.remove(a,d)};b.prototype._transformPrimaryKey=function(a){this._transformEnabled&&this._publicData&&this._publicData.primaryKey(a)};h.prototype.init=function(){this._views=[];a.apply(this,arguments)};h.prototype.view=function(a,d,e){if(this._db&&this._db._views){if(this._db._views[a])throw"Cannot create a view using this collection because one with this name already exists: "+a;a=(new b(a,d,e)).db(this._db)._addCollection(this);this._views=
this._views||[];this._views.push(a);return a}};h.prototype._addView=CollectionGroup.prototype._addView=function(a){void 0!==a&&this._views.push(a);return this};h.prototype._removeView=CollectionGroup.prototype._removeView=function(a){void 0!==a&&(a=this._views.indexOf(a),-1<a&&this._views.splice(a,1));return this};e.prototype.init=function(){this._views={};d.apply(this,arguments)};e.prototype.view=function(a){this._views[a]||(this.debug()||this._db&&this._db.debug())&&console.log("Core.View: Creating view "+
a);this._views[a]=this._views[a]||(new b(a)).db(this);return this._views[a]};e.prototype.viewExists=function(a){return Boolean(this._views[a])};e.prototype.views=function(){var a=[],d;for(d in this._views)this._views.hasOwnProperty(d)&&a.push({name:d,count:this._views[d].count()});return a};m.exports=b},{"./Collection":2,"./CollectionGroup":3,"./Shared":15}],17:[function(e,m,k){window.jQuery&&(this.jQuery=window.jQuery,function(){(function(e,a,d){function b(a){return a}function c(a){debugger;return a}
function f(a){Ma=(va._dbgMode=a)?"Unavailable (nested view): use #getIndex()":"";wa("dbg",Ia.dbg=na.dbg=a?c:b)}function g(a){this.name=(r.link?"JsViews":"JsRender")+" Error";this.message=a||this.name}function k(a,d){for(var b in d)a[b]=d[b];return a}function m(a){return"function"===typeof a}function ja(a,d,b){if(!S.rTag||a)x=a?a.charAt(0):x,ha=a?a.charAt(1):ha,N=d?d.charAt(0):N,z=d?d.charAt(1):z,O=b||O,a="\\"+x+"(\\"+O+")?\\"+ha,d="\\"+N+"\\"+z,G="(?:(?:(\\w+(?=[\\/\\s\\"+N+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+
N+"]|\\"+N+"(?!\\"+z+"))*?)",S.rTag=G+")",G=RegExp(a+G+"(\\/)?|(?:\\/(\\w+)))"+d,"g"),xa=RegExp("<.*>|([^\\\\]|^)[{}]|"+a+".*"+d);return[x,ha,N,z,O]}function Ja(a,b){b||(b=a,a=d);var c,e,g,f;g=this;c=!b||"root"===b;if(a){if(f=g.type===b?g:d,!f)if(c=g.views,g._.useKey)for(e in c){if(f=c[e].get(a,b))break}else for(e=0,g=c.length;!f&&e<g;e++)f=c[e].get(a,b)}else if(c)for(;g.parent.parent;)f=g=g.parent;else for(;g&&!f;)f=g.type===b?g:d,g=g.parent;return f}function R(){var a=this.get("item");return a?
a.index:d}function Y(){return this.index}function A(a){var b,c=this,g=c.linkCtx,f=(c.ctx||{})[a];f===d&&g&&g.ctx&&(f=g.ctx[a]);f===d&&(f=Ia[a]);f&&m(f)&&!f._wrp&&(b=function(){return f.apply(this&&this!==e?this:c,arguments)},b._wrp=1,k(b,f));return b||f}function n(a,b,c){var e,f,g=+c===c&&c,h=b.linkCtx;g&&(c=(g=b.tmpl.bnds[g-1])(b.data,b,I));e=c.args[0];if(a||g){e=h&&h.tag;e||(e={_:{inline:!h,bnd:g},tagName:":",cvt:a,flow:!0,tagCtx:c,_is:"tag"},h&&(h.tag=e,e.linkCtx=h,c.ctx=J(c.ctx,h.view.ctx)),S._lnk(e));
for(f in c.props)Na.test(f)&&(e[f]=c.props[f]);c.view=b;e.ctx=c.ctx||{};delete c.ctx;b._.tag=e;e=q(e,e.convert||"true"!==a&&a)[0];e=g&&b._.onRender?b._.onRender(e,b,g):e;b._.tag=d}return e!=d?e:""}function q(a,d){var b=a.tagCtx,c=b.view,e=b.args;d=d&&(""+d===d?c.getRsc("converters",d)||ka("Unknown converter: '"+d+"'"):d);e=e.length||b.index?d?e.slice():e:[c.data];d&&(d.depends&&(a.depends=S.getDeps(a.depends,a,d.depends,d)),e[0]=d.apply(a,e));return e}function p(a,b){for(var c,e=this;c===d&&e;)c=
(c=e.tmpl[a])&&c[b],e=e.parent;return c||I[a][b]}function l(a,b,c,e,g){var f,h,s,l,H,m,u,t,r,p,E,D="",n=+e===e&&e,G=b.linkCtx||0,w=b.ctx,x=c||b.tmpl;"tag"===a._is&&(f=a,a=f.tagName,e=f.tagCtxs);f=f||G.tag;n&&(e=(t=x.bnds[n-1])(b.data,b,I));m=e.length;for(H=0;H<m;H++){H||c&&f||(r=b.getRsc("tags",a)||ka("Unknown tag: {{"+a+"}}"));h=e[H];G.tag||(u=h.tmpl,u=h.content=u&&x.tmpls[u-1],k(h,{tmpl:(f?f:r).template||u,render:P,index:H,view:b,ctx:J(h.ctx,w)}));if(c=h.props.tmpl)c=""+c===c?b.getRsc("templates",
c)||Ca(c):c,h.tmpl=c;f||(r._ctr?(f=new r._ctr,p=!!f.init,f.attr=f.attr||r.attr||d):S._lnk(f={render:r.render}),f._={inline:!G},G&&(G.attr=f.attr=G.attr||f.attr,G.tag=f,f.linkCtx=G),(f._.bnd=t||G.fn)?f._.arrVws={}:f.dataBoundOnly&&ka("{^{"+a+"}} tag must be data-bound"),f.tagName=a,f.parent=l=w&&w.tag,f._is="tag",f._def=r,f.tagCtxs=e);if(!H)for(E in u=h.props)Na.test(E)&&(f[E]=u[E]);h.tag=f;f.dataMap&&f.tagCtxs&&(h.map=f.tagCtxs[H].map);f.flow||(u=h.ctx=h.ctx||{},h=f.parents=u.parentTags=w&&J(u.parentTags,
w.parentTags)||{},l&&(h[l.tagName]=l),u.tag=f)}b._.tag=f;f.rendering={};for(H=0;H<m;H++){h=f.tagCtx=f.tagCtxs[H];u=h.props;a=q(f,f.convert);if(e=u.dataMap||f.dataMap)if(a.length||u.dataMap){l=h.map;if(!l||l.src!==a[0]||g)l&&l.src&&l.unmap(),l=h.map=e.map(a[0],u);a=[l.tgt]}f.ctx=h.ctx;!H&&p&&(e=f.template,f.init(h,G,f.ctx),p=d,f.template!==e&&(f._.tmpl=f.template));l=d;if(e=f.render)l=e.apply(f,a);a=a.length?a:[b];l=l!==d?l:h.render(a[0],!0)||(g?d:"");D=D?D+(l||""):l}delete f.rendering;f.tagCtx=f.tagCtxs[0];
f.ctx=f.tagCtx.ctx;f._.inline&&(s=f.attr)&&s!==K&&(D="text"===s?na.html(D):"");return n&&b._.onRender?b._.onRender(D,b,n):D}function Z(a,d,b,c,e,f,g,h){var k="array"===d,s={key:0,useKey:k?0:1,id:""+Ha++,onRender:h,bnds:{}};this.data=c;this.tmpl=e;this.content=g;this.views=k?[]:{};this.parent=b;this.type=d;this._=s;this.linked=!!h;b?(d=b.views,c=b._,c.useKey?(d[s.key="_"+c.useKey++]=this,this.index=Ma,this.getIndex=R,f=c.tag,s.bnd=k&&(!f||!!f._.bnd&&f)):d.splice(s.key=this.index=f,0,this),this.ctx=
a||b.ctx):this.ctx=a}function F(a){var d,b,c,e,f,g;for(d in Q)if(e=Q[d],(f=e.compile)&&(b=a[d+"s"]))for(c in b)(e=b[c]=f(c,b[c],a))&&(g=S.onStore[d])&&g(c,e,f)}function aa(a,b,c){m(b)?b={depends:b.depends,render:b}:(b.baseTag&&(b.flow=!!b.flow,b=k(k({},b.baseTag),b)),(a=b.template)!==d&&(b.template=""+a===a?Ca[a]||Ca(a):a),!1!==b.init&&(a=b._ctr=function(){},(a.prototype=b).constructor=a));c&&(b._parentTmpl=c);return b}function la(b,c,f,g){function k(c){if(""+c===c||0<c.nodeType){try{l=0<c.nodeType?
c:!xa.test(c)&&a&&a(e.document).find(c)[0]}catch(s){}l&&(c=Ca[b=b||l.getAttribute(W)],c||(b=b||"_"+X++,l.setAttribute(W,b),c=Ca[b]=la(b,l.innerHTML,f,g)),l=d);return c}}var s,l;c=c||"";s=k(c);g=g||(c.markup?c:{});g.tmplName=b;f&&(g._parentTmpl=f);!s&&c.markup&&(s=k(c.markup))&&s.fn&&(s.debug!==c.debug||s.allowCode!==c.allowCode)&&(s=s.markup);if(s!==d)return b&&!f&&(w[b]=function(){return c.render.apply(c,arguments)}),s.fn||c.fn?s.fn&&(c=b&&b!==s.tmplName?J(g,s):s):(c=La(s,g),oa(s.replace(y,"\\$&"),
c)),F(g),c}function ma(a){function d(b,c){this.tgt=a.getTgt(b,c)}m(a)&&(a={getTgt:a});a.baseMap&&(a=k(k({},a.baseMap),a));a.map=function(a,b){return new d(a,b)};return a}function La(a,d){var b,c=va.wrapMap||{},e=k({markup:a,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:Da},d);d.htmlTag||(b=da.exec(a),e.htmlTag=b?b[1].toLowerCase():"");(b=c[e.htmlTag])&&b!==c.div&&(e.markup=r.trim(e.markup));return e}function pa(a,b){function c(f,g,h){var k,s,l;if(f&&"object"===typeof f&&!f.nodeType&&!f.markup&&
!f.getTgt){for(s in f)c(s,f[s],g);return I}g===d&&(g=f,f=d);f&&""+f!==f&&(h=g,g=f,f=d);l=h?h[e]=h[e]||{}:c;s=b.compile;null===g?f&&delete l[f]:(g=s?g=s(f,g,h):g,f&&(l[f]=g));s&&g&&(g._is=a);g&&(k=S.onStore[a])&&k(f,g,s);return g}var e=a+"s";I[e]=c;Q[a]=b}function Aa(a,d){var b=this.jquery&&(this[0]||ka('Unknown template: "'+this.selector+'"')),c=b.getAttribute(W);return Da.call(c?Ca[c]:Ca(b),a,d)}function ra(a,d,b){if(va._dbgMode)try{return a.fn(d,b,I)}catch(c){return ka(c,b)}return a.fn(d,b,I)}function Da(a,
d,b,c,e,f){return c||!this.fn._nvw||r.isArray(a)?P.call(this,a,d,b,c,e,f):ra(this,a,{tmpl:this})}function P(a,b,c,e,f,g){var h,k,s,l,H,u,m,t,p;s=this;var E="";!!b===b&&(c=b,b=d);!0===f&&(h=!0,f=0);s.tag?(u=s,s=s.tag,k=s._,H=s.tagName,t=k.tmpl||u.tmpl,p=s.attr&&s.attr!==K,b=J(b,s.ctx),m=u.content,!1===u.props.link&&(b=b||{},b.link=!1),e=e||u.view,a=arguments.length?a:e):t=s;if(t&&(!e&&a&&"view"===a._is&&(e=a),e&&(m=m||e.content,g=g||e._.onRender,a===e&&(a=e.data),b=J(b,e.ctx)),e&&e.data!==d||((b=b||
{}).root=a),t.fn||(t=Ca[t]||Ca(t)),t)){u=g=!1!==(b&&b.link)&&!p&&g;!0===g&&(u=d,g=e._.onRender);b=t.helpers?J(t.helpers,b):b;if(r.isArray(a)&&!c)for(l=h?e:f!==d&&e||new Z(b,"array",e,a,t,f,m,g),h=0,k=a.length;h<k;h++)s=a[h],H=new Z(b,"item",l,s,t,(f||0)+h,m,g),s=ra(t,s,H),E+=l._.onRender?l._.onRender(s,H):s;else{if(e||!t.fn._nvw)l=h?e:new Z(b,H||"data",e,a,t,f,m,g),k&&!s.flow&&(l.tag=s);E+=ra(t,a,l)}return u?u(E,l):E}return""}function ka(a,b,d){d=va.onError(a,b,d);if(""+a===a)throw new S.Err(d);return!b.linkCtx&&
b.linked?na.html(d):d}function ea(a){ka("Syntax error\n"+a)}function oa(a,b,d,c){function e(b){(b-=J)&&t.push(a.substr(J,b).replace(ia,"\\n"))}function f(b){b&&ea('Unmatched or missing tag: "{{/'+b+'}}" in template:\n'+a)}var g,h,k,l=b&&b.allowCode,u=[],J=0,m=[],t=u,r=[,,u];d&&(a=x+a+z);f(m[0]&&m[0][2].pop()[0]);a.replace(G,function(g,H,u,p,E,D,n,q,G,w,x,I){D&&(E=":",p=K);w=w||d;H=(H||d)&&[];var y="",B="",fa="",sa="",ta="",Ka="",Oa="",Xa="";n=!w&&!E&&!n;u=u||(G=G||"#data",E);e(I);J=I+g.length;q?l&&
t.push(["*","\n"+G.replace(ga,"$1")+"\n"]):u?("else"===u&&(T.test(G)&&ea('for "{{else if expr}}" use "{{else expr}}"'),H=r[7],r[8]=a.substring(r[8],I),r=m.pop(),t=r[2],n=!0),G&&s(G.replace(ia," "),H,b).replace(M,function(a,b,d,c,e,f,g,h){g?(B+=f+",",sa+="'"+h+"',"):d?(fa+=c+f+",",Ka+=c+"'"+h+"',"):b?Oa+=f:("trigger"===e&&(Xa+=f),y+=c+f+",",ta+=c+"'"+h+"',",k=k||Na.test(e));return""}).slice(0,-1),h=[u,p||!!c||k||"",n&&[],[sa.slice(0,-1),ta.slice(0,-1),Ka.slice(0,-1)],[B.slice(0,-1),y.slice(0,-1),fa.slice(0,
-1)],Oa,Xa,H||0],t.push(h),n&&(m.push(r),r=h,r[8]=J)):x&&(f(x!==r[0]&&"else"!==r[0]&&x),r[8]=a.substring(r[8],I),r=m.pop());f(!r&&x);t=r[2]});e(a.length);(J=u[u.length-1])&&f(""+J!==J&&+J[8]===J[8]&&J[0]);d?(g=H(u,a,d),g.paths=u[0][7]):g=H(u,b);g._nvw&&(g._nvw=!/[~#]/.test(a));return g}function Ga(a,b){return"\n\t"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n\tprops:{"+a[1]+"}":"")+(a[2]?",\n\tctx:{"+a[2]+"}":"")}function s(a,b,d){var c,e,f,g,h,k=0,s=d?d.links:b&&(b.links=b.links||{}),l={},H={0:-1},
u=0;return(a+(d?" ":"")).replace(/\)\^/g,").").replace(Fa,function(J,m,t,r,E,p,D,n,G,q,w,x,I,y,F,B,fa,sa,ta,Ka){function Oa(a,d,B,g,h,fa,sa,k){return B&&(b&&("linkTo"===c&&(e=b._jsvto=b._jsvto||[],e.push(E)),c&&!f||b.push(E.slice(d.length))),"."!==B)?(a=(g?'view.hlp("'+g+'")':h?"view":"data")+(k?(fa?"."+fa:g?"":h?"":"."+B)+(sa||""):(k=g?"":h?fa||"":B,"")),a+=k?"."+k:"",d+("view.data"===a.slice(0,9)?a.slice(5):a)):a}p=p||"";t=t||m||x;E=E||G;q=q||fa||"";if(!D||h||g)return!b||!B||h||g||c&&!f&&!e||(B=
H[u],Ka.length-1>ta-B&&(B=Ka.slice(B,ta+1),B=ha+":"+B+N,D=s[B],D||(s[B]=1,s[B]=D=oa(B,d||b,!0),D.paths.push({_jsvOb:D})),1!==D&&(e||b).push({_jsvOb:D}))),h?(h=!I,h?J:'"'):g?(g=!y,g?J:'"'):(t?(u++,H[u]=ta++,t):"")+(sa?u?"":(k=Ka.slice(k,ta),c?(c=f=e=!1,"\b"):"\b,")+k+(k=ta+J.length,"\b"):n?(u&&ea(a),c=E,f=r,k=ta+J.length,E+":"):E?E.split("^").join(".").replace(V,Oa)+(q?(l[++u]=!0,"."!==E.charAt(0)&&(H[u]=ta),q):p):p?p:F?(l[u--]=!1,F)+(q?(l[++u]=!0,q):""):w?(l[u]||ea(a),","):m?"":(h=I,g=y,'"'));ea(a)})}
function H(b,d,c){var e,f,g,h,k,s,l,u,J,m,t,r,E,p,D,n,q,G,w,x,I,y,F,N,z=0,B="",fa={},sa=b.length;""+d===d?(D=c?'data-link="'+d.replace(ia," ").slice(1,-1)+'"':d,d=0):(D=d.tmplName||"unnamed",d.allowCode&&(fa.allowCode=!0),d.debug&&(fa.debug=!0),t=d.bnds,p=d.tmpls);for(e=0;e<sa;e++)if(f=b[e],""+f===f)B+='\n+"'+f+'"';else if(g=f[0],"*"===g)B+=";\n"+f[1]+"\nret=ret";else{h=f[1];G=f[2];k=Ga(f[3],"params")+"},"+Ga(E=f[4]);F=f[5];N=f[6];w=f[8];(I="else"===g)||(z=0,t&&(r=f[7])&&(z=t.push(r)));(f=":"===g)?
h&&(g=h===K?">":h+g):(G&&(n=La(w,fa),n.tmplName=D+"/"+g,H(G,n),p.push(n)),I||(q=g,x=B,B=""),n=(n=b[e+1])&&"else"===n[0]);I=F?";\ntry{\nret+=":"\n+";if(f&&(r||N||h&&h!==K)){y="return {"+k+"};";F&&(y="try {\n"+y+"\n}catch(e){return {error: j._err(e,view,"+F+")}}\n");y=new Function("data,view,j,u"," // "+D+" "+z+" "+g+"\n"+y);y.paths=r;y._tag=g;if(c)return y;m=1}B+=f?(c?(F?"\ntry{\n":"")+"return ":I)+(m?(m=0,J=u=!0,'c("'+h+'",view,'+(r?(t[z-1]=y,z):"{"+k+"}")+")"):">"===g?(l=!0,"h("+E[0]+")"):"((v="+
E[0]+')!=null?v:"")'):(J=s=!0,"\n{view:view,tmpl:"+(G?p.length:"0")+","+k+"},");if(q&&!n){B="["+B.slice(0,-1)+"]";if(c||r)if(B=new Function("data,view,j,u"," // "+D+" "+z+" "+q+"\nreturn "+B+";"),r&&((t[z-1]=B).paths=r),B._tag=g,c)return B;B=x+I+'t("'+q+'",view,this,'+(z||B)+")";q=r=0}F&&(J=!0,B+=";\n}catch(e){ret"+(c?"urn ":"+=")+"j._err(e,view,"+F+");}\n"+(c?"":"ret=ret"))}B="// "+D+"\nj=j||"+(a?"jQuery.":"jsviews.")+"views;var v"+(s?",t=j._tag":"")+(u?",c=j._cnvt":"")+(l?",h=j.converters.html":
"")+(c?";\n":',ret=""\n')+(fa.debug?"debugger;":"")+B+(c?"\n":";\nreturn ret;");try{B=new Function("data,view,j,u",B)}catch(ta){ea("Compiled template code:\n\n"+B+'\n: "'+ta.message+'"')}d&&(d.fn=B);J||(B._nvw=!0);return B}function J(a,b){return a&&a!==b?b?k(k({},b),a):a:b&&k({},b)}function u(a){return ba[a]||(ba[a]="&#"+a.charCodeAt(0)+";")}function E(a){var b,d,c=[];if("object"===typeof a)for(b in a)(d=a[b])&&d.toJSON&&!d.toJSON()||m(d)||c.push({key:b,prop:d});return c}function D(a){return null!=
a?ca.test(a)&&(""+a).replace(qa,u)||a:""}if(!(a&&a.render||e.jsviews)){var r,t,G,xa,Ma,x="{",ha="{",N="}",z="}",O="^",V=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,Fa=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,ia=/[ \t]*(\r\n|\n|\r)/g,ga=/\\(['"])/g,
y=/['"\\]/g,M=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,T=/^if\s/,da=/<(\w+)[>\s]/,ca=/[\x00`><\"'&]/,Na=/^on[A-Z]|^convert(Back)?$/,qa=/[\x00`><"'&]/g,X=0,Ha=0,ba={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},K="html",W="data-jsv-tmpl",w={},Q={template:{compile:la},tag:{compile:aa},helper:{},converter:{}},I={jsviews:"v1.0.0-beta",settings:function(a){k(va,a);f(va._dbgMode);va.jsv&&va.jsv()},sub:{View:Z,Err:g,tmplFn:oa,cvt:q,
parse:s,extend:k,syntaxErr:ea,onStore:{},_lnk:b},map:ma,_cnvt:n,_tag:l,_err:ka};(g.prototype=Error()).constructor=g;R.depends=function(){return[this.get("item"),"index"]};Y.depends=function(){return["index"]};Z.prototype={get:Ja,getIndex:Y,getRsc:p,hlp:A,_is:"view"};for(t in Q)pa(t,Q[t]);var Ca=I.templates,na=I.converters,Ia=I.helpers,wa=I.tags,S=I.sub,va=I.settings;a?(r=a,r.fn.render=Aa,r.observable&&(k(S,r.views.sub),I.map=r.views.map)):(r=e.jsviews={},r.isArray=Array&&Array.isArray||function(a){return"[object Array]"===
Object.prototype.toString.call(a)});r.render=w;r.views=I;r.templates=Ca=I.templates;va({debugMode:f,delimiters:ja,onError:function(a,b,c){b&&(a=c===d?"{Error: "+a+"}":m(c)?c(a,b):c);return a==d?"":a},_dbgMode:!0});wa({"else":function(){},"if":{render:function(a){return this.rendering.done||!a&&(arguments.length||!this.tagCtx.index)?"":(this.rendering.done=!0,this.selected=this.tagCtx.index,this.tagCtx.render(this.tagCtx.view,!0))},onUpdate:function(a,b,d){var c;for(a=0;(c=this.tagCtxs[a])&&c.args.length;a++)if(c=
c.args[0],b=!c!==!d[a].args[0],!this.convert&&c||b)return b;return!1},flow:!0},"for":{render:function(a){var b,c=this.tagCtx,e="",f=0;if(!this.rendering.done){if(b=!arguments.length)a=c.view.data;a!==d&&(e+=c.render(a,b),f+=r.isArray(a)?a.length:1);if(this.rendering.done=f)this.selected=c.index}return e},flow:!0},include:{flow:!0},"*":{render:b,flow:!0}});wa("props",{baseTag:wa["for"],dataMap:ma(E)});na({html:D,attr:D,url:function(a){return a!=d?encodeURI(""+a):null===a?a:""}});ja()}})(this,this.jQuery);
(function(e,a,d){function b(a){return F(a)?new f(a):new c(a)}function c(a){this._data=a;return this}function f(a){this._data=a;return this}function g(a,b){a=F(a)?a:[a];var d,c,e=b,f=e,h=a.length,k=[];for(d=0;d<h;d++)c=a[d],P(c)?k=k.concat(g(c.call(b,b),b)):""+c!==c?(b=f=c,f!==e&&k.push(e=f)):(f!==e&&k.push(e=f),k.push(c));return k}function k(a,b){var d,c;for(d in a){c=!0;break}c||delete ra[b]}function m(a,b){if(!a.data||!a.data.off){var c,e,f,g=b.oldValue,h=b.value,k=a.data,l=k.observeAll,p=!k.cb.noArray,
n=k.paths;if(a.type===Aa)(k.cb.array||k.cb).call(k,a,b);else if(k.prop===b.path||"*"===k.prop)g=typeof g===la&&(n[0]||p&&F(g))&&g,h=typeof(h=b.value)===la&&(n[0]||p&&F(h))&&h,l?(c=l._path+"."+b.path,e=l.filter,f=[l.parents().slice()],g&&R(p,l.ns,[g],n,k.cb,!0,e,f,c),h&&R(p,l.ns,[h],n,k.cb,d,e,f,c)):(g&&R(p,[g],n,k.cb,!0),h&&R(p,[h],n,k.cb)),k.cb(a,b)}}function ja(){function c(b,d,e,f){var g,h=oa(w),k=F(w)?[w]:w;b=ca?b+"."+ca:b;if(A||f)h&&a(k).off(b,m);else{if(O=h&&a._data(w))for(N=(O=(O=O&&O.events)&&
O[e?Aa:pa])&&O.length;N--;)if((z=O[N].data)&&z.cb._cId===x._cId&&z.ns===ca){if(e)return;("*"===d&&z.prop!==d||z.prop===t)&&a(w).off(b,m)}d=e?{}:{fullPath:n,paths:d?[d]:[],prop:t};d.ns=ca;d.cb=x;T&&(d.observeAll={_path:T,path:function(){g=M.length;return T.replace(/[[.]/g,function(b){g--;return"["===b?"["+a.inArray(M[g-1],M[g]):"."})},parents:function(){return M},filter:da,ns:ca});a(k).on(b,null,d,m);ia&&(ia[a.data(w,"obId")||a.data(w,"obId",ka++)]=w)}}function e(a,b){a._ob=V(a,W);var d=W;return function(c,
e){var g=a._ob,h=b.length;typeof g===la&&(f(g,!0),(h||X&&F(g))&&R(X,[g],b,x,V,!0));g=a._ob=V(a,d);typeof g===la&&(f(g),(h||X&&F(g))&&R(X,[g],b,x,V,[d]));x(c,e)}}function f(a,e,g,h){if(X){var k=w,l=T;w=a;h&&(w=a[h],T+="."+h,da&&(w=b._fltr(h,a,T,da)));w&&(g||F(w))&&c(Aa+".observe"+(x?".obs"+(ha=x._cId=x._cId||ea++):""),d,!0,e);w=k;T=l}}var h,l,p,r,t,n,q,A,x,ha,N,z,O,V,aa,ia,ga,y,M,T,da,ca,Y,ma,X=!1!=this,ja=1,ba=Da,K=Array.apply(0,arguments);h=K.pop();var W=K.shift(),w=y=W,Q=K.length;W+""===W&&X&&(ca=
W,W=w=y=K.shift(),Q--);if(P(h))x=h;else if(h+""===h&&(T=h,M=K.pop(),da=K.pop(),h=K.pop(),Q-=3),!0===h?A=h:h&&(W=h,ja=0),h=K[Q-1],Q&&h===d||P(h))x=K.pop(),Q--;Q&&P(K[Q-1])&&(V=x,x=K.pop(),Q--);ba+=A?x?".obs"+x._cId:"":".obs"+(ha=x._cId=x._cId||ea++);A||(ia=ra[ha]=ra[ha]||{});Y=ca&&ca.match(La)||[""];for(ma=Y.length;ma--;)for(ca=Y[ma],F(y)?f(y,A,!0):A&&0===Q&&y&&c(ba,""),h=ga=0;h<Q;h++)if(n=K[h],""!==n){w=y;if(""+n===n){r=n.split("^");r[1]&&(ga=r[0].split(".").length,n=r.join("."),ga=n.split(".").length-
ga);if(V&&(aa=V(n,y))){Q+=aa.length-1;Z.apply(K,[h--,1].concat(aa));continue}r=n.split(".")}else ja&&!P(n)&&(n._jsvOb&&(y=e(n,K.slice(h+1)),y.noArray=!X,y._cId=x._cId,R(X,[W],K.slice(0,h),y,V),y=d,n=n._ob),w=n),y=n,r=[y];for(;w&&(t=r.shift())!==d;)if(typeof w===la){if(""+t===t){if(""===t)continue;if(r.length<ga+1&&!w.nodeType){if(!A&&(O=oa(w)&&a._data(w))){N=(O=(O=O.events)&&O[pa])&&O.length;for(p=0;N--;)!(z=O[N].data)||z.cb!==x||z.ns!==ca||z.prop!==t&&"*"!==z.prop||((l=r.join("."))&&z.paths.push(l),
p++);if(p){w=w[t];continue}}if("*"===t){!A&&O&&O.length&&c(ba,"",!1,!0);P(w)?(q=w.depends)&&R(X,[q],x,A||W):c(ba,"");for(l in w)f(w,A,d,l);break}else t&&c(ba+"."+t,r.join("."))}T&&(T+="."+t);t=w[t]}if(P(t)){(q=t.depends)&&R(X,[w],g(q,w),x,V,A||[W]);break}w=t}f(w,A)}ha&&k(ia,ha);return{cbId:ha,bnd:ia}}function Ja(){[].push.call(arguments,!0);return ja.apply(this,arguments)}function R(){var a=[].concat.apply([],arguments);return ja.apply(a.shift(),a)}function Y(a,b,d,c){a+""!==a&&(d=b,b=a,a="");n(a,
this._data,b,d,[],"root",c)}function A(a,b,d){Y.call(this,a,b,d,!0)}function n(a,c,e,f,g,h,k){function l(d,c){p=d.length;for(x=h+"[]";p--;)(A=b._fltr(p,d,x,f))&&n(a,A,e,f||"",g.slice(),x,c)}function m(b,d){h=b.data.observeAll._path;var c=g;g[0]!==b.target&&(g=g.slice(),g.unshift(b.target));switch(d.change){case "insert":l(d.items);break;case "remove":l(d.items,!0);break;case "refresh":l(d.oldItems,!0);l(b.target);break;case "set":x=h+"."+d.path,n(a,d.oldValue,e,0,g.slice(),x,!0),n(a,d.value,e,0,g.slice(),
x)}e.apply(this,arguments);g=c}var p,q,x,A;if(typeof c===la){q=F(c)?"":"*";g.unshift(c);if(e){if(q||0!==f)m._cId=e._cId=e._cId||ea++,ja(a,c,q,m,k,f,g.slice(),h)}else ja(a,c,q,d,k,f,g.slice(),h);if(q)for(p in c)"_"!==p.charAt(0)&&p!==aa&&(x=h+"."+p,(A=b._fltr(p,c,x,f))&&n(a,A,e,f||0,g.slice(),x,k));else l(c,k)}}function q(a,b,d){return 0>d.indexOf(".")&&0>d.indexOf("[")&&b[a]}if(!a)throw"jsViews/jsObservable require jQuery";if(!a.observable){e=a.views=a.views||{jsviews:"v1.0.0-alpha",sub:{}};var p=
e.sub,l=a.event.special,Z=[].splice,F=a.isArray,aa=a.expando,la="object",ma=parseInt,La=/\S+/g,pa=p.propChng=p.propChng||"propertyChange",Aa=p.arrChng=p.arrChng||"arrayChange",ra=p._cbBnds=p._cbBnds||{},Da=pa+".observe",P=a.isFunction,ka=1,ea=1,oa=a.hasData,Ga={};p.getDeps=function(){var a=arguments;return function(){for(var b,d,c=[],e=a.length;e--;)b=a[e--],(d=a[e])&&(c=c.concat(P(d)?d(b,b):d));return c}};a.observable=b;b._fltr=function(a,b,d,c){(a=c&&P(c)?c(a,b,d):b[a])&&(a=P(a)?a.set&&a.call(b):
a);return typeof a===la&&a};b.Object=c;b.Array=f;a.observe=b.observe=ja;a.unobserve=b.unobserve=Ja;b._apply=R;c.prototype={_data:null,observeAll:Y,unobserveAll:A,data:function(){return this._data},setProperty:function(a,b,c){var e,f=this._data;a=a||"";if(f)if(F(a))for(e=a.length;e--;)b=a[e],this.setProperty(b.name,b.value,c===d||c);else if(""+a!==a)for(e in a)this.setProperty(e,a[e],b);else if(a!==aa){for(a=a.split(".");f&&1<a.length;)f=f[a.shift()];f&&this._setProperty(f,a[0],b,c)}return this},removeProperty:function(a){this.setProperty(a,
Ga);return this},_setProperty:function(a,b,c,e){var f,g,h,k=b?a[b]:a;P(k)&&k.set&&(g=k,f=!0===k.set?k:k.set,k=k.call(a));if(k!==c||e&&k!=c)if(!(k instanceof Date)||k>c||k<c)f?(f.call(a,c),c=g.call(a)):(h=c===Ga)?(delete a[b],c=d):b&&(a[b]=c),this._trigger(a,{change:"set",path:b,value:c,oldValue:k,remove:h})},_trigger:function(b,d){a(b).triggerHandler(pa,d)}};f.prototype={_data:null,observeAll:Y,unobserveAll:A,data:function(){return this._data},insert:function(a,b){var d=this._data;1===arguments.length&&
(b=a,a=d.length);a=ma(a);-1<a&&a<=d.length&&(b=F(b)?b:[b],b.length&&this._insert(a,b));return this},_insert:function(a,b){var d=this._data,c=d.length;Z.apply(d,[a,0].concat(b));this._trigger({change:"insert",index:a,items:b},c)},remove:function(a,b){var c;c=this._data;a===d&&(a=c.length-1);a=ma(a);b=b?ma(b):0===b?0:1;-1<b&&-1<a&&(c=c.slice(a,a+b),(b=c.length)&&this._remove(a,b,c));return this},_remove:function(a,b,d){var c=this._data,e=c.length;c.splice(a,b);this._trigger({change:"remove",index:a,
items:d},e)},move:function(a,b,d){d=d?ma(d):0===d?0:1;a=ma(a);b=ma(b);if(0<d&&-1<a&&-1<b&&a!==b){var c=this._data.slice(a,a+d);(d=c.length)&&this._move(a,b,d,c)}return this},_move:function(a,b,d,c){var e=this._data,f=e.length;e.splice(a,d);e.splice.apply(e,[b,0].concat(c));this._trigger({change:"move",oldIndex:a,index:b,items:c},f)},refresh:function(a){var b=this._data.slice();this._refresh(b,a);return this},_refresh:function(a,b){var d=this._data,c=d.length;Z.apply(d,[0,d.length].concat(b));this._trigger({change:"refresh",
oldItems:a},c)},_trigger:function(b,d){var c=this._data,e=c.length,c=a([c]);c.triggerHandler(Aa,b);e!==d&&c.triggerHandler(pa,{change:"set",path:"length",value:e,oldValue:d})}};l[pa]=l[Aa]={remove:function(b){var d,c,e,f,g=b.data;if(g&&(g.off=1,g=g.cb)&&(d=ra[g._cId])){b=a._data(this).events[b.type];for(e=b.length;e--&&!c;)c=(f=b[e].data)&&f.cb===g;c||(delete d[a.data(this,"obId")],k(d,g._cId))}}};e.map=function(c){function e(a,d,f){var g,h=this;this.src&&this.unmap();"object"===typeof a&&(h.src=
a,h.tgt=f||h.tgt||[],h.options=d||h.options,h.update(),c.obsSrc&&b(h.src).observeAll(h.obs=function(a,b){g||(g=1,c.obsSrc(h,a,b),g=0)},h.srcFlt),c.obsTgt&&b(h.tgt).observeAll(h.obt=function(a,b){g||(g=1,c.obsTgt(h,a,b),g=0)},h.tgtFlt))}(e.prototype={srcFlt:c.srcFlt||q,tgtFlt:c.tgtFlt||q,update:function(b){a.observable(this.tgt).refresh(c.getTgt(this.src,this.options=b||this.options))},unmap:function(){this.src&&(this.obs&&a.observable(this.src).unobserveAll(this.obs,this.srcFlt),this.obt&&a.observable(this.tgt).unobserveAll(this.obt,
this.tgtFlt),this.src=d)},map:e,_def:c}).constructor=e;P(c)&&(c={getTgt:c});c.baseMap&&(c=a.extend({},c.baseMap,c));c.map=function(a,b,d){return new e(a,b,d)};return c}}})(this,this.jQuery);(function(e,a,d){function b(b,c,e){var f,g,h,k,l,p,n,q,r,C=b.target,s=C._jsvBnd,v=/&(\d+)\+?/g;if(s)for(;h=v.exec(s);)if(h=Ba[h[1]])if(c=h.to){h=h.linkCtx;n=h.view;r=h.tag;p=a(C);l=n.hlp(Q);q=n.hlp(I);g=m(C);f=Ra[g];e===d&&(e=ca(g)?g(C):f?p[f]():p.attr(g));f=c[1];c=c[0];f&&(k=ca(f)?f:n.getRsc("converters",f));
k&&(e=k.call(r,e));f=n.linkCtx;n.linkCtx=h;g={change:"change",oldValue:h._val,value:e};if(!(l&&!1===l.call(h,b,g)||r&&r.onBeforeChange&&!1===r.onBeforeChange(b,g)||e===d)&&(l=c[0],e!==d&&l)){l=l._jsvOb?l._ob:l;r&&(r._.chging=!0);X(l).setProperty(c[2]||c[1],e);q&&q.call(h,b,g);if(r){if(r.onAfterChange)r.onAfterChange(b,g);delete r._.chging}h._val=e}n.linkCtx=f}}function c(b,c,e){var g,h,k,l=this.data,p=this.elem,n=this.convert;h=p.parentNode;var q=this.view,r=q.linkCtx,s=q.hlp(Q);q.linkCtx=this;if(h&&
!(s&&c&&!1===s.call(this,b,c)||c&&"*"!==b.data.prop&&b.data.prop!==c.path)){c&&(this.eventArgs=c);if(c||this._initVal){delete this._initVal;h=e.call(q.tmpl,l,q,y);a:{var C=h,t=k=this.tag;g=this.attr||m(p,!0,n!==d);var v,u,w=t&&t.parentElem||this.elem;if(C!==d){u=a(w);g=t&&t.attr||g;ca(C)&&ha(this.expr+": missing parens");"visible"===g&&(g="css-display");if(t=/^css-/.test(g)&&g.slice(4))v=a.style(w,t),+C===C&&(v=parseInt(v));else if("link"!==g){if("value"===g)w.type===Ia&&(v=u.prop(g=na));else if(g===
wa)if(w.value===""+C)v=u.prop(na);else break a;v===d&&(v=(v=Ra[g])?u[v]():u.attr(g))}this._val=v}}if(h&&h.error!==d)h=h.error;else if(k){h=h[0]?h:[h];e=c&&k.onUpdate&&!1===k.onUpdate(b,c,h);ra(k,h);if(e||g===S){g===U&&k.onBeforeLink&&k.onBeforeLink();ma(k,k.tagCtx);R(this,l,p);q.linkCtx=r;return}if(k._.chging)return;h=":"===k.tagName?y._cnvt(k.cvt,q,h[0]):y._tag(k,q,q.tmpl,h,!0)}else e._tag&&(h=(n=""===n?va:n)?y._cnvt(n,q,h):y._tag(e._tag,q,q.tmpl,h,!0),k=this.tag,g=this.attr||g);f(h,this,g,k)&&c&&
(s=q.hlp(I))&&s.call(this,b,c);k&&ma(k,k.tagCtx)}R(this,l,p);q.linkCtx=r}}function f(b,c,f,g){var k,l,m,p,n,q,r=b!==d,t=c.data,C=g&&g.parentElem||c.elem,u=a(C),v=c.view;q=c._val;var w=v.ctx,y=v.linkCtx,x=g||f===U;g&&(g.parentElem=g.parentElem||c.expr||g._elCnt?C:C.parentNode,l=g._prv,m=g._nxt);if(r){if(/^css-/.test(f))"visible"===c.attr&&(c=(C.currentStyle||eb.call(e,C,"")).display,b?(b=C._jsvd||c,b!==S||(b=bb[k=C.nodeName])||(c=ga.createElement(k),ga.body.appendChild(c),b=bb[k]=(c.currentStyle||
eb.call(e,c,"")).display,ga.body.removeChild(c))):(C._jsvd=c,b=S)),(x=x||q!==b)&&a.style(C,f.slice(4),b);else if("link"!==f){if(f===na)n=1,b=b&&"false"!==b;else if(f===wa)if(C.value===""+b)b=!0,n=1,f=na;else{R(c,t,C);return}else if("selected"===f||"disabled"===f||"multiple"===f||"readonly"===f)b=b&&"false"!==b?f:null;if(k=Ra[f])if(f===U){v.linkCtx=c;v.ctx=c.ctx;if(g&&g._.inline){f=g.nodes(!0);if(g._elCnt){if(l&&l!==m)s(l,m,C,g._tgId,"^",!0);else if(p=C._dfr)q=g._tgId+"^",k=p.indexOf("#"+q)+1,n=p.indexOf("/"+
q),k&&0<n&&(k+=q.length,n>k&&(C._dfr=p.slice(0,k)+p.slice(n),H(p.slice(k,n))));l=l?l.previousSibling:m?m.previousSibling:C.lastChild}a(f).remove();if(g&&g.onBeforeLink)g.onBeforeLink();p=v.link(v.data,C,l,m,b,g&&{tag:g._tgId,lazyLink:g.tagCtx.props.lazyLink})}else{r&&u.empty();if(g&&g.onBeforeLink)g.onBeforeLink();r&&(p=v.link(t,C,l,m,b,g&&{tag:g._tgId}))}v.linkCtx=y;v.ctx=w}else{if(x=x||q!==b)if("text"===f&&C.children&&!C.children[0])C.textContent!==d?C.textContent=b:C.innerText=null===b?"":b;else u[k](b)}else if(x=
x||q!==b)u[n?"prop":"attr"](f,b!==d||n?b:null);c._val=b}return p||x}if(f===U&&g&&g.onBeforeLink)g.onBeforeLink()}function g(a,b){var c=this.hlp(Q),d=this.hlp(I);if(!c||!1!==c.call(this,a,b)){if(b){var c=b.index,e=b.items;switch(b.change){case "insert":this.addViews(c,e);break;case "remove":this.removeViews(c,e.length);break;case "move":this.refresh();break;case "refresh":this.refresh()}}d&&d.call(this,a,b)}}function k(b){var c,e=b.data,f=b._.bnd;if(!b._.useKey&&f){if(c=b._.bndArr)a([c[1]]).off(W,
c[0]),b._.bndArr=d;f!==!!f&&f._.inline?e?f._.arrVws[b._.id]=b:delete f._.arrVws[b._.id]:e&&(c=function(a){a.data&&a.data.off||g.apply(b,arguments)},a([e]).on(W,c),b._.bndArr=[c,e])}}function m(a,b,c){var d=a.nodeName.toLowerCase(),e=T.merge[d]||a.contentEditable===va&&{to:U,from:U};return e?b?"input"===d&&a.type===wa?wa:e.to:e.from:b?c?"text":U:""}function ja(b,c,e,f,g,h,k){var l,m,p,n=b.parentElem,q=b._prv,r=b._nxt,t=b._elCnt;q&&q.parentNode!==n&&ha("Missing parentNode");if(k)for(p in m=b.nodes(),
t&&q&&q!==r&&s(q,r,n,b._.id,"_",!0),b.removeViews(d,d,!0),f=r,t&&(q=q?q.previousSibling:r?r.previousSibling:n.lastChild),a(m).remove(),b._.bnds)P(p);else{if(c){l=f[c-1];if(!l)return!1;q=l._nxt}t?q=(f=q)?f.previousSibling:n.lastChild:f=q.nextSibling}c=e.render(g,h,b._.useKey&&k,b,k||c,!0);b.link(g,n,q,f,c,l)}function Ja(a,b,c){var e;c?(e="^`",b=b._.tag||{_:{inline:!0,bnd:c},tagCtx:{view:b},flow:!0},c=b._tgId,c||(Ba[c=cb++]=b,b._tgId=""+c)):(e="_`",ia[c=b._.id]=b);return"#"+c+e+(a!=d?a:"")+"/"+c+e}
function R(a,b,c){var e,f=a.tag,g=a.convertBack,h=[],k=a._bndId||""+cb++,l=a._hdlr;delete a._bndId;f&&(h=f.depends||h,h=ca(h)?f.depends(f):h,e=f.linkedElem);if(!a._depends||""+a._depends!==""+h)if(a._depends&&X._apply(!1,[b],a._depends,l,!0),b=X._apply(!1,[b],a.fn.paths,h,l,a._ctxCb),b.elem=c,b.linkCtx=a,b._tgId=k,c._jsvBnd=c._jsvBnd||"",c._jsvBnd+="&"+k,a._depends=h,a.view._.bnds[k]=k,Ba[k]=b,e&&(b.to=[[],g]),(e||g!==d)&&Aa(b,f&&f.convertBack||g),f){if(f.onAfterBind)f.onAfterBind(b);f.flow||f._.inline||
(c.setAttribute(ba,(c.getAttribute(ba)||"")+"#"+k+"^/"+k+"^"),f._tgId=""+k)}if(e&&e[0])for(f._.radio&&(e=e.children("input[type=radio]")),a=e.length;a--;)e[a]._jsvBnd=e[a]._jsvBnd||c._jsvBnd+"+",e[a]._jsvLnkdEl=f}function Y(a,b,c,d,e,f,g){return A(this,a,b,c,d,e,f,g)}function A(c,e,f,g,h,k,l,m){if(c&&e){e=e.jquery?e:a(e);D||(D=ga.body,a(D).on(w,b).on("blur","[contenteditable]",b));for(var n,p,t,s,C,u,v,x=Ja,y=g&&"replace"===g.target,A=e.length;A--;)if(v=e[A],""+c===c)C=r(v),n=C.ctx,C.ctx=g,q(c,v,
C,f),C.ctx=n;else{k=k||r(v);if(c.markup!==d)!1===k.link&&(g=g||{},g.link=x=!1),y&&(u=v.parentNode),t=c.render(f,g,h,k,d,x),u?(l=v.previousSibling,m=v.nextSibling,a.cleanData([v],!0),u.removeChild(v),v=u):(l=m=d,a(v).empty());else if(!0!==c)break;if(v._dfr&&!m){s=F(v._dfr,1,db);n=0;for(p=s.length;n<p;n++)C=s[n],(C=ia[C.id])&&C.data!==d&&C.parent.removeViews(C._.key,d,!0);v._dfr=""}k.link(f,v,l,m,t,d,g)}}return e}function n(b,c,e,f,h,m,n,p){function s(a,b,c,e,f,g,k,B,l,fa,sa,m,ta){var n,p="";if(ta)return C=
0,a;v=B||l||"";e=e||fa;c=c||m;ka&&!c&&(e||v||g)&&(ka=d,ya=oa.shift());if(e=e||c)C=0,ka=d,da&&(c||m?Wa[ya]||/;svg;|;math;/.test(";"+oa.join(";")+";")||(n="'<"+ya+".../"):Wa[e]?n="'</"+e:oa.length&&e===ya||(n="Mismatch: '</"+e),n&&Ta(n+">' in:\n"+h)),pa=za,ya=oa.shift(),za=Va[ya],fa=fa?"</"+fa+">":"",pa&&(ua+=Ea,Ea="",za?ua+="-":(p=fa+Za+"@"+ua+Ya+(sa||""),ua=Ga.shift()));za?(g?Ea+=g:b=fa||m||"",v&&(b+=v,Ea&&(b+=" "+ba+'="'+Ea+'"',Ea=""))):b=g?b+p+f+Za+g+Ya+k+v:p||a;C&&g&&Ta(" No {^{ tags within elem markup ("+
C+' ). Use data-link="..."');v&&(C=v,oa.unshift(ya),ya=v.slice(1),oa[0]&&oa[0]===jb[ya]&&ha("Parent of <tr> must be <tbody>"),ka=Wa[ya],(za=Va[ya])&&!pa&&(Ga.unshift(ua),ua=""),pa=za,ua&&za&&(ua+="+"));return b}function t(a,b){var e,f,h,B,sa=[];if(a){"@"===a._tkns.charAt(0)&&(b=L.previousSibling,L.parentNode.removeChild(L),L=d);for(G=a.length;G--;){E=a[G];h=E.ch;if(e=E.path)for(D=e.length-1;f=e.charAt(D--);)"+"===f?"-"===e.charAt(D)?(D--,b=b.previousSibling):b=b.parentNode:b=b.lastChild;if("^"===
h){if(v=Ba[e=E.id]){f=b&&(!L||L.parentNode!==b);if(!L||f)v.parentElem=b;E.elCnt&&f&&(b._dfr=(E.open?"#":"/")+e+h+(b._dfr||""));sa.push([f?null:L,E])}}else if(z=ia[e=E.id])(z.parentElem||(z.parentElem=b||L&&L.parentNode||c,z._.onRender=Ja,z._.onArrayChange=g,k(z)),f=z.parentElem,E.open)?(z._elCnt=E.elCnt,b?b._dfr="#"+e+h+(b._dfr||""):(z._prv||(f._dfr=l(f._dfr,"#"+e+h)),z._prv=L)):(!b||L&&L.parentNode===b?L&&(z._nxt||(f._dfr=l(f._dfr,"/"+e+h)),z._nxt=L):(b._dfr="/"+e+h+(b._dfr||""),z._nxt=d),y=z.linkCtx,
(B=z.ctx&&z.ctx.onAfterCreate||Ia)&&B.call(y,z))}for(G=sa.length;G--;)xa.push(sa[G])}return!a||a.elCnt}function u(a){var b,c;if(a)for(G=a.length,D=0;D<G;D++)if(E=a[D],S.id)S.id=S.id!==E.id&&S.id;else if(c=v=Ba[E.id].linkCtx.tag,!v.flow){if(!X){for(b=1;c=c.parent;)b++;ja=ja||b}!X&&b!==ja||Y&&v.tagName!==Y||W.push(v)}}function w(){I=Ua?c.querySelectorAll(O):a(O,c).get();H=I.length;e&&e.innerHTML&&(M=Ua?e.querySelectorAll(O):a(O,e).get(),e=M.length?M[M.length-1]:e);for(A=ja=0;A<H;A++)if(L=I[A],e&&!Aa)Aa=
L===e;else if(f&&L===f)break;else L.parentNode&&Ha(F(L,d,W&&ob))&&!S&&L.getAttribute(N)&&xa.push([L]);wa===Fa&&h===d&&c.getAttribute(N)&&xa.push([c]);aa(e,za);aa(f,za);if(!S){if(za&&ua+Ea&&(L=f,ua&&(f?t(F(ua+"+",1),f):t(F(ua,1),c)),t(F(Ea,1),c),f)){U=f.getAttribute(ba);if(H=U.indexOf(ra)+1)U=U.slice(H+ra.length-1);f.setAttribute(ba,Ea+U)}H=xa.length;for(A=0;A<H;A++)if(L=xa[A],J=L[1],L=L[0],J){if(v=Ba[J.id]){if(y=v.linkCtx)v=y.tag,v.linkCtx=y;J.open?(L&&(v.parentElem=L.parentNode,v._prv=L),v._elCnt=
J.elCnt,!v||v.onBeforeLink&&!1===v.onBeforeLink()||v._.bound||(v._.bound=!0,z=v.tagCtx.view,q(d,v._prv,z,b,J.id)),v._.linking=!0):(v._nxt=L,v._.linking&&(ca=v.tagCtx,z=ca.view,delete v._.linking,v._.bound||(v._.bound=!0,q(d,v._prv,z,b,J.id)),ma(v,ca)))}}else z=r(L),q(L.getAttribute(N),L,z,b,d,n)}qa&&qa.resolve()}var C,y,v,A,H,D,G,I,L,z,E,J,M,K,Q,R,P,W,X,Y,ca,da,ja,S,ea,Z,ya,ka,na,U,za,pa,Ea,ra,Aa,qa,wa=this,Da=wa._.id+"_",ua="",xa=[],oa=[],Ga=[],Ia=wa.hlp(Ca),Ha=t;m&&(qa=m.lazyLink&&a.Deferred(),
m.tmpl?Q="/"+m._.id+"_":(S=m.get,m.tag&&(Da=m.tag+"^",m=!0)),m=!0===m);S&&(Ha=u,W=S.tags,X=S.deep,Y=S.name);c=c?""+c===c?a(c)[0]:c.jquery?c[0]:c:wa.parentElem||ga.body;da=!T.noValidate&&c.contentEditable!==va;ya=c.tagName.toLowerCase();za=!!Va[ya];e=e&&la(e,za);f=f&&la(f,za)||null;if(h!=d){na=ea=ga.createElement("div");ra=Ea="";Z="http://www.w3.org/2000/svg"===c.namespaceURI?"svg_ns":(K=hb.exec(h))&&K[1]||"";x&&K&&K[2]&&ha("Unsupported: "+K[2]);if(za){for(P=f;P&&!(R=F(P));)P=P.nextSibling;if(U=R?
R._tkns:c._dfr){K=Q||"";if(m||!Q)K+="#"+Da;D=U.indexOf(K);D+1&&(D+=K.length,ra=Ea=U.slice(0,D),U=U.slice(D),R?P.setAttribute(ba,U):c._dfr=U)}}ka=d;h=(""+h).replace(lb,s);da&&oa.length&&Ta("Mismatched '<"+ya+"...>' in:\n"+h);if(p)return;ab.appendChild(ea);Z=V[Z]||V.div;m=Z[0];for(na.innerHTML=Z[1]+h+Z[2];m--;)na=na.lastChild;ab.removeChild(ea);for(ea=ga.createDocumentFragment();Z=na.firstChild;)ea.appendChild(Z);c.insertBefore(ea,f)}qa?setTimeout(w,0):w();return qa&&qa.promise()}function q(b,c,e,f,
g,h){var k,l,n,q,r,s,u,w;f=e.data===d?f||{}:e.data;if(g)h=Ba[g],h=h.linkCtx?h.linkCtx.tag:h,u=h.linkCtx||{data:f,elem:h._elCnt?h.parentElem:c,view:e,ctx:e.ctx,attr:U,fn:h._.bnd,tag:h,_bndId:g},p(u,u.fn);else if(b&&c)for(k=e.tmpl,n=m(c),b=a.trim(b).replace(ib,"\\$&"),b=b.slice(-1)!==xa?G+":"+b+(n?":":"")+xa:b,t.lastIndex=0;l=t.exec(b);)w=t.lastIndex,n=g?U:l[1],s=l[3],r=l[10],q=d,u={data:f,elem:c,view:e,ctx:h||e.ctx,attr:n,_initVal:!l[2]},l[6]&&(!n&&(q=/:([\w$]*)$/.exec(r))&&(q=q[1],q!==d&&(r=-q.length-
1,s=s.slice(0,r-1)+xa)),null===q&&(q=d),u.convert=l[5]||""),u.expr=n+s,(l=k.links[s])||(k.links[s]=l=M.tmplFn(s,k,!0,q)),u.fn=l,n||q===d||(u.convertBack=q),p(u,l),t.lastIndex=w}function p(a,b){function d(e,f){c.call(a,e,f,b)}d.noArray=!0;a._ctxCb=oa(a.view);a._hdlr=d;d(!0)}function l(a,b){var c;return a?(c=a.indexOf(b),c+1?a.slice(0,c)+a.slice(c+b.length):a):""}function Z(a){return a&&(""+a===a?a:"SCRIPT"===a.tagName?a.type.slice(3):1===a.nodeType&&a.getAttribute(ba)||"")}function F(a,b,c){function d(a,
b,c,g,h,k){f.push({elCnt:e,id:g,ch:h,open:b,close:c,path:k,token:a})}var e,f=[];if(b=b?a:Z(a))return f.elCnt=!a.type,e="@"===b.charAt(0)||!a.type,f._tkns=b,b.replace(c||pb,d),f}function aa(a,b){a&&("jsv"===a.type?a.parentNode.removeChild(a):b&&""===a.getAttribute(N)&&a.removeAttribute(N))}function la(a,b){for(var c=a;b&&c&&1!==c.nodeType;)c=c.previousSibling;c&&(1!==c.nodeType?(c=ga.createElement("SCRIPT"),c.type="jsv",a.parentNode.insertBefore(c,a)):Z(c)||c.getAttribute(N)||c.setAttribute(N,""));
return c}function ma(b,c){var e,f,g,h,k,l,m;e=c.view;var n=b.linkCtx=b.linkCtx||{tag:b,data:e.data,view:e,ctx:e.ctx};if(b.onAfterLink)b.onAfterLink(c,n);if(f=(e=b.targetTag?b.targetTag.linkedElem:b.linkedElem)&&e[0]){if(g=b._.radio)e=e.children("input[type=radio]");if(g||!b._.chging){h=M.cvt(b,b.convert)[0];if(g||f!==n.elem){for(m=e.length;m--;){f=e[m];k=f._jsvLnkdEl;if(b._.inline&&(!k||k!==b&&k.targetTag!==b))for(f._jsvLnkdEl=b,k=n.elem?n.elem._jsvBnd:b._prv._jsvBnd,f._jsvBnd=k+"+",k=k.slice(1).split("&"),
l=k.length;l--;)Aa(Ba[k[l]],b.convertBack);g&&(f[na]=h===f.value)}n._val=h}h!==d&&(g||f.value===d?f.contentEditable===va&&(f.innerHTML=h):f.type===Ia?f[na]=h&&"false"!==h:e.val(h))}}if(f=f||":"===b.tagName&&n.elem)g=f._jsvTr,h=c.props.trigger,g!==h&&(f._jsvTr=h,e=e||a(f),pa(e,g,"off"),pa(e,h,"on"))}function La(a){setTimeout(function(){b(a)},0)}function pa(a,c,d){c&&a[d](!0===c?"keydown":c,!0===c?La:b)}function Aa(a,b){var c,d,e,f,g,h=a.linkCtx,k=h.data,l=h.fn.paths;if(a){if(c=l._jsvto)l=c;for(d=l.length;d&&
""+(f=l[--d])!==f;);!f||h.tag&&!h.tag.tagCtx.args.length?a.to=[[],b]:(f=f.split("^").join("."),a.to="."===f.charAt(0)?[[g=l[d-1],f.slice(1)],b]:[h._ctxCb(e=d?l[0].split("^").join("."):f)||[k,e],b],c&&g&&(a.to[0][0]=h._ctxCb(g,k)))}}function ra(b,c){var d,e;d=b.tagCtx.view;var f=b.tagCtxs||[b.tagCtx],g=f.length,h=!c;for(c=c||b._.bnd.call(d.tmpl,(b.linkCtx||d).data,d,y);g--;)d=f[g],e=c[g],a.observable(d.props).setProperty(e.props),da(d.ctx,e.ctx),d.args=e.args,h&&(d.tmpl=e.tmpl);return f}function Da(a){for(var b,
c,d=[],e=b=a.length;e--;)d.push(a[e]);for(e=b;e--;)if(b=d[e],b.parentNode){if(c=b._jsvBnd)for(c=c.slice(1).split("&"),b._jsvBnd="",a=c.length;a--;)P(c[a],b._jsvLnkdEl,b);H(Z(b)+(b._dfr||""))}}function P(b,c,e){var f,g,h,k=Ba[b];if(c)e===c.linkedElem[0]&&(delete e._jsvLnkdEl,delete c.linkedElem);else if(k){delete Ba[b];for(f in k.bnd)c=k.bnd[f],e=".obs"+k.cbId,a.isArray(c)?a([c]).off(W+e).off(K+e):a(c).off(K+e),delete k.bnd[f];if(f=k.linkCtx){if(c=f.tag){if(e=c.tagCtxs)for(g=e.length;g--;)(h=e[g].map)&&
h.unmap();if(g=(e=(h=c.linkedElem)&&h[0]||f.elem)&&e._jsvTr)pa(h||a(e),g,"off"),e._jsvTr=d;if(c.onDispose)c.onDispose();c._elCnt||(c._prv&&c._prv.parentNode.removeChild(c._prv),c._nxt&&c._nxt.parentNode.removeChild(c._nxt))}delete f.view._.bnds[b]}delete M._cbBnds[k.cbId]}}function ka(c,e){c===d?(D&&(a(D).off(w,b).off("blur","[contenteditable]",b),D=d),c=!0,Fa.removeViews(),Da(ga.body.getElementsByTagName("*"))):e&&!0===c&&(e=e.jquery?e:a(e),e.each(function(){for(var a;(a=r(this,!0))&&a.parent;)a.parent.removeViews(a._.key,
d,!0);Da(this.getElementsByTagName("*"));Da([this])}));return e}function ea(a,b){return ka(this,a,b)}function oa(b){b=b||a.view();return function(a,c){var d,e,f=[c];if(b&&a){if(a._jsvOb)return a._jsvOb.call(b.tmpl,c,b,y);if("~"===a.charAt(0)){if("~tag"===a.slice(0,4)&&(e=b.ctx,"."===a.charAt(4)&&(d=a.slice(5).split("."),e=e.tag),d))return e?[e,d.join("."),c]:[];a=a.slice(1).split(".");if(c=b.hlp(a.shift()))a.length&&f.unshift(a.join(".")),f.unshift(c);return c?f:[]}if("#"===a.charAt(0))return"#data"===
a?[]:[b,a.replace(kb,""),c]}}}function Ga(a){return a.type===Ia?a[na]:a.value}function s(a,b,c,d,e,f){var g,h,k,m,n,p,q=0,r=a===b;if(a){k=F(a)||[];g=0;for(h=k.length;g<h;g++){m=k[g];p=m.id;if(p===d&&m.ch===e)if(f)h=0;else break;r||(n="_"===m.ch?ia[p]:Ba[p].linkCtx.tag,m.open?n._prv=b:m.close&&(n._nxt=b));q+=p.length+2}q&&a.setAttribute(ba,a.getAttribute(ba).slice(q));a=b?b.getAttribute(ba):c._dfr;if(h=a.indexOf("/"+d+e)+1)a=k._tkns.slice(0,q)+a.slice(h+(f?-1:d.length+1));a&&(b?b.setAttribute(ba,a):
c._dfr=a)}else c._dfr=l(c._dfr,"#"+d+e),f||b||(c._dfr=l(c._dfr,"/"+d+e))}function H(a){var b,c,e;if(e=F(a,1,mb))for(a=0,b=e.length;a<b;a++)c=e[a],"_"===c.ch?(c=ia[c.id])&&c.data!==d&&c.parent.removeViews(c._.key,d,!0):P(c.id)}function J(b,c,d){switch(d.change){case "set":b=b.tgt;for(c=b.length;c--&&b[c].key!==d.path;);-1===c?d.path&&a.observable(b).insert({key:d.path,prop:d.value}):d.remove?a.observable(b).remove(c):a.observable(b[c]).setProperty("prop",d.value)}}function u(b,c,d){b=b.src;switch(d.change){case "set":"prop"===
d.path?a.observable(b).setProperty(c.target.key,d.value):(a.observable(b).setProperty(d.oldValue,null),delete b[d.oldValue],a.observable(b).setProperty(d.value,c.target.prop));break;case "remove":c=d.items[0];a.observable(b).removeProperty(c.key);delete b[c.key];break;case "insert":c=d.items[0],c.key&&a.observable(b).setProperty(c.key,c.prop)}}function E(a,b,c){return 0>c.indexOf(".")&&b[a]}var D,r,t,G,xa,Ma,x,ha,N,z,O,V,Fa,ia,ga=e.document,y=a.views,M=y.sub,T=y.settings,da=M.extend,ca=a.isFunction,
Na=y.converters,qa=y.tags,X=a.observable,Ha=X.observe,ba="data-jsv",K=M.propChng=M.propChng||"propertyChange",W=M.arrChng=M.arrChng||"arrayChange",w="change.jsv",Q="onBeforeChange",I="onAfterChange",Ca="onAfterCreate",na="checked",Ia="checkbox",wa="radio",S="none",va="true",Ya='">\x3c/script>',Za='<script type="jsv',Qa="script,["+ba+"]",U="html",Ra={value:"val",input:"val",html:U,text:"text"},$a={from:"value",to:"value"},Sa=0,fb=a.cleanData,gb=T.delimiters,Ta=M.syntaxErr,hb=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,
ib=/['"\\]/g,ab=ga.createDocumentFragment(),Ua=ga.querySelector,Va={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},jb={tr:"table"},Wa={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},bb={},Ba={},cb=1,kb=/^#(view\.?)?/,lb=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,db=/(#)()(\d+)(_)/g,mb=/(#)()(\d+)([_^])/g,
nb=/(?:(#)|(\/))(\d+)(_)/g,ob=/(#)()(\d+)(\^)/g,pb=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,eb=e.getComputedStyle;if(!a)throw"JsViews requires jQuery";if(!a.views)throw"JsViews requires JsRender";if(!a.observable)throw"JsViews requires jquery.observable";a.link||(z={contents:function(b,c){b!==!!b&&(c=b,b=d);var e,f=a(this.nodes());f[0]&&(e=c?f.filter(c):f,f=b&&c?e.add(f.find(c)):e);return f},nodes:function(a,b,c){var d=this._elCnt,e=!b&&d,f=[];b=b||this._prv;c=c||this._nxt;for(b=e?b===this._nxt?this.parentElem.lastSibling:
b:!1===this._.inline?b||this.linkCtx.elem.firstChild:b&&b.nextSibling;b&&(!c||b!==c);)(a||d||"SCRIPT"!==b.tagName)&&f.push(b),b=b.nextSibling;return f},childTags:function(a,b){a!==!!a&&(b=a,a=d);var c=this.link?this:this.tagCtx.view,e=this._prv,f=this._elCnt,g=[];e&&c.link(d,this.parentElem,f?e.previousSibling:e,this._nxt,d,{get:{tags:g,deep:a,name:b,id:f&&this._tgId}});return g},refresh:function(a){var b,c=this.linkCtx,e=this.tagCtx.view;this.disposed&&ha("Removed tag");a===d&&(a=y._tag(this,e,e.tmpl,
ra(this),!0));a+""===a&&(b=this._.inline?U:c.attr||m(this.parentElem,!0),b=f(a,c,b,this));ma(this,this.tagCtx);return b||this},update:function(a){var c=this.linkedElem;c&&b({target:c[0]},d,a)}},M.onStore.template=function(b,c){c.link=Y;c.unlink=ea;b&&(a.link[b]=function(){return Y.apply(c,arguments)},a.unlink[b]=function(){return ea.apply(c,arguments)})},M.onStore.tag=function(a,b){M._lnk(b)},M._lnk=function(a){return da(a,z)},M.viewInfos=F,(T.delimiters=function(){var a=gb.apply(y,arguments);G=a[1];
xa=a[2];Ma=a[4];t=RegExp("(?:^|\\s*)([\\w-]*)(\\"+Ma+")?(\\"+G+M.rTag+"\\"+xa+")","g");return this})(),da(M._lnk(M.View.prototype),{addViews:function(a,b,c){var d,e=b.length,f=this.views;if(!this._.useKey&&e&&(c=this.tmpl)&&(d=f.length+e,!1!==ja(this,a,c,f,b,this.ctx)))for(a+=e;a<d;a++)X(f[a]).setProperty("index",a);return this},removeViews:function(b,c,e){function f(b){var c,g,h,l,n,p=m[b];if(p&&p.link){b=p._.id;e||(n=p.nodes());p.removeViews(d,d,!0);p.data=d;h=p._prv;l=p._nxt;g=p.parentElem;e||
(p._elCnt&&s(h,l,g,b,"_"),a(n).remove());if(!p._elCnt)try{h.parentNode.removeChild(h),l.parentNode.removeChild(l)}catch(q){}k(p);for(c in p._.bnds)P(c);delete ia[b]}}var g,h,l=!this._.useKey,m=this.views;l&&(h=m.length);if(b===d)if(l){for(g=h;g--;)f(g);this.views=[]}else{for(g in m)f(g);this.views={}}else if(c===d&&(l?c=1:(f(b),delete m[b])),l&&c){for(g=b+c;g-- >b;)f(g);m.splice(b,c);if(h=m.length)for(;b<h;)X(m[b]).setProperty("index",b++)}return this},refresh:function(a){var b=this.parent;b&&(ja(this,
this.index,this.tmpl,b.views,this.data,a,!0),k(this));return this},link:n}),ia={0:Fa=new M.View(d,"top")},Na.merge=function(a){var b,c=this.linkCtx._val||"",d=this.tagCtx.props.toggle;d&&(b=d.replace(/[\\^$.|?*+()[{]/g,"\\$&"),c=c.replace(RegExp("(\\s(?="+b+"$)|(\\s)|^)("+b+"(\\s|$))"),"$2"),a=c+(a?(c&&" ")+d:""));return a},qa("on",{attr:S,onAfterLink:function(b,c){for(var e,f,g=0,h=b.args,k=b.props.data,l=b.view,m=b.props.context;!ca(e=h[g++]););f=h.slice(g);h=h.slice(0,g-1);m||(m=(m=/^(.*)[\.^][\w$]+$/.exec(b.params.args.slice(-f.length-
1)[0]))&&M.tmplFn("{:"+m[1]+"}",l.tmpl,!0)(c.data,l));if(e){if(this._evs)this.onDispose();a(c.elem).on(this._evs=h[0]||"click",this._sel=h[1],k==d?null:k,this._hlr=function(a){return e.apply(m||c.data,[].concat(f,a,{change:a.type,view:l,linkCtx:c}))})}},onDispose:function(){a(this.parentElem).off(this._evs,this._sel,this._hlr)},flow:!0}),da(qa["for"],{onArrayChange:function(a,b){var c,d=b.change;if(this.tagCtxs[1]&&("insert"===d&&a.target.length===b.items.length||"remove"===d&&!a.target.length||"refresh"===
d&&!b.oldItems.length!==!a.target.length))this.refresh();else for(c in this._.arrVws)c=this._.arrVws[c],c.data===a.target&&c._.onArrayChange.apply(c,arguments);a.done=!0},onAfterLink:function(){var b,c,d,e,f=this,g=f._ars||{},h=f.tagCtxs,k=h.length,l=f.selected||0;for(b=0;b<=l;b++)c=h[b],e=c.map?c.map.tgt:c.args.length?c.args[0]:c.view.data,(d=g[b])&&e!==d[0]&&(Ha(d[0],d[1],!0),delete g[b]),!g[b]&&a.isArray(e)&&(Ha(e,c=function(a,b){f.onArrayChange(a,b)}),g[b]=[e,c]);for(b=l+1;b<k;b++)if(d=g[b])Ha(d[0],
d[1],!0),delete g[b];f._ars=g},onDispose:function(){for(var a in this._ars)Ha(this._ars[a][0],this._ars[a][1],!0)}}),da(qa["for"],z),da(qa["if"],z),da(qa.include,z),qa("props",{baseTag:qa["for"],dataMap:y.map({getTgt:qa.props.dataMap.getTgt,obsSrc:J,obsTgt:u,tgtFlt:E})}),da(a,{view:y.view=r=function(b,c,e){c!==!!c&&(e=c,c=d);var f,g,h,k,l,m;m=0;l=ga.body;if(b&&b!==l&&1<Fa._.useKey&&(b=""+b===b?a(b)[0]:b.jquery?b[0]:b))if(c)for(m=Ua?b.querySelectorAll(Qa):a(Qa,b).get(),l=m.length,b=0;b<l;b++)for(f=
m[b],g=F(f,d,db),h=0,k=g.length;h<k;h++){if(f=g[h],f=ia[f.id])if(f=f&&e?f.get(!0,e):f)return f}else for(;b;){if(g=F(b,d,nb))for(l=g.length;l--;)if(f=g[l],f.open){if(1>m)return(f=ia[f.id])&&e?f.get(e):f||Fa;m--}else m++;b=b.previousSibling||b.parentNode}return c?d:Fa},link:y.link=A,unlink:y.unlink=ka,cleanData:function(b){b.length&&Sa&&Da(b);fb.apply(a,arguments)}}),y.utility={validate:function(a){try{Fa.link(d,ga.createElement("div"),d,d,a,d,d,1)}catch(b){return b.message}}},da(a.fn,{link:function(a,
b,c,d,e,f,g){return A(a,this,b,c,d,e,f,g)},unlink:function(a){return ka(a,this)},view:function(a){return r(this[0],a)}}),a.each([U,"replaceWith","empty","remove"],function(b,c){var d=a.fn[c];a.fn[c]=function(){var a;Sa=1;try{a=d.apply(this,arguments)}finally{Sa=0}return a}}),da(Fa,{tmpl:{links:{},tags:{}}}),Fa._.onRender=Ja,T({wrapMap:V={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>",
"</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:N="data-link",merge:{input:{from:Ga,to:"value"},textarea:$a,select:$a,optgroup:{to:"label"}},jsrDbgMode:T.debugMode,debugMode:function(a){T.jsrDbgMode(a);a?e._jsv={views:ia,bindings:Ba}:delete e._jsv},jsv:function(){T.debugMode(T._dbgMode);
N=T.linkAttr;ha=y._err;O=Qa+",["+N+"]";x=T.noDomLevel0;V.optgroup=V.option;V.tbody=V.tfoot=V.colgroup=V.caption=V.thead;V.th=V.td}}))})(this,this.jQuery)}())},{}]},{},[1])(1)});
